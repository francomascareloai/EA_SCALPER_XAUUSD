study("Signal by risal",overlay=true)

source=hlc3

pulse(source)=>OUTPUT = iff ( source and not source[1], 1, 0 )
multifirefix(source)=>OUTPUT = fixnan ( source and not source[1] ? 1 : source[1] and not source ? 0 : na )
res1 = input(title="Hlc3 Time Frame", type=resolution, defval="1D")
test = input(1,"Hlc3 Shift")
sloma = input(20,"Slow EMA Period")

//Kaufman MA
Length = input(5, minval=1)
xPrice = input(close)
xvnoise = abs(xPrice - xPrice[1])
Fastend = input(1.7,step=.5)
Slowend = input(20)
nfastend = 2/(Fastend + 1)
nslowend = 2/(Slowend + 1)
nsignal = abs(xPrice - xPrice[Length])
nnoise = sum(xvnoise, Length)
nefratio = iff(nnoise != 1, nsignal / nnoise, 1)
nsmooth = pow(nefratio * (nfastend - nslowend) + nslowend, 2) 
nAMA = nz(nAMA[1]) + nsmooth * (xPrice - nz(nAMA[1]))
bha_close = security(tickerid, period, nAMA)
bmha_close = security(tickerid, res1, hlc3)
bfma = ema(bmha_close[test],1)
bsma = ema(bha_close,sloma)
up=bfma>bsma
down=bfma<bsma
bgcolor(up > 0 ? green : na, transp=90) 
bgcolor(down > 0 ? red : na, transp=80)
long =  crossover(bfma,bsma) and up
short =   crossunder(bfma,bsma) and down

plotshape(short, title="short", style=shape.labeldown,location=location.abovebar, color=#4a4a4a, transp=0, size=size.small, text = "Sell", textcolor = #ffffff)
plotshape(long,  title="long", style=shape.labelup,location=location.belowbar, color=green, transp=0, size=size.small, text = "Buy", textcolor = #ffffff)
alertcondition(long, title='go long', message='go long')
alertcondition(short, title='go short', message='go short')