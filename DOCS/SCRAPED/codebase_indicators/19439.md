# CEquityHstBar - library for MetaTrader 4

Source: https://www.mql5.com/en/code/19439

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/19439) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# CEquityHstBar - library for MetaTrader 4

[Ziheng Zhuang](/en/users/fxmeter)

Views:
:   8758

Rating:
:   (11)

Published:
:   20 November 2017, 09:19

Updated:
:   22 November 2017, 12:30
:   \MQL4\Include\

    [EquityHstBar.mqh](/en/code/download/19439/equityhstbar.mqh "EquityHstBar.mqh")
    (15.28 KB)
    [view](# "view")

    \MQL4\Experts\

    [test\_EquityHstBar.mq4](/en/code/download/19439/test_equityhstbar.mq4 "test_EquityHstBar.mq4")
    (3.92 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/19439.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

CEquityHstBar is the library for showing the equity of EA back-testing on an offline chart. The class is designed to write the equity data in back-testing into .hst file, and then show the equity on an offline chart.

The .hst file is in the \tester folder, call CopyFile() to copy it to the history folder, and then open it from "File" → "Open Offline".

* <Data folder>\tester\files\
* <Data folder>\history\account server\

### Usage

1. Create an instance of CEquityHstBar.
2. Call Update() in OnTick().
3. Call SaveData() in OnDeinit().
4. Call CopyFile() in OnDeinit().
5. Open the .hst file from "File" → "Open Offline".

```mql5
//+------------------------------------------------------------------+
//|                                            test_EquityHstBar.mq4 |
//|                                          Copyright 2017,fxMeter. |
//|                            https://www.mql5.com/en/users/fxmeter |
//+------------------------------------------------------------------+
#property copyright "Copyright 2017,fxMeter."
#property link      "https://www.mql5.com/en/users/fxmeter"
#property version   "1.00"
#property strict
#include <EquityHstBar.mqh>

//--- create an instance 
CEquityHstBar ebar("EquityBar",PERIOD_M30);

//--- or create an instance 
// CEquityHstBar ebar;  

int pt=1;
//+------------------------------------------------------------------+
//| Expert initialization function                                   |
//+------------------------------------------------------------------+
int OnInit()
  {
//---
   if(Digits()==5 || Digits==3)pt=10;
//---
   return(INIT_SUCCEEDED);
  }
//+------------------------------------------------------------------+
//| Expert deinitialization function                                 |
//+------------------------------------------------------------------+
void OnDeinit(const int reason)
  {
//---      
   ebar.SaveData();
   ebar.CopyFile();
  }
//+------------------------------------------------------------------+
//| Expert tick function                                             |
//+------------------------------------------------------------------+
void OnTick()
  {
//---
   ebar.Update();

   static double stoploss=20;   //Pips
   static double takeprofit=30; //Pips
   int tkt=-1;
   if(OrdersTotal()==0)
     {
      if(Hour()/2==0) tkt=OrderSend(Symbol(),0,0.1,Ask,10,Ask-stoploss*pt*Point,Ask+takeprofit*pt*Point);
      else tkt=OrderSend(Symbol(),1,0.1,Bid,10,Bid+stoploss*pt*Point,Bid-takeprofit*pt*Point);
     }
  }
//+------------------------------------------------------------------+
```

![](https://c.mql5.com/18/62/2017-11-17_145117.png)

**Last comments |
[Go to discussion](/en/forum/220380)**
(4)

![Mehmet Bastem](https://c.mql5.com/avatar/2019/12/5DED9647-6215.png "Mehmet Bastem")

**[Mehmet Bastem](/en/users/drbastem)**
|
3 Apr 2018 at 08:23

this systems is not work

![Hoang Tran](https://c.mql5.com/avatar/2018/4/5AC33751-73AA.jpg "Hoang Tran")

**[Hoang Tran](/en/users/tth0899487062)**
|
3 Apr 2018 at 08:31

**Mehmet Bastem:**  
 this systems is not work

![Hoang Tran](https://c.mql5.com/avatar/2018/4/5AC33751-73AA.jpg "Hoang Tran")

**[Hoang Tran](/en/users/tth0899487062)**
|
3 Apr 2018 at 08:32

.

![Mehmet Bastem](https://c.mql5.com/avatar/2019/12/5DED9647-6215.png "Mehmet Bastem")

**[Mehmet Bastem](/en/users/drbastem)**
|
12 Apr 2018 at 21:45

**Hoang Tran:**  
 .

How Do Mean ?.

this is T1 TMABands

![Self Optimizing RSI or MFI Trader](https://c.mql5.com/i/code/expert.png)
[Self Optimizing RSI or MFI Trader](/en/code/19392)

This robot optimizes the values it uses for overbought and oversold based on what would have been profitable during the Optimization periods(bars) back. Using the strategy of selling when the index indicator crosses below overbought and buying when the index indicator crosses above oversold.

![Multi Timeframe Triple Moving Averages](https://c.mql5.com/i/code/indicator.png)
[Multi Timeframe Triple Moving Averages](/en/code/19315)

This indicator allows you to see the Moving Averages from different timeframes on the same chart. It helps you to spot the dynamic levels of support and resistance. It uses a custom window with check boxes to show/hide the different Moving Averages without need to access the indicator settings window.

![SL&TP Values](https://c.mql5.com/i/code/indicator.png)
[SL&TP Values](/en/code/19479)

Indicator displays the value of defined stop loss and or take profit in the deposit currency.

![Center of Gravity Modification](https://c.mql5.com/i/code/indicator.png)
[Center of Gravity Modification](/en/code/19698)

Center of Gravity Modification 2018.