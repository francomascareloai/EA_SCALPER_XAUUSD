# Examples from the book "Neural networks for algorithmic trading with MQL5" - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/48097

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/48097) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Examples from the book "Neural networks for algorithmic trading with MQL5" - expert for MetaTrader 5

[MetaQuotes](/en/users/metaquotes)  |
[English](javascript:void(false);)

[Русский](/ru/code/48097) [中文](/zh/code/48097) [Español](/es/code/48097) [Deutsch](/de/code/48097) [日本語](/ja/code/48097) [Português](/pt/code/48097) [한국어](/ko/code/48097) [Français](/fr/code/48097) [Italiano](/it/code/48097) [Türkçe](/tr/code/48097)

Views:
:   39244

Rating:
:   (27)

Published:
:   29 February 2024, 13:32
:   \MQL5\Experts\NeuroNetworksBook\

    [ea\_template.mq5](/en/code/download/48097/ea_template.mq5 "ea_template.mq5")
    (14.59 KB)
    [view](# "view")

    \MQL5\Include\NeuroNetworksBook\about\_ai\activation\

    [activations.mqh](/en/code/download/48097/activations.mqh "activations.mqh")
    (12.64 KB)
    [view](# "view")

    [activations.py](/en/code/download/48097/activations.py "activations.py")
    (2.24 KB)
    [view](# "view")

    \MQL5\Include\NeuroNetworksBook\algotrading\

    [mult\_vect\_ocl.cl](/en/code/download/48097/mult_vect_ocl.cl "mult_vect_ocl.cl")
    (3.38 KB)

    [mult\_vect\_ocl.mqh](/en/code/download/48097/mult_vect_ocl.mqh "mult_vect_ocl.mqh")
    (8.09 KB)
    [view](# "view")

    \MQL5\Include\NeuroNetworksBook\realization\

    [activation.mqh](/en/code/download/48097/activation.mqh "activation.mqh")
    (57 KB)
    [view](# "view")

    [arraylayers.mqh](/en/code/download/48097/arraylayers.mqh "arraylayers.mqh")
    (13.92 KB)
    [view](# "view")

    [buffer.mqh](/en/code/download/48097/buffer.mqh "buffer.mqh")
    (36.65 KB)
    [view](# "view")

    [defines.mqh](/en/code/download/48097/defines.mqh "defines.mqh")
    (32.59 KB)
    [view](# "view")

    [layerdescription.mqh](/en/code/download/48097/layerdescription.mqh "layerdescription.mqh")
    (8.53 KB)
    [view](# "view")

    [lossfunction\_.mqh](/en/code/download/48097/lossfunction_.mqh "lossfunction_.mqh")
    (8.36 KB)
    [view](# "view")

    [neuronattention.mqh](/en/code/download/48097/neuronattention.mqh "neuronattention.mqh")
    (48.33 KB)
    [view](# "view")

    [neuronbase.mqh](/en/code/download/48097/neuronbase.mqh "neuronbase.mqh")
    (82.9 KB)
    [view](# "view")

    [neuronbatchnorm.mqh](/en/code/download/48097/neuronbatchnorm.mqh "neuronbatchnorm.mqh")
    (31.42 KB)
    [view](# "view")

    [neuronconv.mqh](/en/code/download/48097/neuronconv.mqh "neuronconv.mqh")
    (37.43 KB)
    [view](# "view")

    [neurondropout.mqh](/en/code/download/48097/neurondropout.mqh "neurondropout.mqh")
    (22.88 KB)
    [view](# "view")

    [neurongpt.mqh](/en/code/download/48097/neurongpt.mqh "neurongpt.mqh")
    (67.52 KB)
    [view](# "view")

    [neuronlstm.mqh](/en/code/download/48097/neuronlstm.mqh "neuronlstm.mqh")
    (56.07 KB)
    [view](# "view")

    [neuronmhattention.mqh](/en/code/download/48097/neuronmhattention.mqh "neuronmhattention.mqh")
    (42.97 KB)
    [view](# "view")

    [neuronnet.mqh](/en/code/download/48097/neuronnet.mqh "neuronnet.mqh")
    (64.88 KB)
    [view](# "view")

    [neuronproof.mqh](/en/code/download/48097/neuronproof.mqh "neuronproof.mqh")
    (29.8 KB)
    [view](# "view")

    [opencl.mqh](/en/code/download/48097/opencl.mqh "opencl.mqh")
    (20.19 KB)
    [view](# "view")

    [opencl\_program.cl](/en/code/download/48097/opencl_program.cl "opencl_program.cl")
    (113.76 KB)

    [positionencoder.mqh](/en/code/download/48097/positionencoder.mqh "positionencoder.mqh")
    (8.68 KB)
    [view](# "view")

    \MQL5\Scripts\NeuroNetworksBook\attention\

    [attention.py](/en/code/download/48097/attention.py "attention.py")
    (30.56 KB)
    [view](# "view")

    [attention\_test.mq5](/en/code/download/48097/attention_test.mq5 "attention_test.mq5")
    (21.34 KB)
    [view](# "view")

    [attention\_test2.mq5](/en/code/download/48097/attention_test2.mq5 "attention_test2.mq5")
    (21.39 KB)
    [view](# "view")

    \MQL5\Scripts\NeuroNetworksBook\batch\_norm\

    [batch\_norm.py](/en/code/download/48097/batch_norm.py "batch_norm.py")
    (23.79 KB)
    [view](# "view")

    [perceptron\_test\_norm.mq5](/en/code/download/48097/perceptron_test_norm.mq5 "perceptron_test_norm.mq5")
    (21.43 KB)
    [view](# "view")

    \MQL5\Scripts\NeuroNetworksBook\convolution\

    [check\_gradient\_conv.mq5](/en/code/download/48097/check_gradient_conv.mq5 "check_gradient_conv.mq5")
    (20.85 KB)
    [view](# "view")

    [convolution.py](/en/code/download/48097/convolution.py "convolution.py")
    (20.19 KB)
    [view](# "view")

    [convolution\_test.mq5](/en/code/download/48097/convolution_test.mq5 "convolution_test.mq5")
    (22.52 KB)
    [view](# "view")

    [convolution\_test2.mq5](/en/code/download/48097/convolution_test2.mq5 "convolution_test2.mq5")
    (23.29 KB)
    [view](# "view")

    [convolution\_test3.mq5](/en/code/download/48097/convolution_test3.mq5 "convolution_test3.mq5")
    (22.5 KB)
    [view](# "view")

    \MQL5\Scripts\NeuroNetworksBook\dropout\

    [dropout.py](/en/code/download/48097/dropout.py "dropout.py")
    (37.58 KB)
    [view](# "view")

    \MQL5\Scripts\NeuroNetworksBook\gpt\

    [gpt\_test.mq5](/en/code/download/48097/gpt_test.mq5 "gpt_test.mq5")
    (22.29 KB)
    [view](# "view")

    [gpt\_test\_not\_norm.mq5](/en/code/download/48097/gpt_test_not_norm.mq5 "gpt_test_not_norm.mq5")
    (27.5 KB)
    [view](# "view")

    \MQL5\Scripts\NeuroNetworksBook\initial\_data\

    [create\_initial\_data.mq5](/en/code/download/48097/create_initial_data.mq5 "create_initial_data.mq5")
    (16.34 KB)
    [view](# "view")

    [initial\_data.mq5](/en/code/download/48097/initial_data.mq5 "initial_data.mq5")
    (16.62 KB)
    [view](# "view")

    [initial\_data\_macd.mq5](/en/code/download/48097/initial_data_macd.mq5 "initial_data_macd.mq5")
    (10.1 KB)
    [view](# "view")

    [initial\_data\_macd\_pow.mq5](/en/code/download/48097/initial_data_macd_pow.mq5 "initial_data_macd_pow.mq5")
    (13.22 KB)
    [view](# "view")

    [initial\_data\_macd\_shift.mq5](/en/code/download/48097/initial_data_macd_shift.mq5 "initial_data_macd_shift.mq5")
    (9.9 KB)
    [view](# "view")

    [initial\_data\_rsi.mq5](/en/code/download/48097/initial_data_rsi.mq5 "initial_data_rsi.mq5")
    (11.8 KB)
    [view](# "view")

    [initial\_data\_rsi\_pow.mq5](/en/code/download/48097/initial_data_rsi_pow.mq5 "initial_data_rsi_pow.mq5")
    (9.92 KB)
    [view](# "view")

    [initial\_data\_rsi\_shift.mq5](/en/code/download/48097/initial_data_rsi_shift.mq5 "initial_data_rsi_shift.mq5")
    (9.47 KB)
    [view](# "view")

    \MQL5\Scripts\NeuroNetworksBook\

    [opencl\_test.mq5](/en/code/download/48097/opencl_test.mq5 "opencl_test.mq5")
    (6.65 KB)
    [view](# "view")

    [template.py](/en/code/download/48097/template.py "template.py")
    (9.03 KB)
    [view](# "view")

    \MQL5\Scripts\NeuroNetworksBook\perceptron\

    [check\_gradient\_percp.mq5](/en/code/download/48097/check_gradient_percp.mq5 "check_gradient_percp.mq5")
    (17.91 KB)
    [view](# "view")

    [perceptron.py](/en/code/download/48097/perceptron.py "perceptron.py")
    (19.39 KB)
    [view](# "view")

    [perceptron\_test.mq5](/en/code/download/48097/perceptron_test.mq5 "perceptron_test.mq5")
    (19.87 KB)
    [view](# "view")

    \MQL5\Scripts\NeuroNetworksBook\rnn\

    [check\_gradient\_lstm.mq5](/en/code/download/48097/check_gradient_lstm.mq5 "check_gradient_lstm.mq5")
    (15.29 KB)
    [view](# "view")

    [lstm.py](/en/code/download/48097/lstm.py "lstm.py")
    (27.64 KB)
    [view](# "view")

    [lstm\_test.mq5](/en/code/download/48097/lstm_test.mq5 "lstm_test.mq5")
    (21.07 KB)
    [view](# "view")

    [Expand (53)](javascript:void(false))
    [Collapse (53)](javascript:void(false))

    [Download as ZIP](/en/code/download/48097.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The book "[Neural networks for algorithmic trading with MQL5](/en/neurobook)" is your go-to guide for learning how to use machine learning and neural networks in trading. This book is intended for algorithmic traders who want to learn how to create trading strategies using advanced artificial intelligence techniques.   
   

The book has 7 chapters that cover everything you need to know to get started with neural networks and integrate them into your trading robots in MQL5. With easy-to-follow explanations, you will learn the basics of machine learning and will discover different types of neural networks, including convolutional and recurrent models, as well as more complex architectural solutions and attention mechanisms.

To assist you in integrating these solutions into your trading robots within the MQL5 environment, the book provides a plethora of practical examples. Additionally, the book explores various methods for improving model convergence, such as Batch Normalization and Dropout.

Furthermore, the author provides practical guidance on how to train neural networks and embed them into your trading strategies. You will learn how to create trading Expert Advisors to test the performance of trained models on new data, enabling you to evaluate their potential in real-world financial markets.

![](https://c.mql5.com/18/153/neural-network--ill-01.png)

"Neural networks for algorithmic trading with MQL5" is not just a book: it is a handy guide that can help you integrate advanced decision-making techniques into your trading algorithms and potentially improve financial results. Start learning the advanced capabilities of machine learning today and take your trading to the next level.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/48097](/ru/code/48097)

**Last comments |
[Go to discussion](/en/forum/463316)**
(38)

![ORTAYA KARIŞIK](https://c.mql5.com/avatar/avatar_na2.png "ORTAYA KARIŞIK")

**[ORTAYA KARIŞIK](/en/users/yilmazyucel068)**
|
10 Jun 2025 at 23:06

```mql5
//+------------------------------------------------------------------+
//|                                          Advanced FVG EA.mq5     |
//+------------------------------------------------------------------+
#property strict

input double Lots = 0.1;
input int TakeProfit = 200;
input int StopLoss = 200;
input int MaxLookback = 50;
input int Slippage = 5;
input int MagicNumber = 123456;
input double MaxSpreadPoints = 20.0; // Maksimum izin verilen spread
input int MA_Period = 50; // Trend filtresi
input int StartHour = 8;  // İşlem saat aralığı başlangıç
input int EndHour = 20;   // İşlem saat aralığı bitiş

//+------------------------------------------------------------------+
int OnInit()
  {
   Print("Advanced FVG EA başlatıldı.");
   return(INIT_SUCCEEDED);
  }
//+------------------------------------------------------------------+
void OnTick()
  {
   // Yeni bar kontrolü
   static datetime lastBarTime = 0;
   MqlRates candles[3];
   if(CopyRates(_Symbol, PERIOD_M5, 0, 3, candles) < 3) return;
   if(candles[0].time == lastBarTime) return;
   lastBarTime = candles[0].time;

   // Zaman filtresi
   int currentHour = TimeHour(TimeCurrent());
   if(currentHour < StartHour || currentHour >= EndHour) return;

   // Spread kontrolü
   double spread = (SymbolInfoDouble(_Symbol, SYMBOL_ASK) - SymbolInfoDouble(_Symbol, SYMBOL_BID)) / _Point;
   if(spread > MaxSpreadPoints) return;

   // Pozisyon kontrolü
   if(PositionSelect(_Symbol)) return;

   // Trend filtresi (MA)
   double ma = iMA(_Symbol, PERIOD_M5, MA_Period, 0, MODE_SMA, PRICE_CLOSE, 0);
   double price = SymbolInfoDouble(_Symbol, SYMBOL_BID);

   // FVG tespiti
   double fvgHigh = 0;
   double fvgLow = 0;
   bool isBullishFVG = false;
   bool isBearishFVG = false;

   MqlRates rates[];
   if(CopyRates(_Symbol, PERIOD_M5, 2, MaxLookback, rates) < 3) return;

   for(int i = 0; i < ArraySize(rates)-2; i++)
     {
      double high0 = rates[i].high;
      double low2 = rates[i+2].low;
      double low0 = rates[i].low;
      double high2 = rates[i+2].high;

      // Bullish FVG (sadece yükselen trendde aç)
      if(high0 < low2 && price > ma)
        {
         isBullishFVG = true;
         fvgHigh = low2;
         fvgLow = high0;
         break;
        }
      // Bearish FVG (sadece düşen trendde aç)
      else if(low0 > high2 && price < ma)
        {
         isBearishFVG = true;
         fvgHigh = low0;
         fvgLow = high2;
         break;
        }
     }

   double bid = SymbolInfoDouble(_Symbol, SYMBOL_BID);
   double ask = SymbolInfoDouble(_Symbol, SYMBOL_ASK);

   // İşlem açma
   if(isBullishFVG && bid <= fvgHigh && bid >= fvgLow)
     {
      trade_buy(ask);
     }
   else if(isBearishFVG && ask >= fvgLow && ask <= fvgHigh)
     {
      trade_sell(bid);
     }
  }
//+------------------------------------------------------------------+
void trade_buy(double price)
  {
   double sl = price - StopLoss * _Point;
   double tp = price + TakeProfit * _Point;

   MqlTradeRequest req = {};
   MqlTradeResult res  = {};

   req.action = TRADE_ACTION_DEAL;
   req.symbol = _Symbol;
   req.volume = Lots;
   req.type = ORDER_TYPE_BUY;
   req.price = price;
   req.sl = NormalizeDouble(sl, _Digits);
   req.tp = NormalizeDouble(tp, _Digits);
   req.deviation = Slippage;
   req.magic = MagicNumber;
   req.comment = "FVG Buy";

   if(OrderSend(req, res))
      Print("Buy order gönderildi: ", res.retcode);
   else
      Print("Buy order hatası: ", res.retcode);
  }
//+------------------------------------------------------------------+
void trade_sell(double price)
  {
   double sl = price + StopLoss * _Point;
   double tp = price - TakeProfit * _Point;

   MqlTradeRequest req = {};
   MqlTradeResult res  = {};

   req.action = TRADE_ACTION_DEAL;
   req.symbol = _Symbol;
   req.volume = Lots;
   req.type = ORDER_TYPE_SELL;
   req.price = price;
   req.sl = NormalizeDouble(sl, _Digits);
   req.tp = NormalizeDouble(tp, _Digits);
   req.deviation = Slippage;
   req.magic = MagicNumber;
   req.comment = "FVG Sell";

   if(OrderSend(req, res))
      Print("Sell order gönderildi: ", res.retcode);
   else
      Print("Sell order hatası: ", res.retcode);
  }
//+------------------------------------------------------------------+
```

![Aws Kyoma](https://c.mql5.com/avatar/2025/5/68291CCE-F5CA.png "Aws Kyoma")

**[Aws Kyoma](/en/users/awsrayyan)**
|
26 Jun 2025 at 22:24

When I use the gpt\_not\_norm.net after running the "gpt\_test\_not\_norm" script I get the following error  

" Error of Feed Forward: 0" in the [strategy tester](https://www.mql5.com/en/articles/239 "Article: The Fundamentals of Testing in MetaTrader 5 ")

I made sure to set the "BarsToLine" input variable to 40, which i used for collecting and for training the model.

if I used the "attention" script it works fine

![Ahmad Kazbar](https://c.mql5.com/avatar/2025/1/679c97cb-3dea.jpg "Ahmad Kazbar")

**[Ahmad Kazbar](/en/users/ahmadkz)**
|
22 Jul 2025 at 14:04

It is a great and very useful work, but there is a problem.(Error of load mode gpt\_not\_norm.net: 5008)Is there a solution for it?

![Leonil Gacote](https://c.mql5.com/avatar/2025/9/68BE20E1-46C7.jpg "Leonil Gacote")

**[Leonil Gacote](/en/users/onelgacote)**
|
2 Oct 2025 at 00:12

The power of traders most the Best

![lalmhommad raeisi](https://c.mql5.com/avatar/2025/11/690F7114-83F9.png "lalmhommad raeisi")

**[lalmhommad raeisi](/en/users/lalmhommadraeis)**
|
14 Nov 2025 at 16:10

خیلی خوب

![Local Timezones and Local Session Hours](https://c.mql5.com/i/code/library.png)
[Local Timezones and Local Session Hours](/en/code/48419)

Class to access to the local time for the specified location, as well as time zone information and the local trading session hours.

![Class For Working With Databases In A Simplified Manner](https://c.mql5.com/i/code/library.png)
[Class For Working With Databases In A Simplified Manner](/en/code/48362)

easydatabase

![Intraday Currencies Performance](https://c.mql5.com/i/code/indicator.png)
[Intraday Currencies Performance](/en/code/48524)

A simple observatory of individual currencies.

![Wick or Body High Low](https://c.mql5.com/i/code/indicator.png)
[Wick or Body High Low](/en/code/48612)

Searches for Wick or Body based High low in visible bars of chart