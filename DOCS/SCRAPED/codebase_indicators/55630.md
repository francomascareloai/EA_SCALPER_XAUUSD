# Calendar-Based Backtesting: an Event-Driven Trading EA - library for MetaTrader 5

Source: https://www.mql5.com/en/code/55630

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/55630) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# Calendar-Based Backtesting: an Event-Driven Trading EA - library for MetaTrader 5

[Peter Mueller](/en/users/mullerp04)  |
[English](javascript:void(false);)

[Русский](/ru/code/55630) [中文](/zh/code/55630) [Español](/es/code/55630) [Deutsch](/de/code/55630) [日本語](/ja/code/55630) [Português](/pt/code/55630) [한국어](/ko/code/55630) [Français](/fr/code/55630) [Italiano](/it/code/55630) [Türkçe](/tr/code/55630)

Views:
:   4133

Rating:
:   (4)

Published:
:   6 February 2025, 07:46

Updated:
:   29 July 2025, 14:12
:   [NewsBacktest.mq5](/en/code/download/55630/newsbacktest.mq5 "NewsBacktest.mq5")
    (15.54 KB)
    [view](# "view")

    [CalendarRetriever.mq5](/en/code/download/55630/calendarretriever.mq5 "CalendarRetriever.mq5")
    (2.16 KB)
    [view](# "view")

    \MQL5\Include\

    [CalendarFile.mqh](/en/code/download/55630/calendarfile.mqh "CalendarFile.mqh")
    (22.28 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/55630.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The code is full of comments for better understanding. This Description explains the main idea, and the ways to use/reuse the code. This framework consists of three key components:1. CalendarRetriever.mq5 (Script) – This script fetches past economic news events and saves them to files in the "Common" folder of your terminal. These files will later be read by the expert advisor during backtesting. The script requires two input parameters:

* Start Date – The date from which past news events should be retrieved.
* End Date – The last date for which news events should be stored

After running this script, it will generate a "Calendar" folder in the "Common" directory of the terminal the following text files will be then created:

* Countries.txt – Contains information about each MQLCalendarCountry
* Events.txt – Stores event details such as name, impact and countryid.
* News.bin – Holds historical news event values, including timestamps.

2. CalendarFile.mq (Include File) – This file provides a structured way to handle news data in the expert advisor. It contains two main classes:

* CalendarFileWriter – Used internally by the script to store news data.
* CalendarFileReader – Used in the expert advisor to read and process news data. It includes functions to load event data and track upcoming news in the OnTick function.

3. NewsBacktest.mq5 (Expert Advisor) – This EA uses the stored data to simulate real-time news conditions in the strategy tester. It reads the saved news data using the Load functions and executes trades accordingly. How to Use the Framework:

1. Run the CalendarRetriever Script:  Select the Symbol you'd like to backtest and run the CalendarRetriever.mq5 script, with the specified start and end date.
2. The Expert Advisor

   * The EA uses the CalendarFileReader class to load the data using these functions:
     + LoadEvents() – Loads event details.
     + LoadCountries() – Loads country information.
     + LoadValues() – Loads historical news values.
   * It then processes the news events in the OnTick function to determine when a news event is happening. Use Propagate() to predict, Track() to react.
   * The CalendarFileReader.Propagate() function will set the next index to the next upcoming event, this should be called on each tick.
   * The CalendarFileReader.Track() function returns true when a news event has passed and sets the last index to that particular event. Also called in the OnTick() function, but the result should be checked.
3. Backtest the Strategy Open the Strategy Tester in MetaTrader 5, Select NewsBacktest.mq5 and Run the Backtest in Visual Mode

How to Adapt It to Your Own News-Based Strategies:

This framework is designed to be flexible, allowing traders to develop their own strategies around economic news events. Here are some ways you can modify it:

* Adjust the event filtering logic in OnTick() to react to specific news types (e.g., only trade after NFP or CPI releases).
* Modify the order execution logic to implement different strategies, such as fading the initial move instead of breakout trading.
* Use additional indicators alongside news events to refine entry signals.
* Change the expiration time of pending orders based on event impact level.

This solution makes backtesting news-based strategies as realistic as possible within the limitations of MetaTrader 5. By first retrieving historical news data and then simulating its impact on the market, traders can gain valuable insights into how their strategies would perform in live conditions.

For easier and better understanding make sure to check out my video about it:

**[Go to discussion](/en/forum/480993)**

![Smart Trend Follower](https://c.mql5.com/i/code/expert.png)
[Smart Trend Follower](/en/code/53022)

This EA is designed to automatically follow market trends using signals from the Moving Average and Stochastic Oscillator indicators. The EA detects buy and sell signals by utilizing MA crossovers and confirms the trend with Stochastic. Additionally, the EA includes automatic position management, such as setting Take Profit, Stop Loss, and lot size doubling to enhance trading effectiveness in trending markets.

![Trade Assistant MT5](https://c.mql5.com/i/code/indicator.png)
[Trade Assistant MT5](/en/code/55521)

Trade Assistant MetaTrader indicator — a multi-timeframe indicator that is based on three standard indicators: Stochastic oscillator, RSI (Relative Strength Index), and CCI (Commodity Channel Index). It displays current trend directions for M1, M5, M15, M30, H1, H4, D1, W1, and MN1 timeframes. When you follow such an indicator you have a clear picture of the trends across all important timeframes. It doesn't matter which timeframe you attach this indicator to. The indicator can be downloaded for MT4 and MT5.

![Intrabar Volume Flow](https://c.mql5.com/i/code/indicator.png)
[Intrabar Volume Flow](/en/code/55923)

An indicator which visualizes how volume changes over time within each bar. It shows tick volume in a rolling histogram format.

![A 3 line script that tells you how many bars are on your chart](https://c.mql5.com/i/code/script.png)
[A 3 line script that tells you how many bars are on your chart](/en/code/55976)

A script which when dragged onto the chart will print out in the experts window the number of bars that are on that chart - like magic.