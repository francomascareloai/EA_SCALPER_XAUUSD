# Smart Trend Follower - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/53022

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/53022) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Smart Trend Follower - expert for MetaTrader 5

[Yulianto Hiu](/en/users/signalforex.id)  |
[English](javascript:void(false);)

[Русский](/ru/code/53022) [中文](/zh/code/53022) [Español](/es/code/53022) [Deutsch](/de/code/53022) [日本語](/ja/code/53022) [Português](/pt/code/53022) [한국어](/ko/code/53022) [Français](/fr/code/53022) [Italiano](/it/code/53022) [Türkçe](/tr/code/53022)

Views:
:   18128

Rating:
:   (12)

Published:
:   4 February 2025, 03:53
:   [Smart Trend Follower.mq5](/en/code/download/53022/smart_trend_follower.mq5 "Smart Trend Follower.mq5")
    (12.54 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/53022.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

1. **Enum Types (enumJnsSignal, enumOrderType)**

- **enumJnsSignal** This enum defines the type of signal used in the EA. There are two signal options:

- `eTypeCrossMA`: Uses the signal of **Cross 2 MA**(the crossing of two Moving Averages).

- `eTypeTrend`: Follows the **trend**using Moving Averages and Stochastic.

- **enumOrderType** This enum defines the type of order:

- `eBuy`: A **Buy**order.

- `eSell`: A **Sell**order.

- `eNone`: No order executed.

2. **Input Parameters**

- **inMagicNumber** A unique magic number used to distinguish orders from this EA.

- **inLotSize** The initial lot size for each order.

- **inMultiply** The multiplier factor used in the lot size strategy.

- **inJarakLayer** The pip distance between trading positions in the grid/layer strategy.

- **inMAPeriodFast & inMAPeriodSlow** The periods for fast and slow Moving Averages.

- **inSTOKPeriod, inSTODPeriod, inSTOSlowing** Parameters for the Stochastic Oscillator.

- **inTakeProfit & inStopLoss** The settings for Take Profit and Stop Loss.

3. **Struct dataTrades**

- This struct is used to store data related to open trading positions, such as the total number of positions (`ttlPos`), the average price of positions (`hargaTA`, `hargaTB`), and the total volume (`ttlLot`).

4. **OnInit() Function**

- This function handles the initialization of the EA, including validating input parameters (e.g., ensuring that the fast MA period is smaller than the slow MA period) and creating handles for the MA and Stochastic indicators.

5. **OnTick() Function**

- The main function executed every time the price moves (tick).

- It calls the function to check for a new signal with **GetSignal()**, and if a signal is found, **manageTrading()**is used to execute trades.

- It also calls **setTPSL()**to ensure that Take Profit and Stop Loss are always updated.

6. **isNewCandle() Function**

- This function detects whether a new candle has formed. This is important because the EA checks for signals only on new candle formations.

7. **GetSignal() Function**

- This function determines if a valid trading signal exists based on the selected strategy:

- For **eTypeCrossMA**, the signal is determined by the crossing of the fast and slow Moving Averages.

- For **eTypeTrend**, the signal uses confirmation from MA and Stochastic.

8. **manageTrading() Function**

- This function manages the execution of trades.

- If a valid signal is detected, the EA opens a position with the lot size determined using the **getLotSize()**function.

- A grid/layer strategy is also applied to open additional positions based on the price distance (`inJarakLayer`).

9. **updateDataTrades() Function**

- This function updates the data related to ongoing trading positions, such as calculating the average price and total volume of open positions.

10. **openTrade() Function**

- This function opens a new trading position based on the generated signal and calculated lot size. It uses **OrderSend()**to execute the order.

11. **setTPSL() Function**

- This function sets or updates the **Take Profit**and **Stop Loss**for each open position.

12. **modifTPSL() Function**

- This function modifies the **Take Profit**and **Stop Loss**of existing positions if the values differ from what has been previously set.

13. **validateLot() Function**

- This function ensures that the lot size used is within the allowed minimum and maximum range, as well as in line with the minimum lot step (`gLotStep`).

14. **getLotSize() Function**

- This function calculates the lot size to be used based on the initial lot size and the number of positions already opened, taking into account the multiplier factor (`inMultiply`).

This code is designed to capture market trends and manage trading positions automatically using technical signals from Moving Averages and Stochastic.

**Last comments |
[Go to discussion](/en/forum/480872)**
(10)

![testtestmio71](https://c.mql5.com/avatar/avatar_na2.png "testtestmio71")

**[testtestmio71](/en/users/testtestmio71)**
|
5 Feb 2025 at 17:57

this is the problem  gLotLimit= SymbolInfoDouble(Symbol(), [SYMBOL\_VOLUME\_LIMIT](https://www.mql5.com/en/docs/constants/environment_state/marketinfoconstants#enum_symbol_info_double "MQL5 documentation: Symbol properties"));

my broker answer 0......so i put 1 and is ok

![Cristian-bogdan Buzatu](https://c.mql5.com/avatar/avatar_na2.png "Cristian-bogdan Buzatu")

**[Cristian-bogdan Buzatu](/en/users/buza20)**
|
13 Mar 2025 at 22:36

I get this error when I try to run a [backtest](/en/articles/2612 "Article: Testing trading strategies on real ticks ") on XM:

2025.03.14 00:35:45.411 Core 01 2022.05.16 07:30:00   Error in CheckMoneyForTrade code=4002

Symbol is GOLD#, timeframe M15

![Gigantum Investment](https://c.mql5.com/avatar/2025/4/67f32046-c37b.png "Gigantum Investment")

**[Gigantum Investment](/en/users/mamat.alwis)**
|
14 Mar 2025 at 03:19

Please be aware if some EA is not using SL, u are the SL.

![Omotere Love](https://c.mql5.com/avatar/2023/5/646A8AE1-940A.png "Omotere Love")

**[Omotere Love](/en/users/omoterelove)**
|
15 May 2025 at 15:33

I have been on look out for a MA entry strategy, but I found this more reliable although did back test on EA a lot of DD but it make sense. I made some tweak on code by adding more functions and logic for robustness of the EA. Breakeven and Trailing to reduce losses, H4 and D1 is best TF to use

![jfmsf](https://c.mql5.com/avatar/2025/4/6800c372-f941.jpg "jfmsf")

**[jfmsf](/en/users/jfmsf)**
|
11 Jul 2025 at 14:04

**Ryan L Johnson [#](/en/forum/480872#comment_55825567):**  

According to [this Post](/en/forum/240549#comment_7233305) in another thread, a return statement is missing.

Note that the OP there said that it works on currency pairs only.

i got the same error in the pairs USDCAD andUSDJPY

2025.07.11 14:30:00.311 Smart Trend Follower (USDCAD,M15) Error in CheckMoneyForTrade code=4002

![Trade Assistant MT5](https://c.mql5.com/i/code/indicator.png)
[Trade Assistant MT5](/en/code/55521)

Trade Assistant MetaTrader indicator — a multi-timeframe indicator that is based on three standard indicators: Stochastic oscillator, RSI (Relative Strength Index), and CCI (Commodity Channel Index). It displays current trend directions for M1, M5, M15, M30, H1, H4, D1, W1, and MN1 timeframes. When you follow such an indicator you have a clear picture of the trends across all important timeframes. It doesn't matter which timeframe you attach this indicator to. The indicator can be downloaded for MT4 and MT5.

![Portable Moving Average](https://c.mql5.com/i/code/indicator.png)
[Portable Moving Average](/en/code/55622)

Calculate a moving average in one function call. Code that can easily be transported between different projects.

![Calendar-Based Backtesting: an Event-Driven Trading EA](https://c.mql5.com/i/code/library.png)
[Calendar-Based Backtesting: an Event-Driven Trading EA](/en/code/55630)

This Script & EA enables coders to backtest their news based strategies which use the MQL5 Calendar.

![Intrabar Volume Flow](https://c.mql5.com/i/code/indicator.png)
[Intrabar Volume Flow](/en/code/55923)

An indicator which visualizes how volume changes over time within each bar. It shows tick volume in a rolling histogram format.