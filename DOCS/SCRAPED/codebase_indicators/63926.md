# StopLoss trailing classes library for MQL5 - library for MetaTrader 5

Source: https://www.mql5.com/en/code/63926

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/63926) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# StopLoss trailing classes library for MQL5 - library for MetaTrader 5

[Artyom Trishkin](/en/users/artmedia70)  |
[English](javascript:void(false);)

[Русский](/ru/code/63926) [中文](/zh/code/63926) [Español](/es/code/63926) [Deutsch](/de/code/63926) [日本語](/ja/code/63926) [Português](/pt/code/63926) [한국어](/ko/code/63926) [Français](/fr/code/63926) [Italiano](/it/code/63926) [Türkçe](/tr/code/63926)

Views:
:   1514

Rating:
:   (5)

Published:
:   20 October 2025, 13:02
:   \MQL5\Include\Trailings\

    [Trailings.mqh](/en/code/download/63926/Trailings.mqh "Trailings.mqh")
    (107.4 KB)
    [view](# "view")

    \MQL5\Experts\Trailings\

    [MovingAverageWithSimpleTrail.mq5](/en/code/download/63926/MovingAverageWithSimpleTrail.mq5 "MovingAverageWithSimpleTrail.mq5")
    (18.02 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/63926.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Universal class library for implementing various StopLoss trailing strategies in trading robots. The library allows you to flexibly manage StopLoss of open positions by a fixed distance from the price, as well as by the values of popular indicators: Parabolic SAR, AMA, DEMA, FRAMA, MA, TEMA, VIDYA and arbitrary level.

The library provides a convenient way to add several types of different StopLoss trailing to your MQL5 Expert Advisor. Just plug in the required class, configure the parameters and call the Run() method in OnTick().

**Header**

```mql5
#include <Trailings\Trailings.mqh>
```

**Class Structure**

| Class | Purpose | Usage examples |
| --- | --- | --- |
| CSimpleTrailing | base class of price trailing (simple trailing) | ```mql5 //--- Connection  #include <Trailings\Trailings.mqh>  //--- Globally CSimpleTrailing trail;  //--- In OnInit(): trail.SetSymbol(_Symbol); trail.SetMagicNumber(123); trail.SetStopLossOffset(100); trail.SetActive(true);  //--- In OnTick(): trail.Run(); ``` |
| CTrailingByInd | base class of trailing by indicator | Used by inherited classes |
| CTrailingBySAR | trailing by Parabolic SAR indicator | ```mql5 //--- Connection  #include <Trailings\Trailings.mqh>  //--- Globally CTrailingBySAR trailSAR;  //--- In OnInit(): trailSAR.Initialize(_Symbol, PERIOD_M15, 0.02, 0.2); trailSAR.SetActive(true);  //--- In OnTick(): trailSAR.Run(); ``` |
| CTrailingByAMA | Trailing by Adaptive Moving Average | ```mql5 //--- Connection  #include <Trailings\Trailings.mqh>  //--- Globally CTrailingByAMA trailAMA;  //--- In OnInit(): trailAMA.Initialize(_Symbol, PERIOD_H1, 9, 2, 30, 0, PRICE_CLOSE); trailAMA.SetActive(true);  //--- In OnTick(): trailAMA.Run(); ``` |
| CTrailingByDEMA | Trailing Double Exponential Moving Average | ```mql5 //--- Connection  #include <Trailings\Trailings.mqh>  //--- Globally CTrailingByDEMA trailDEMA;  //--- In OnInit(): trailDEMA.Initialize(_Symbol, PERIOD_H1, 14, 0, PRICE_CLOSE); trailDEMA.SetActive(true);  //--- In OnTick(): trailDEMA.Run(); ``` |
| CTrailingByFRAMA | Fractal Adaptive Moving Average trailing | ```mql5 //--- Connection  #include <Trailings\Trailings.mqh>  //--- Globally CTrailingByFRAMA trailFRAMA;  //--- In OnInit(): trailFRAMA.Initialize(_Symbol, PERIOD_H1, 14, 0, PRICE_CLOSE); trailFRAMA.SetActive(true);  //--- In OnTick(): trailFRAMA.Run(); ``` |
| CTrailingByMA | Moving Average trailing | ```mql5 //--- Connection  #include <Trailings\Trailings.mqh>  //--- Globally CTrailingByMA trailMA;  //--- In OnInit(): trailMA.Initialize(_Symbol, PERIOD_H1, 20, 0, MODE_EMA, PRICE_CLOSE); trailMA.SetActive(true);  //--- In OnTick(): trailMA.Run(); ``` |
| CTrailingByTEMA | Trailing Triple Exponential Moving Average | ```mql5 //--- Connection  #include <Trailings\Trailings.mqh>  //--- Globally CTrailingByTEMA trailTEMA;  //--- In OnInit(): trailTEMA.Initialize(_Symbol, PERIOD_H1, 14, 0, PRICE_CLOSE); trailTEMA.SetActive(true);  //--- In OnTick(): trailTEMA.Run(); ``` |
| CTrailingByVIDYA | Trailing Variable Index Dynamic Average | ```mql5 //--- Connection  #include <Trailings\Trailings.mqh>  //--- Globally CTrailingByVIDYA trailVIDYA;  //--- In OnInit(): trailVIDYA.Initialize(_Symbol, PERIOD_H1, 9, 12, 0, PRICE_CLOSE); trailVIDYA.SetActive(true);  //--- In OnTick(): trailVIDYA.Run(); ``` |
| CTrailingByValue | trailing on a specified level | ```mql5 //--- Connection  #include <Trailings\Trailings.mqh>  //--- Globally CTrailingByValue trailValue;  //--- In OnInit(): trailValue.SetSymbol(_Symbol); trailValue.SetActive(true);  //--- In OnTick(): trailValue.Run(customSLBuy, customSLSell); ``` |

**Setting parameters:**

* **SetSymbol(symbol)** - setting the trading symbol;
* **SetMagicNumber(magic)** - set magic number;
* **SetStopLossOffset(offset)** - setting the StopLoss offset from the price/indicator;
* **SetTrailingStart(start)** - setting the minimum profit for trailing activation;
* **SetTrailingStep(step)** - setting the step of StopLoss movement;
* **SetSpreadMultiplier(value)** - setting the spread multiplier for StopLevel;
* **SetActive(flag)** - enable/disable trailing.

For indicator classes - additional indicator parameters (periods, price types, methods, etc.).

Here is an example of how the Parabolic SAR trawl connected to the standard Expert Advisor \MQL5\Experts\Advisors\ExpertMACD.mq5 works:

![](https://c.mql5.com/18/168/metatester64_XqxxNax39L.gif)

More details on the topic of these trawls can be found in the articles

1. [How to add Trailing Stop on Parabolic SAR indicator](/en/articles/14782)
2. [How to make any type of Trailing Stop and connect it to an Expert Advisor](/en/articles/14862)

**Trailings.mqh** is an easy way to add a trailing StopLoss to your MQL5 Expert Advisor.  
 Connect the necessary class, configure the parameters and call \*.Run() in OnTick.

If your EA has a cycle of enumerating its positions, you can call the Run() method of trailing with the ticket of the selected position:

```mql5
Run(const ulong pos_ticket);
```

In the common simple case, this would be so in the OnTick() handler:

```mql5
for(int i=PositionsTotal()-1; i>=0; i--) 
  { 
   trailing_simple.Run(PositionGetTicket(i)); 
  }
```

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/63926](/ru/code/63926)

![MACD Histogram MC](https://c.mql5.com/i/code/indicator.png)
[MACD Histogram MC](/en/code/65050)

MACD Histogram

![ZZVolatility](https://c.mql5.com/i/code/indicator.png)
[ZZVolatility](/en/code/50597)

Another ZigZag. ZigZag

![ConvertServerTime](https://c.mql5.com/i/code/library.png)
[ConvertServerTime](/en/code/65102)

Function to convert server time from one broker's time zone to another.

![Bollinger Bands Squeeze](https://c.mql5.com/i/code/indicator.png)
[Bollinger Bands Squeeze](/en/code/65117)

It signals a period of low market volatility that is about to end, foreshadowing a significant price move.