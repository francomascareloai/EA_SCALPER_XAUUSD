# How to Disable/Enable Auto/Algo-Trading in both MT5 and MT4. - script for MetaTrader 4

Source: https://www.mql5.com/en/code/39068

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/39068) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Scripts](https://c.mql5.com/i/code/script.png)

# How to Disable/Enable Auto/Algo-Trading in both MT5 and MT4. - script for MetaTrader 4

Sahil Bagdi

Published by:
:   [Sahil Bagdi](/en/users/sahilbagdi)

Views:
:   12564

Rating:
:   (33)

Published:
:   21 April 2022, 07:38
:   [Empty File.mq4](/en/code/download/39068/empty_file.mq4 "Empty File.mq4")
    (0.87 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/39068.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

MT4:

```mql5
//--- importing required dll files
#include <WinUser32.mqh>
#import "user32.dll"
int GetAncestor(int, int);
#define MT4_WMCMD_EXPERTSÂ Â 33020
#import

//+------------------------------------------------------------------+
//|Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |
//+------------------------------------------------------------------+
void SetAlgoTradingTo(bool trueFalse) {
Â Â Â Â //--- getting the current status
Â Â Â Â bool currentStatus = IsTradeAllowed();
Â Â Â Â //--- if the current status is equal to input trueFalse then, no need to toggle auto-trading
Â Â Â Â if(currentStatus != trueFalse) {
Â Â Â Â Â Â Â Â //--- Toggle Auto-Trading
Â Â Â Â Â Â Â Â int main = GetAncestor(WindowHandle(Symbol(), Period()), 2/*GA_ROOT*/);
Â Â Â Â Â Â Â Â PostMessageA(main, WM_COMMAND,Â Â MT4_WMCMD_EXPERTS, 0 );//Toggle Expert Advisor button
Â Â Â Â }
}
```

MT5:

```mql5
//--- importing required dll files
#define MT_WMCMD_EXPERTSÂ Â  32851
#define WM_COMMAND 0x0111
#define GA_ROOTÂ Â Â Â 2
#include <WinAPI\winapi.mqh>

//+------------------------------------------------------------------+
//| Toggle auto-trading buttonÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
//+------------------------------------------------------------------+
void AlgoTradingStatus(bool newStatus_True_Or_False) {
Â Â Â Â //--- getting the current status
Â Â Â Â bool currentStatus = (bool) TerminalInfoInteger(TERMINAL_TRADE_ALLOWED);
Â Â Â Â //--- if the current status is equal to input trueFalse then, no need to toggle auto-trading
Â Â Â Â if(trueFalse != newStatus_True_Or_False) {
Â Â Â Â Â Â Â Â //--- Toggle Auto-Trading
Â Â Â Â Â Â Â Â HANDLE hChart = (HANDLE) ChartGetInteger(ChartID(), CHART_WINDOW_HANDLE);
Â Â Â Â Â Â Â Â PostMessageW(GetAncestor(hChart, GA_ROOT), WM_COMMAND, MT_WMCMD_EXPERTS, 0);
Â Â Â Â }
}
//+------------------------------------------------------------------+
```

**Last comments |
[Go to discussion](/en/forum/399347)**
(7)

![Noiros Tech](https://c.mql5.com/avatar/2019/3/5C83117D-29AF.PNG "Noiros Tech")

**[Nesimeye Oswald](/en/users/oswoil)**
|
17 Oct 2024 at 21:26

If you getting any error about event handling function or getting an error , use these two codes below

MT4

> ```mql5
> //--- importing required dll files
> #include <WinUser32.mqh>
> #import "user32.dll"
> int GetAncestor(int, int);
> #define MT4_WMCMD_EXPERTSÂ Â 33020
> #import
> //+------------------------------------------------------------------+
> //|Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |
> //+------------------------------------------------------------------+
> void SetAlgoTradingTo(bool trueFalse) {
> Â Â Â Â //--- getting the current status
> Â Â Â Â bool currentStatus = IsTradeAllowed();
> Â Â Â Â //--- if the current status is equal to input trueFalse then, no need to toggle auto-trading
> Â Â Â Â if(currentStatus != trueFalse) {
> Â Â Â Â Â Â Â Â //--- Toggle Auto-Trading
> Â Â Â Â Â Â Â Â int main = GetAncestor(WindowHandle(Symbol(), Period()), 2/*GA_ROOT*/);
> Â Â Â Â Â Â Â Â PostMessageA(main, WM_COMMAND,Â Â MT4_WMCMD_EXPERTS, 0 );//Toggle Expert Advisor button
> Â Â Â Â }
> }
> //======================================================================
> input bool EnableAlgoTrading=false;
> //--------------------------------------------------------------
> int OnInit()
> Â Â {
>  SetAlgoTradingTo(EnableAlgoTrading);
> Â Â  return(INIT_SUCCEEDED);
> Â Â }
> //-------------------------------------------------------------Â Â 
> void OnTick()
> Â Â {
> Â Â // You can also call it from the OnTick function , just delete the first two forward slash below :
> Â Â 
> Â Â // SetAlgoTradingTo(EnableAlgoTrading);
> Â Â 
> Â Â }
> ```

MT5

> ```mql5
> //+------------------------------------------------------------------+
> //|Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â EnableDisableAlgo_Trading.mq5 |
> //|Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Copyright 2024, MetaQuotes Ltd. |
> //|Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  https://www.mql5.com |
> //+------------------------------------------------------------------+
> //--- importing required dll files
> #define MT_WMCMD_EXPERTSÂ Â  32851
> #define WM_COMMAND 0x0111
> #define GA_ROOTÂ Â Â Â 2
> #include <WinAPI\winapi.mqh>
> //+------------------------------------------------------------------+
> //| Toggle auto-trading buttonÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
> //+------------------------------------------------------------------+
> void AlgoTradingStatus(bool newStatus_True_Or_False) {
> Â Â Â Â //--- getting the current status
> Â Â Â Â bool currentStatus = (bool) TerminalInfoInteger(TERMINAL_TRADE_ALLOWED);
> Â Â Â Â //--- if the current status is equal to input trueFalse then, no need to toggle auto-trading
> Â Â Â Â if(currentStatus != newStatus_True_Or_False) {
> Â Â Â Â Â Â Â Â //--- Toggle Auto-Trading
> Â Â Â Â Â Â Â Â HANDLE hChart = (HANDLE) ChartGetInteger(ChartID(), CHART_WINDOW_HANDLE);
> Â Â Â Â Â Â Â Â PostMessageW(GetAncestor(hChart, GA_ROOT), WM_COMMAND, MT_WMCMD_EXPERTS, 0);
> Â Â Â Â }
> }
> //-------------------------------------------------------------------------------------
> //-------------------------------------------------------------------------------------
> //+------------------------------------------------------------------+
> #property copyright "Copyright 2024, MetaQuotes Ltd."
> #property linkÂ Â Â Â Â Â "https://www.mql5.com"
> #property versionÂ Â  "1.00"
> //+------------------------------------------------------------------+
> //| Expert initialization functionÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
> //+------------------------------------------------------------------+
> input bool EnabAlgoTrading=false;
> int OnInit()
> Â Â {
> //---
> Â Â  AlgoTradingStatus(EnabAlgoTrading);
> Â Â 
>  
> //---
> Â Â  return(INIT_SUCCEEDED);
> Â Â }
> //+------------------------------------------------------------------+
> //| Expert deinitialization functionÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
> //+------------------------------------------------------------------+
> void OnDeinit(const int reason)
> Â Â {
> //---
> Â Â  
> Â Â }
> //+------------------------------------------------------------------+
> //| Expert tick functionÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  |
> //+------------------------------------------------------------------+
> void OnTick()
> Â Â {
> // You can also call it from the OnTick function , just delete the first two forward slash below :
> Â Â 
> Â Â // AlgoTradingStatus(EnabAlgoTrading);
> Â Â  
> Â Â }
> //+------------------------------------------------------------------+
> ```

![Gabriela Soldati](https://c.mql5.com/avatar/2025/2/67A41AE3-A6B5.png "Gabriela Soldati")

**[Gabriela Soldati](/en/users/gabysoldati)**
|
21 Feb 2025 at 11:34

Excellent app

![Token Hunter](https://c.mql5.com/avatar/2025/2/67A12DAE-B3D3.png "Token Hunter")

**[Token Hunter](/en/users/tokenhunter)**
|
22 Feb 2025 at 03:51

**Automated-Trading:**  

[How to Disable/Enable Auto/Algo-Trading in both MT5 and MT4.](/en/code/39068):

Author: [Kailash Bai Mina](https://www.mql5.com/en/users/SahilBagdi "SahilBagdi")

I want to enable algo trading and I have mt5 real account, so please help me step wise to start algo trading ğŸ™

![Nino Guevara Ruwano](https://c.mql5.com/avatar/2022/1/61D47E25-F2EF.jpg "Nino Guevara Ruwano")

**[Nino Guevara Ruwano](/en/users/ninoguevara)**
|
27 Mar 2025 at 00:21

Good jobÂ ğŸ‘ğŸ»  
It's helpful, thanks a lot bro! :-)

![felix olang](https://c.mql5.com/avatar/2024/12/67667025-22F2.png "felix olang")

**[felix olang](/en/users/felixolang)**
|
29 Jun 2025 at 22:04

How can I in stall auto trading in [real account](https://www.mql5.com/en/docs/constants/environment_state/accountinformation#enum_account_trade_mode "MQL5 documentation: Account Properties")

![Account History Export](https://c.mql5.com/i/code/script.png)
[Account History Export](/en/code/38975)

Export the history of transactions on the MT4 trading account.

![ADXm (experiment)](https://c.mql5.com/i/code/indicator.png)
[ADXm (experiment)](/en/code/39028)

ADXm experiment (metatrader 4 versions)

![Listing all MT4 Signals' properties to a CSV file](https://c.mql5.com/i/code/script.png)
[Listing all MT4 Signals' properties to a CSV file](/en/code/39087)

This simple quick & dirty script code will output a CSV file of all the Signals' properties as reported by the MQL4 Trade Signals functionality.

![Detecting the start of a new bar or candle](https://c.mql5.com/i/code/expert.png)
[Detecting the start of a new bar or candle](/en/code/39104)

Detecting the start of a new bar or candle, in the OnTick() event handler of an expert advisor.