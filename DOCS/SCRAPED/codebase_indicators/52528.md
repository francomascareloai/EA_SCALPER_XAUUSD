# Panel for Calculating History Profit - script for MetaTrader 5

Source: https://www.mql5.com/en/code/52528

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/52528) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Scripts](https://c.mql5.com/i/code/script.png)

# Panel for Calculating History Profit - script for MetaTrader 5

[Sergey Porphiryev](/en/users/snail000)  |
[English](javascript:void(false);)

[Русский](/ru/code/52528) [中文](/zh/code/52528) [Español](/es/code/52528) [Deutsch](/de/code/52528) [日本語](/ja/code/52528) [Português](/pt/code/52528) [한국어](/ko/code/52528) [Français](/fr/code/52528) [Italiano](/it/code/52528) [Türkçe](/tr/code/52528)

Views:
:   2117

Rating:
:   (4)

Published:
:   17 April 2025, 08:44
:   [CalculateHistoryProfit.mq5](/en/code/download/52528/calculatehistoryprofit.mq5 "CalculateHistoryProfit.mq5")
    (0.45 KB)
    [view](# "view")

    \MQL5\Include\Snail000\

    [CalculateHistoryProfit.mqh](/en/code/download/52528/calculatehistoryprofit.mqh "CalculateHistoryProfit.mqh")
    (50.45 KB)
    [view](# "view")

    \MQL5\Libraries\

    [MtGuiController.zip](/en/code/download/52528/mtguicontroller.zip "MtGuiController.zip")
    (12.03 KB)

    [Download as ZIP](/en/code/download/52528.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This CalculateHistoryProfit script version 1.0 is designed to calculate profits for a specified period using a graphical panel loaded from the external library [MtGuiController.dll](/en/articles/6549). Main features:

* User can select date range, symbols and magic numbers through the graphical panel.
* The script counts the total profit and number of trades based on the selected filters (symbols, magic numbers).
* The results are displayed on the graphical panel including profit and number of trades.
* The script supports preset buttons for quick selection of dates (today, week, month, year).

Suitable for traders who need to quickly evaluate the historical performance of trades by selected parameters.  
**I made it for myself to make it easier to understand which Expert Advisors traded how (several Expert Advisors work on the same demo account, with a fixed lot). Later I want to add here the recalculation of the maximum drawdown for the reporting period...**  
  
 After installation, you need to manually remove the first line in the file Include\Snail000\CalculateHistoryProfit.mqh

[![](https://c.mql5.com/18/162/5234044246735__1.png)](https://c.mql5.com/18/162/5234044246735.png "https://c.mql5.com/18/156/5234044246735.png")

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/52528](/ru/code/52528)

**Last comments |
[Go to discussion](/en/forum/485110)**
(3)

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
4 Oct 2024 at 07:36

```mql5
    //+------------------------------------------------------------------+
    //| Calculate total profit and deal count for the selected period |
    //+------------------------------------------------------------------+
    void CalculateProfit()
    {
       total_profit = 0;
       total_deals = 0;
      
       HistorySelect(0, TimeCurrent());
       int total_orders = HistoryDealsTotal();
  
       for (int i = total_orders - 1; i >= 0; i--)
       {
           ulong deal_ticket = HistoryDealGetTicket(i);
           datetime deal_time = (datetime)HistoryDealGetInteger(deal_ticket, DEAL_TIME); // Why isn't this line lower than the next?
           if (HistoryDealGetInteger(deal_ticket, DEAL_ENTRY) != 1) continue; // What about CloseBy deals and IN-commission?
  
           if (deal_time >= start_date && deal_time <= end_date) // Why not HistorySelect?
           {
               string deal_symbol = HistoryDealGetString(deal_ticket, DEAL_SYMBOL);
               int deal_magic = (int)HistoryDealGetInteger(deal_ticket, DEAL_MAGIC);
               int deal_type = (int)HistoryDealGetInteger(deal_ticket, DEAL_TYPE);
              
               // Filtering by transaction type (buy or sell)
               bool type_filter = (deal_type == 0 || deal_type == 1);
  
               // Character filtering
               bool symbol_filter = (StringFind(current_symbols, "ALL") != -1) || (StringFind(current_symbols, deal_symbol) != -1); // It is expensive to check the first condition every time in the loop.
  
               // Filtering by Magiks
               bool magic_filter_all = (StringFind(current_magics, "ALL") != -1); // It is expensive to check every time in a loop.
              
               // Split the string with mages into an array
               string magic_values[];
               int count = StringSplit(current_magics, ',', magic_values); // This should have been taken out of the loop as well.
  
               // Check for "Empty" and magick 0
               bool magic_filter_empty = false;
               for (int j = 0; j < count; j++) // Dear Cycle.
               {
                   if (magic_values[j] == "Empty" && deal_magic == 0) // It is cheaper to check the second condition first.
                   {
                       magic_filter_empty = true;
                       break;
                   }
               }
  
               // Check for a specific magik
               bool magic_filter_exact = false;
               for (int j = 0; j < count; j++)
               {
                   if (IntegerToString(deal_magic) == magic_values[j]) // Why compare string variables with each other?
                   {
                       magic_filter_exact = true;
                       break;
                   }
               }
```

Some comments on the code.

![Sergey Porphiryev](https://c.mql5.com/avatar/avatar_na2.png "Sergey Porphiryev")

**[Sergey Porphiryev](/en/users/snail000)**
|
4 Oct 2024 at 11:17

**fxsaber [#](/ru/forum/474140#comment_54746582):**  

Some comments on the code.

OOO!!! Thank you very much for your valuable notes!!!! It will be something to do this weekend ;))))))

![Soshianth Azar](https://c.mql5.com/avatar/2021/8/610B070F-9A56.jpg "Soshianth Azar")

**[Soshianth Azar](/en/users/alakialakiani)**
|
11 Jun 2025 at 07:05

Nice work. Thank you for sharing.

![Volatility Stop](https://c.mql5.com/i/code/indicator.png)
[Volatility Stop](/en/code/49558)

Volatility Stop - indicator of stop levels by volatility

![SMI Ergodic Oscillator](https://c.mql5.com/i/code/indicator.png)
[SMI Ergodic Oscillator](/en/code/49404)

Ergodic oscillator Stochastic Momentum Index (SMI)

![RiskManager with InfoPanel and Support](https://c.mql5.com/i/code/expert.png)
[RiskManager with InfoPanel and Support](/en/code/56126)

My first code on the site, which requires improvement. The idea to create an ideal tool for traders, in the work on the main component of any trading system-Risk Manager

![Better volume](https://c.mql5.com/i/code/indicator.png)
[Better volume](/en/code/56678)

Better Volume is an advanced indicator designed to analyse the behaviour of volume on price charts. It combines volume information with metrics such as candlestick range and moving averages to identify important patterns in the market, such as buy/sell climaxes, churn and weak candles. With its dynamic visual interface and volume categorisation, the indicator offers valuable insights for traders who want to make informed decisions based on volume flow.