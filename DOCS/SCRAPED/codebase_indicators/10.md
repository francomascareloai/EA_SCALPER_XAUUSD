# Adaptive Moving Average (AMA) - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/10

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/10) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Adaptive Moving Average (AMA) - indicator for MetaTrader 5

[MetaQuotes](/en/users/metaquotes)  |
[English](javascript:void(false);)

[Русский](/ru/code/10) [中文](/zh/code/10) [Español](/es/code/10) [Deutsch](/de/code/10) [日本語](/ja/code/10) [Português](/pt/code/10) [한국어](/ko/code/10) [Français](/fr/code/10) [Italiano](/it/code/10) [Türkçe](/tr/code/10)

Views:
:   32538

Rating:
:   (70)

Published:
:   8 January 2010, 13:48

Updated:
:   22 November 2016, 07:32
:   [ama.mq5](/en/code/download/10/ama.mq5 "ama.mq5")
    (5.13 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/10.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

[Adaptive Moving Average](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ama "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ama") (AMA) is used for constructing a moving average with low sensitivity to price series noises and is characterized by the minimal lag for trend detection.

This indicator was developed and described by Perry Kaufman in his book ["Smarter Trading"](/go?link=https://www.amazon.com/Smarter-Trading-Improving-Performance-Changing/dp/0070340021 "http://www.amazon.com/Smarter-Trading-Improving-Performance-Changing/dp/0070340021").

One of disadvantages of different smoothing algorithms for price series is that accidental price leaps can result in the appearance of false trend signals. On the other hand, smoothing leads to the unavoidable lag in predicting the trends. This indicator was developed to overcome these two disadvantages.

![](https://c.mql5.com/18/0/AMA.png "Adaptive Moving Average Indicator")

Adaptive Moving Average Indicator

**Calculation:**

To define the current market state Kaufman introduced the notion of Efficiency Ratio (ER), which is calculated by the below formula:

ER(i) = Sinal(i)/Noise(i)

where:

* ER(i) - current value of the Efficiency Ratio;
* Signal(i) = ABS(Price(i) - Price(i - N)) - current signal value, absolute value of difference between the current price and price N period ago;
* Noise(i) = Sum(ABS(Price(i) - Price(i-1)),N) - current noise value, sum of absolute values of the difference between the price of the current period and price of the previous period for N periods.

At a strong trend the Efficiency Ratio (ER) will tend to 1; if there is no directed movement, it will be a little more than 0.

The obtained value of ER is used in the [exponential smoothing](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") formula:

EMA(i) = Price(i) \* SC + EMA(i-1) \* (1 - SC)

where:

* SC = 2/(n+1) - EMA smoothing constant, n - period of the exponential moving;
* EMA(i-1) - previous value of EMA.

The smoothing ratio for the fast market mast be as for EMA with period 2 (fast SC = 2/(2+1) = 0.6667), and for the period of no trend EMA period must be equal to 30 (slow SC = 2/(30+1) = 0.06452). Thus the new changing smoothing constant is introduced (scaled smoothing constant) SSC:

SSC(i) = (ER(i) \* ( fast SC - slow SC) + slow SC

or

SSC(i) = ER(i) \* 0.60215 + 0.06425

For a more efficient influence of the obtained smoothing constant on the averaging period Kaufman recommends squaring it.

Final calculation formula:

AMA(i) = Price(i) \* (SSC(i)^2) + AMA(i-1)\*(1-SSC(i)^2)

or (after rearrangement):

AMA(i) = AMA(i-1) + (SSC(i)^2) \* (Price(i) - AMA(i-1))

where:

* AMA(i) - current value of AMA;
* AMA(i-1) - previous value of AMA;
* SSC(i) - current value of the scaled smoothing constant.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/10](/ru/code/10)

**Last comments |
[Go to discussion](/en/forum/211)**
(6)

![Gabor Torma](https://c.mql5.com/avatar/2012/10/507C0684-4A63.jpg "Gabor Torma")

**[Gabor Torma](/en/users/vincentx)**
|
16 Nov 2012 at 22:53

**usmanp:**  
 CAN I USE IT WITH MT4 TRADER?

No!

![Maxim Khrolenko](https://c.mql5.com/avatar/2018/1/5A6B2B7F-D1C2.png "Maxim Khrolenko")

**[Maxim Khrolenko](/en/users/paladin800)**
|
26 Dec 2012 at 12:13

The formula ER(i) = Sinal(i)/Noise(i) has a grammatical typo, it should be **Signal**.

![MrShuM](https://c.mql5.com/avatar/2015/8/55C3A164-B8BF.jpg "MrShuM")

**[MrShuM](/en/users/mrshum)**
|
29 Mar 2013 at 14:31

There is an AMA indicator for MT4, could you make one for MT5?

![Sergey Golubev](https://c.mql5.com/avatar/2012/12/50D09349-3D90.jpg "Sergey Golubev")

**[Sergey Golubev](/en/users/newdigital)**
|
13 Jul 2014 at 12:24

[Forum on trading, automated trading systems and testing trading strategies](/en/forum)

[Indicators: AMA\_STL\_HTF](/en/forum/33221#comment_985170)

[newdigital](https://www.mql5.com/en/users/newdigital "https://www.mql5.com/en/users/newdigital"), 2014.07.13 12:00

**[Adaptive Moving Average](https://www.mql5.com/go?link=https://www.forexkarma.com/adaptive-moving-average.html%23.U8JW_0DetFI "http://www.forexkarma.com/adaptive-moving-average.html#.U8JW_0DetFI")**

**Adaptive moving average (AMA), as the name suggests is an adaptation of moving average. It is designed to adapt according to the dynamic market as needed.**

----

Simple moving average (SMA) and its cousins weighted moving averages (WMA) and exponential moving averages (EMA) all work fantastic when the market is trending. However when the market is range bound they pick up a lot of market noise generating a lot of premature signals. Moreover, they are all inherently lagging in nature.

In a quest to remedy shortcomings of moving averages, Perry J. Kaufmann, first introduced adaptive moving average in his book The Smarter Trading: Improving Performance in Changing Markets.  
  
*20-Day-SMA & AMA In Action:*  
  
![](https://c.mql5.com/3/43/adaptive-moving-average.jpg)

Prior to Mr. Kaufmann's introduction of AMA, traders employed combination of more than a single moving average such as [The Double Crossover Method](https://www.mql5.com/go?link=https://www.forexkarma.com/moving-average.html%23double_crossover_2765 "http://www.forexkarma.com/moving-average.html#double_crossover_2765") and [The Triple Crossover Method](https://www.mql5.com/go?link=https://www.forexkarma.com/moving-average.html%23triple_crossover_4937 "http://www.forexkarma.com/moving-average.html#triple_crossover_4937").

The reasons behind employing multiple combination of moving averages are based on the following facts:

1. Fast moving averages, which often consists of shorter time period such as 5-day period performed best when the market is rapidly trending.
2. Slow moving averages, which often consists of longer time period such as 50-day period performed best when the market is range bound thereby filtering most of the noise in the market.

So the genius in Kaufmann's AMA was a system smart enough to vary its speed according to a combination of market direction and speed.

In another words, when the market is trending, AMA speeds up along with the trend. When the market is range bound and does nothing AMA slows down.

Thus it righteously earns the name "adaptive" as it self adjusts to market direction and speed.

Kaufmann's AMA achieves sense of market direction and speed by incoporating the efficiency ratio.

**Adaptive Moving Average Trading Rules**  
  

Following are the trading rules for the Adaptive Moving Average:

1. Buy when the AMA turns up
2. Sell when the AMA turns down

![Dadas](https://c.mql5.com/avatar/avatar_na2.png "Dadas")

**[Dadas](/en/users/dadas)**
|
16 Mar 2021 at 22:56

Your indicator does not match the default [Adaptive Moving Average indicator](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ama "MetaTrader 5 Help: Adaptive Moving Average indicator") provided in MT5 as far as Shift is concerned. It is shifted one candle further than it should be. It fits when PlotIndexSetInteger(0,PLOT\_SHIFT,InpShiftAMA-1);  
I wrote an EA based on the default AMA in MT5 and it works exactly like it is supposed to.  
If I were to use yours, it would give a different reading.  
  
Oh, sorry, I just realised your indicator applies to the Open Price, not Close Price.

![Average Directional Movement Index Wilder](https://c.mql5.com/i/code/indicator.png)
[Average Directional Movement Index Wilder](/en/code/8)

The Average Directional Movement Index by Wilder (ADX Wilder) helps to determine the presence of the price trend.

![Class CalcFrac - Number of bars before and after the current High / Low (calculated fractal)](https://c.mql5.com/i/code/library.png)
[Class CalcFrac - Number of bars before and after the current High / Low (calculated fractal)](/en/code/62)

Calculates fractals and lets you specify the number of bars separately before and after the current High / Low (fractal).

![Accumulation Swing Index (ASI)](https://c.mql5.com/i/code/indicator.png)
[Accumulation Swing Index (ASI)](/en/code/11)

ASI was created by Wales Wilder as an ordinary fluctuations indicator that gets signals from previous maximums and minimums of price.

![Average True Range (ATR)](https://c.mql5.com/i/code/indicator.png)
[Average True Range (ATR)](/en/code/12)

Average True Range Technical Indicator (ATR) is an indicator that shows volatility of the market.