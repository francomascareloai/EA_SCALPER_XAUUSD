# Triangular Arbitrage - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/57272

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/57272) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Triangular Arbitrage - expert for MetaTrader 5

[Джованни Орсани](/en/users/lupin.trader)  |
[English](javascript:void(false);)

[Русский](/ru/code/57272) [中文](/zh/code/57272) [Español](/es/code/57272) [Deutsch](/de/code/57272) [日本語](/ja/code/57272) [Português](/pt/code/57272) [한국어](/ko/code/57272) [Français](/fr/code/57272) [Italiano](/it/code/57272) [Türkçe](/tr/code/57272)

Views:
:   7189

Rating:
:   (9)

Published:
:   28 May 2025, 11:50
:   [Triangular Arbitrage.mq5](/en/code/download/57272/triangular_arbitrage.mq5 "Triangular Arbitrage.mq5")
    (20.26 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/57272.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This Expert Advisor (EA) is designed to perform triangular arbitrage between three currency pairs: EURUSD, USDJPY and EURJPY. The main objective is to exploit price discrepancies between these pairs, identifying arbitrage opportunities and opening positions to capitalise on them.

### Description of functionalities:

1. **Identifying opportunities**: The EA calculates the implied price of EURJPY by multiplying the Ask prices of EURUSD and USDJPY. This value is then compared to the EURJPY direct price. If the relative difference exceeds a defined threshold, an arbitrage opportunity is recognised.
2. **Opening of positions**: When an opportunity is identified:

   * If the implied price is higher than the direct price, the EA executes a set of trades including buying EURJPY and selling EURUSD and USDJPY.
   * If the implied price is lower, the EA executes the reverse trade.
3. **Position tracking**: The EA tracks open positions using a specific Magic Number. This helps to distinguish trades executed by the EA from others.
4. **Closing positions**: When the cumulative profit of open positions exceeds the defined target, all positions associated with the EA are closed.
5. **Error handling**: The EA includes error checks to ensure that any problems when opening or closing positions are reported.

In summary, this EA automates the triangular arbitrage process with a systematic approach, optimising returns based on price discrepancies.

Translated from Italian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/it/code/57272](/it/code/57272)

**Last comments |
[Go to discussion](/en/forum/487642)**
(8)

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
6 Jun 2025 at 08:23

**sfhomebiz [#](/ru/forum/487641#comment_56882816):**  
 Works well on historical data(target profit set at 0.1$). I set the delay (ping) at 60 ms.

The reason is this.

```mql5
void CloseArbitragePositions()
{
   double totalProfit = 0;
  
   // Calcola il profitto cumulativo delle posizioni col Magic Number
   for(int i = 0; i < PositionsTotal(); i++)
   {
      ulong ticket = PositionGetTicket(i);
      if(PositionSelectByTicket(ticket))
      {
         if(PositionGetInteger(POSITION_MAGIC) == MagicNumber)
            totalProfit += PositionGetDouble(POSITION_PROFIT);
      }
   }
  
   if(totalProfit >= ProfitTarget)
   {
      Print("Profit target raggiunto: ", totalProfit, ". Procedo alla chiusura delle posizioni.");
      
      // Chiude le posizioni iterando all'indietro per sicurezza
      for(int i = PositionsTotal() - 1; i >= 0; i--)
      {
         ulong ticket = PositionGetTicket(i);
         if(PositionSelectByTicket(ticket))
         {
            if(PositionGetInteger(POSITION_MAGIC) == MagicNumber)
            {
               string sym = PositionGetString(POSITION_SYMBOL);
               if(!trade.PositionClose(sym))
                  Print("Errore nella chiusura della posizione su ", sym, " - ", GetLastError());
               else
                  Print("Posizione su ", sym, " chiusa con successo.");
            }
         }
      }
   }
}
```

All EAs with this condition will show something good.

![xery](https://c.mql5.com/avatar/avatar_na2.png "xery")

**[xery](/en/users/xery)**
|
30 Jun 2025 at 01:23

**fxsaber [#](/en/forum/487642#comment_56912958):**  
 The reason is this. All EAs with this condition will show something good.

So it doesn't print results that were negative?

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
30 Jun 2025 at 05:27

**xery [#](/ru/forum/487641#comment_57360998):**  
So it doesn't display results that were negative?

Only when the Tester pass is stopped.

![michal_](https://c.mql5.com/avatar/avatar_na2.png "michal_")

**[michal\_](/en/users/michal_)**
|
1 Jul 2025 at 12:29

// This is more powerfull, higher trashold usable int CheckArbitrageOpportunity(double &diff, double &impliedPrice, double &directPrice)
{ double price1 = SymbolInfoDouble(symbol1, [SYMBOL\_BID](https://www.mql5.com/en/docs/constants/environment_state/marketinfoconstants#enum_symbol_info_double "MQL5 documentation: Symbol properties")); double price2 = SymbolInfoDouble(symbol2, SYMBOL\_BID); directPrice = SymbolInfoDouble(symbol3, SYMBOL\_ASK); impliedPrice = price1 \* price2; diff = (impliedPrice - directPrice) / directPrice; if(diff > Threshold) return 1; price1 = SymbolInfoDouble(symbol1, SYMBOL\_ASK); price2 = SymbolInfoDouble(symbol2, SYMBOL\_ASK); directPrice = SymbolInfoDouble(symbol3, SYMBOL\_BID); impliedPrice = price1 \* price2; diff = (impliedPrice - directPrice) / directPrice; if(diff < -Threshold) return -1; return 0;
}

![Clankar](https://c.mql5.com/avatar/avatar_na2.png "Clankar")

**[Clankar](/en/users/azuyaturkan)**
|
23 Oct 2025 at 17:46

**michal\_ [#](/en/forum/487642#comment_57381060):**  
 // This is more powerfull, higher trashold usable int CheckArbitrageOpportunity(double &diff, double &impliedPrice, double &directPrice) { double price1 = SymbolInfoDouble(symbol1, [SYMBOL\_BID](/en/docs/constants/environment_state/marketinfoconstants#enum_symbol_info_double "MQL5 documentation: Symbol properties")); double price2 = SymbolInfoDouble(symbol2, SYMBOL\_BID); directPrice = SymbolInfoDouble(symbol3, SYMBOL\_ASK); impliedPrice = price1 \* price2; diff = (impliedPrice - directPrice) / directPrice; if(diff > Threshold) return 1; price1 = SymbolInfoDouble(symbol1, SYMBOL\_ASK); price2 = SymbolInfoDouble(symbol2, SYMBOL\_ASK); directPrice = SymbolInfoDouble(symbol3, SYMBOL\_BID); impliedPrice = price1 \* price2; diff = (impliedPrice - directPrice) / directPrice; if(diff < -Threshold) return -1; return 0; }

Why do have you decided to use the bid of the first two symbols to calculate the ask of the directprice and viceversa ..?

![Population-based optimisation algorithms](https://c.mql5.com/i/code/script.png)
[Population-based optimisation algorithms](/en/code/49355)

Population-based optimisation algorithms are collected here. The archive contains all necessary files to run the algorithms on test functions.

![Trade Classes in Python - CTade, CSymbol, CPositionInfo, etc.](https://c.mql5.com/i/code/library.png)
[Trade Classes in Python - CTade, CSymbol, CPositionInfo, etc.](/en/code/59808)

MQL5-Like Trade Classes in Python for MetaTrader 5 Python

![Customised bmap chart](https://c.mql5.com/i/code/indicator.png)
[Customised bmap chart](/en/code/58845)

This is a custom indicator for MetaTrader 5 whose sole purpose is to display a BMP image on the chart, centred on the screen

![Change the colour of candles and wick](https://c.mql5.com/i/code/indicator.png)
[Change the colour of candles and wick](/en/code/58896)

Draw the wicks (thin lines): Draw a vertical line from the lowest price to the highest price of each candle (this is called a "wick")