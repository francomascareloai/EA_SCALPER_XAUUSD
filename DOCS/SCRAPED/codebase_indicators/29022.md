# Disable auto trading but ONLY for a specific EA - library for MetaTrader 4

Source: https://www.mql5.com/en/code/29022

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/29022) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# Disable auto trading but ONLY for a specific EA - library for MetaTrader 4

[Noe Combes Bardoll](/en/users/nono86)

Views:
:   11148

Rating:
:   (23)

Published:
:   2 May 2020, 16:53
:   \MQL4\Scripts\

    [Disable current.mq4](/en/code/download/29022/disable_current.mq4 "Disable current.mq4")
    (8.26 KB)
    [view](# "view")

    \MQL4\Include\

    [WinUser32.mqh](/en/code/download/29022/winuser32.mqh "WinUser32.mqh")
    (37.64 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/29022.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This script is made to disable the EA on the chart from trading, Its made to click the following buton on the image, automatically :

![](https://c.mql5.com/18/90/allow_trading.PNG)

In the following code, its getting the handle of the main Metatrader and open the Expert tab (command 33048 is in mt4, for mt5 It's different)

```mql5
int hMetaTrader = GetAncestor(WindowHandle(Symbol(),Period()),2);         
   
PostMessageA (hMetaTrader, WM_COMMAND , 33048, 0);

Sleep(200); //It's important to keep at least 0.2 secs to let the window open correctly
```

Then we need to check what tab we are currently on, we get the name of the tab and auto correct to go to the right one :

```mql5
int kid=get(hMetaTrader);
   
   string top=name(kid);
   
   if(top=="Common "){//if the window is already the right one (Common section tab), just find the button, click it and click OK
      kid=avance(kid);
      
      int is_checked=check_state(kid);
      
      if(is_checked){Print("button is currently checked");}
      else{Print("button is currently NOT checked");}
      
      Sleep(10);
      PostMessageW(kid,WM_LBUTTONDOWN,1,0);//press the left mouse button
      Sleep(10);
      PostMessageW(kid,WM_LBUTTONUP ,1,0);//release it
      Sleep(10);
      PostMessageA(kid,WM_KEYDOWN,0x0D,0);//pressing enter to validate the selection
      return 0;
      
      }
   else if(top==""){//if the tab is the "About" section, press ctrl+tab (to go 1 tab forward)
      Print("first");
      Sleep(10);
      keybd_event(17,0,0,0);
      Sleep(10);
      keybd_event(9,0,0,0);
      Sleep(10);
      keybd_event(9,0,KEYEVENTF_KEYUP,0);
      Sleep(10);
      keybd_event(17,0,KEYEVENTF_KEYUP,0);
      Sleep(10);
      }
   else{//if the tab is "Inputs" then press ctrl+maj+tab (to go 1 tab back)
      keybd_event(17,0,0,0);
      Sleep(10);
      keybd_event(16,0,0,0);
      Sleep(10);
      keybd_event(9,0,0,0);
      Sleep(10);
      keybd_event(9,0,KEYEVENTF_KEYUP,0);
      Sleep(10);
      keybd_event(16,0,KEYEVENTF_KEYUP,0);
      Sleep(10);
      keybd_event(17,0,KEYEVENTF_KEYUP,0);
      Sleep(10);
      }
```

And then finally if the tab wasn't the right one, find the button "allow auto trading" and press it to disable it :

```mql5
   Sleep(100);
   kid=get(hMetaTrader);
   kid=avance(kid);
   Sleep(100);
   bool is_checked=check_state(kid);

   if(is_checked){Print("button is currently checked");}
   else{Print("button is currently NOT checked");}
   
   Print(name(kid));
   PostMessageW(kid,WM_LBUTTONDOWN,1,0);
   Sleep(10);
   PostMessageW(kid,WM_LBUTTONUP,1,0);
   Sleep(10);
   PostMessageA(kid,WM_KEYDOWN,0x0D,0);
```

I forgot to mention that the code is going to click this particular button even if the autotrading is **already off** so
Its going to activate it, disable it, activate it.. Thats why I made a special function to get the current state of the button, you can modify
the code as you want to change it getting the button state with this function :

```mql5
int kid=<HANDLE OF THE BUTTON>
bool is_checked=check_state(kid);

bool check_state(int handle){
   return (bool)SendMessageA(handle, 0x00F0, 0, 0);
   }
```

**Last comments |
[Go to discussion](/en/forum/339322)**
(4)

![Andre Gomes](https://c.mql5.com/avatar/avatar_na2.png "Andre Gomes")

**[Andre Gomes](/en/users/andremog)**
|
29 Aug 2020 at 16:43

Hi - thanks for sharing the script!

I have been trying to develop a script to [check](https://www.mql5.com/en/docs/common/GetTickCount64 "MQL5 Documentation: GetTickCount64 function") if there are open orders and if the EA is already ON/OFF before runnnig the script. But it is not working as expected.

Any idea on how to solve it?

Thanks

Andre

![Andre Gomes](https://c.mql5.com/avatar/avatar_na2.png "Andre Gomes")

**[Andre Gomes](/en/users/andremog)**
|
29 Aug 2020 at 18:16

**Andre Gomes:**  

Hi - thanks for sharing the script!

I have been trying to develop a script to check if there are open orders and if the EA is already ON/OFF before runnnig the script. But it is not working as expected.

Any idea on how to solve it?

Thanks

Andre

I think the problem is that the script does not find the handle of the "Allow live trading" button.

Any idea on how to do it?

![Noe Combes Bardoll](https://c.mql5.com/avatar/2020/5/5EBB5594-AFD0.jpg "Noe Combes Bardoll")

**[Noe Combes Bardoll](/en/users/nono86)**
|
30 Aug 2020 at 09:44

**Andre Gomes:**  

I think the problem is that the script does not find the handle of the "Allow live trading" button.

Any idea on how to do it?

There is a way to check if its on or off, just look at the code for the 'is\_checked' [function](https://www.mql5.com/en/docs/constants/namedconstants/compilemacros "MQL5 documentation: Predefined Macrosubstitutions") if its true then its ON and if its false its OFF.

![Osazee Asikhemhen](https://c.mql5.com/avatar/2022/10/633d884d-7930.jpg "Osazee Asikhemhen")

**[Osazee Asikhemhen](/en/users/45266274)**
|
22 Sep 2024 at 07:43

Great job

![Smoothed Bar to Bar Correlation](https://c.mql5.com/i/code/indicator.png)
[Smoothed Bar to Bar Correlation](/en/code/28957)

The Correlation Indicator provides a smoothed bar to bar correlation value.

![MA HISTOGRAM SEPARATE WINDOW](https://c.mql5.com/i/code/indicator.png)
[MA HISTOGRAM SEPARATE WINDOW](/en/code/28922)

Trend indicator (separate window)

![RingSystemEA](https://c.mql5.com/i/code/expert.png)
[RingSystemEA](/en/code/29034)

It's a triangular arbitrage system.

![V Sync Chart Lite](https://c.mql5.com/i/code/indicator.png)
[V Sync Chart Lite](/en/code/29105)

The V Sync Chart Lite indicator is written for demonstration purposes and shows how it is possible to synchronize the object