# WatchDog - An EA monitoring script.  - script for MetaTrader 4

Source: https://www.mql5.com/en/code/10615

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/10615) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Scripts](https://c.mql5.com/i/code/script.png)

# WatchDog - An EA monitoring script. - script for MetaTrader 4

[Erich Pribitzer](/en/users/seizu1)

Views:
:   20059

Rating:
:   (18)

Published:
:   21 February 2012, 07:07

Updated:
:   22 November 2016, 07:32
:   [alive\_php\_scripts.zip](/en/code/download/10615/alive_php_scripts.zip "alive_php_scripts.zip")
    (1.36 KB)

    [WatchDog.mq4](/en/code/download/10615/WatchDog.mq4 "WatchDog.mq4")
    (29.29 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/10615.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

WatchDog is an "Expert Advisor" and "System" monitoring script.

WatchDog sends an e-mail when things go wrong, an order has opened or closed, on requotes, on log errors, on server shut down ... Just drag the script in a chart window.

In order to use this script, you have to:

1. Adjust the BASEDIR value. Set your MetaTrader installation path string BASEDIR = "C:\\Program Files\\MetaTrader4\\";
2. Setup MetaTrader for Email notification. (Tools -> Options -> Email)
3. Optional: A Webspace with PHP support. Only necessary if you want to use the server alive-event. (This event is disabled by default)

The script is based on events; each event defines a monitoring task. WatchDog comes with a lot of pre-defined events. But it's also possible to add custom events. Later on I'll explain how to do this. Basically there are two types of events, events and log-events. A log-event searches the given log file for a string. The different between events and log-events is just the parameter count. Log-events always expect a log file name and a search pattern.

Here comes a short description of all events. (Each event has its own event-id which is defined in the source.)  
  
**Log-Events:**

* WDE\_JL\_DELETED: Searches the journal-log (every minute) for "order deleted" and mails any corresponding line.
* WDE\_JL\_REQUOTE: Searches the journal-log (every minute) for "requote" and mails any corresponding line.
* WDE\_JL\_FAILED: Searches the journal-log (every minute) for "failed" and mails any corresponding line.
* WDE\_JL\_EALOADED: Helper event
* WDE\_JL\_EAREMOVED: Sends a mail when an EA script was removed or loaded. (1 min. check interval)

**Events:**

* WDE\_ALIVE: A helper event that invokes an URL (every 40 seconds)
* WDE\_CONNECTIVITY: Sends a mail when MetaTrader has lost the connection.
* WDE\_OPENCLOSE: Invokes a WDE\_STATEMEN-event when an order has opened or closed.
* WDE\_STATEMENT: Sends (every hour) information about active trades, closed trades and account values.
* WDE\_ERROR: Sends information about errors.

To change or add an event, go to the init() function. Below the "Event configuration" comment-line, you can add or update event parameters.   
Furthermore, if you add an event, you have to uncomment or add the corresponding line within the switch statement. Search the script for "custom1" to see what I mean.

For example to add a log-event (WDE\_JL\_custom1) that searches the journal log for "error", just uncomment and update these lines.

```mql5
//   wd_eventTitle[WDE_JL_custom1]         = "Custom1";           // email subject
//   wdc[WDE_JL_custom1][WDC_ENABLED]      = 1;                   // event 0=disabled / 1=enabled
//   wdc[WDE_JL_custom1][WDC_INTERVAL]     = 60;                  // check-interval in seconds
//   wdc[WDE_JL_custom1][WDC_NORMALLEVEL]  = 1;                   // perform a normal-action if level-counter is >= 1
//   wdc[WDE_JL_custom1][WDC_NORMALACTION] = WDA_MAIL|WDA_RESET;  // normal-action: send mail and clear level-counter
//   wd_logPath[WDE_JL_custom1]            = BASEDIR+"logs\\";    // journal log path
//   wd_match1[WDE_JL_custom1]             = "error";             // first pattern
```

...also uncomment

```mql5
            switch(event) {
//             case WDE_JL_custom1:
```

**Optional:**

The Alive-Event calls a php web script every 40 seconds.

To use this event you have to:

1. Install update.php, check.php and timestamp.txt on a website (with sendmail and php support)
2. Make timestamp.txt writeable
3. Set the WD\_URL ( #define WD\_URL "http://myWebSite.com/update.php" )
4. Modify update.php, check.php (adjust IP and Email addresses)
5. Use a free cronjob service to call "http://myWebSite.com/check.php" every 2 minutes. (If the update.php script fails, check.php sends an alert mail)
6. Enable the Alive-Event. (wdc[WDE\_ALIVE][WDC\_ENABLED]=1)

**Last comments |
[Go to discussion](/en/forum/28389)**
(9)

![cristiano](https://c.mql5.com/avatar/2013/11/5281FC8E-A4EE.jpg "cristiano")

**[cristiano](/en/users/cristiano74)**
|
25 Jan 2013 at 16:48

Hi Erich,

 i'd like to use your scipt just on \experts\logs but if I change just the basedir i cannot see changes in the script actions.

 Could you please tell me how I can handle it?

 Thanks in advance

![Kutyar Oztas](https://c.mql5.com/avatar/2014/11/547B54DE-6D47.jpg "Kutyar Oztas")

**[Kutyar Oztas](/en/users/fxg)**
|
24 Feb 2019 at 18:14

Thank you very much. Nice work!

![AFRT927](https://c.mql5.com/avatar/2020/9/5F591962-5DE1.jpg "AFRT927")

**[AFRT927](/en/users/afrt927)**
|
9 Sep 2020 at 19:34

Excelent Work!

![qqqfight](https://c.mql5.com/avatar/avatar_na2.png "qqqfight")

**[qqqfight](/en/users/qqqfight)**
|
14 Sep 2020 at 08:02

Unable to search journal log.

Can you fix it?

![vitalis4u](https://c.mql5.com/avatar/avatar_na2.png "vitalis4u")

**[vitalis4u](/en/users/vitalis4u)**
|
29 Oct 2020 at 14:41

Please can anyone help me with the watchdog [expert advisor](https://www.mql5.com/en/market/mt5 "A Market of Applications for the MetaTrader 5 and MetaTrader 4") code for mt5. Thanks

![MMT](https://c.mql5.com/i/code/expert.png)
[MMT](/en/code/10517)

It is a Malty order Placer(4 LIMIT and 1 INSTANT). and good performed EA. It Works With THE Co-ordination of Different Moving Averages.

![Time trader v1.1](https://c.mql5.com/i/code/expert.png)
[Time trader v1.1](/en/code/10611)

Opens specified orders at a specified time

![Clear Method](https://c.mql5.com/i/code/indicator.png)
[Clear Method](/en/code/10623)

This indicator is based on the article: Getting Clear With Short-Term Swings by Ron Black

![Bill Williams ATZ indicator](https://c.mql5.com/i/code/indicator.png)
[Bill Williams ATZ indicator](/en/code/10622)

This indicator throws visual and verbose buy/sell signals according to Bill Williams Trading in the Zone methodology and Alligator.