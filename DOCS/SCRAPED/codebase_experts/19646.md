# ExpertZZLWA - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/19646

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/19646) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# ExpertZZLWA - expert for MetaTrader 5

[Gayrat Madumarov](/en/users/gara)  |
[English](javascript:void(false);)

[Русский](/ru/code/19646) [中文](/zh/code/19646) [Español](/es/code/19646) [Deutsch](/de/code/19646) [日本語](/ja/code/19646) [Português](/pt/code/19646)

Views:
:   7539

Rating:
:   (29)

Published:
:   1 March 2018, 10:55
:   [optimization result.zip](/en/code/download/19646/optimization_result.zip "optimization result.zip")
    (417.84 KB)

    \MQL5\Experts\

    [ExpertZZLWA.mq5](/en/code/download/19646/expertzzlwa.mq5 "ExpertZZLWA.mq5")
    (19.13 KB)
    [view](# "view")

    \MQL5\Include\

    [isnewbar.mqh](/en/code/download/19646/isnewbar.mqh "isnewbar.mqh")
    (1.41 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/19646.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

### Installation Instructions

To test the Expert Advisor, download the demo version of the [ZigZagLW Addition](/en/market/product/25584 "Market → MetaTrader 5 → Indicators → ZigZagLW Addition") indicator. The **ZigZagLW Addition.ex5** file must be located in the MQL5\Indicators\Market directory. Also, download the [IsNewBar](/en/code/768 "IsNewBar - library for MetaTrader 5") library and add the **isnewbar.mqh** file to the MQL5\Include directory. Then download the EA file **ExpertZZLWA.mq5**, open it in the editor and compile it. The model is ready for testing.

### Testing

The purpose of this publication is to demonstrate the potential profitability of the ZigZagLW Addition indicator, which can be briefly described as a "trend indicator". For a detailed description of the indicator algorithm, please see [https://www.mql5.com/en/market/product/2647](/en/market/product/2647 "Market → MetaTrader 5 → Indicators → ZigZagLW"). We will use an Expert Advisor from [https://www.mql5.com/en/code/19102](/en/code/19102 "Cross Platform Expert MT45 - Expert for MetaTrader 5") to develop an automated system model trading based on the specified indicator. Nothing was removed from the EA body - unnecessary lines were commented instead and required code blocks were added. I also changed the EA name. Changes are marked with the following comments:

```mql5
//**************************

...

//**************************
```

How it works: the EA buys and sells when appropriate signals emerge, but it is not a reversal EA: all orders are closed by Stop Loss and Take Profit, and the number of open orders is equal to the number of signals.

Let's determine the main criteria for evaluating the effectiveness of the automated system and the way the evaluation should be performed. At the initial stage, we have only a model and want to understand whether it is a good basis for constructing a system. A positive answer to this question could be obtained from the balance curve shape over a long testing period. If the balance curve shows a steady uptrend, this model can be considered as the basis for a system, to which filters, indicators, money management and other elements can be added. In general, the basis must be stable to provide a good foundation for all additions.

To avoid manual evaluation of different balance curves with all parameters, let's set reasonable limits for the optimization by selecting (by trying to guess) the most promising sets of parameters.

Here we can use some classic ideas. Here I mention a book, which was not my first choice. I liked the numbered list of rules for the trader. Other authors present such thoughts inconsistently scattered through the text. So, the book is "The Way to Trade" by John Piper. Open chapter 9 and read:

The trading secrets:

1. Cut your losses
2. Run your profits
3. Trade selectivity
4. Trade with the trend

In our case, these secrets mean the following:

1. Stop loss should be small
2. Take profit should be large
3. Not programmed in the model
4. Buy at a buy signal, sell at a sell signal

Three of four rules can be implemented. Although there are some remarks to the last item: signals not indicate a long trend. The signal may change multiple times while the price makes its way to Take Profit. Here the signal rather plays the role of a stochastic, but its required characteristics include an early alert and mandatory formation at the beginning of the trend. So it would be more correct to say that the indicator discussed here can partially cover items 3 and 4, but none of them is covered completely. The problem with long-term trend indicators is a catastrophic lag. However such signals can also be used, for example for position scaling when such a signal is formed.

The first screenshot shows optimization parameters. Optimize only two parameters, stoploss and takeprofit:

![parameters](https://c.mql5.com/18/63/parameters.png "parameters")

The **Level** parameter means the used level of the ZigZagLW Addtion indicator, and **mode** shows the EA operation mode. In **original\_mode**, the EA works as the original MT45 Expert Advisor; in **addition\_test\_mode** it uses signals of the ZigZagLW Addtion indicator; in **ma\_test\_mode** it uses MA intersection signals.

The EA was optimized in the MetaTrader 5 terminal using data from the **access.metatrader5.com:443** server as it is recommended in the article at [https://www.mql5.com/en/articles/385#files](/en/articles/385#files "How to Post a Product in the Market: 2.5. Prepare a Product for Publication - Versions"), using the data interval 1.01.2000 - 31.12.2016, in the Control Points mode on the M15 timeframe - it is shown in the second screenshot:

![settings](https://c.mql5.com/18/63/settings__1.png "settings")

The optimization result is attached here as **complete period.xml**.

Consider the highest result: it obviously has a long unsuccessful period at the end of testing, which is highlighted in orange.

![first test](https://c.mql5.com/18/63/first_test_moded.png "first test")

The next optimization was performed on data 1.01.2012 - 31.12.2016. The result is available in the file **partial period.xml**.

Let's choose the best result and see how these parameters work on the entire interval 1.01.2000 - 31.12.2016.

![second test](https://c.mql5.com/18/63/second_test.png "second test")

For comparison, I added the third EA mode **ma\_test\_mode**. Crossing of moving averages is used as a signal in this mode. The purpose was to get about the same number of deals in order to compare the results and evaluate the effect of trading signals with the same stoploss and takeprofit parameters.

![third test](https://c.mql5.com/18/63/third_test.png "third test")

### General Observations

The results may seem encouraging for some users and not good enough for others. Here we only note indisputable facts:

* The model corresponds to the recommendations of experienced traders in terms of loss cutting and profit running: it is reflected on the balance curve as the equity line which is above the balance line.
* The equity curve showed a steady upward trend over a long time interval with small drawdowns.
* A purely mechanical model with a small number of optimization parameters is used.

Parameters, which are used as optimal (StopLoss=3600, TakeProfit=6700, Level=Long\_term1) are a compromise. It would be more interesting to test parameters, which better suit traders' recommendations, such as StopLoss=500 and TakeProfit=8000.

![fourth test](https://c.mql5.com/18/63/fourth_test.png "fourth test")

Let us compare the same parameters for signals on the crossing of moving averages

![fifth test](https://c.mql5.com/18/63/fifth_test.png "fifth test")

The variant of the model with parameters StopLoss = 500, TakeProfit = 8000 is closest to experienced traders' ideas, but it is the most complex one from the point of view of psychology: because of long plateaus on the balance curve and long series of losing trades (up to 145), very few traders are able to follow the advice (maybe that's why it still works).

Recommendations and tips described in most books on trading really work. I think, even if market entries at the specified interval were completely random, these parameters would show a profit.

Some automated systems differ significantly from others with the same order placing parameters and with approximately the same number of orders in the selected interval.

Given the extreme volatility of the Forex market, perhaps better results could have been obtained on other less volatile markets.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/19646](/ru/code/19646)

**Last comments |
[Go to discussion](/en/forum/229054)**
(8)

![Gayrat Madumarov](https://c.mql5.com/avatar/avatar_na2.png "Gayrat Madumarov")

**[Gayrat Madumarov](/en/users/gara)**
|
7 Jun 2021 at 22:50

It seems to be most correct to add up the income for the periods where presumably there was no buffer overflow:

2849,07 + 425,20 = 3274,27

But this is not the point. The most important thing is that this system continues to show profitability for five years since its development.

![Gayrat Madumarov](https://c.mql5.com/avatar/avatar_na2.png "Gayrat Madumarov")

**[Gayrat Madumarov](/en/users/gara)**
|
7 Jun 2021 at 23:12

Several years have passed since the publication of this model. It is possible to conduct a retrospective analysis of how this system worked on the market with the initial parameters.

[![fig2](https://c.mql5.com/3/357/fig2__3.jpg "fig2")](https://c.mql5.com/3/357/fig2__2.jpg "https://c.mql5.com/3/357/fig2__2.jpg")

![fig3](https://c.mql5.com/3/357/fig3__1.jpg "fig3")

[![fig1](https://c.mql5.com/3/357/TesterGraphReport2021.06.07__3.png "fig1")](https://c.mql5.com/3/357/TesterGraphReport2021.06.07__2.png "https://c.mql5.com/3/357/TesterGraphReport2021.06.07__2.png")

In fact, this system had been ready at the end of 2016, but I did not publish it until the end of 2017. I mentioned this for completeness. We will start from the actual publication date. Let's test this period when the system showed steady growth.

[![fig5](https://c.mql5.com/3/357/fig5__3.jpg "fig5")](https://c.mql5.com/3/357/fig5__2.jpg "https://c.mql5.com/3/357/fig5__2.jpg")

[![fig6](https://c.mql5.com/3/357/fig6__3.jpg "fig6")](https://c.mql5.com/3/357/fig6__2.jpg "https://c.mql5.com/3/357/fig6__2.jpg")

[![fig8](https://c.mql5.com/3/357/TesterGraphReport2021.06.07-1__3.png "fig8")](https://c.mql5.com/3/357/TesterGraphReport2021.06.07-1__2.png "https://c.mql5.com/3/357/TesterGraphReport2021.06.07-1__2.png")

The system looks stable, what can happen in the near future where it starts to fall uncontrollably. Let's explore this period:

![Gayrat Madumarov](https://c.mql5.com/avatar/avatar_na2.png "Gayrat Madumarov")

**[Gayrat Madumarov](/en/users/gara)**
|
7 Jun 2021 at 23:17

[![fig7](https://c.mql5.com/3/357/fig7__3.jpg "fig7")](https://c.mql5.com/3/357/fig7__2.jpg "https://c.mql5.com/3/357/fig7__2.jpg")

[![fig8](https://c.mql5.com/3/357/TesterGraphReport2021.06.07-2__3.png "fig8")](https://c.mql5.com/3/357/TesterGraphReport2021.06.07-2__2.png "https://c.mql5.com/3/357/TesterGraphReport2021.06.07-2__2.png") [![fig9](https://c.mql5.com/3/357/fig9__3.jpg "fig9")](https://c.mql5.com/3/357/fig9__2.jpg "https://c.mql5.com/3/357/fig9__2.jpg")

The result is discouraging. On a long test, this area falls like an avalanche. I found three possible explanations for this phenomenon:

1. There have been fundamental changes in the market.

This version, in my opinion, does not stand up to criticism due to the change in the relative position of the equity and balance lines with unchanged stop loss and take profit ratios.

![fig10](https://c.mql5.com/3/357/fig10__1.jpg "fig10")

![Gayrat Madumarov](https://c.mql5.com/avatar/avatar_na2.png "Gayrat Madumarov")

**[Gayrat Madumarov](/en/users/gara)**
|
7 Jun 2021 at 23:22

2. Insufficiently good quality of historical data.

[![fig10](https://c.mql5.com/3/357/fig11__3.jpg "fig10")](https://c.mql5.com/3/357/fig11__2.jpg "https://c.mql5.com/3/357/fig11__2.jpg")

As you can see, this is an indisputable fact. But the degree of influence on the result is a subject for further research.

3. A buffer overflow has occurred. In my opinion, this is indicated by the different results obtained when testing on the long section 2017.01.01-2022.12.31 and on the short unprofitable section 2020.02.19-2022.12.31, given that the historical data are the same.

![Gayrat Madumarov](https://c.mql5.com/avatar/avatar_na2.png "Gayrat Madumarov")

**[Gayrat Madumarov](/en/users/gara)**
|
7 Jun 2021 at 23:23

It would seem most correct to add up revenues for periods where no buffer overflow was supposed to occur:

2849.07 + 425.20 = 3274.27

But that's not the point. The most important thing is that this system continues to show profitability for five years from the moment of its development.

![Arrows and Curves EA](https://c.mql5.com/i/code/expert.png)
[Arrows and Curves EA](/en/code/19643)

An Expert Advisor based on the "Arrows&Curves" indicator.

![AdaptiveRVICloud_System_HTF](https://c.mql5.com/i/code/indicator.png)
[AdaptiveRVICloud\_System\_HTF](/en/code/19639)

Two AdaptiveRVICloud indicators from different timeframes on one chart.

![Exp_XDidi_Index_Cloud_Duplex](https://c.mql5.com/i/code/expert.png)
[Exp\_XDidi\_Index\_Cloud\_Duplex](/en/code/19647)

Two identical trading systems based on the change in the color of the XDidi\_Index\_Cloud indicator cloud for long and short trades, which can be configured in different ways in one Expert Advisor.

![Exp_ColorJFatl_Digit_Tm_Plus](https://c.mql5.com/i/code/expert.png)
[Exp\_ColorJFatl\_Digit\_Tm\_Plus](/en/code/19653)

A trading system based on ColorJFatl\_Digit indicator signals with the possibility to set a fixed position holding time.