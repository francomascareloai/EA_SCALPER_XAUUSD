# MultiMartin - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/27286

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/27286) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# MultiMartin - expert for MetaTrader 5

[Stanislav Korotky](/en/users/marketeer)

Views:
:   19007

Rating:
:   (32)

Published:
:   5 December 2019, 22:13

Updated:
:   21 June 2021, 21:20
:   \MQL5\Include\MT4Bridge\

    [MT4Mode.mqh](/en/code/download/27286/mt4mode.mqh "MT4Mode.mqh")
    (0.72 KB)
    [view](# "view")

    [MT4MarketInfo.mqh](/en/code/download/27286/mt4marketinfo.mqh "MT4MarketInfo.mqh")
    (3.17 KB)
    [view](# "view")

    [MT4Time.mqh](/en/code/download/27286/mt4time.mqh "MT4Time.mqh")
    (1.59 KB)
    [view](# "view")

    [MT4Account.mqh](/en/code/download/27286/mt4account.mqh "MT4Account.mqh")
    (1.55 KB)
    [view](# "view")

    [MT4Orders.mqh](/en/code/download/27286/mt4orders.mqh "MT4Orders.mqh")
    (110.1 KB)
    [view](# "view")

    [MultiMartin.mq5](/en/code/download/27286/multimartin.mq5 "MultiMartin.mq5")
    (18.59 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/27286.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This is a multi-asset expert adviser based on martingale trading strategy. Its original idea is taken from another expert adviser - [ExpMartin](/en/code/13532) available for MT4.

### Warning. Martingale is easy yet very dangerous strategy. Evaluate your risks carefully.

The strategy is to open reversal trades with increased lots after every loss, until a profitable trade occured or a maximal number of reversals achieved. In both cases next trade will start with initial lot.

[![MultiMartin trading 3 symbols in MT5 tester in visual mode](https://c.mql5.com/18/87/MultiMartinTester__1.png "MultiMartin trading 3 symbols in MT5 tester in visual mode")](https://c.mql5.com/18/87/MultiMartinTester.png "https://c.mql5.com/18/87/MultiMartinTester.png")

In comparison to the original one, this expert adviser demonstrates several points:

* conversion from MT4 to MT5 ([MT4Orders](/en/code/16006) and other header files are used, please find all dependencies attached);
* conversion from [functional programming](https://en.wikipedia.org/wiki/Functional_programming "https://en.wikipedia.org/wiki/Functional_programming") to [OOP](https://en.wikipedia.org/wiki/Object-oriented_programming "https://en.wikipedia.org/wiki/Object-oriented_programming") paradigm, which in essence makes it possible to fulfill the next objective:
* adaptation from single-symbol to multi-symbol processing;
* source code refactoring for easier reading and support;

Also some bugs were fixed.

The program can still be improved in many aspects, for example, operation by timer, volatility analysis, etc. are left out of consideration.

### Input parameters

Specific symbol settings - used for step by step optimization on every work symbol (should be selected as current chart symbol).

* UseTime - enable/disable new trades opening according to the range of hours [HourStart..HourEnd];
* HourStart - starting hour of the range when new trades are allowed; takes effect if only UseTime is true;
* HourEnd - ending hour of the range when new trades are allowed; takes effect if only UseTime is true;
* Lots - initial lot size;
* Factor - multiplication factor for increased lots;
* Limit - maximal number of multiplications, if reached - initial lot is used;
* StopLoss - distance to stoploss in points (no automatic pip adjustement);
* TakeProfit - distance to takeprofit in points (no automatic pip adjustement);
* StartType - trade type for starting order: o - buy, 1 - sell;

Common settings - used for trading.

* Magic - expert id;
* SkipBadTime - an option to wait predefined period of time after trading errors (such as "not enough money", "lost connection" etc);
* WorkSymbols - a string of work symbols and their specific settings, which should be selected after separate optimizations per every symbol; the settings for symbols are separated by semicolon; the format is "name±lots\*factor^limit(sl,tp)[start,stop];...", for example "EURUSD+0.01\*2.0^7(500,500)[2,22];AUDJPY+0.01\*2.0^5(500,500)[1,21]" -- to trade EURUSD and AUDJPY starting with buying (the plus sign) of 0.01 lots, then multiplied by 2 on losses up to 7 or 5 times correspondingly, stoploss and takeprofit are all 500 points, trading window differs by 1 hour;
* Trail - a mode how to treat stop orders: none - fixed level stoploss (no trailing), break-even - trail after profit equal to stoploss size in points, straight - trail from very beginning (may end up with a loss up to the stoploss size in points, but not larger than that);

When used with multi-currency settings, it's advisable to place the expert to a chart with most liquid symbol (where ticks arrive most frequently and trading sessions are continuous), for example EURUSD. Alternatively, one can replace OnTick event handler with OnTimer and start a timer in OnInit.

### Example reports

![MultiMartin trade performance on EURUSD for 3 years 2016-2019](https://c.mql5.com/18/87/mm_report_eurusd_3years.png "MultiMartin trade performance on EURUSD for 3 years 2016-2019")

MultiMartin trade performance on EURUSD for 3 years 2016-2019

![MultiMartin trade performance on EURUSD,AUDJPY,GBPCHF for 2019](https://c.mql5.com/18/87/mm_report_3symbols.png "MultiMartin trade performance on EURUSD,AUDJPY,GBPCHF for 2019")

MultiMartin trade performance on EURUSD,AUDJPY,GBPCHF for 2019

**Last comments |
[Go to discussion](/en/forum/327843)**
(6)

![Stanislav Korotky](https://c.mql5.com/avatar/2010/10/4CA7CFA0-1F0C.jpg "Stanislav Korotky")

**[Stanislav Korotky](/en/users/marketeer)**
|
30 May 2020 at 20:41

**FreddieNBSPdemo:**  
 106 errors on code..

Try to figure out what has been changed in MQL compiler (you did not specify your environment and exact errors). The [source codes](/go?link=https://forge.mql5.io/help/en/guide "MQL5 Algo Forge: Cloud Workspace for Algorithmic Trading Development") were tested on current build at the time of publication. From time to time MQ change their compiler in such incompatible way that it breaks many existing codes.

![Stanislav Korotky](https://c.mql5.com/avatar/2010/10/4CA7CFA0-1F0C.jpg "Stanislav Korotky")

**[Stanislav Korotky](/en/users/marketeer)**
|
1 Jun 2020 at 13:13

**FreddieNBSPdemo:**  
 106 errors on code..

I've [checked](https://www.mql5.com/en/docs/common/GetTickCount64 "MQL5 Documentation: GetTickCount64 function") on the latest build 2470. No errors. You're doing something wrong.

![echinois](https://c.mql5.com/avatar/avatar_na2.png "echinois")

**[echinois](/en/users/echinois)**
|
21 Jun 2021 at 06:42

Hi,

Thanks for sharing this expert. I have 1 error:

do I miss something?

[![](https://c.mql5.com/3/358/2650878479401__1.png)](https://c.mql5.com/3/358/2650878479401.png "https://c.mql5.com/3/358/2650878479401.png")

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
21 Jun 2021 at 07:08

**echinois:**  

Thanks for sharing this expert. I have 1 error:

do I miss something?

[Forum on trading, automated trading systems and testing trading strategies](/en/forum)

[Libraries: MT4Orders](/en/forum/97505/page2#comment_22637061)

[fxsaber](/en/users/fxsaber), 2021.06.02 10:09

Difference from the previous version that was available on the English-language page.

```mql5
// List of changes:
// 01.06.2021
//   Fix: Compatibility with the compiler build 2449 and higher.
```

![Stanislav Korotky](https://c.mql5.com/avatar/2010/10/4CA7CFA0-1F0C.jpg "Stanislav Korotky")

**[Stanislav Korotky](/en/users/marketeer)**
|
21 Jun 2021 at 21:32

**fxsaber:**

Thank you. I have updated MT4Orders to the latest version here.

![Scalp All](https://c.mql5.com/i/code/script.png)
[Scalp All](/en/code/27162)

Opens random positions on marketwatch symbols.

![LotLoss](https://c.mql5.com/i/code/script.png)
[LotLoss](/en/code/27132)

Simple risk management tool.

![BPNN MQL Predictor Demo with library](https://c.mql5.com/i/code/indicator.png)
[BPNN MQL Predictor Demo with library](/en/code/27396)

This is a demo indicator with BPNN neural network library ported from C++ to MQL.

![WmiFor 3.5 for MT5 (with DTW engine)](https://c.mql5.com/i/code/indicator.png)
[WmiFor 3.5 for MT5 (with DTW engine)](/en/code/27436)

This indicator predicts future price movements by searching for similar candle patterns in the rate history.