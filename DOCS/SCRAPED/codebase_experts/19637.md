# Martin for small deposits - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/19637

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/19637) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Martin for small deposits - expert for MetaTrader 5

cobrra  |
[English](javascript:void(false);)

[Русский](/ru/code/19637) [中文](/zh/code/19637) [Español](/es/code/19637) [Deutsch](/de/code/19637) [日本語](/ja/code/19637) [Português](/pt/code/19637)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   9331

Rating:
:   (26)

Published:
:   1 March 2018, 09:37

Updated:
:   27 June 2018, 12:32
:   [Martin for small deposits.mq5](/en/code/download/19637/martin_for_small_deposits.mq5 "Martin for small deposits.mq5")
    (15.56 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/19637.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**The author of the idea**: [udrya](/en/users/cobrra "udrya (cobrra)"), **the mq5 code author**: [barabashkakvn](/en/users/barabashkakvn).

Martingale based Expert Advisor specially designed for small deposits. This feature is enabled through the configurable parameter "Number of bars to be skipped", which means skipping the specified number of bars after the last entry.

How it works: suppose we have the first open BUY position, and a new entry signal emerges on the next bar (the price moved down by "Step between positions"). More signals to open BUY emerge on the next two bars. A regular martingale would open four consecutive positions with the following total volume (taking into account the starting lot of 0.01 and the multiplier of 2.0):

* #1 BUY 0.01
* #2 BUY 0.02
* #3 BUY 0.04
* #4 BUY 0.08

This load can destroy small deposits. Our EA with "Number of bars to be skipped" (let it equal 3) would open the first BUY 0.01 position, skip three bars and open the second BUY 0.02 position.

### Input Parameters

* **Volume** - position volume;
* **Take Profit** (in pips) - take profit value;
* **Step between positions** - step between position;
* **Number of bars to be skipped** - the number of bars to skip before opening a new trade;
* **Volume increase factor** - volume multiplier for each subsequent position;
* **Max volume** - maximum allowable position volume;
* **Min profit for close all** - minimum profit, at which all open position should be closed.

Testing on EURUSD,H1:

![Martin for small deposits](https://c.mql5.com/18/63/Martin_for_small_deposits.png "Martin for small deposits")

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/19637](/ru/code/19637)

**Last comments |
[Go to discussion](/en/forum/229006)**
(15)

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
24 Jan 2022 at 15:51

**linus888 [#](/en/forum/229006#comment_27265880) :**  

Hello Vladimir, thanks for your code. It's interesting.

I am new to MT5 coding.

How could i understand the function of void CloseAllPositions ()?

It seem that the function do not close all position but only the position which hit the [take profit](/en/articles/7113 "Article: Scratching Profits to the Last Pip") pips.

Hope you won't mind to explain me step by step. And how should i change it so that it will close all positions once the biggest opened trade hit the profit pips?

Thanks.

This function closes ALL positions (taking into account the name "Symbol" and "Magic")

Each line has a description. Start asking what exactly you don't understand. I will answer your questions.

![linus888](https://c.mql5.com/avatar/avatar_na2.png "linus888")

**[linus888](/en/users/linus888)**
|
24 Jan 2022 at 16:06

**Vladimir Karputov [#](/en/forum/229006#comment_27265961):**  

This function closes ALL positions (taking into account the name "Symbol" and "Magic")

Each line has a description. Start asking what exactly you don't understand. I will answer your questions.

Hi, thanks for reply.

Will the function will close all open position at the same direction?

for example the EA opened 0.01, 0.02, 0.04, 0.08 lots.how could I change the code so that once the trade of 0.08 lots take profit, it will close all other open positions (0.01, 0.02, 0.04)?

Thanks.

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
24 Jan 2022 at 16:07

**linus888 [#](/en/forum/229006#comment_27266066) :**  

Hi, thanks for reply.

Will the function will close all open position at the same direction?

for example the EA opened 0.01, 0.02, 0.04, 0.08 lots.how could I change the code so that once the trade of 0.08 lots take profit, it will close all other open positions (0.01, 0.02, 0.04)?

Thanks.

The function '**CloseAllPositions**' closes ALL positions opened by the EA. This is clear?

![linus888](https://c.mql5.com/avatar/avatar_na2.png "linus888")

**[linus888](/en/users/linus888)**
|
24 Jan 2022 at 16:13

**Vladimir Karputov [#](/en/forum/229006#comment_27266684):**  

The function '**CloseAllPositions**' closes ALL positions opened by the EA. This is clear?

but it seem not work.

I have tried this in strategy tester, and only the latest open position been closed.

[![](https://c.mql5.com/3/378/Screenshot_2022-01-24_at_11.11.12_PM__1.png)](https://c.mql5.com/3/378/Screenshot_2022-01-24_at_11.11.12_PM.png "https://c.mql5.com/3/378/Screenshot_2022-01-24_at_11.11.12_PM.png") [![](https://c.mql5.com/3/378/Screenshot_2022-01-24_at_11.11.12_PM__3.png)](https://c.mql5.com/3/378/Screenshot_2022-01-24_at_11.11.12_PM__2.png "https://c.mql5.com/3/378/Screenshot_2022-01-24_at_11.11.12_PM__2.png")

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
24 Jan 2022 at 16:17

**linus888 [#](/en/forum/229006#comment_27268468) :**  

but it seem not work.

I have tried this in strategy tester, and only the latest open position been closed.

Put a check in the function - if the position was not closed, then print the reason.

And, if you have questions, ALWAYS read the messages in JOURNAL!!!

![JS_SISTEM_2](https://c.mql5.com/i/code/expert.png)
[JS\_SISTEM\_2](/en/code/19633)

The Expert Advisor uses three iMAs (Moving Average, MA), one iOsMA (Moving Average of Oscillator and one iRVI (Relative Vigor Index, RVI). Trailing stop is based on the High/Low of earlier bars.

![ColorSRoC](https://c.mql5.com/i/code/indicator.png)
[ColorSRoC](/en/code/19631)

The smoothed S-RoC indicator of the relative price increment by Fred Shutsman.

![XDidi_Index_System_HTF](https://c.mql5.com/i/code/indicator.png)
[XDidi\_Index\_System\_HTF](/en/code/19638)

Two "Didi Needles" indicators from different timeframes on one chart.

![AdaptiveRVICloud_System_HTF](https://c.mql5.com/i/code/indicator.png)
[AdaptiveRVICloud\_System\_HTF](/en/code/19639)

Two AdaptiveRVICloud indicators from different timeframes on one chart.