# Candle Filter - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/58516

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/58516) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Candle Filter - indicator for MetaTrader 5

[Gustavo Franthesco Kerntopf](/en/users/virologustavo)  |
[English](javascript:void(false);)

[Русский](/ru/code/58516) [中文](/zh/code/58516) [Español](/es/code/58516) [Deutsch](/de/code/58516) [日本語](/ja/code/58516) [Português](/pt/code/58516) [한국어](/ko/code/58516) [Français](/fr/code/58516) [Italiano](/it/code/58516) [Türkçe](/tr/code/58516)

Views:
:   4027

Rating:
:   (3)

Published:
:   22 May 2025, 11:39
:   [Candle\_Filter.mq5](/en/code/download/58516/candle_filter.mq5 "Candle_Filter.mq5")
    (16.3 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/58516.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

### Main Features

Candle filtering:

The indicator allows you to display only those candles that meet a certain criterion:

1. Bullish: Displays only bullish candles.
2. Bearish: Displays only bearish candles.
3. Doji: Displays only Doji candles.
4. All: Displays all candles with their respective colours.

---

Doji candle detection:

The detection of Doji candles is based on a configurable threshold (`InpDojiThreshold`), which defines the ratio between the body of the candle and its total range. This guarantees accuracy in identifying neutral candles.

---

Candle filtering: Colour customisation:

The trader can define custom colours for each type of candle:

- Bullish: Default colour is green (`clrForestGreen`).  
 - Bearish: Default colour is dark red (`clrDarkRed`).  
 - Doji: Default colour is gold (`clrGold`).  
 - Bottom: Default colour is black (`clrBlack`).

---

Chart cleaning: 

The indicator removes unnecessary visual elements from the chart, such as grids, volumes and period separators, to facilitate visual analysis.

---

How it works:

1. initialisation (`OnInit`):

> Buffers are mapped to store OHLC values (open, high, low, close) and the corresponding colours.

> Custom colours are assigned to the indicator's colour indices.

> The chart is cleaned up by removing unnecessary visual elements.

2. Main Calculation (`OnCalculate`)

> For each candle on the chart, the indicator checks whether it meets the selected criterion (`InpCandleShow`).

> Candles that do not meet the criterion are displayed in background colour (`InpBackgroundColor`).

> Candles that meet the criterion are displayed with custom colours.

3. Deinitialisation (`OnDeinit`):

> When the indicator is removed, the original chart settings are restored, ensuring that the trading environment returns to its initial state.

---

Usage examples:

* Trend Analysis:

> Set `InpCandleShow` to `ShowBullish` or `ShowBearish` to focus only on candles that indicate an uptrend or downtrend.

* Identifying Neutral Zones:

  Use `ShowDoji` to highlight neutral candles and identify possible reversal or consolidation points.

* Full Visualisation:

> Choose `ShowAllCandle` to display all candles with their respective colours, allowing an overview of market behaviour.

---

Improvements Implemented:

* Accurate Doji Detection: The use of a configurable threshold (`InpDojiThreshold`) ensures that only truly neutral candles are classified as Doji.
* Full Customisation: The trader has complete control over the colours and background of the chart.
* Automatic Cleaning: The indicator automatically removes unnecessary visual elements, improving the readability of the chart.

---

 ![](https://c.mql5.com/18/162/Candle_filter.png)

Translated from Portuguese by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/pt/code/58516](/pt/code/58516)

![Basket Manager EA](https://c.mql5.com/i/code/expert.png)
[Basket Manager EA](/en/code/59651)

This EA is meant to impose a few rules to manage baskets.

![RSI Divergence](https://c.mql5.com/i/code/indicator.png)
[RSI Divergence](/en/code/58104)

This indicator takes RSI divergences and plots them in buffers to automate EAs

![Function for checking whether the market is open for trading at the moment by the current symbol](https://c.mql5.com/i/code/script.png)
[Function for checking whether the market is open for trading at the moment by the current symbol](/en/code/57948)

The function can be useful to not overload the server with trade requests at times when the market is closed for trading

![Equity and Balance Indicator - History based](https://c.mql5.com/i/code/indicator.png)
[Equity and Balance Indicator - History based](/en/code/59744)

This indicator reads the trade history and plots the Cumulative P & L over time, helping visual traders to see how much money they are making or losing over time.
This current version has a difference of 0.02% marginal error, due to rounding floats, and calculation methods. It can be considered extremely precise with this marginal error.