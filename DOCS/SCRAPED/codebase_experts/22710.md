# BestInterval - library for MetaTrader 5

Source: https://www.mql5.com/en/code/22710

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/22710) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# BestInterval - library for MetaTrader 5

[fxsaber](/en/users/fxsaber)  |
[English](javascript:void(false);)

[Русский](/ru/code/22710) [中文](/zh/code/22710) [Español](/es/code/22710) [Deutsch](/de/code/22710) [日本語](/ja/code/22710) [Português](/pt/code/22710)

Views:
:   8757

Rating:
:   (45)

Published:
:   28 December 2018, 13:09

Updated:
:   17 January 2019, 11:29
:   \MQL5\Include\fxsaber\BestInterval\

    [Files.mqh](/en/code/download/22710/files.mqh "Files.mqh")
    (0.85 KB)
    [view](# "view")

    [Deal.mqh](/en/code/download/22710/deal.mqh "Deal.mqh")
    (2.28 KB)
    [view](# "view")

    [Interval.mqh](/en/code/download/22710/interval.mqh "Interval.mqh")
    (3.49 KB)
    [view](# "view")

    [BestInterval.mqh](/en/code/download/22710/bestinterval.mqh "BestInterval.mqh")
    (22.97 KB)
    [view](# "view")

    \MQL5\Experts\fxsaber\

    [BestInterval\_Example.mq5](/en/code/download/22710/bestinterval_example.mq5 "BestInterval_Example.mq5")
    (0.38 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/22710.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Market laws depend on the intra-day or intra-week intervals. This is why it is reasonable to limit your trading system by time.

For example, there are scalping trading systems that are good at trading at Asian and American sessions. Disabling the trading system during high volatility periods is also practiced.

Accordingly, a problem arises: **How to find the best time for trading with your TS?** As a rule, this interval is searched for either by intuition or by shouldering the standard Tester. Let us forget about intuition as a non-technical case. As to using the standard Tester in solving such a problem, this automatically leads to significantly increasing the number of runs and, accordingly, the Optimization and the money (Cloud). However, there will still be some points that could be improved.

It is also possible that there is a really good TS. However, its positive features are hidden, since there is no time filtere in it. After all, if it were possible to find a suitable trading interval for that TS, it would not be trashed, but would trigger additional research...

### Implementation.

This cross-platform library allows the system to find the optimal trading interval very quickly and as efficiently as possible.

Example of use with comments:

```mql5
#include <MT4Orders.mqh> // <a2>https://www.mql5.com/en/code/16006</a2>

#include <fxsaber\BestInterval\BestInterval.mqh> // Calculating the best trading interval

void OnDeinit( const int )
{
  BESTINTERVAL BestInterval; // So we have created an object to calculate the best trading interval
  
  BestInterval.Set(); // Placed trading history
  
  const int AmountIntervals = 3; // How many worst intervals should be deleted
  
  for (int i = 0; i < AmountIntervals; i++)
    if (BestInterval.DeleteWorseInterval()) // If we have deleted something
      Print(BestInterval.ToString());       // Print the trading data obtained
    else
      break;                                // Else, we will exit
}
```

Now, let's have a look at the real application of the library within the scalper EA.

### 

### Scalper.

Let's launch the round-the-clock scalper in MT5 Tester. We will see the following

![](https://c.mql5.com/18/76/BestInterval1.png)

look at the single pass log

```mql5
Amount of Delete Intervals = 0
00:00:00 - 23:59:59 : Profit = 20121.00, Total = 1138, PF = 1.68, Mean = 17.68
SUMMARY: 00:00:00 - 23:59:59 : Profit = 20121.00, Total = 1138, PF = 1.68, Mean = 17.68
```

here is the raw passage data - no intervals are discarded.

Now let's provide consecutively the further log entries, where the effect of deleting weak intervals would be shown gradually.

One interval is deleted:

```mql5
Amount of Delete Intervals = 1
00:00:00 - 10:08:04 : Profit = 6830.00, Total = 203, PF = 3.10, Mean = 33.65
11:05:24 - 23:59:59 : Profit = 17086.00, Total = 819, PF = 1.93, Mean = 20.86
SUMMARY: 00:00:00 - 23:59:59 : Profit = 23916.00, Total = 1022, PF = 2.10, Mean = 23.40
```

Highlighted strings are trading intervals. We can see that there is no trading from 10-11 am. The interval is deleted.

Two intervals are deleted:

```mql5
Amount of Delete Intervals = 2
00:00:00 - 10:08:04 : Profit = 6830.00, Total = 203, PF = 3.10, Mean = 33.65
11:05:24 - 12:21:06 : Profit = 2767.00, Total = 112, PF = 2.46, Mean = 24.71
13:02:59 - 23:59:59 : Profit = 15915.00, Total = 664, PF = 2.17, Mean = 23.97
SUMMARY: 00:00:00 - 23:59:59 : Profit = 25512.00, Total = 979, PF = 2.36, Mean = 26.06
```

Finally, three intervals are deleted

```mql5
Amount of Delete Intervals = 3
00:00:00 - 10:08:04 : Profit = 6830.00, Total = 203, PF = 3.10, Mean = 33.65
11:05:24 - 12:21:06 : Profit = 2767.00, Total = 112, PF = 2.46, Mean = 24.71
13:02:59 - 17:26:06 : Profit = 7476.00, Total = 348, PF = 1.98, Mean = 21.48
17:47:36 - 23:59:59 : Profit = 9640.00, Total = 288, PF = 3.31, Mean = 33.47
SUMMARY: 00:00:00 - 23:59:59 : Profit = 26713.00, Total = 951, PF = 2.57, Mean = 28.09
```

Note how the TS parameters improve with each deleted interval.

Let's apply the calculated filter to the TS

![](https://c.mql5.com/18/76/BestInterval2.png)

We can visually compare the two charts BEFORE and AFTER. Perhaps, someone would make an appropriate GIF animation for clarity...

As a result, the TS parameters have been improved significantly almost for free: We have spent as little efforts and time as possible.

### OnTester.

The example above was based on adding just two strings into the initial EA

```mql5
#define BESTINTERVAL_ONTESTER // Optimization criterion is the profit of the best interval.
#include <fxsaber\BestInterval\BestInterval.mqh> // Calculating the best trading interval
```

The highlighted string allows you not to write anything else in the EA. At the same time, the custom optimization criterion is also specified, allowing the optimizer not to look for good intervals in the old-fashioned way. The criterion immediately returns the TS result on a good interval calculated and show the TS potential much better than when using standard Optimization.

To apply the found interval upon calculating thereof, set **BestInteval Action = true** in its inputs.

![](https://c.mql5.com/18/76/BestInterval3.png)

### Summary.

All TSes should be broadly checked, including the best trading interval calculation. Therefore, this tool is a must-have.

It is reasonable to connect to all current, past, and future TSes (using the two strings above) the search for an optimal trading interval. This implementation facilitates considerably creating a profitable TS or improving the robustness of an existing one

### Features.

* It is recommended to enable/disable trading on the intervals detected, using the [virtual trading environment](/en/code/22577).
* The library algorithm is very fast. It can be easily implemented in third-party trading analyzers for the same purpose.
* This is my own idea. Perhaps there are similar solutions.
* I have not got around yet to implement intra-week intervals. Maybe later...
* The library is a cross-platform one. It is relevant for both MT4 and MT5.
* The best interval is calculated and then applied in the Tester without modifying the original EA source code.

### 

### P.S.

Please share your experience of applying the library BEFORE and AFTER (as described above) as screenshots and appropriate MT4/5 single pass log segments.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/22710](/ru/code/22710)

**Last comments |
[Go to discussion](/en/forum/296664)**
(283)

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
25 Jun 2024 at 17:53

**hini symbols and strategies?**

It is possible, that's how I do it. I can't help you with an example, as it requires time, which I don't have.

![hini](https://c.mql5.com/avatar/2024/3/65e98921-0708.jpg "hini")

**[hini](/en/users/hini)**
|
25 Jun 2024 at 18:02

**fxsaber [#](/ru/forum/283611/page27#comment_53788053):**  

It is possible, that's what I do. I can't help you with an example, as it requires time, which I don't have.

ok, thanks

![Dmitrii Verevkin](https://c.mql5.com/avatar/2025/10/68f30ad7-e53f.jpg "Dmitrii Verevkin")

**[Dmitrii Verevkin](/en/users/verevkin.dmitry)**
|
14 Oct 2025 at 12:56

Hi!

An error appears during compilation. Has anyone encountered it?

[![](https://c.mql5.com/3/476/133479260390__1.png)](https://c.mql5.com/3/476/133479260390.png "https://c.mql5.com/3/476/133479260390.png")

I searched the forum, I don't think it's been discussed.

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
14 Oct 2025 at 14:42

**Dmitrii Verevkin [#](/ru/forum/283611/page29#comment_58265718):**  

an error appears during compilation.

Add these lines to **Deal.mqh**.

```mql5
#include "Deal_Base.mqh"

struct DEAL : public DEAL_BASE
{
  int Index;

  void ToNull( DEAL &Deals[] ) const
  {
  #ifdef __MQL5__
    Deals[this.Index].DEAL_BASE::ToNull();
  #else // __MQL5__ - https://www.mql5.com/ru/forum/322209#comment_13314616
    Deals[this.Index].ToNull();
  #endif // __MQL5__

    return;
  }
  
  void operator =( const DEAL_BASE &bDeal )
  {
    /*this.*/ DEAL_BASE::operator=(bDeal); // https://www.mql5.com/ru/forum/1111/page3368#comment_48437633
    
    return;
  }  
};
```

![Dmitrii Verevkin](https://c.mql5.com/avatar/2025/10/68f30ad7-e53f.jpg "Dmitrii Verevkin")

**[Dmitrii Verevkin](/en/users/verevkin.dmitry)**
|
14 Oct 2025 at 18:00

**Dmitrii Verevkin [#](/ru/forum/283611/page29#comment_58265718):**  

Hi!

I get an error when compiling. Has anyone encountered it?

I searched the forum, I don't think it's been discussed.

It helped.

thanks!

![HLCrossSigForWPR_HTF](https://c.mql5.com/i/code/indicator.png)
[HLCrossSigForWPR\_HTF](/en/code/22711)

Indicator HLCrossSigForWPR with the option of selecting its timeframe in its input parameters

![RJTX_Matches_Smoothed_Alert](https://c.mql5.com/i/code/indicator.png)
[RJTX\_Matches\_Smoothed\_Alert](/en/code/22712)

Indicator RJTX\_Matches\_Smoothed featuring alerts, emails and push notifications for smartphones

![Price_Momentum_Oscillator](https://c.mql5.com/i/code/indicator.png)
[Price\_Momentum\_Oscillator](/en/code/22709)

Indicator Price Momentum Oscillator

![Extreme EA](https://c.mql5.com/i/code/expert.png)
[Extreme EA](/en/code/22703)

Indicators iCCI (Commodity Channel Index, CCI) and two iMAs (Moving Average, MA) are used.