# AutoCloseOnProfitLoss Expert - Automatically Close All Positions on Profit/Loss - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/59371

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/59371) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# AutoCloseOnProfitLoss Expert - Automatically Close All Positions on Profit/Loss - expert for MetaTrader 5

[Duy Van Nguy](/en/users/wazatrader)  |
[English](javascript:void(false);)

[Русский](/ru/code/59371) [中文](/zh/code/59371) [Español](/es/code/59371) [Deutsch](/de/code/59371) [日本語](/ja/code/59371) [Português](/pt/code/59371) [한국어](/ko/code/59371) [Français](/fr/code/59371) [Italiano](/it/code/59371) [Türkçe](/tr/code/59371)

Views:
:   12222

Rating:
:   (5)

Published:
:   14 May 2025, 04:17
:   [AutoCloseOnProfitLoss.mq5](/en/code/download/59371/autocloseonprofitloss.mq5 "AutoCloseOnProfitLoss.mq5")
    (5.86 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/59371.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

## Introduction

The AutoCloseOnProfitLoss Expert Advisor (EA) is a powerful automation tool for MetaTrader 5, designed to close all open positions when predefined profit or loss targets are reached. This EA is perfect for traders who want to manage risk and secure profits without manual intervention. Whether you're a scalper targeting quick gains or a long-term trader protecting capital, this EA offers a reliable, hands-free solution.

## Features

* **Automated Position Closing**: Automatically closes all open positions when the total profit or loss meets the specified threshold.
* **Customizable Targets**: Set profit and loss targets in your account currency (e.g., USD, EUR).
* **Flexible Options**: Independently enable or disable closing based on profit or loss.
* **User Notifications**: Displays alerts and logs in the terminal when positions are closed.
* **Efficient and Lightweight**: Runs continuously with minimal CPU usage, ideal for ongoing trade management.

## How It Works

The EA monitors the total profit or loss of all open positions using the PositionGetDouble(POSITION\_PROFIT) function in MetaTrader 5. It compares this value against the user-defined TargetProfit and MaxLoss thresholds. If either condition is met (and the corresponding feature is enabled), the EA closes all positions using market orders and notifies the user through alerts (if enabled) and terminal logs.

## Installation

1. Download the AutoCloseOnProfitLoss.mq5 file from the MQL5 CodeBase.
2. Open MetaTrader 5 and go to **File > Open Data Folder**.
3. Navigate to **MQL5 > Experts** and copy the .mq5 file into this folder.
4. Restart MetaTrader 5 or refresh the Navigator panel.
5. Locate the EA in the Navigator under **Expert Advisors**, then drag it onto a chart to activate.

## Input Parameters

* **TargetProfit** (default: 100.0): The profit target in your account currency to close all positions.
* **MaxLoss** (default: -50.0): The maximum loss in your account currency (must be a negative value) to close all positions.
* **EnableProfitClose** (default: true): Enable or disable closing positions when the target profit is reached.
* **EnableLossClose** (default: true): Enable or disable closing positions when the maximum loss is reached.
* **ShowAlerts** (default: true): Enable or disable alerts in MetaTrader 5 when positions are closed.

## Usage

1. Drag the AutoCloseOnProfitLoss EA onto any chart in MetaTrader 5.
2. In the dialog box that appears, configure the input parameters:
   * Set your desired TargetProfit and MaxLoss values.
   * Enable or disable profit/loss closing as needed.
   * Choose whether to display alerts.
3. Click **OK** to start the EA.
4. The EA will continuously monitor all open positions and close them if the specified conditions are met.
5. Check the **Experts** or **Journal** tab in MetaTrader 5 for logs and results.

## Example

Suppose you set TargetProfit = 100.0, MaxLoss = -50.0, EnableProfitClose = true, and EnableLossClose = true. If your open positions reach a total profit of $120, the EA will close all positions and display an alert: "All positions closed! Reason: Target profit reached: 120.00". If the total loss reaches -$60, the EA will close all positions with an alert: "All positions closed! Reason: Max loss reached: -60.00".

## Notes

* The EA requires open positions to take action; otherwise, it will log the current profit/loss and continue monitoring.
* Positions are closed using market orders, so slippage may occur depending on market conditions.
* Test the EA on a demo account first to ensure it suits your trading strategy.
* Unlike a script, this EA runs continuously until manually stopped or removed from the chart.

## Feedback

If you have suggestions or encounter issues, please leave a comment on the MQL5 CodeBase page or [contact me](/en/users/wazatrader) through the MQL5 community. Your feedback is valuable for improving this tool!

## 

Author: Duy Van Nguy  
Contact: [MQL5 Link](/en/users/wazatrader)  
Updated: May 14, 2025

##

**Last comments |
[Go to discussion](/en/forum/486456)**
(5)

![Alexander Orekhov](https://c.mql5.com/avatar/2020/5/5ECA6617-5CF3.jpg "Alexander Orekhov")

**[Alexander Orekhov](/en/users/aalex198555)**
|
16 May 2025 at 17:13

It closes all symbols or only the symbol where EA is placed?

![Duy Van Nguy](https://c.mql5.com/avatar/2025/6/68454827-85be.jpg "Duy Van Nguy")

**[Duy Van Nguy](/en/users/wazatrader)**
|
17 May 2025 at 03:36

The EA will close all positions across all symbols when the profit/loss threshold is reached, not just the symbol where the EA is placed.

![Duy Van Nguy](https://c.mql5.com/avatar/2025/6/68454827-85be.jpg "Duy Van Nguy")

**[Duy Van Nguy](/en/users/wazatrader)**
|
17 May 2025 at 03:36

**Alexander Orekhov [#](/en/forum/486456#comment_56719303):**  
 It closes all symbols or only the symbol where EA is placed?

The EA will close all positions across all symbols when the profit/loss threshold is reached, not just the symbol where the EA is placed.

![Abdelsalam Gebrel Abdelsalam Ahmed](https://c.mql5.com/avatar/2024/2/65c7e323-11b6.jpg "Abdelsalam Gebrel Abdelsalam Ahmed")

**[Abdelsalam Gebrel Abdelsalam Ahmed](/en/users/abdogebrel)**
|
31 May 2025 at 10:30

**Duy Van Nguy [#](/en/forum/486456#comment_56720922):**  
 The EA will close all positions across all symbols when the profit/loss threshold is reached, not just the symbol where the EA is placed.

hello.

thank you for your eforts but it will be more good , if EX close buy orders and sell orders seperated , and close orders only on chart

![Nguyen Van Thanh Hoang](https://c.mql5.com/avatar/2019/6/5D15955C-9DFF.PNG "Nguyen Van Thanh Hoang")

**[Nguyen Van Thanh Hoang](/en/users/chumenh)**
|
2 Nov 2025 at 06:02

Hi Dao,

 Could you please help to create this ea for MT4 ?

![Swaps Monitor for a Single Symbol](https://c.mql5.com/i/code/indicator.png)
[Swaps Monitor for a Single Symbol](/en/code/59368)

A simple utility for monitoring long and short swaps of a single symbol. If your broker-dealer's swaps are specified in points instead of account currency, this utility automatically converts points into account currency. Swaps are tripled on Wednesday. Horizontal and vertical alignment can be adjusted in the inputs.

![Function for converting the number of seconds to years, months, days, hours, minutes, seconds](https://c.mql5.com/i/code/script.png)
[Function for converting the number of seconds to years, months, days, hours, minutes, seconds](/en/code/58198)

It is taken into account that there are 30 days in a month, 365 days in a year The script demonstrates the counter of time until the beginning of the new year

![Bands R-squared](https://c.mql5.com/i/code/expert.png)
[Bands R-squared](/en/code/58268)

Simple Expert Advisor with custom R-squared optimisation function

![DailyHighLow Indicator for MQL5](https://c.mql5.com/i/code/indicator.png)
[DailyHighLow Indicator for MQL5](/en/code/59477)

The DailyHighLow indicator is a versatile tool designed for MetaTrader 5 (MQL5) to display high and low price levels on a chart based on a specified timeframe. This indicator is particularly useful for traders who rely on key price levels for decision-making, offering flexibility through customizable timeframes and price calculation methods.