# Virtual SL TP Pending with SL Trailing for Symbol Chart - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/49146

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/49146) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Virtual SL TP Pending with SL Trailing for Symbol Chart - expert for MetaTrader 4

[Deleted]

Views:
:   8731

Rating:
:   (5)

Published:
:   10 April 2024, 05:09

Updated:
:   11 April 2024, 12:10
:   [Virtual SL TP V1.mq4](/en/code/download/49146/virtual_sl_tp_v1.mq4 "Virtual SL TP V1.mq4")
    (4.64 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/49146.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

T"Virtual\_SL\_TP\_Pending\_with\_SL\_Trailing.mq4." It's designed to manage trades by setting virtual stop loss and take profit levels, along with a virtual pending order with an optional trailing stop loss feature.

Here's a breakdown of the script:

1. **Copyright and Link**: Specifies the copyright information and a link to the creator's website.
2. **Version**: Indicates the version of the script.
3. **Description**: Provides information about the script, including the creator's email address, intellectual property details, and a warning about using the software at your own risk.
4. **Input Parameters**: External variables that allow users to customize the behavior of the EA, including:
   * StopLossPoints : Initial Stop Loss in points.
   * TakeProfitPoints : Initial Take Profit in points.
   * SpreadThreshold : Spread threshold for virtual stop loss/take profit in points.
   * TrailingStopPoints : Trailing stop in points for the virtual pending order.
   * EnableTrailing : Option to enable or disable trailing stop.
5. **Global Variables**: Variables used throughout the script to store initial spread, virtual stop loss, virtual take profit, and pending order price.
6. **Initialization Function ( OnInit )**: Initializes the EA when it's attached to a chart. It calculates the initial virtual stop loss, take profit, and pending order price based on the input parameters.
7. **Tick Function ( OnTick )**: Called on every tick of the price. It checks if the spread has increased beyond the threshold and adjusts the virtual stop loss, take profit, and pending order price accordingly. It also monitors if the price hits the virtual stop loss or take profit and closes the position. Additionally, if trailing stop is enabled and the price reaches the pending order price, it places a virtual pending order with a trailing stop loss.
8. **Close Position Function ( ClosePosition )**: Closes the position when the price hits the virtual stop loss or take profit.
9. **Place Pending Order Function ( PlacePendingOrder )**: Places a virtual pending order with a trailing stop loss if trailing stop is enabled.

This EA provides a flexible way to manage trades using virtual levels and a trailing stop feature, allowing traders to automate their trade management process in MetaTrader 4.

[![](https://c.mql5.com/18/155/Screenshot_2024-04-09_200347__1.png)](https://c.mql5.com/18/155/Screenshot_2024-04-09_200347.png "https://c.mql5.com/18/155/Screenshot_2024-04-09_200347.png")

**Last comments |
[Go to discussion](/en/forum/465387)**
(2)

![kingmaarin](https://c.mql5.com/avatar/avatar_na2.png "kingmaarin")

**[kingmaarin](/en/users/kingmaarin)**
|
12 Apr 2024 at 01:35

Thanks for the widget works well.

![vienert](https://c.mql5.com/avatar/avatar_na2.png "vienert")

**[vienert](/en/users/vienert1555)**
|
11 Nov 2024 at 04:17

Por desgracia no me carga, lastima.

![Close Basket Pairs v1](https://c.mql5.com/i/code/expert.png)
[Close Basket Pairs v1](/en/code/49145)

This MQL4 EA is designed to close positions for a basket of currency pairs based on certain profit and loss thresholds.

![Reverse Trades For All Symbols Script](https://c.mql5.com/i/code/script.png)
[Reverse Trades For All Symbols Script](/en/code/49137)

Reverses all open trades after Closure for all symbols .

![Classic and Virtual Trailing](https://c.mql5.com/i/code/expert.png)
[Classic and Virtual Trailing](/en/code/49326)

Classic & Virtual Trailing for MT4

![MQL4 Implementation of onTrade Event Handler](https://c.mql5.com/i/code/expert.png)
[MQL4 Implementation of onTrade Event Handler](/en/code/49474)

This is a simple code to mimic onTradeTransaction Event handler defined in MQL5