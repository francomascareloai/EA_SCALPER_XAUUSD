# FIR_filter - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/120

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/120) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# FIR\_filter - indicator for MetaTrader 5

gpwr  |
[English](javascript:void(false);)

[Русский](/ru/code/120) [中文](/zh/code/120) [Español](/es/code/120) [Deutsch](/de/code/120) [日本語](/ja/code/120) [Português](/pt/code/120) [한국어](/ko/code/120) [Français](/fr/code/120) [Italiano](/it/code/120) [Türkçe](/tr/code/120)

Published by:
:   [Vladimir](/en/users/gpwr)

Views:
:   11526

Rating:
:   (24)

Published:
:   9 June 2010, 10:23

Updated:
:   22 November 2016, 07:32
:   [fir\_filter.mq5](/en/code/download/120/fir_filter.mq5 "fir_filter.mq5")
    (2.41 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/120.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The indicator shows [moving average](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma), calculated using the digital filter. In this example the Hann Window is used.

You can use the other filter coefficients, just modify them in [OnInit()](/en/docs/basis/function/events#oninit):

```mql5
   for(int k=0;k<Per;k++)
   {
      w[k]=0.5-0.5*MathCos(2.*pi*(k+1)/(Per+1));
      wsum+=w[k];
   }
```

![FIR_filter](https://c.mql5.com/18/0/fir__3.png "FIR_filter")

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/120](/ru/code/120)

**Last comments |
[Go to discussion](/en/forum/1152)**
(8)

![Evgeniy Logunov](https://c.mql5.com/avatar/avatar_na2.png "Evgeniy Logunov")

**[Evgeniy Logunov](/en/users/lea)**
|
9 Jun 2010 at 23:18

**Prival:**  

As for the accuracy of pi, accuracy is never unnecessary.  We  can always load the result. Here is a simple way to set it [https://www.mql5.com/en/code/8309](/en/code/8309).

You should not define pi as a variable. Let it be a constant.

But you don't need extra characters either. For double we know the number of characters that can be stored.

![Prival](https://c.mql5.com/avatar/2010/5/4BDE08C1-2DC0.jpg "Prival")

**[Prival](/en/users/prival)**
|
9 Jun 2010 at 23:58

**lea:**  

You should not define pi as a variable. It is better to let it be a constant.

But you don't need extra characters either. For double, we know the number of characters that can be stored.

you are wrong. i lost 2 weeks in my time simply because pi was not defined with maximum precision. i checked the spectrum construction obtained in matkad with that made using the FFT library [https://www.mql5.com/en/code/9696](/en/code/9696).

![Vladimir](https://c.mql5.com/avatar/2010/5/4C030557-C801.jpg "Vladimir")

**[Vladimir](/en/users/gpwr)**
|
10 Jun 2010 at 02:35

**Prival:**  

Are you sure the formula is correct ? Please compare it with these [http://dspsystem.narod.ru/add/win/win.html](https://www.mql5.com/go?link=http://dspsystem.narod.ru/add/win/win.html "http://dspsystem.narod.ru/add/win/win.html")

Regarding terminology, sorry, you change not filter coefficients, but window coefficients. They are different things. In your example the digital filter (DF) is a moving average (MA),  and  it (MA) can be used with any window (a small part of them is given in the link above). Each window, and there are many, serves a specific purpose. Usually it improves some property of the DF, but you have to pay for it, nothing is given for nothing, distortions are introduced into the output spectrum.

There are different formulas for the Hahn window and other similar windows. They are all identical if you think about it. The formula in your link has one big drawback: zero window values at n=0 and n=N-1. Since there is no sense to multiply prices by zeros, it turns out that the window only exists for prices with n=1...n=N-2. Now let's denote the number of prices for which the window is not equal to zero through Per, as I have, then we get N-2=Per or N=Per+2. Substitute this N into Hahn's formula in your link and you will get the same formula as mine.

About the name of the indicator. The name is right. By definition, what I have constructed is a **digital filter with finite impulse response**

The [difference equation](https://en.wikipedia.org/wiki/Difference_equation "http://en.wikipedia.org/wiki/Difference_equation") that defines the output of an FIR filter in terms of its input is:

y[n]=b\_0 x[n] + b\_1 x[n-1] + ... + b\_N x[n-N]

where:

* *x*[*n*] is the input signal,* *y*[*n*] is the output signal,* *bi* **are the filter coefficients**, and* *N* is the filter order

See here [http://en.wikipedia.org/wiki/Finite\_impulse\_response](https://en.wikipedia.org/wiki/Finite_impulse_response "http://en.wikipedia.org/wiki/Finite_impulse_response")

I've been in electronics for 21 years. I know this stuff. Thanks always for the comments though. It's nice to talk to knowledgeable people.

![Prival](https://c.mql5.com/avatar/2010/5/4BDE08C1-2DC0.jpg "Prival")

**[Prival](/en/users/prival)**
|
10 Jun 2010 at 10:58

**gpwr:**  

There are different formulas for the Hahn window and other similar windows. They are all identical if you think about it. The formula in your link has one big disadvantage: zero values of the window at n=0 and n=N-1. Since there is no sense to multiply prices by zeros, it turns out that the window only exists for prices with n=1...n=N-2. Now let's denote the number of prices for which the window is not equal to zero through Per, as I have, then we get N-2=Per or N=Per+2. Substitute this N into Hahn's formula in your link and you will get the same formula as mine.

....

Thanks for the wikipedia link. I will try to show with formulas,   what you have done.

For your case it would be more accurate to write this formula as follows

y[n]=a\_0\*b\_0\* x[n] +a\_1\* b\_1\* x[n-1] + ... + a\_N\*b\_N\* x[n-N]

x[n] is the input signal,

y[n] is the output signal,

bi are the filter coefficients, and

**а[****i] are the   window coefficients,**

N is the filter order

I.e. you have convolved the DF coefficients(b) and the window coefficients(a).

Yes, you are right that there are different formulas for writing window functions. But this difference is caused by the fact in which domain the convolution is performed, in the frequency or time domain. And these formulas are rigidly linked by the Fourier transform [http://ru.wikipedia.org/wiki/Оконное\_преобразование\_Фурье.](https://ru.wikipedia.org/wiki/%D0%9E%D0%BA%D0%BE%D0%BD%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%B5%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%A4%D1%83%D1%80%D1%8C%D0%B5 "http://ru.wikipedia.org/wiki/%D0%9E%D0%BA%D0%BE%D0%BD%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%B5%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D0%A4%D1%83%D1%80%D1%8C%D0%B5")

Although the formulas are similar, you should never confuse in which domain the convolution is performed, otherwise you get an abracodabra.

Now about n. In the formula, it's really important to determine whether it starts at 0 or 1 ("...the window only exists for prices with n=1.....**n=N**), if you shift by 1, then everything shifts and N-1, becomes N, not N-2

The exact formula for the Hahn window looks like this

p(t) = 0.5[1+cos(pi\*t/tac)].

For those who want to explore this topic a little deeper I have attached a file with a lecture.

***For traders***

I will try to explain what we are talking about using an example you all know.

[https://www.metatrader5.com/ru/terminal/help/indicators/trend\_indicators/ma](https://www.metatrader5.com/ru/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/ru/terminal/help/indicators/trend_indicators/ma")

Everyone knows:

(a) Simple Moving Average (SMA).

Its window is rectangular, i.e. each price value has the same weight a[i]= 1, regardless of the depth of history.

b) Linear Weighted Moving Average (LWMA)

In a weighted moving average, the most recent data is given more weight and earlier data is given less weight.

i.e. window coefficients a[1]=1, a[2]=1/2,a[3]=1/3 .... a[n]=1/n

SO. **gpwr** also glad to communicate, a radio engineer will always find a common language with an electronic engineer, especially if both are not new in this business and speak a universal language - the language of mathematics.

![Maks](https://c.mql5.com/avatar/avatar_na2.png "Maks")

**[Maks](/en/users/maxer)**
|
11 Aug 2010 at 21:47

there are only 3 indicators - price, [closing price](https://www.mql5.com/en/docs/constants/indicatorconstants/prices#enum_applied_price_enum "MQL5 Documentation: Price constants"), and simple moving average

![WPR_Hist](https://c.mql5.com/i/code/indicator.png)
[WPR\_Hist](/en/code/119)

It searches for tops or bottoms of price movement.

![HI LO Indicator](https://c.mql5.com/i/code/indicator.png)
[HI LO Indicator](/en/code/117)

This is HILO Indicator

![Export historical data](https://c.mql5.com/i/code/script.png)
[Export historical data](/en/code/124)

The script purpose is to export historical rates data to format, convenient for analysis in external programs.

![A simple RKD Expert Advisor  based on a specified custom RKD indicator](https://c.mql5.com/i/code/expert.png)
[A simple RKD Expert Advisor based on a specified custom RKD indicator](/en/code/126)

This is a simple Expert Advisor, that uses a specified custom RKD indicator.