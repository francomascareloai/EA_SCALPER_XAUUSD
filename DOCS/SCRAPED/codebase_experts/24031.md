# Nonlinear Kalman filter - floating levels - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/24031

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/24031) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Nonlinear Kalman filter - floating levels - indicator for MetaTrader 5

[Mladen Rakic](/en/users/mladen)

Views:
:   7602

Rating:
:   (9)

Published:
:   7 January 2019, 12:01
:   [Nonlinear Kalman filter (fl).mq5](/en/code/download/24031/nonlinear_kalman_filter_afls.mq5 "Nonlinear Kalman filter (fl).mq5")
    (19.39 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/24031.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Theory :**

John Ehlers describes what he calls the nonlinear Kalman filter in the following way :

> > > * Take EMA of price (better, a 3 Pole filter).
> > > * Take the difference (delta) between Price and its EMA.
> > > * Take an EMA of delta (or a 3 Pole filter):
> > >   + Smoothing will help reduce whipsaws.
> > >   + Ideally, smoothing introduces no major trend mode lag because delta is detrended.
> > > * Add the smoothed delta to EMA for a zero lag curve.
> > > * Add 2\*(smoothed delta) to EMA for a smoother predictive line.

In order to add signals other than simple slope direction change, in this version you can chose 3 types of color changes :

* color change on slope
* color change on outer (floating) levels cross
* color change on middle (floating) level (sort of a "zero line") cross

**Usage :**

You can use the color changes as signals

![](https://c.mql5.com/18/79/cb__22.png)

**[Go to discussion](/en/forum/298273)**

![Singleton Example](https://c.mql5.com/i/code/expert.png)
[Singleton Example](/en/code/24015)

This is a working singleton code example. The sole purpose of this post is to provide a working code sample of a singleton object. A singleton object is created when there 'can be only one' of the object. This is accomplished by making an object's constructor private, and ensuring assignment and copy operations are also private.
I was working on an EA and identified that an object should never have more than one copy. I don't expect the EA to ever get large enough for it to actually matter that a singleton is used, but I like the clarity in the code for the object's type.
The code follows closely the tutorial at http://www.yolinux.com/TUTORIALS/C++Singleton.html.

![Averages crosses](https://c.mql5.com/i/code/indicator.png)
[Averages crosses](/en/code/24013)

Averages crosses

![Zero mean normalized nonlinear Kalman filter](https://c.mql5.com/i/code/indicator.png)
[Zero mean normalized nonlinear Kalman filter](/en/code/24032)

Zero mean normalized nonlinear Kalman filter

![Zero mean normalized nonlinear Kalman filter - with floating levels](https://c.mql5.com/i/code/indicator.png)
[Zero mean normalized nonlinear Kalman filter - with floating levels](/en/code/24033)

Zero mean normalized nonlinear Kalman filter - with floating levels