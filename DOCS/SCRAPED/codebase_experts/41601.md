# Detecting the start of a new bar or candle - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/41601

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/41601) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Detecting the start of a new bar or candle - expert for MetaTrader 5

[Fernando Carreiro](/en/users/fmic)  |
[English](javascript:void(false);)

[Русский](/ru/code/41601) [中文](/zh/code/41601) [Español](/es/code/41601) [Deutsch](/de/code/41601) [日本語](/ja/code/41601) [Português](/pt/code/41601) [한국어](/ko/code/41601) [Français](/fr/code/41601) [Italiano](/it/code/41601) [Türkçe](/tr/code/41601)

Views:
:   3140

Rating:
:   (14)

Published:
:   3 April 2025, 11:16
:   [NovaBarra.mq5](/en/code/download/41601/novabarra.mq5 "NovaBarra.mq5")
    (1.53 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/41601.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

For an *Expert Advisor (EA)*, when a new quote (*"tick")* is received by *MetaTrader*, the standard ***[OnTick()](/pt/docs/event_handlers/ontick)*** event handling function is called by the terminal. However, there is no standard event handling function for when a new bar (candle) starts.

To detect this, you need to monitor the opening time of the most recent bar. When it changes, it signifies the start of a new bar, and you can react to the situation and handle the event. The following code example, compatible with both MQL4 and MQL5, demonstrates one of the methods of how this can be achieved:

> ```mql5
> // Standard tick event handler
>    void OnTick()
>    {
>       // Check for a new bar (compatible with MQL4 and MQL5).
>          static datetime dtBarraCorrente   = WRONG_VALUE;
>                 datetime dtBarraPrecedente = dtBarraCorrente;
>                          dtBarraCorrente   = iTime( _Symbol, _Period, 0 );
>                 bool     bEventoBarraNova  = ( dtBarraCorrente != dtBarraPrecedente );
> 
>       // React to the event of a new bar and deal with the situation.
>          if( bEventoBarraNova )
>          {
>             // Detect if this is the first tick received and deal with the situation.
>                /* For example, when it is first applied to the graph and
>  the bar is somewhere in the middle of its progress and
>  is not really the start of a new bar. */
>                if( dtBarraPrecedente == WRONG_VALUE )
>                {
>                   // Do something on the first tick or in the middle of a bar ...
>                }
>                else
>                {
>                   // Do something when a normal bar appears ...
>                };
> 
>             // Do something independent of the previous condition ...
>          }
>          else
>          {
>             // Do something else ...
>          };
> 
>       // Do other things ...
>    };
> ```

In the previous code, the [static variable](/pt/docs/basis/variables/static) keeps track of the bar's opening time, even when returning from the *OnTick()* function. Unlike a normal local variable, it memorises its data content and does not release it when leaving the function. This is the key to detecting a change in the current bar's opening time.

It is also important to note that when the EA is placed on a chart for the first time, the previous code reacts as if the bar had just opened. This condition requires special treatment if the situation needs to be handled differently.

Please note that the source code for all my *CodeBase* publications is now also available via *MetaEditor* 's "Public Projects" under the name "FMIC".

Translated from Portuguese by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/pt/code/41601](/pt/code/41601)

**Last comments |
[Go to discussion](/en/forum/484204)**
(2)

![Francisco Gomes Da Silva](https://c.mql5.com/avatar/2023/11/655a5120-f909.jpg "Francisco Gomes Da Silva")

**[Francisco Gomes Da Silva](/en/users/franciscogomes5)**
|
1 Feb 2023 at 02:46

congratulations fernando! great code, your contributions have helped me a lot to better understand the codes and the logic behind the codes in mql5 and mql4, you're great!!!

![Fernando Carreiro](https://c.mql5.com/avatar/2025/9/68d40cf8-38fb.png "Fernando Carreiro")

**[Fernando Carreiro](/en/users/fmic)**
|
1 Feb 2023 at 04:04

**Francisco Gomes Da Silva [#](/pt/forum/437357#comment_44716443):**  Congratulations fernando! great code, your contributions have already helped me a lot to better understand the codes and the logic behind the codes in mql5 and mql4, you are a beast!!!

Thanks for the compliment and you're welcome!

![Calendar](https://c.mql5.com/i/code/library.png)
[Calendar](/en/code/32430)

Calendar - fundamental analysis on history and real-time.

![SingleTesterCache](https://c.mql5.com/i/code/library.png)
[SingleTesterCache](/en/code/27611)

Tester's single pass data.

![New Candle or Bar formation.](https://c.mql5.com/i/code/expert.png)
[New Candle or Bar formation.](/en/code/57849)

This Bot detects the open of a new candle on any set timeframe, thereby making it easier to run a one-time code, place trades and call other functions. The code is written in the OnTick() function.

![Back kick](https://c.mql5.com/i/code/expert.png)
[Back kick](/en/code/23628)

Algorithm cycle: when there are no open positions, open two opposite positions. Wait for both positions to close.