# Divergence Trader - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/8379

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/8379) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Divergence Trader - expert for MetaTrader 4

[Collector](/en/users/collector)  |
[English](javascript:void(false);)

[Русский](/ru/code/8379) [中文](/zh/code/8379) [Deutsch](/de/code/8379) [日本語](/ja/code/8379) [Português](/pt/code/8379)

Views:
:   28657

Rating:
:   (11)

Published:
:   22 September 2008, 07:26

Updated:
:   21 April 2014, 14:53
:   [Divergence\_Trader.mq4](/en/code/download/8379/Divergence_Trader.mq4 "Divergence_Trader.mq4")
    (17.07 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/8379.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Expert Advisor Divergence Trader.

  
  

Test results:

**Last comments |
[Go to discussion](/en/forum/25841)**
(10)

![](https://c.mql5.com/avatar/avatar_na2.png)

**[Deleted]**
|
26 Jan 2010 at 09:41

**bagoomba:**  

If I'm reading the code right, this isn't really a divergence trade as-is. BUT YOU CAN'T ARGUE WITH RESULTS!!

I took this and did some optimization. I'm working with a smaller account and a broker that does 5-digit pricing, but I'm getting 2.38 profit factor. I'm going to do a walk-forward test on my demo account, but this is really impressive!

**Strategy Tester Report**

How did you run this optimization...with what settings?

![](https://c.mql5.com/avatar/avatar_na2.png)

**[Deleted]**
|
27 Mar 2010 at 14:11

This robot is very interesting...but I have a doubt about then [function](https://www.mql5.com/en/docs/constants/namedconstants/compilemacros "MQL5 documentation: Predefined Macrosubstitutions") divergence().  
 What's meaning in the function  
   
 maF1 = iMA(Symbol(), 0, F\_Period, 0, MODE\_SMA, F\_Price, mypos);  
 maS1 = iMA(Symbol(), 0, S\_Period, 0, MODE\_SMA, S\_Price, mypos);  
 dv1 = (maF1 - maS1);

maF2 = iMA(Symbol(), 0, F\_Period, 0, MODE\_SMA, F\_Price, mypos + 1);  
 maS2 = iMA(Symbol(), 0, S\_Period, 0, MODE\_SMA, S\_Price, mypos + 1);  
 dv2 = ((maF1 - maS1) - (maF2 - maS2));  
 //----  
 return(dv1 - dv2);  
   
 this function always returns (maF2 - maS2). in fact dv1-dv2=(maF1 - maS1)-((maF1 - maS1) - (maF2 - maS2))=(maF2 - maS2)  
 If isn't an error, why calculate maF1 and maS1? In this way maF1 and maS1 never play a role in trading strategy.  
 ..or I'm wrong?  
   
 Thanks

![](https://c.mql5.com/avatar/avatar_na2.png)

**[Deleted]**
|
27 Apr 2010 at 16:51

**Carabobo:**  

This robot is very interesting...but I have a doubt about then function divergence().  
What's meaning in the function  
  
maF1 = iMA(Symbol(), 0, F\_Period, 0, MODE\_SMA, F\_Price, mypos);  
maS1 = iMA(Symbol(), 0, S\_Period, 0, MODE\_SMA, S\_Price, mypos);  
dv1 = (maF1 - maS1);

maF2 = iMA(Symbol(), 0, F\_Period, 0, MODE\_SMA, F\_Price, mypos + 1);  
maS2 = iMA(Symbol(), 0, S\_Period, 0, MODE\_SMA, S\_Price, mypos + 1);  
dv2 = ((maF1 - maS1) - (maF2 - maS2));  
//----  
return(dv1 - dv2);  
  
this function always returns (maF2 - maS2). in fact dv1-dv2=(maF1 - maS1)-((maF1 - maS1) - (maF2 - maS2))=(maF2 - maS2)  
If isn't an error, why calculate maF1 and maS1? In this way maF1 and maS1 never play a role in trading strategy.  
..or I'm wrong?  
  
Thanks

I think that's a mistake. the author maybe want to get a indicator like AO - REF(AO,1)  
REF(indicator,N) means the indicdator in N days before  
I test this EA in some markets in different frames,short always win,but long bring big loss  
but the result is so exciting  
maybe because it has a good exit module

**-**
|
18 Feb 2011 at 18:59

Be very careful about this EA and test it on a demo account. In 2 days test on demo I had a big loss. EA only opened long positions!!!! [Balance of account](https://www.mql5.com/en/docs/constants/environment_state/accountinformation#enum_account_info_double "MQL5 documentation: Account Properties") droped to half in only two day but interestingly strategy tester reports a tremendous raise in the same period!!!!!!!! I don't understand how he could trick strategy tester.

![Serge beaudet](https://c.mql5.com/avatar/avatar_na2.png "Serge beaudet")

**[Serge beaudet](/en/users/carib58)**
|
8 Jun 2011 at 20:39

**CyrusTheGreat:**  

Be very careful about this EA and test it on a demo account. In 2 days test on demo I had a big loss. EA only opened long positions!!!! Balance of account droped to half in only two day but interestingly strategy tester reports a tremendous raise in the same period!!!!!!!! I don't understand how he could trick strategy tester.

  
Any updates on this strategy? I am trying it right now on demo mode and it gives tremendeous results on Shorts. 260 pips so far today on 0.1 lots settings. it opens up to 12 transactions at once. I didnt study the code yet. i know that it is a good day for going short but still..

![CyberiaTrader](https://c.mql5.com/i/code/expert.png)
[CyberiaTrader](/en/code/8397)

An EA that works on the M1 period and with the symbols that have the spread of 2 points.

![Straddle&Trail](https://c.mql5.com/i/code/expert.png)
[Straddle&Trail](/en/code/8366)

Expert Advisor Straddle&Trail. The code contains a comprehensive description.

![The Indicator of the Difference Between the Open Price of the Last Bar and the Close Price of the Previous Bar](https://c.mql5.com/i/code/indicator.png)
[The Indicator of the Difference Between the Open Price of the Last Bar and the Close Price of the Previous Bar](/en/code/8373)

The indicator shows the difference between the open price of the zero bar and the close price of the first bar in points at the top-left corner of the main window.

![Vegas](https://c.mql5.com/i/code/indicator.png)
[Vegas](/en/code/8385)

Indicator Vegas.