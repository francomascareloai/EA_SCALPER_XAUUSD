# MA MACD Position averaging - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/22834

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/22834) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# MA MACD Position averaging - expert for MetaTrader 5

Myth63  |
[English](javascript:void(false);)

[Русский](/ru/code/22834) [中文](/zh/code/22834) [Español](/es/code/22834) [Deutsch](/de/code/22834) [日本語](/ja/code/22834) [Português](/pt/code/22834)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   5675

Rating:
:   (15)

Published:
:   28 December 2018, 12:56

Updated:
:   17 January 2019, 11:29
:   [MA MACD Position averaging.mq5](/en/code/download/22834/ma_macd_position_averaging.mq5 "MA MACD Position averaging.mq5")
    (56.83 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/22834.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Idea by:** Myth63

**Code mq5 by:** [barabashkakvn](/en/users/barabashkakvn)

The EA only checks for a trading signal or an addition to the position when a new bar appears.

The EA is based on indicators iMA (Moving Average, MA) and iMACD (Moving Average Convergence/Divergence, MACD). If a position has a loss exceeding **Step lossing** pips, open yet another position (in the loss-making position direction) with an increased lot (**Lot coefficient** is considered).

The EA holds only one position or multiple positions of the same direction. The EA uses two parameters: **Indent price from MA** and **Ratio of MAIN to SIGNAL** (both are displayed in the picture below)

![MA MACD Position averaging](https://c.mql5.com/18/76/MA_MACD_Position_averaging.png "MA MACD Position averaging")

Sample BUY signal: MACD indicator is below "0.0", the main line (MAIN) exceeds the signal line (SIGNAL) and the current price is higher than Moving Average. Two filters are added to this condition:

* **Ratio of MAIN to SIGNAL**
* **Indent price from MA**

You can select a bar to be checked - on a zero (current) one or on bar #1. This is defined by the **Bar Current** parameter.

EA operation

The following data is collected on a new bar: Number of BUY and SELL positions and the most loss-making (according to the number of pips) BUY and SELL positions. If it turns out that there are both BUY and SELL positions at the same time, this is considered to be an error and ALL positions are closed. If the most loss-making position is found and it is unprofitable by more than**Step lossing**pips, then the parameters of this position (the ticket and the number of lots) are remembered.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/22834](/ru/code/22834)

**Last comments |
[Go to discussion](/en/forum/296610)**
(5)

![Koresch156](https://c.mql5.com/avatar/avatar_na2.png "Koresch156")

**[Koresch156](/en/users/koresch156)**
|
20 Oct 2018 at 18:15

Hello! Can I make a reverse, so that instead of buy it opens sel

and vice versa.

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
20 Oct 2018 at 18:16

**Koresch156:**  

Hello! Can I make a reversal so that instead of a buy it opens a sel

and vice versa.

Of course you can. This is open [source code](https://forge.mql5.io/help/en/guide "MQL5 Algo Forge: Cloud Workspace for Algorithmic Trading Development") and you can do anything you want with it.

![Koresch156](https://c.mql5.com/avatar/avatar_na2.png "Koresch156")

**[Koresch156](/en/users/koresch156)**
|
20 Oct 2018 at 18:18

Man, I'm not good at this, unfortunately.

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
21 Oct 2018 at 07:52

**Koresch156:**  
 Man, I'm not good at this, unfortunately(

Then here is the second version of [MA MACD Position averaging v2](/en/code/22854): added reversal of the trading signal. Reversal will be triggered when there are no open positions in the market.

![Koresch156](https://c.mql5.com/avatar/avatar_na2.png "Koresch156")

**[Koresch156](/en/users/koresch156)**
|
21 Oct 2018 at 15:38

**Vladimir Karputov:**  

Then here is the second version of [MA MACD Position averaging v2](/en/code/22854): added reversal of the trading signal. Reversal will work when there are no open positions in the market.

Thank you!

![Nerve](https://c.mql5.com/i/code/script.png)
[Nerve](/en/code/22840)

The script calculates the average and weighted volatility of a symbol.

![Stochastic_Histogram_HTF](https://c.mql5.com/i/code/indicator.png)
[Stochastic\_Histogram\_HTF](/en/code/22848)

Indicator Stochastic\_Histogram with the timeframe selection option available in its input parameters

![XFisher_org_v1_Candle](https://c.mql5.com/i/code/indicator.png)
[XFisher\_org\_v1\_Candle](/en/code/22833)

Indciator XFisher\_org\_v1 represented as candlesticks

![XFisher_org_v1_HTF](https://c.mql5.com/i/code/indicator.png)
[XFisher\_org\_v1\_HTF](/en/code/22832)

The XFisher\_org\_v1 indicator with the timeframe selection option available in the input parameters