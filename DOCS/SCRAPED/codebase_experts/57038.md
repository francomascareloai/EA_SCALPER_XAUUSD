# BarDuration - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/57038

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/57038) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# BarDuration - indicator for MetaTrader 5

[Stanislav Korotky](/en/users/marketeer)  |
[English](javascript:void(false);)

[Русский](/ru/code/57038) [中文](/zh/code/57038) [Español](/es/code/57038) [Deutsch](/de/code/57038) [日本語](/ja/code/57038) [Português](/pt/code/57038) [한국어](/ko/code/57038) [Français](/fr/code/57038) [Italiano](/it/code/57038) [Türkçe](/tr/code/57038)

Views:
:   3662

Rating:
:   (5)

Published:
:   14 March 2025, 14:58
:   [BarDuration.mq5](/en/code/download/57038/barduration.mq5 "BarDuration.mq5")
    (4.53 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/57038.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This indicator displays a subwindow with histogram of custom bars' durations in minutes. It's applicable for renko boxes, PnF, equivolume bars, and other custom charts, where bar durations are variable, as opposed to standard charts based on timeframes.

Please note that MT5 does not support charts with variable timeframes, so the custom representation, such as renko or equivolume, is emulated by standard charts anyway, and usually uses M1 timeframe, because it's the smallest available timeframe and it provides highest possible accuracy of bar alignment on time axis.

Using this indicator on a regular chart makes small sense, because it'll show vertical columns of the same height for all bars.

### Inputs

* **Directional** - a boolean option to show signed or unsigned histogram; by default, it's false (unsigned) and all values are absolute; if direction is enabled (true) - the values are positive or negative depending from price change on corresponding bar;

![Bar Duration indicator on a renko chart](https://c.mql5.com/18/160/EURUSD_renko_bardur.png "Bar Duration indicator on a renko chart")

**Last comments |
[Go to discussion](/en/forum/482948)**
(3)

![amrali](https://c.mql5.com/avatar/2021/7/60EB6C17-183F.jpg "amrali")

**[amrali](/en/users/amrali)**
|
14 Mar 2025 at 23:30

Thanks for the nice code.

I have a little improvement, as the code is (wrongly) assuming a fixed number of trading sessions per day for all the [week days](https://www.mql5.com/en/docs/constants/environment_state/marketinfoconstants#enum_day_of_week "MQL5 documentation: Symbol properties").

```mql5
   struct Session
   {
      datetime from[], to[];
      Session()
      {
         ZeroMemory(this);
      }
   };

   static Session schedule[7];
   static bool init = false;

   if(!init)
   {
      for(int j = 0; j < 7; j++)
      {
         i = 0;
         while(SymbolInfoSessionQuote(_Symbol, (ENUM_DAY_OF_WEEK)j, i++, from, to))
         {
            ArrayResize(schedule[j].from, i);
            ArrayResize(schedule[j].to, i);
            schedule[j].from[i - 1] = from;
            schedule[j].to[i - 1] = to;
         }
      }
      init = true;
   }

   i = 0;
   while(i < ArraySize(schedule[d].from))
   {
      if(time >= (ulong)schedule[d].from[i] && time < (ulong)schedule[d].to[i])
      {
         return (datetime)(date + schedule[d].to[i]);
      }
      i++;
   }
```

![Stanislav Korotky](https://c.mql5.com/avatar/2010/10/4CA7CFA0-1F0C.jpg "Stanislav Korotky")

**[Stanislav Korotky](/en/users/marketeer)**
|
15 Mar 2025 at 12:50

**amrali [#](/en/forum/482948#comment_56173661):**  

Thanks for the nice code.

I have a little improvement, as the code is (wrongly) assuming a fixed number of trading sessions per day for all the [week days](/en/docs/constants/environment_state/marketinfoconstants#enum_day_of_week "MQL5 documentation: Symbol properties").

Thank you for pointing out this nuance, but I think your change is not necessary.

My version allocates *schedule* array by maximal number of sessions among all days, with zeros in *from/to* fields for all other days where the later session might be missing. Such "zero" sessions are eliminated from consideration in the latter lookup loop.

![amrali](https://c.mql5.com/avatar/2021/7/60EB6C17-183F.jpg "amrali")

**[amrali](/en/users/amrali)**
|
15 Mar 2025 at 15:18

Yes, I see. Thank you.   

Also, in your version ArrayPrint(schedule) works nicely.

![MeanReversionTrendEA](https://c.mql5.com/i/code/expert.png)
[MeanReversionTrendEA](/en/code/57020)

The EA automatically trades based on trend and mean reversion signals with validated parameters.

![JSON](https://c.mql5.com/i/code/library.png)
[JSON](/en/code/53107)

Serialization and deserialization of the JSON format

![Supertrend](https://c.mql5.com/i/code/indicator.png)
[Supertrend](/en/code/57063)

A SuperTrend indicator that plots trend direction using ATR volatility to create dynamic support/resistance levels for MetaTrader 5.

![Introsort (Introspective sort) using Function Pointers](https://c.mql5.com/i/code/library.png)
[Introsort (Introspective sort) using Function Pointers](/en/code/57233)

A hybrid sorting algorithm that provide fast performance for sorting arrays of simple types, structures or object pointers.