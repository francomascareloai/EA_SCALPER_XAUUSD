# Visualization of Optimization Results in Real Time - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/914

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/914) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Visualization of Optimization Results in Real Time - expert for MetaTrader 5

[MetaQuotes](/en/users/metaquotes)  |
[English](javascript:void(false);)

[Русский](/ru/code/914) [中文](/zh/code/914) [Español](/es/code/914) [Deutsch](/de/code/914) [日本語](/ja/code/914) [Português](/pt/code/914) [한국어](/ko/code/914) [Français](/fr/code/914) [Italiano](/it/code/914) [Türkçe](/tr/code/914)

Views:
:   13673

Rating:
:   (48)

Published:
:   13 June 2012, 15:46

Updated:
:   22 November 2016, 07:32
:   \MQL5\Include\

    [specialchart.mqh](/en/code/download/914/specialchart.mqh "specialchart.mqh")
    (7.71 KB)
    [view](# "view")

    [simpletable.mqh](/en/code/download/914/simpletable.mqh "simpletable.mqh")
    (10.78 KB)
    [view](# "view")

    [framegenerator.mqh](/en/code/download/914/framegenerator.mqh "framegenerator.mqh")
    (15.08 KB)
    [view](# "view")

    [colorprogressbar.mqh](/en/code/download/914/colorprogressbar.mqh "colorprogressbar.mqh")
    (4.89 KB)
    [view](# "view")

    \MQL5\Scripts\

    [test\_simpletable.mq5](/en/code/download/914/test_simpletable.mq5 "test_simpletable.mq5")
    (2.52 KB)
    [view](# "view")

    [test\_cspecialchart.mq5](/en/code/download/914/test_cspecialchart.mq5 "test_cspecialchart.mq5")
    (2.19 KB)
    [view](# "view")

    [moving\_average\_with\_frames.mq5](/en/code/download/914/moving_average_with_frames.mq5 "moving_average_with_frames.mq5")
    (8.67 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/914.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

MetaTrader 5 Strategy Tester allows to get statistical parameters of a trading system after each testing pass.

Statistical parameters can be obtained using [TesterStatistics()](/en/docs/common/testerstatistics) function, which is called inside [OnTester()](/en/docs/basis/function/events#ontester) and [OnDeinit()](/en/docs/basis/function/events#ondeinit) functions.

With the introduction of functions for working with optimization results ([FrameFirst()](/en/docs/optimization_frames/framefirst), [FrameFilter()](/en/docs/optimization_frames/framefilter), [FrameNext()](/en/docs/optimization_frames/framenext), [FrameInputs()](/en/docs/optimization_frames/frameinputs) and [FrameAdd()](/en/docs/optimization_frames/frameadd)), traders are now able to perform visual optimization. The necessary data now can be processed and displayed right during an Expert Advisor optimization or a mathematical problem solving.

We will consider the details of the example of visualization of an Expert Advisor testing results during the optimization described in the article ["Visualize a Strategy in the MetaTrader 5 Tester"](/en/articles/403).

****1. Visualization of balance dynamics during the optimization****

**1.1. Downloading Files**

Moving Averages\_With\_Frames.mq5 Expert Advisor should be copied to the terminal\_data\_folder\MQL5\Experts.

The following files are used for the Expert Advisor operation:

1. FrameGenerator.mqh - CFrameGenerator class for displaying optimization results;
2. SpecialChart.mqh - CSpecialChart class for drawing several balance charts;
3. SimpleTable.mqh - CSimpleTable class is a simple table having two columns;
4. ColorProgressBar.mqh - CСolorProgressBar class is a progress bar using two colors.

They should be copied to the terminal\_data\_folder\MQL5\Include.

Code Base programs can be downloaded automatically via MetaTrader 5 terminal (CodeBase tab of the "Toolbox" window). To do this, select "Download". All codes will be downloaded and placed in their folders.

![Fig. 1. Downloading CodeBase programs via MetaTrader 5 terminal](https://c.mql5.com/18/6/Download_CodeBase_from_MetaTrader_5__1.png "Fig. 1. Downloading CodeBase programs via MetaTrader 5 terminal")

Fig. 1. Downloading CodeBase programs via MetaTrader 5 terminal

**1.2.** **Testing the Expert Advisor**

Moving Averages\_With\_Frames.mq5 Expert Advisor should be launched in the Strategy Tester.

Test settings:

![Moving Averages_With_Frames.mq5 test settings](https://c.mql5.com/18/6/Fig1__2.png "Moving Averages_With_Frames.mq5 test settings")

Fig. 2. Moving Averages\_With\_Frames.mq5 test settings

Optimization options:

![Moving Averages_With_Frames.mq5 optimization parameters](https://c.mql5.com/18/6/Fig2__1.png "Moving Averages_With_Frames.mq5 optimization parameters")

Fig. 3. Moving Averages\_With\_Frames.mq5 test settings

During the optimization the Expert Advisor displays the balance dynamics and optimization pass statistical data:

![Fig. 4. Moving Averages_With_Frames.mq5 optimization](https://c.mql5.com/18/6/Fig3__1.png "Fig. 4. Moving Averages_With_Frames.mq5 optimization")

Fig. 4. Moving Averages\_With\_Frames.mq5 optimization

Optimization process:

**1.3.** **The Expert Advisor Operation Principle**

Moving Averages\_With\_Frames.mq5 Expert Advisor is created based on Moving Averages.mq5 one included in the standard MetaTrader 5 terminal package (MQL5\Experts\Examples\Moving Average).

The following code has been added for the results visualization:  

```mql5
//--- connecting the code for working with optimization results
#include <FrameGenerator.mqh>
//--- frames generator
CFrameGenerator fg;
//+------------------------------------------------------------------+
//| Tester function                                                  |
//+------------------------------------------------------------------+
double OnTester()
  {
//--- insert your optimization criterion calculation function here
   double TesterCritetia=MathAbs(TesterStatistics(STAT_SHARPE_RATIO)*TesterStatistics(STAT_PROFIT));
   TesterCritetia=TesterStatistics(STAT_PROFIT)>0?TesterCritetia:(-TesterCritetia);
//--- invoking after each test and submitting optimization criterion as a parameter
   fg.OnTester(TesterCritetia);
//---
   return(TesterCritetia);
  }
//+------------------------------------------------------------------+
//| TesterInit function                                              |
//+------------------------------------------------------------------+
void OnTesterInit()
  {
//--- preparing the chart for displaying several balance lines
   fg.OnTesterInit(3); // parameter sets the number of balance lines on the chart
  }
//+------------------------------------------------------------------+
//| TesterPass function                                              |
//+------------------------------------------------------------------+
void OnTesterPass()
  {
//--- handling obtained test results and displaying graphics
   fg.OnTesterPass();
  }
//+------------------------------------------------------------------+
//| TesterDeinit function                                            |
//+------------------------------------------------------------------+
void OnTesterDeinit()
  {
//--- optimization end
   fg.OnTesterDeinit();
  }
//+------------------------------------------------------------------+
//|  Chart events handling                                           |
//+------------------------------------------------------------------+
void OnChartEvent(const int id,const long &lparam,const double &dparam,const string &sparam)
  {
//--- launches frames display after the optimization end when clicking on the header
   fg.OnChartEvent(id,lparam,dparam,sparam,100); // 100 is a pause in ms between the shots
  }
//+------------------------------------------------------------------+
```

This code can be similarly used in any Expert Advisor.

CFrameGenerator class is used for working with optimization results. The class contains the methods for
handling the Strategy Tester events ([OnTester()](/en/docs/basis/function/events#ontester), [OnTesterInit()](/en/docs/basis/function/events#ontesterinit), [OnTesterPass()](/en/docs/basis/function/events#ontesterpass), [OnTesterDeinit()](/en/docs/basis/function/events#ontesterdeinit)) and the method for chart events ([OnChartEvent()](/en/docs/basis/function/events#onchartevent)). Used graphical objects are prepared in OnTesterInit() method of CFrameGenerator class.

OnTester() method of CFrameGenerator class is invoked on a test agent after each test pass. This method
provides calculation of the balance curve dynamics based on trading results. Balance curve chart is a one-dimensional array, the length of which depends on the number of performed deals.

Then, [TesterStatistics()](/en/docs/common/testerstatistics) function is used to request statistical data (net profit, profit factor, recovery factor, number of trades, number of deals, maximum funds drawdown percentage, custom optimization criteria value) and a frame (test pass data array, in our case) is generated, which is sent to the terminal (from the test agent) using [FrameAdd()](/en/docs/optimization_frames/frameadd) function.

Frames are received and handled in OnTesterPass() method of CFrameGenerator class. Frames read operation is performed by [FrameNext()](/en/docs/optimization_frames/framenext) function. Request for the Expert Advisor input parameters, for which the frame has been generated, is performed using [FrameInputs()](/en/docs/optimization_frames/frameinputs) function.

After obtaining the data, it is displayed and updated using CSimpleTable, CColorProgressBar and CSpecialChart classes methods.

It should be noted that OnTester() handling functions execution is performed **on the test agent** after another current optimization pass has been finished. This allows the use of [MQL5 Cloud Network](https://cloud.mql5.com/ "https://cloud.mql5.com/") distributed network capacities to carry out complex mathematical calculations. To do this, place the calculation part to OnTester event handler.

The example of using the optimization for accelerating mathematical calculations (continuous wavelet transformation of the [Weierstrass function](https://en.wikipedia.org/wiki/Weierstrass_function "https://en.wikipedia.org/wiki/Weierstrass_function")) is shown in the topic ["Managing optimization processes in real time and transferring massive data from the agents to MetaTrader 5"](/en/forum/6411).

  

**2. Examples of Working with CSimpleTable, CColorProgressBar and CSpecialChart Classes**

Attached Test\_SimpleTable.mq5 and Test\_CSpecialChart.mq5 scripts contain examples of working with CSimpleTable, CColorProgressBar and CSpecialChart classes. They should be copied to the terminal\_data\_folder\MQL5\Scripts.

![Fig. 5. Test_SimpleTable.mq5 script operation result](https://c.mql5.com/18/6/Fig4.png "Fig. 5. Test_SimpleTable.mq5 script operation result")

Fig. 5. Test\_SimpleTable.mq5 script operation result

![Fig. 6. Test_CSpecialChart.mq5 script operation result](https://c.mql5.com/18/6/Fig5.png "Fig. 6. Test_CSpecialChart.mq5 script operation result")

Fig. 6. Test\_CSpecialChart.mq5 script operation result

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/914](/ru/code/914)

**[Go to discussion](/en/forum/6930)**

![EA_MARSI](https://c.mql5.com/i/code/expert.png)
[EA\_MARSI](/en/code/913)

The Expert Advisor is based on EMA\_RSI\_VA indicator.

![EMA_RSI_VA](https://c.mql5.com/i/code/indicator.png)
[EMA\_RSI\_VA](/en/code/907)

Exponential Moving Average - RSI Volatility-Adjusted by Jose Silva.

![Chart_Period_Changer](https://c.mql5.com/i/code/script.png)
[Chart\_Period\_Changer](/en/code/911)

A simple script for switching basic timeframes. It allows to change a chart period using hot keys.

![Corrected Average (CA)](https://c.mql5.com/i/code/indicator.png)
[Corrected Average (CA)](/en/code/923)

Corrected Average indicator by A.Uhl (also known as the "Optimal moving average").