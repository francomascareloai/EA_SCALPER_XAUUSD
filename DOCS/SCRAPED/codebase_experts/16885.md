# Opening and Сlosing on time v2 - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/16885

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/16885) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Opening and Сlosing on time v2 - expert for MetaTrader 5

[Vladimir Karputov](/en/users/barabashkakvn)  |
[English](javascript:void(false);)

[Русский](/ru/code/16885) [中文](/zh/code/16885) [Español](/es/code/16885) [Deutsch](/de/code/16885) [日本語](/ja/code/16885) [Português](/pt/code/16885)

Views:
:   7531

Rating:
:   (24)

Published:
:   19 January 2017, 17:08

Updated:
:   20 July 2018, 14:29
:   [Opening and \_losing on time v2.mq5](/en/code/download/16885/opening_and_rlosing_on_time_v2.mq5 "Opening and _losing on time v2.mq5")
    (29.23 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/16885.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The EA opens and closes positions at a specified time. The condition is additionally checked:

* for Buy —  if the fast iMA on the first bar exceeds the slow iMA   

  if(iMAGet(handle\_iMAFast,1)>iMAGet(handle\_iMASlow,1))  
                   {  
                    if(!RefreshRates())

* for Sell — if the fast iMA on the first bar is less than the slow iMA  

  if(iMAGet(handle\_iMAFast,1)<iMAGet(handle\_iMASlow,1))  
                   {  
                    if(!RefreshRates())  
                       return;  
                    price=m\_symbol.Bid();  
                    if(Extm\_sl>0.0)  
                       sl=m\_symbol.Ask()+Extm\_sl;  
                    if(Extm\_tp>0.0)  
                       tp=m\_symbol.Ask()-Extm\_tp;  
                    m\_trade.Sell(m\_lots,InpSymbol,price,sl,tp);  
                   }

Only HH:mm are considered in the inputs (time).

**Inputs:**

***opening time (only HH:mm are considered)*** — position open time

***closing time (only HH:mm are considered)*** — position close time

***symbol*** — traded symbol

***volume transaction*** — position volume

***sell stop*** — stop loss level

***take profit***  — take profit level

***true -> Buy, false -> Sell*** — if "true", only "Buy" positions are opened; if "false", only "Sell" ones

***magic number*** — EA's magic number.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/16885](/ru/code/16885)

**Last comments |
[Go to discussion](/en/forum/167487)**
(29)

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
24 Jun 2021 at 14:27

**womouse :**  
Only complete opening and closing of a position can be executed. Is it impossible to just close a position based on time?

Do you need a code that will close all-all positions at a specified time?

Do you need a code that will close all-all positions at a specified time?

![womouse](https://c.mql5.com/avatar/avatar_na2.png "womouse")

**[womouse](/en/users/womouse)**
|
24 Jun 2021 at 14:41

**Vladimir Karputov:**  

No.

I tried it, but it didn't work at all.

![womouse](https://c.mql5.com/avatar/avatar_na2.png "womouse")

**[womouse](/en/users/womouse)**
|
24 Jun 2021 at 15:52

**Vladimir Karputov:**  

Do you need a code that will close all-all positions at a specified time?

It is best to be able to switch off a certain variety separately according to the need according to flexible settings.

It is best to be able to switch off a certain variety separately according to the need according to flexible settings. If there is no way to achieve it, you can If there is no way to achieve it, you can also close all.

![womouse](https://c.mql5.com/avatar/avatar_na2.png "womouse")

**[womouse](/en/users/womouse)**
|
25 Jun 2021 at 18:21

**Vladimir Karputov:**  

No.

hello, Do you have any code that can be implemented?

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
25 Jun 2021 at 18:49

**womouse :**  
hello, Do you have any code that can be implemented?

Didn't the code from [# 11 work](/zh/forum/169217/page2#comment_23080934 "Permanent link")? Then you need to look for another code.

![Exp_Bezier_ReOpen](https://c.mql5.com/i/code/expert.png)
[Exp\_Bezier\_ReOpen](/en/code/16883)

The Exp\_Bezier\_ReOpen trading system is based on the Bezier indicator color change with adding to trend-following positions.

![EnvelopesATR_Cloud_HTF](https://c.mql5.com/i/code/indicator.png)
[EnvelopesATR\_Cloud\_HTF](/en/code/16882)

The EnvelopesATR\_Cloud indicator with the timeframe selection option available in the input parameters.

![DoubleUp с изгибом](https://c.mql5.com/i/code/expert.png)
[DoubleUp с изгибом](/en/code/16886)

The Expert Advisor works comparing iCCI and iMACD indicators.

![Exp_JBrainTrend1Stop_ReOpen](https://c.mql5.com/i/code/expert.png)
[Exp\_JBrainTrend1Stop\_ReOpen](/en/code/16894)

The Exp\_JBrainTrend1Stop\_ReOpen trading system is based on the JBrainTrend1Stop indicator color change with adding to trend-following positions.