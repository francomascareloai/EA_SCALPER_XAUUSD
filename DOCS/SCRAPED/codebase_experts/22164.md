# Easy Canvas - library for MetaTrader 5

Source: https://www.mql5.com/en/code/22164

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/22164) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# Easy Canvas - library for MetaTrader 5

[Nikolai Semko](/en/users/nikolay7ko)  |
[English](javascript:void(false);)

[Русский](/ru/code/22164) [中文](/zh/code/22164) [Español](/es/code/22164) [Deutsch](/de/code/22164) [日本語](/ja/code/22164) [Português](/pt/code/22164)

Views:
:   9520

Rating:
:   (62)

Published:
:   25 October 2018, 18:37
:   \MQL5\Indicators\

    [Test\_iCanvas.mq5](/en/code/download/22164/test_icanvas.mq5 "Test_iCanvas.mq5")
    (6.64 KB)
    [view](# "view")

    \MQL5\Include\Canvas\

    [iCanvas.mqh](/en/code/download/22164/icanvas.mqh "iCanvas.mqh")
    (31.88 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/22164.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The library and iCanvas class simplify writing programs using Canvas.

Here is an example of a simple indicator using this library.

In this example, the indicator body features no function for processing OnChartEvent events. But it may also be present.

![](https://c.mql5.com/18/73/iCanvas__1.gif)

```mql5
#property indicator_chart_window
#include <Canvas\iCanvas.mqh>

int OnInit()
  {
   EventSetMillisecondTimer(33);
   ChartSetInteger(0,CHART_SHOW,true);
   ChartSetInteger(0,CHART_CROSSHAIR_TOOL,false);  // turn off the crosshair
   return(INIT_SUCCEEDED);
  }

void OnDeinit(const int reason) {if(reason<2) {ChartSetInteger(0,CHART_CROSSHAIR_TOOL,true); ChartRedraw();}}

void  OnTimer()
  {
   static int X=0;
   static int Y=0;
   if(X!=W.MouseX || Y!=W.MouseY)
     {
      Canvas.Erase(0);
      // Draw a blurry spot
      for(int ix=-20;ix<=20;ix++) for(int iy=-20;iy<=20;iy++)
        {
         double p=sqrt(ix*ix+iy*iy)/20.0;
         if(p>1) p=1;
         uchar P=(uchar)Round((1.0-p)*255.0);
         Canvas.PixelSet(W.MouseX+ix,W.MouseY+iy,ARGB(P,100,0,200));
        }
      //  Display the information block
      int Y1=(int)Canvas.Y(Canvas.Close(W.MouseX));
      Canvas.FillRectangle(W.MouseX,Y1,W.MouseX+140,Y1+67,0xA0808080);
      Canvas.TextOut(W.MouseX+5,Y1+2,"Close = "+DoubleToString(Canvas.Close(W.MouseX),_Digits),0xFFFFFFFF);
      Canvas.TextOut(W.MouseX+5,Y1+18,"Bar = "+DoubleToString(W.MouseBar,2),0xFFFFFFFF);
      Canvas.TextOut(W.MouseX+5,Y1+34,TimeToString(W.MouseTime,TIME_DATE|TIME_SECONDS),0xFFFFFFFF);
      Canvas.TextOut(W.MouseX+5,Y1+50,"SubWindow = "+string(W.MouseSubWin),0xFFFFFFFF);
      //  Crosshairs
      Canvas.LineHorizontal(0,W.Width-1,W.MouseY,~W.Color);
      Canvas.LineVertical(W.MouseX,0,W.Height-1,~W.Color);
      int Ym=(W.MouseY>16)?(W.MouseY-16):(W.MouseY+2);
      int Xm=(W.MouseX<(W.Width-140))?(W.MouseX+4):(W.MouseX-125);
      Canvas.TextOut(W.Width-76,Ym,DoubleToString(W.MousePrice,_Digits),~W.Color);
      Canvas.TextOut(Xm,W.Height-16,TimeToString(W.MouseTime,TIME_DATE|TIME_SECONDS),~W.Color);

      Canvas.Update();
      X=W.MouseX; Y=W.MouseY;
     }
  }

int OnCalculate(const int rates_total,
                const int prev_calculated,
                const int begin,
                const double &price[])
  {
   return(rates_total);
  }
```

Library features:

* when connecting the library, one instance with the name Canvas of the iCanvas class derived from the CCanvas class is created immediately.
* the size of this instance matches the entire window. Further, when the window is resized, the canvas is automatically resized (except for scripts).
* using the OnChartEvent event handler function is optional.
* inside the library, there is also an instance of the Window structure named W. The window parameters (except for scripts) are located and automatically updated inside this structure.

Window structure:

```mql5
struct Window
  {
   uint              Color;       // window background color
   int               Width;       // window width
   int               Height;      // window height
   int               Left_bar;    // number of the leftmost bar in the window
   double            Right_bar;   // number of the rightmost bar in the window
   double            Total_bars;  // the maximum number of bars in the window
   int               BarsInWind;  // number of visible bars in the window
   double            Y_min;       // The minimum value of the price in the window
   double            Y_max;       // The maximum value of the price in the window
   double            dy_pix;      // price change for one pixel
   int               dx_pix;      // changing the number of bars per pixel
   int               MouseX;      // coordinate X of the current position of the mouse pointer
   int               MouseY;      // coordinate Y of the current position of the mouse pointer
   double            MouseBar;    // the current bar position of the mouse pointer 
   double            MousePrice;  // the current price of the mouse pointer
   datetime          MouseTime;   // the current time of the mouse pointer
   int               MouseSubWin; // number of the subwindow in which the mouse pointer is located
   int               WindowsTotal;// total subwindows, including the main window
   int               SubWin;      // current subwindow
   datetime          time[];      // array of opening time of all visible bars in the window
  };
```

iCanvas class:

```mql5
class iCanvas : public CCanvas
  {
private:
   datetime          T[1];
   double            Pr[1];
   bool              FullWinCanvW; // using full window canvas by width
   bool              FullWinCanvH; // using full window canvas by height
public:
                     iCanvas(int Xpos=0,int Ypos=0,string Name="iCanvas",int width=0,int height=0,ENUM_COLOR_FORMAT formatCF=COLOR_FORMAT_ARGB_NORMALIZE,int subwin=-1);
                    ~iCanvas() { Destroy();};
   double            X(double bar);
   double            X(datetime Time) {return X((double)Ceil(W.Right_bar)+iBarShift(NULL,0,Time));};
   double            Y(double Price)  {return((W.Y_max-Price)/W.dy_pix); };
   double            Bar(int x)       {return((double)W.Left_bar+1-(double)x/(double)W.dx_pix);};
   datetime          TimePos(int x)   {double B=Bar(x); CopyTime(_Symbol,_Period,Floor(B),1,T); return T[0]+int((double)PeriodSeconds()*(1-B+(int)B));};
   double            Close(int x)     {CopyClose(_Symbol,_Period,int(Bar(x)),1,Pr); return Pr[0];};
   double            Open(int x)      {CopyOpen(_Symbol,_Period,int(Bar(x)),1,Pr); return Pr[0];};
   double            High(int x)      {CopyHigh(_Symbol,_Period,int(Bar(x)),1,Pr); return Pr[0];};
   double            Low(int x)       {CopyLow(_Symbol,_Period,int(Bar(x)),1,Pr); return Pr[0];};
   bool              FullWinCanvWidth()  {return FullWinCanvW;}; // using full window canvas by width  
   bool              FullWinCanvHeight() {return FullWinCanvH;}; // using full window canvas by height             
   ENUM_PROGRAM_TYPE ProgType;
  };
```

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/22164](/ru/code/22164)

**Last comments |
[Go to discussion](/en/forum/285732)**
(188)

![BeeXXI Corporation](https://c.mql5.com/avatar/2024/9/66dbee89-a47e.png "BeeXXI Corporation")

**[Nikolai Semko](/en/users/nikolay7ko)**
|
17 Jun 2025 at 21:44

**Vladimir Pastushak [#](/ru/forum/277867/page17#comment_57030450):**  

100500 programmers will thank you sincerely before going to bed if you make a quality Easy Canvas 2 library.

I need it very much, but I don't have enough knowledge to make it myself....

Vladimir, Renat [said](/ru/forum/487541/page4#comment_56821872) recently that they will implement [Blend2D](/go?link=https://blend2d.com/ "https://blend2d.com/") in the terminal and in the editor.   
 And it means that this library will already become a rudiment. The main thing is not to turn their intention into a long construction.

![Denis Kirichenko](https://c.mql5.com/avatar/2019/5/5CEDB8D2-7CB7.jpg "Denis Kirichenko")

**[Denis Kirichenko](/en/users/denkir)**
|
18 Jun 2025 at 08:37

**Vladimir Pastushak [#](/ru/forum/277867/page17#comment_57030450):**  

*100500 programmers will thank you sincerely before going to bed if you make a quality Easy Canvas 2 library.*

*I need it very much, but I don't have enough knowledge to make it myself....*

And collect  at least $1 from these 100500 programmers, then Nikolay will probably do it. Meanwhile it sounds like this: "Nikolay, you work on a new bibliography, and then we will thank you!" ))

A quality bibliography for graphics is expensive. For example, one author wrote a lot of articles about such a case. And where is this bibliography? It is working through a stump, that's why it is not popular....

![Vladimir Pastushak](https://c.mql5.com/avatar/2025/10/690362ed-8db6.png "Vladimir Pastushak")

**[Vladimir Pastushak](/en/users/voldemar)**
|
3 Jul 2025 at 16:46

**Nikolai Semko [#](/ru/forum/277867#comment_12381397):**  

This is done to control multiple subwindows and multiple instances of iCanvas. After all, windows can be added and removed in the process of the indicator work.   
 For example, it is necessary for this indicator:

[https://www.mql5.com/en/code/25414](/en/code/25414)

The object is created practically first, which leads to the fact that if more objects were created afterwards, they overlap the library object.

![BeeXXI Corporation](https://c.mql5.com/avatar/2024/9/66dbee89-a47e.png "BeeXXI Corporation")

**[Nikolai Semko](/en/users/nikolay7ko)**
|
3 Jul 2025 at 16:59

**Vladimir Pastushak [#](/ru/forum/277867/page17#comment_57406140):**  

The object is created almost first, which means that if more objects are created afterwards, they overlap the library object.

Yeah. That's the way it should be. What's the problem?

If you need to change the Z-index, you need to recreate objects in the right sequence

![Vladimir Pastushak](https://c.mql5.com/avatar/2025/10/690362ed-8db6.png "Vladimir Pastushak")

**[Vladimir Pastushak](/en/users/voldemar)**
|
4 Jul 2025 at 07:05

**Nikolai Semko [#](/ru/forum/277867/page17#comment_57406331):**  
 Yeah. That's the way it should be. What's the problem?

If you need to change the Z-index, you need to recreate the objects in the right sequence

Thank you, I thought about it afterwards.....

![TradeTransactions](https://c.mql5.com/i/code/library.png)
[TradeTransactions](/en/code/22166)

Access to OnTradeTransaction data anywhere within an application

![Skyscraper](https://c.mql5.com/i/code/indicator.png)
[Skyscraper](/en/code/22177)

A trend indicator of NRTR type with an additional middle line

![Previous Candle Breakdown 3](https://c.mql5.com/i/code/expert.png)
[Previous Candle Breakdown 3](/en/code/22145)

"Previous Candle Breakdown" Expert Advisor.

![Rollback system](https://c.mql5.com/i/code/expert.png)
[Rollback system](/en/code/22142)

Defining the channel width for a previous day.