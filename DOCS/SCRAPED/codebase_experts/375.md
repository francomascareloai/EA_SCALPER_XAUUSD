# Moving Averages Convergence/Divergence Indicator Blau_MACD - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/375

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/375) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Moving Averages Convergence/Divergence Indicator Blau\_MACD - indicator for MetaTrader 5

[Andrey F. Zelinsky](/en/users/abolk)  |
[English](javascript:void(false);)

[Русский](/ru/code/375) [中文](/zh/code/375) [Español](/es/code/375) [Deutsch](/de/code/375) [日本語](/ja/code/375) [Português](/pt/code/375) [한국어](/ko/code/375) [Français](/fr/code/375) [Italiano](/it/code/375) [Türkçe](/tr/code/375)

Views:
:   18613

Rating:
:   (21)

Published:
:   7 July 2011, 16:56

Updated:
:   22 November 2016, 07:32
:   [blau\_macd.mq5](/en/code/download/375/blau_macd.mq5 "blau_macd.mq5")
    (6.56 KB)
    [view](# "view")

    \MQL5\Include\

    [williamblau.mqh](/en/code/download/375/williamblau.mqh "williamblau.mqh")
    (4.52 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/375.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Author: [Andrey N. Bolkonsky](https://www.mql5.com/en/users/abolk "https://www.mql5.com/en/users/abolk")

The Moving Averages Convergence/Divergence Indicator by William Blau is described in the book [Momentum, Direction, and Divergence: Applying the Latest Momentum Indicators for Technical Analysis"](/go?link=https://www.amazon.com/Momentum-Direction-Divergence-Indicators-Technical/dp/0471027294 "http://www.amazon.com/Momentum-Direction-Divergence-Indicators-Technical/dp/0471027294").

The Moving Average Convergence/Divergence (MACD) technical Indicator is the difference between two [exponentially smoothed moving averages (EMA)](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") (fast EMA has period s and slow EMA has period r).

*The sign of MACD* indicates the relative position of fast s-period EMA and slow r-period EMA. It's positive when EMA(s)>EMA(r) and negative if EMA(s)<EMA(r). The increase of the |MACD| (absolute value) indicates the divergence of moving averages, the decrease of of the |MACD| indicated the convergence of EMAs.

* WilliamBlau.mqh must be placed in **terminal\_data\_folder**\MQL5\Include\
* Blau\_SM\_Stochastic.mq5 must be placed in **terminal\_data\_folder**\MQL5\Indicators\

![Moving Averages Convergence/Divergence by William Blau.](https://c.mql5.com/18/3/Blau_MACD.png "Moving")

Moving Averages Convergence/Divergence by William Blau.

**Calculation:**

Moving Averages Convergence/Divergence is calculated by formula:

macd(price,r,s) = EMA(price,s) - EMA(price,r)  
s < r

where:

* price - close price of the current period;
* EMA(price,r) - slow EMA with period r, applied to price;
* EMA(price,s) - fast EMA with period s, applied to price.

  

The formula of MACD by William Blau looks as follows:

MACD(price,r,s,u) = EMA( macd(price,r,s) ,u) = EMA( EMA(price,s)-EMA(price,r) ,u)  
s < r

where:

* price - close price;
* EMA(price,r) - 1st smoothing - slow EMA, applied to price;
* EMA(price,s) - 2nd smoothingе - fast EMA, appled to price;
* macd(r,s)=EMA(price,s)-EMA(price,r) - moving averages convergence/divergence;
* EMA(macd(r,s),u) - 3rd smoothing (with period u),
  applied to MACD.

**Input parameters**:

* r - period of the 1st EMA (slow), applied to price (by default r=20);
* s - period of the 2nd EMA (fast), applied to price (by default s=5)
* u - period of the 3rd EMA, applied to MACD (by default u=3);
* AppliedPrice - [price type](/en/docs/constants/indicatorconstants/prices) (by default AppliedPrice=PRICE\_CLOSE).

**Note**:

* r>1, s>1;
* s<r (according by William Blau, there isn't any checks in the code);
* u>0. If u=1, smoothing is not used;
* Min. rates =([max(r,s)]+u-2+1).

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/375](/ru/code/375)

**Last comments |
[Go to discussion](/en/forum/4116)**
(1)

![Robert](https://c.mql5.com/avatar/avatar_na2.png "Robert")

**[Robert](/en/users/cosmicbeing)**
|
7 Jul 2011 at 22:35

**Automated-Trading:**  

[Moving Averages Convergence/Divergence Indicator Blau\_MACD](/en/code/375):

Author: [Andrey N. Bolkonsky](https://www.mql5.com/en/users/abolk "https://www.mql5.com/en/users/abolk")

Hi Andrey,

First of all, thanks for your efforts with the MT5 indicators.

I have a question on the "Price\_Weighted" calculation. I'm just a novice coder so this may have an easy answer.

The Price Constants for MT5 shows:

PRICE\_WEIGHTED: Average price, (high + low + close + close)/4

This code shows **4 variables divided by 4**.

  

Your MACD Blau Diverg indicator shows:

case PRICE\_WEIGHTED: Price[i]=(High[i]+Low[i]+Close[i]+Close[i]+Close[i])/4.0; break;

This code shows **5 variables divided by 4**...??

Which is the correct Price\_Weighted code?

Secondly, which buffers, if any, shows the Troughs and Peaks and can you draw the divergence lines that show these?

Again, thanks for your efforts and for all your help,

Robert

![Ergodic Mean Deviation Index Oscillator Ergodic_MDI](https://c.mql5.com/i/code/indicator.png)
[Ergodic Mean Deviation Index Oscillator Ergodic\_MDI](/en/code/374)

Ergodic Mean Deviation Index (MDI) Oscillator by William Blau.

![Mean Deviation Index Blau_MDI](https://c.mql5.com/i/code/indicator.png)
[Mean Deviation Index Blau\_MDI](/en/code/373)

Mean Deviation Index (MDI) by William Blau.

![Ergodic MACD Oscillator  Blau_Ergodic_MACD](https://c.mql5.com/i/code/indicator.png)
[Ergodic MACD Oscillator Blau\_Ergodic\_MACD](/en/code/376)

Ergodic MACD Oscillator by William Blau.

![Candlestick Momentum Blau_CMtm](https://c.mql5.com/i/code/indicator.png)
[Candlestick Momentum Blau\_CMtm](/en/code/377)

Candlestick Momentum Indicator by William Blau.