# CloseAgent - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/53889

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/53889) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# CloseAgent - expert for MetaTrader 5

[Pedro Roberto Diez San Jose](/en/users/alfa-centauri)  |
[English](javascript:void(false);)

[Русский](/ru/code/53889) [中文](/zh/code/53889) [Español](/es/code/53889) [Deutsch](/de/code/53889) [日本語](/ja/code/53889) [Português](/pt/code/53889) [한국어](/ko/code/53889) [Français](/fr/code/53889) [Italiano](/it/code/53889) [Türkçe](/tr/code/53889)

Views:
:   4837

Rating:
:   (7)

Published:
:   29 November 2024, 21:42

Updated:
:   25 February 2025, 23:15
:   [CloseAgent.mq5](/en/code/download/53889/closeagent.mq5 "CloseAgent.mq5")
    (4.97 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/53889.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This is a free example of an automated tool designed to close open positions at the optimal moment, combining two of the most effective technical analysis indicators: Bollinger Bands and RSI. It is particularly useful for closing residual trades at the end of the day or session, identifying overbought and oversold levels to find the best exit points, especially in low volatility conditions. It's also useful during the uncertainty leading up to high-impact news.

**Update:** added CloseAll function for all positions at specified profit.

**Last comments |
[Go to discussion](/en/forum/477401)**
(4)

![MahirFY](https://c.mql5.com/avatar/avatar_na2.png "MahirFY")

**[MahirFY](/en/users/mahirfy)**
|
7 Dec 2024 at 07:08

How to use?

![Pedro Roberto Diez San Jose](https://c.mql5.com/avatar/2023/1/63d808e5-8a0a.jpg "Pedro Roberto Diez San Jose")

**[Pedro Roberto Diez San Jose](/en/users/alfa-centauri)**
|
7 Dec 2024 at 19:52

**MahirFY [#](/en/forum/477401#comment_55323601):**  
 How to use?

Enable autotrading and the advisor into any chart, it will close your positions at the "optimal point" based on Bollinger Bands and the RSI.

![Wai Leong Wong](https://c.mql5.com/avatar/2020/11/5FBF8467-B590.jpg "Wai Leong Wong")

**[Wai Leong Wong](/en/users/madtwong)**
|
28 Feb 2025 at 06:48

can you please elaborate on what to set for the parameters ?   
  
Wtinmeframe 5 min  means only works base on 5 min?, what if i set 5 min on 30min chart?  
  
Close all 0 =  disable , 1 = to enable? what about 2 or 3... etc ?

![Pedro Roberto Diez San Jose](https://c.mql5.com/avatar/2023/1/63d808e5-8a0a.jpg "Pedro Roberto Diez San Jose")

**[Pedro Roberto Diez San Jose](/en/users/alfa-centauri)**
|
28 Feb 2025 at 18:06

**Wai Leong Wong [#](/en/forum/477401#comment_56031285):**  

can you please elaborate on what to set for the parameters ?   
  
Wtinmeframe 5 min  means only works base on 5 min?, what if i set 5 min on 30min chart?  
  
Close all 0 =  disable , 1 = to enable? what about 2 or 3... etc ?

PERIOD\_M5 to work in the 5 minute timeframe of Bollinger Bands and RSI, it's the most effective for day trading but if you expect high volatility a higher timeframe could be ok.

The chart timeframe doesn't matter, it will work based on the advisor settings. **CloseAll (0 disabled): more than zero is your global take profit.**

![Get min margin in to csv](https://c.mql5.com/i/code/script.png)
[Get min margin in to csv](/en/code/53550)

The script MinMargins.mq5 is designed to help traders quickly calculate and document the minimum amount of money required to open a position with the smallest lot size for all symbols available in the Market Watch. This data is saved to a CSV file for easy review and analysis.

![MT4 to MT5 Convertor (MT5Compat.mqh)](https://c.mql5.com/i/code/library.png)
[MT4 to MT5 Convertor (MT5Compat.mqh)](/en/code/53547)

A new interface library has been developed to simplify the process of converting MT4 indicators and Expert Advisors (EAs) to MT5. This library supports most of the MetaTrader 4 functions, offering developers a unified solution for cross-platform compatibility.

![Converted from Pine Script - Fibonacci Bollinger Bands](https://c.mql5.com/i/code/indicator.png)
[Converted from Pine Script - Fibonacci Bollinger Bands](/en/code/53959)

This Fibonacci Bollinger Bands indicator is a conversion from Pine Script (by Rashad) to the MQL5 language.

![High-Performance Time Functions (TimeUtils)](https://c.mql5.com/i/code/library.png)
[High-Performance Time Functions (TimeUtils)](/en/code/53970)

High-performmance functions for dealing with time.