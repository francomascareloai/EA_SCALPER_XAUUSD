# Trend_Catcher - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/13661

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/13661) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Trend\_Catcher - expert for MetaTrader 4

[Dmitriy Epshteyn](/en/users/gazon_3)  |
[English](javascript:void(false);)

[Русский](/ru/code/13661) [Español](/es/code/13661) [Deutsch](/de/code/13661) [日本語](/ja/code/13661)

Views:
:   46452

Rating:
:   (57)

Published:
:   7 October 2015, 10:45

Updated:
:   22 November 2016, 07:32
:   [trend\_catcher.mq4](/en/code/download/13661/trend_catcher.mq4 "trend_catcher.mq4")
    (8.99 KB)
    [view](# "view")

    [Trend\_Catcher\_v2.mq4](/en/code/download/13661/trend_catcher_v2.mq4 "Trend_Catcher_v2.mq4")
    (11.22 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/13661.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The EA looks for trend using three MAs (period 200, 50, 25 or other) and opens orders using the Parabolic SAR indicator. There is martingale in an Expert Advisor, the lot is calculated in percents from a deposit depending on Stop Loss.

The updated version has some new adds, user can: 1) choose days for trade, 2) open orders on the inverted signal, 3) disable closing an order on an opposite signal.

**Entering the market**

* Buy: if current price is higher than point of Parabolic SAR indicator on a current candle, Close price of the previous candle is lower than the previous point of Parabolic SAR indicator, МА is higher than the first slow МА, current price is higher than the second МА with other period.
* Sell: if current price is below than point of Parabolic SAR indicator on a current candle, Close price of the previous candle is higher than the previous point of Parabolic SAR indicator, МА is lower than the first slow МА, current price is lower than the second МА with other period.
* The Expert Advisor closes the order at the opposite signal.

**Stop Loss and Take Profit**

* If Auto\_SL = true, then the Stop Loss is calculated automatically and is set on the point of Parabolic SAR indicator. You can apply the SL\_koef coefficient which is multiplied by the distance in points between the level of opening the order and the point of the Parabolic SAR indicator. Example: if the distance from the order price to the point of Parabolic SAR indicator is 20 points and SL\_koef = 2, then an order will be opened with a Stop Loss of 40 points, if SL\_koef = 0.5, the order will be placed with a Stop Loss of 10 points.
* If Auto\_SL = false, Stop Loss will be fixed at the parameter SL in points.
* If Auto\_TP = true, Take Profit is calculated automatically by the Stop Loss and multiplied by TP\_koef. Example: If TP\_koef = 2, it means that the Take Profit will be twice of Stop Loss.
* If Auto\_TP = false, the Take Profit is fixed at TP in points.

**Lot and martingale settings**

* Order lot size is calculated by the percentage of the deposit, based on the Risk setting and Stop Loss. Example: the account balance is $1,000, Stop Loss is 100 points at Risk = 1 (1 percent of the deposit) we can lose 10 currency units, the lot will be 0.01, at Risk = 10 the lot will be 0.1.
* If Martin = true and the latest order is closed with a loss, the risk of the next trade will be increased by Koef times.
* If Martin = false, then the EA will calculate the lot at the percentage of the current account balance.

**Breakeven and Trailing Stop**

If the position profit reaches Profit\_Level pips, then SL\_Plus pips of the profit will be put a Stop Loss.

If the position profit reaches Profit\_Level2 pips, at TrailingStop2 distance Stop Loss will be dragged by the price.

![](https://c.mql5.com/18/42/eng-2.png)

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/13661](/ru/code/13661)

**Last comments |
[Go to discussion](/en/forum/65078)**
(76)

![Dmitriy Epshteyn](https://c.mql5.com/avatar/2015/10/561FB079-115F.jpg "Dmitriy Epshteyn")

**[Dmitriy Epshteyn](/en/users/gazon_3)**
|
16 Feb 2016 at 16:33

**Povilas Damarackas:**  

Hi **Dmitriy,**

Correct me if I am wrong, but I believe there is a mistake in your experts logic, because Lot is always =0 and One\_Lot\*Lot will always be 0.  I believe it should be One\_Lot\*Lot\_History?

Hi, thank you for your attention to EA.

Yes, your write, code EA needs update, but there are no mistake, it is not critically, becorse:

```mql5
if(sl>0&&AccountFreeMargin()>=One_Lot*Lot) {Lot=NormalizeDouble(Procent/sl*Point/MarketInfo(Symbol(),MODE_TICKVALUE),2);}
```

```mql5
AccountFreeMargin() will be more 0, then Lot will be = NormalizeDouble(Procent/sl*Point/MarketInfo(Symbol(),MODE_TICKVALUE),2)

```mql5
if(sl>0&&AccountFreeMargin()<=One_Lot*Lot) {Lot=NormalizeDouble((AccountBalance()/100*Risk)/sl*Point/MarketInfo(Symbol(),MODE_TICKVALUE),2);}
```

if we have no margin to open a calculation lot after increasing, we will open lot wich will be 
calculated from Account Balance 

or

if(Lot<MarketInfo(Symbol(),MODE_MINLOT)) {Lot=MarketInfo(Symbol(),MODE_MINLOT);}
min Lot
```

![Francis Dogbe](https://c.mql5.com/avatar/2021/1/600DF368-9DA2.png "Francis Dogbe")

**[Francis Dogbe](/en/users/roszey)**
|
17 Feb 2016 at 10:23

any new version available?

![Dmitriy Epshteyn](https://c.mql5.com/avatar/2015/10/561FB079-115F.jpg "Dmitriy Epshteyn")

**[Dmitriy Epshteyn](/en/users/gazon_3)**
|
17 Feb 2016 at 12:48

**Francis Dogbe:**  
 any new version available?

trend\_catcher\_v2.mq4 - last version. When there are will be new update, you will report by "Favorites".

Best Regards,

Dmitriy

![Francis Dogbe](https://c.mql5.com/avatar/2021/1/600DF368-9DA2.png "Francis Dogbe")

**[Francis Dogbe](/en/users/roszey)**
|
17 Feb 2016 at 14:38

**Dmitriy Epshteyn:**  

trend\_catcher\_v2.mq4 - last version. When there are will be new update, you will report by "Favorites".

Best Regards,

Dmitriy

ok thanks

![Francesco740](https://c.mql5.com/avatar/avatar_na2.png "Francesco740")

**[Francesco740](/en/users/francesco740)**
|
1 Mar 2020 at 23:05

Bad EA! It's Capital dinstructor|

![Instant Execution New](https://c.mql5.com/i/code/expert.png)
[Instant Execution New](/en/code/13940)

Instant execution button to close profit orders, close all orders, auto close by trailing parameter. Last update: 21 April 2016. Prev: 8 Dec 2015

![Squeeze RA V1](https://c.mql5.com/i/code/indicator.png)
[Squeeze RA V1](/en/code/13938)

My version of Squeeze Indicator for MetaTrader 4. This indicator is based on a strategy mentioned in John Carter's book, Mastering the Trade. It is also a fully improvised version of Squeeze\_Break indicator by Des O'Regan.

![AutoSLTP](https://c.mql5.com/i/code/expert.png)
[AutoSLTP](/en/code/14005)

This EA will help you to set Stop Loss and Take Profit.

![Traditional MACD with Momentum indicador and alarms](https://c.mql5.com/i/code/indicator.png)
[Traditional MACD with Momentum indicador and alarms](/en/code/13947)

Traditional MACD indicator with a Momentum indicator and alarms. Allows customization of most of the parameters without having to dive into code.