# Tunnel gen4 - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/22659

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/22659) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Tunnel gen4 - expert for MetaTrader 5

Scriptor  |
[English](javascript:void(false);)

[Русский](/ru/code/22659) [中文](/zh/code/22659) [Español](/es/code/22659) [Deutsch](/de/code/22659) [日本語](/ja/code/22659) [Português](/pt/code/22659)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   7285

Rating:
:   (28)

Published:
:   28 December 2018, 13:11

Updated:
:   17 January 2019, 11:29
:   [Tunnel gen4.mq5](/en/code/download/22659/tunnel_gen4.mq5 "Tunnel gen4.mq5")
    (29.93 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/22659.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Idea by:** [Scriptor](/en/users/scriptor "Scriptor")

**Code mq5 by:** [barabashkakvn](/en/users/barabashkakvn)

**The EA works on hedge accounts ONLY!**

It works on each tick.

The EA works in a cyclic manner: The initial reference point is no open positions on the market. Trading starts with simultaneously opening opposite positions: BUY and SELL with the initial lot size of **Start Lots**. At the next step (as soon as the price passes the **Step**), we will open a double-lot-size position:

* If the price has passed the Step upwards, we will open Sell
* If the price has passed the Step downwards, we will open Buy

If the price passes one more Step, we will close everything and get a profit or loss, depending on where the price has gone:

![Tunnel gen4](https://c.mql5.com/18/75/Tunnel_gen4.png "Tunnel gen4")

This trading system is based on the assumption that the price would rather return than continue its trend.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/22659](/ru/code/22659)

**Last comments |
[Go to discussion](/en/forum/296686)**
(9)

![Tiago Martins](https://c.mql5.com/avatar/2020/6/5EDD0D28-DB5C.png "Tiago Martins")

**[Tiago Martins](/en/users/ffiesta)**
|
30 Mar 2020 at 13:05

**Vladimir Karputov:**  

No. In this strategy, you can't limit yourself: "or only BUY", "or only SELL"

Okay, thanks my friend.

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
30 Mar 2020 at 13:20

**Tiago Martins :**  

Okay, thanks my friend.

I've changed my mind: now, in the strategy, you can set the restriction "only buy" or "only sell" - but in this case, you'll have to enter the [parameter](https://www.mql5.com/en/docs/network/socketiswritable "MQL5 documentation: SocketIsWritable function") "Max Loss, on cash deposit". This is necessary in order not to get a suspended position.

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
30 Mar 2020 at 15:22

**Tiago Martins :**  

Hello Mr Vladimir

This expert advisor is very promising, but I have a request to ask you, please, will it be possible to place an option of only buying or selling only up or down from the initial buy and sell positions, number of open positions on each candle and close profit when it reaches a certain value predefined by the trader. I would really appreciate this update.

[Tunnelling gen4 2](/ru/code/28496) :

> > ### Principle of operation
>
> [Modified](/ru/code/22659) version of the [gen4 tunnel 2](/ru/code/22659)
>
> > Differences from the gen4 tunnel:
>
> * new parameter ' **Max Loss, on cash deposit** ' - maximum loss. When this value is reached, all positions will be closed
> * new parameter ' **Target Profit, in cash deposit** ' - target profit. When this value is reached, all positions will be closed
> * new parameter ' **Maximum positions on bar** ' - limiting the number of open positions on a bar (does not work on the first open, when there are no positions on the market)
> * new parameter ' **Search for signals, in seconds** ' - pause in seconds between searches for trading signals. General rule: if the interval is set to less than "10" - this means ONLY at the moment a new bar is born, if the interval is set to exactly or more than "10" - this means working every "N" seconds.
> * new parameter ' **Trading mode:** ' - type of trading allowed. It can be " ***Only*** ***buy*** ***positions allowed*** ", " ***Only buy positions allowed*** " and " ***Only*** ***buy*** and ***sell*** ***positions*** ***allowed*** ".
>
> ![Tunnel gen4 2](https://c.mql5.com/18/89/2020-03-30_14h37_11.png "Gen4 Tunnel 2")

![Tiago Martins](https://c.mql5.com/avatar/2020/6/5EDD0D28-DB5C.png "Tiago Martins")

**[Tiago Martins](/en/users/ffiesta)**
|
6 Apr 2020 at 19:01

**Vladimir Karputov:**  

[Tunnel gen4 2](/ru/code/28496) :

> > ### Operating principle
>
> [Modified](/ru/code/22659) version of the [gen4 2 tunnel](/ru/code/22659)
>
> > Differences from the gen4 tunnel:
>
> * new parameter ' **Max Loss, on cash deposit** ' - maximum loss. When this value is reached, all positions will be closed
> * new parameter ' **Target Profit, in cash deposit** ' - target profit. When this value is reached, all positions will be closed
> * new parameter ' **Maximum positions on bar** ' - limiting the number of open positions on a bar (does not work on the first open, when there are no positions on the market)
> * new parameter ' **Search for signals, in seconds** ' - pause in seconds between searches for trading signals. General rule: if the interval is set to less than "10" - this means ONLY at the moment a new bar is born, if the interval is set to exactly or more than "10" - this means working every "N" seconds.
> * new parameter ' **Trading mode:** ' - type of trading allowed. It can be " ***Only*** ***buy*** ***positions allowed*** ", " ***Only buy positions allowed*** " and " ***Only*** ***buy*** and ***sell*** ***positions*** ***allowed*** ".

Hi Sir, thank you for the update, works awesome. Thank you. Best Regards

![Alife Jaymes Alves Diniz](https://c.mql5.com/avatar/2019/12/5DFA6332-B386.png "Alife Jaymes Alves Diniz")

**[Alife Jaymes Alves Diniz](/en/users/5847539)**
|
10 May 2021 at 03:52

Is there any way to specify the % profit function he should be earning per month?

For example, he was earning 5% per month, this month he is no longer working!

![HLCrossSigForRSI_HTF](https://c.mql5.com/i/code/indicator.png)
[HLCrossSigForRSI\_HTF](/en/code/22660)

Indicator HLCrossSigForRSI with the possibility of changing its timeframe in its input parameters

![RSI RFTL EA](https://c.mql5.com/i/code/expert.png)
[RSI RFTL EA](/en/code/22662)

An EA based on indicators iRSI (Relative Strength Index, RSI) and RFTL

![Hans_Indicator_x62_Cloud_System_Alert](https://c.mql5.com/i/code/indicator.png)
[Hans\_Indicator\_x62\_Cloud\_System\_Alert](/en/code/22656)

An indicator of expanding time zone ranges with the background color filling and the midline of the Hans\_Indicator range, capable of giving alerts and sending mail and Push messages at the time of breaking through the expanding of the range formed, with the number of price levels increased up to thirty-one

![Smoothing Average](https://c.mql5.com/i/code/expert.png)
[Smoothing Average](/en/code/22653)

An EA based on indicator iMA (Moving Average, MA). Reverse of signals. Lot size is either fixed or based on risk percentage.