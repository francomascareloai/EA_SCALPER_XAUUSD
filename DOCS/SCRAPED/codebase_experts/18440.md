# Crossing of two iMA - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/18440

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/18440) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Crossing of two iMA - expert for MetaTrader 5

ITM7  |
[English](javascript:void(false);)

[Русский](/ru/code/18440) [中文](/zh/code/18440) [Español](/es/code/18440) [Deutsch](/de/code/18440) [日本語](/ja/code/18440) [Português](/pt/code/18440)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   10865

Rating:
:   (31)

Published:
:   10 August 2017, 10:36

Updated:
:   27 June 2018, 13:16
:   \MQL5\Indicators\

    [Custom Moving Average Input Color.mq5](/en/code/download/18440/custom_moving_average_input_color.mq5 "Custom Moving Average Input Color.mq5")
    (7.32 KB)
    [view](# "view")

    [Crossing of two iMA.mq5](/en/code/download/18440/crossing_of_two_ima.mq5 "Crossing of two iMA.mq5")
    (50.57 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/18440.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**The author of the idea**: [ITM7](/en/users/itm7 "ITM7 (ITM7)") (inspired by [Requests & Ideas (MQL5 only!)](/en/forum/189685))

**MQL5 code author**: [Vladimir Karputov](/en/users/barabashkakvn "Vladimir Karputov (barabashkakvn)").

**Added:**

The call to iMA has been replaced by a call to iCustom [Custom Moving Average Input Color](/en/code/19864 "Custom Moving Average Input Color - indicator for MetaTrader 5"). In the tester (in the visual mode) or when attached to a chart, the EA visualizes the Moving Average indicators in different colors:

![Crossing of two iMA](https://c.mql5.com/18/64/Crossing_of_two_iMA__1.png "Crossing of two iMA")

Crossover of two iMAs (Moving Averages), one more iMA (Moving Average) is used as the filter.

Position **Lot** calculation: manually or risk percent of balance.

Trading method: Stop, Market or Limit orders. The EA also sets Stop Loss, Take Profit, Trailing Stop.

**Input parameters: (additions are highlighted)**

* "Parameters of the first Moving Average"
  + Period of the first Moving Average
  + Shift of the first Moving Average
  + Method of the first Moving Average
  + Color of the first Moving Average
* "Parameters of the second Moving Average"
  + Period of the second Moving Average
  + Shift of the second Moving Average
  + Method of the second Moving Average
  + Color of the second Moving Average
* "Parameters of the Third Moving Average"
  + Third indicator Moving Average - filter
  + Period of the third Moving Average
  + Shift of the third Moving Average
  + Method of the third Moving Average
  + Color of the third Moving Average
* "Parameters of Money Management"
  + true -> lot is manual, false -> percentage of risk from balance
  + Lots (use only if lot size is manual)
* "Parameters of trading"
  + Risk in percent for a deal from balance
  + (in pips) <0 -> Stop orders, =0 -> Market, >0 -> Limit orders
  + Stop Loss (in pips)
  + Take Profit (in pips)
  + Trailing Stop ("0" -> not trailing)
  + Trailing Step (use if Trailing Stop >0)
  + Magic number
  + Slippage

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/18440](/ru/code/18440)

**Last comments |
[Go to discussion](/en/forum/213103)**
(71)

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
25 Sep 2021 at 16:10

**Armin [#](/en/forum/213103/page3#comment_24833763) :**  
 thanks for such a nice EA, I read the code and couldn't understand which part (if any) limits the total [number of positions](/en/docs/trading/positionstotal "MQL5 documentation: PositionsTotal function") to open. can you please tell me which part to look into?

There is no such limitation.

![](https://c.mql5.com/avatar/avatar_na2.png)

**[Deleted]**
|
25 Sep 2021 at 16:25

**Vladimir Karputov [#](/en/forum/213103/page3#comment_24833824):**  

There is no such limitation.

thanks, so it will open one position on each bar until reaches not enough money?

```mql5
//check volume before OrderSend to avoid "not enough money" error (CTrade)
   
if(chek_volime_lot!=0.0)
```

if I want to put such limitation, where do you suggest to add it?

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
25 Sep 2021 at 16:33

**Armin [#](/en/forum/213103/page3#comment_24834098) :**  

thanks, so it will open one position on each bar until reaches not enough money?

if I want to put such limitation, where do you suggest to add it?

No. It will not be able to open at every bar - since the trading signal is -> this is the intersection of indicators.

![](https://c.mql5.com/avatar/avatar_na2.png)

**[Deleted]**
|
25 Sep 2021 at 16:57

**Vladimir Karputov [#](/en/forum/213103/page3#comment_24834161):**  

No. It will not be able to open at every bar - since the trading signal is -> this is the intersection of indicators.

thank you so much.

the thing I noticed is a situation that during one of my tests happens, so I start with 200, and money management is set to true with lot size 0.01, the EA is in profit but due to many positions open the margin level is reached and it stops out even though it's in profit, here's the photo:

[![](https://c.mql5.com/3/367/4353728384650__1.png)](https://c.mql5.com/3/367/4353728384650.png "https://c.mql5.com/3/367/4353728384650.png")

this is why I want to put a limit on the number of positions to open, what to do you suggest on this? check margin level before each order to be more than a certain value? because I checked and there are 26 open positions of 0.01 and margin level is just over 50%

[![](https://c.mql5.com/3/367/573066841977__1.png)](https://c.mql5.com/3/367/573066841977.png "https://c.mql5.com/3/367/573066841977.png")

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
25 Sep 2021 at 17:00

**Armin [#](/en/forum/213103/page3#comment_24834313) :**  

thank you so much.

the thing I noticed is a situation that during one of my tests happens, so I start with 200, and money management is set to true with lot size 0.01, the EA is in profit but due to many positions open the margin level is reached and it stops out even though it's in profit, here's the photo:

this is why I want to put a limit on the number of positions to open, what to do you suggest on this? check margin level before each order to be more than a certain value? because I checked and there are 26 open positions of 0.01 and margin level is just over 50%

I propose to rewrite all this to the trading engine version 4.XXXX (article [Почти конструктор для создания советника](/ru/articles/9717) ). In the new engine, you can always allow only one position.

![NRTR_ATR_STOP_HTF](https://c.mql5.com/i/code/indicator.png)
[NRTR\_ATR\_STOP\_HTF](/en/code/18436)

The NRTR\_ATR\_STOP indicator with the timeframe selection option available in the indicator input parameters.

![DeltaForce](https://c.mql5.com/i/code/indicator.png)
[DeltaForce](/en/code/18435)

Two histograms in one window showing the degree of the financial asset's overbought or oversold state.

![exp_Amstell-SL](https://c.mql5.com/i/code/expert.png)
[exp\_Amstell-SL](/en/code/18443)

The EA buys if the open price of the last position is higher than the current price.

![Exp_NRTR_ATR_STOP](https://c.mql5.com/i/code/expert.png)
[Exp\_NRTR\_ATR\_STOP](/en/code/18448)

The trading system is based on the NRTR\_ATR\_STOP indicator signals.