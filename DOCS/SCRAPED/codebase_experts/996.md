# ClosePosition - script for MetaTrader 5

Source: https://www.mql5.com/en/code/996

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/996) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Scripts](https://c.mql5.com/i/code/script.png)

# ClosePosition - script for MetaTrader 5

[Nikolay Kositsin](/en/users/godzilla)  |
[English](javascript:void(false);)

[Русский](/ru/code/996) [中文](/zh/code/996) [Español](/es/code/996) [Deutsch](/de/code/996) [日本語](/ja/code/996) [Português](/pt/code/996)

Views:
:   10945

Rating:
:   (37)

Published:
:   21 September 2012, 09:19

Updated:
:   22 November 2016, 07:32
:   [closeposition.mq5](/en/code/download/996/closeposition.mq5 "closeposition.mq5")
    (15.15 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/996.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

ClosePosition script is designed for closing open positions with the volume depending on their size.

**Input parameters:**

```mql5
//+----------------------------------------------+
//| INPUT PARAMETERS OF THE SCRIPT               |
//+----------------------------------------------+
input double VOLUME=1.0;    // The volume of the closed position in relation to the initial
input int  DEVIATION=10;    // Price deviation
input uint RTOTAL=4;        // The number of repeats on unsuccessful transactions
input uint SLEEPTIME=1;     // Pause time in seconds between repeats
```

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/996](/ru/code/996)

**Last comments |
[Go to discussion](/en/forum/7950)**
(36)

![Alexey Viktorov](https://c.mql5.com/avatar/2017/4/58E3DFDD-D3B2.jpg "Alexey Viktorov")

**[Alexey Viktorov](/en/users/alexeyvik)**
|
21 Feb 2017 at 12:44

**Nikolay Kositsin:**  
 Hardly! Your code **is like a rhinoceros in a china shop,** it will just smash all positions and that's all, not close the required volume. Good luck.

This is a very accurate point.   
  
**fxsaber:** everyone who is interested in your library is already using it, but it is not decent to impose it like this. The best is the enemy of the good.

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
21 Feb 2017 at 12:56

**Alexey Viktorov:**  
**fxsaber:** everyone who is interested in your library is already using it, but it is unseemly to impose it like this. The best is the enemy of the good.

Sometimes it is much more effective to convey an algorithm/thought by code than by its description. MQL4 code is the most understandable and concise. Using this syntax is 100% justified.

As for the Bible, it is mentioned only to remove the often heard "this is not MQL5".

Well, it was clearly demonstrated that the filling is filled incorrectly. Therefore, the sub-job will not work on many symbols on net accounts.

But you have the right to consider that all of the above is an indecent advertisement of bibla.

![Alexey Viktorov](https://c.mql5.com/avatar/2017/4/58E3DFDD-D3B2.jpg "Alexey Viktorov")

**[Alexey Viktorov](/en/users/alexeyvik)**
|
21 Feb 2017 at 15:01

**fxsaber:**  

Sometimes it is much more effective to convey an algorithm/thought by code than by its description. MQL4 code is the most understandable and concise. The use of this syntax is 100% justified.

As for the Bible, it is mentioned only to remove the often heard "this is not MQL5".

Well, it was clearly demonstrated that the filling is filled incorrectly. Therefore, the sub-job will not work on many symbols on net accounts.

But you have the right to consider that all of the above is an **indecent advertisement of bibla**.

Sorry to be blunt, but it is exactly an annoying advert. Even if not bullshit, but still a tiresome advert, equivalent to this.  
  
![](https://c.mql5.com/3/118/i.jpg)

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
21 Feb 2017 at 15:08

**Alexey Viktorov:**  
 Sorry to be blunt, but that's exactly what it is, an annoying advert. Even if it's not crap, it's still an annoying advert, equal to this.

No problem! Crashed the post with the mention.

Please just let me know how to avoid annoying adverts in answers to questions or bug reports, so as not to lose the point and not to cause flooding?

![ot-kr](https://c.mql5.com/avatar/avatar_na2.png "ot-kr")

**[ot-kr](/en/users/ot-kr)**
|
10 Jul 2023 at 15:51

It closes 1 position in MT5 on 1 pair, but why do you need it if you can close 1 position as it is. Apparently it works only in netting.

![InvertPosition](https://c.mql5.com/i/code/script.png)
[InvertPosition](/en/code/997)

The script is developed for reversing open positions with fixed Stop Loss and Take Profit values in points from the current price and the volume depending on the reversed position.

![AverageSizeBar](https://c.mql5.com/i/code/indicator.png)
[AverageSizeBar](/en/code/989)

The average candle size for a certain period.

![Moving Average: 3-Pole Butterworth Filter](https://c.mql5.com/i/code/indicator.png)
[Moving Average: 3-Pole Butterworth Filter](/en/code/929)

Moving Average: 3-Pole Butterworth Filter. The indicator is based on the code of Witold Wozniak.

![EA_CCIT3](https://c.mql5.com/i/code/expert.png)
[EA\_CCIT3](/en/code/992)

The Expert Advisor is based on CCIT3\_Simple and CCIT3\_noReCalc. Crossing of the indicator's zero line is used for trading activity.