# iCHO Trend CCIDualOnMA Filter - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/37799

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/37799) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# iCHO Trend CCIDualOnMA Filter - expert for MetaTrader 5

[Vladimir Karputov](/en/users/barabashkakvn)  |
[English](javascript:void(false);)

[Русский](/ru/code/37799) [中文](/zh/code/37799) [Español](/es/code/37799) [Deutsch](/de/code/37799) [日本語](/ja/code/37799) [Português](/pt/code/37799) [한국어](/ko/code/37799) [Français](/fr/code/37799) [Italiano](/it/code/37799) [Türkçe](/tr/code/37799)

Views:
:   3155

Rating:
:   (18)

Published:
:   4 April 2025, 10:53
:   [iCHO Trend CCIDualOnMA Filter.mq5](/en/code/download/37799/icho_trend_ccidualonma_filter.mq5 "iCHO Trend CCIDualOnMA Filter.mq5")
    (193.65 KB)
    [view](# "view")

    \MQL5\Indicators\

    [CCIDualOnMA.mq5](/en/code/download/37799/ccidualonma.mq5 "CCIDualOnMA.mq5")
    (18.27 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/37799.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

### Trading strategy

The Expert Advisor uses two indicators: iCHO (Chaikin Oscillator, CHO) and custom [CCIDualOnMA](/en/code/37429). CHO is used as a trend indicator and also, when the indicator crosses zero, to close positions. The 'CCIDualOnMA' indicator is used as a filter to add positions. Both indicators are created on the specified**'Working** timeframe' - the same timeframe is used to determine the moment of birth of a new bar (if necessary for the parameters **'Trailing on ...**' and**'Search signals on ...**').

**Trading signals:**

**Closing positions when the CHO indicator crosses zero :**

| Crossing | Positions: Reverse | Trade mode |
| --- | --- | --- |
| Crossing from bottom to top | ***'false***' -> close all SELL positions | (***'Allowed only BUY positions***' OR***'Allowed BUY and SELL positions***') -> open BUY position |
|  | ***'true***' -> close all BUY positions | (***'Allowed only SELL positions***' OR***'Allowed BUY and SELL positions***') -> open SELL position |
|  |  |  |
| Top-down intersection | ***'false***' -> close all BUY positions | (***'Allowed only SELL positions***' OR***'Allowed BUY and SELL positions***') -> open SELL position |
|  | ***'true***' -> close all SELL positions | (***'Allowed only BUY positions***' OR '***Allowed BUY and SELL positions***') -> open BUY position |
|  |  |  |

**Normal signals (adding a position)**

The CHO indicator is above zero and the fast CCI crosses the slow CCI from bottom to top and the fast one is below zero - a signal to open BUY.

The CHO indicator is below zero and the fast CCI crosses the slow CCI from top to bottom and the fast one is above zero - signal to open SELL.

![iCHO Trend CCIDualOnMA Filter](https://c.mql5.com/18/161/2022-01-11_18h07_36.png "iCHO Trend CCIDualOnMA Filter")

Fig. 1. iCHO Trend CCIDualOnMA Filter

**Features:**

* The Expert Advisor can be optimised by**working time** frame (**'Working time** frame')
* There can be only one 'market entry' trade per bar (this is an internal parameter, it is not included in the input parameters and it has nothing to do with the**'Only one positions**' parameter).
* When working in the*'inside bar*' mode (the '**Search signals on ...**' parameter is 'bar***#0 (at every tick)***') the current bar is bar #0, when working in the*'only when a new bar is born*' mode(  the'**Search signals on ...**' parameter  is '***bar #1 (on a new bar)***') the current  bar is bar #1.
* Parameter**'Trade mode: '** - restriction on which side to trade. It can take the values***'Allowed only BUY positions***', '***Allowed******only SELL positions***'***and 'Allowed BUY and SELL positions***'.
* The**'Use time control**' parameter- time interval for searching for trading signals  from**'Start Hour**'::**'Start Minute**' to**'End Hour**'::**'End Minute**'. The time range can be set both within a day and with a transition through a day

Now let's learn more about each group of parameters:

**Trading settings:**

> **'Working timeframe**' -**working** timeframe. The timeframe on which indicators are created and on which a new bar is searched.

> Stop Loss, Take Profit and Trailing are set in[Points](/en/articles/9717#chapter1). Any of the parameters (**'Stop Loss**',**'Take Profit**',**'Trailing Stop**') can be disabled - to do this, set the selected parameter to '0.0'.

> How trailing works is shown in pictures in the [TrailingStop](/en/code/17263) code.

**Position size management (lot calculation)**

> Lot can be either constant (**'Money management**' set to***'Constant lot***' and set lot size in**'The value for "Money management"**') or dynamic - in percentage of risk per**deal**(**'Money management**' set to**'Risk in percent for a deal**' and set risk percentage in**'The value for "Money management**"'). It is also possible to set a constant lot equal to the minimum lot - '**Money management**' is set to***'Lots Min***'.

**Time control:**

> This section sets the time range for searching for trading signals. The time range is enabled via**'Use time control**' and sets the time interval for searching signals from**'Start Hour**'::**'Start Minute**' to**'End Hour**':::**'End Minute**'. The time range can be set both within a day and with a transition through a day. Does not affect trailing.

**Additional features:**

> The**'Positions: Only one**' flag set to***'true***' allows the Expert Advisor to have no more than one position in the market.

ATTENTION: '**Positions: Only one**' set to'***true***' does not cancel'**Positions: Close opposite**'set to '***true***'! In other words: the opposite position(s) will be closed first.

![Additional features](https://c.mql5.com/18/161/Additional_features.png "Additional features")

The**'Positions: Reverse**' flag is responsible for reversing signals. An interesting flag 'Positions**: Close opposite**' - when set to***'true***' before opening a position, it ensures that opposite positions are removed.**'Print** log' outputs advanced logging of all operations. The**'Freeze and StopsLevels Coefficient**' parameter sets the coefficient for stop and freeze levels for cases when these levels for a symbol are equal to zero. It is recommended to use the value '3'.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/37799](/ru/code/37799)

**Last comments |
[Go to discussion](/en/forum/484162)**
(12)

![Leonid Polosuhin](https://c.mql5.com/avatar/2020/6/5ED77D85-08BA.png "Leonid Polosuhin")

**[Leonid Polosuhin](/en/users/leonidpolosuhin)**
|
24 Jan 2022 at 22:51

**Leonid Polosuhin [#](/ru/forum/386068#comment_27276113):**  

You mean this: CAUTION: '**Positions: Only one'** set to'***true***' does not override'**Positions: Close opposite**'set to '***true***'! In other words: the opposite position(s) will be closed first. The 'Positions**: Reverse**' flag is responsible for reversing the signals. An interesting flag '**Positions: Close opposite**' - when set to '***true***' before opening a position, it is guaranteed to delete opposite positions...? Well, I have everything set to false and still closes opposite positions in minus...what am I doing wrong?...I don't know how you checked...now I'll delete the code and load it again, if anything changes, it means the reason was in it

I reloaded the code, nothing has changed...by the way, the strategy - [iMACD Four TimeFrames Full.mq5](/ru/code/download/37573/imacd_four_timeframes_full.mq5 "iMACD Four TimeFrames Full.mq5") has the same settings and works correctly - so the code on the forum is corrupted, replace it with the one that works correctly for you...Thanks

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
25 Jan 2022 at 03:59

**Leonid Polosuhin [#](/ru/forum/386068#comment_27278014):**  
 Reloaded the code, nothing has changed...by the way, the strategy - [iMACD Four TimeFrames Full.mq5](/ru/code/download/37573/imacd_four_timeframes_full.mq5 "iMACD Four TimeFrames Full.mq5") has the same settings and works correctly - so the code on the forum is corrupted, replace it with one that works correctly for you...Thanks

What in your understanding does "closes with counter" mean? ( as there is no closing of position by counter position in the code). Please explain in detail with logs and pictures.

Also provide the settings of the tester and EA. And don't forget information about the terminal and type of trading account.

![Leonid Polosuhin](https://c.mql5.com/avatar/2020/6/5ED77D85-08BA.png "Leonid Polosuhin")

**[Leonid Polosuhin](/en/users/leonidpolosuhin)**
|
25 Jan 2022 at 20:21

**Vladimir Karputov [#](/ru/forum/386068#comment_27281121):**  
 What do you mean by "closes with a counter position"? (as there is no closing of a position with a counter position in the code). Please explain in detail with logs and pictures.

Also provide the settings of the tester and EA. And don't forget information about the terminal and type of trading account.

MT5 "Alfa-Forex", demo account... what is there to explain, it's as if we are talking in different languages.... Take your two strategies:

[iMACD Four TimeFrames Full.mq5](/ru/code/download/37573/imacd_four_timeframes_full.mq5 "iMACD Four TimeFrames Full.mq5") and [iCHO Trend CCIDualOnMA Filter](/ru/code/37799), put the settings - '**Positions: Only one - false, ****Positions:** Close opposite - false, '**Positions: Reverse -** false, ****Stop Loss - 0******** ,

the others can be left as default and run them one by one in the strategy tester ... you will immediately see the difference in how the trades are opened: in the

[iMACD Four TimeFrames Full.mq5](/ru/code/download/37573/imacd_four_timeframes_full.mq5 "iMACD Four TimeFrames Full.mq5") trades will be opened in two directions, i.e. both buy and sell positions can be traded simultaneously and independently.... but in[iCHO Trend CCIDualOnMA Filter](/ru/code/37799) it is different - if, for example, buy is open, then when a sell  signal is received, first buy will be closed and then sell will be opened, i.e. the Expert Advisor behaves as if ****Positions: Close opposite is true**** in the settings ****, but in fact ****Positions: Close opposite is false.... that's where the error is********

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
25 Jan 2022 at 21:02

**Leonid Polosuhin [#](/ru/forum/386068#comment_27300662):**  

MT5 "Alfa-Forex", demo account... what is there to explain, it's as if we are speaking different languages.... Take your two strategies:

[iMACD Four TimeFrames Full.mq5](/ru/code/download/37573/imacd_four_timeframes_full.mq5 "iMACD Four TimeFrames Full.mq5") and [iCHO Trend CCIDualOnMA Filter](/ru/code/37799), put the settings - '**Positions: Only one - false, ****Positions:** Close opposite - false, '**Positions: Reverse -** false, ****Stop Loss - 0******** ,

the others can be left as default and run them one by one in the strategy tester ... you will immediately see the difference in how the trades are opened: in the

[iMACD Four TimeFrames Full.mq5](/ru/code/download/37573/imacd_four_timeframes_full.mq5 "iMACD Four TimeFrames Full.mq5") trades will be opened in two directions, i.e. both buy and sell positions can be traded simultaneously and independently.... but in[iCHO Trend CCIDualOnMA Filter](/ru/code/37799) it is different - if, for example, buy is open, then when a sell  signal is received, first buy will be closed and then sell will be opened, i.e. the Expert Advisor behaves as if ****Positions: Close opposite is true**** in the settings ****, but in fact ****Positions: Close opposite is false.... that's where the error is********

You should answer all the points in the post above. You don't need reasoning - just do what is usually required on a technical resource: answer all the questions point by point.  

After that I will show you your mistake (but beforehand I can say: you completely ignored the description of the strategy, especially the table).

So we are waiting for your answer on all points from my post above.

![Yordan Lechev](https://c.mql5.com/avatar/2020/5/5EC6F682-3925.jpg "Yordan Lechev")

**[Yordan Lechev](/en/users/jordan.l)**
|
6 Apr 2025 at 19:27

It's good, something like this, I'm testing it now, the interesting thing is that my [stop loss](https://www.metatrader5.com/en/terminal/help/trading/general_concept "User Guide: Types of orders") is 0 .....

Apparently the entries are flawless....

![Manual Position Tracking Panel](https://c.mql5.com/i/code/expert.png)
[Manual Position Tracking Panel](/en/code/36412)

Panel based on CDialog class. Work on the current symbol. Deleting, setting Take Profit, setting Breakeven on a group of positions

![Display optimised for console-type chart text output](https://c.mql5.com/i/code/library.png)
[Display optimised for console-type chart text output](/en/code/33898)

This library allows you to create displays to easily output text information to the chart at the most optimal rate

![MT4Orders QuickReport](https://c.mql5.com/i/code/library.png)
[MT4Orders QuickReport](/en/code/47816)

Fast JavaScript version of Report library from fxsaber for MT4-style trading commands implemented via MT4Orders or Virtual.
Works up to 10 times faster, NTML file size is smaller, can upload and display up to 5.4 million report lines.

![Angle and Speed](https://c.mql5.com/i/code/indicator.png)
[Angle and Speed](/en/code/49985)

The indicator shows the angle or average speed of price change.