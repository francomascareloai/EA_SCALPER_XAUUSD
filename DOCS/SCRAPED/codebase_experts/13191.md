# HAN - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/13191

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/13191) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# HAN - expert for MetaTrader 4

[Vladimir Lyopa](/en/users/grosstraktor)  |
[English](javascript:void(false);)

[Русский](/ru/code/13191) [Deutsch](/de/code/13191) [日本語](/ja/code/13191)

Views:
:   17419

Rating:
:   (24)

Published:
:   8 February 2016, 11:39

Updated:
:   22 November 2016, 07:32
:   [han.mq4](/en/code/download/13191/han.mq4 "han.mq4")
    (9.27 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/13191.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The Heiken Ashi Naive Expert Advisor is based on the Heiken Ashi candle chart system and uses the standard indicator of the same name. The «Naivete» of the trading system used is that it interprets only the two last candles of Heiken Ashi and does not use some complex analysis of patterns. The only «but» — the EA trades *against* the estimated trend direction, which is confirmed by the current state of the candlesticks.

The greatest advantage of the EA is that it has no input parameters, which would need optimization or "adjustment" to fit the previous data. For better control of the funds, the position size calculation can be enabled, which is based on the ATR indicator.

**Calculation Rules**

The following rules are used in the calculation of the Heiken Ashi candlesticks:

* Open\_HA = (previous Open\_HA + previous Close\_HA) / 2
* Close\_HA = min(Minimum, Open\_HA, Close\_HA)
* High\_HA = max(High, Open\_HA, Close\_HA)
* Low\_HA = (Open + High + Low + Close) / 4

where:

* Open\_HA, High\_HA, Low\_HA and Close\_HA are the levels of the Heiken Ashi candlesticks.
* Open + High + Low and Close are the levels of conventional candles.
* The levels of the initial Heiken Ashi candle are equal to respective levels of the simple candle.

**Trade Strategy:**

Heiken Ashi Naive uses a rather simple, yet not very obvious trading method.

The following entry signals are used:

* Sell if the latest completed Heiken Ashi candle is bullish, its body is longer than previous candle's body, previous candle is also bullish, and latest candle has no lower wick.
* Buy if the latest completed Heiken Ashi candle is bearish, its body is longer than previous candle's body, previous candle is also bearish, and latest candle has no upper wick.

If there exists an open position in an opposite direction when a signal arrives, the position is closed. If the position is in the same direction as the signal, the latter is ignored.

The following exit signals are used to close the trades before the new entry signals appear:

* Exit the short position if the latest completed Heiken Ashi candle is bearish, the previous candle is also bearish, and latest candle has no upper wick.
* Exit the long position if the latest completed Heiken Ashi candle is bullish, the previous candle is also bullish, and latest candle has no lower wick.

As you can see, the Expert Advisor uses the inverted logic in its trading strategy. It buys when the system points at a rather strong bearish trend, and it sells when it is a bullish rally according to Heiken Ashi. The point is to try to catch the reversals as early as possible.

**Input Parameters:**

**Money management**

* **Lots** (default = 0.1) — fixed base position size. Used when **MM** = *false*.
* **MM** (default = false) — if *true*, the position calculation based on the ATR indicator will be used.
* **ATR\_Period** (default = 20) — the period of the ATR indicator, which is used for position size calculation. Works only if **MM** = *true*.
* **ATR\_Multiplier** (default = 1) — value, by which the ATR indicator value will be multiplied. Works only if **MM** = *true*.
* **Risk** (default = 2) — risk tolerance in percentage of account balance/equity. Works only if **MM** = *true*. This parameter is ignored if **UseMoneyInsteadOfPercentage** = *true*.
* **FixedBalance** (default = 0) — if set to non-zero value, it is used instead of account balance/equity for position size calculation. Works only if **MM** = *true*.
* **MoneyRisk** (default = 0) — allowed risk in the account currency. Works only if **MM** = *true*. Requires **UseMoneyInsteadOfPercentage** to be set to *true*.
* **UseMoneyInsteadOfPercentage** (default = false) — if *true*, position size is calculated based on risk amount given in account currency (**MoneyRisk**) instead of balance/equity percentage risk (**Risk**). Works only if **MM** = *true*.
* **UseEquityInsteadOfBalance** (default = false) — if *true*, position size is calculated based on account equity instead of balance. Works only if **MM** = *true*. Ignored if **UseMoneyInsteadOfPercentage** = *true*.
* **LotDigits** (default = 2) — number of decimal places allowed by your broker in order volume. For example, if your broker allows trading micro lots (0.01), then this parameter should be set to 2. If your broker allows only mini lots (0.1) this parameter should be set to 1. Required only if **MM** = *true*.

**Miscellaneous**

* **OrderComment** (default = "HAN") — the comment for opened positions.
* **Slippage** (default = 100) — maximum allowed slippage; in broker points.
* **Magic** (default = 152207122013) — the magic number to filter positions opened by this EA.

![](https://c.mql5.com/18/38/EURUSDH1.png)

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/13191](/ru/code/13191)

**Last comments |
[Go to discussion](/en/forum/72908)**
(1)

![fxstreet111](https://c.mql5.com/avatar/avatar_na2.png "fxstreet111")

**[fxstreet111](/en/users/fxstreet111)**
|
11 Jul 2016 at 07:46

hi .. i like your thinking behind this code can you modify it a bit more according to my stagy i think it will be a good or  please modify this code a bit for me as per my requirement ,. i can also pay you for that.

BUY RULE:- after a full bullish candle with no lower wick on hekin ashi .open [buy order](https://www.mql5.com/en/docs/constants/tradingconstants/enum_book_type "MQL5 documentation: Trade Orders in Depth Of Market") 10 points down to the close of the previous candle.

STOP :- low of the full bullish candle with now lower side wick.

TARGET :- bye default 400 points but can be changed input menu.

TRAILIN STOP : DEFAULT 200 POints can be changed from input

FOR SELL: REVERSE ALL THE POINT

![GainLossInfo](https://c.mql5.com/i/code/indicator.png)
[GainLossInfo](/en/code/13185)

Shows the current gain and loss for the candlesticks on the chart.

![Easy Trend Visualizer](https://c.mql5.com/i/code/indicator.png)
[Easy Trend Visualizer](/en/code/13182)

A simple visualizer of trends.

![Price Alert](https://c.mql5.com/i/code/indicator.png)
[Price Alert](/en/code/13192)

Plays sound alerts when the price reaches certain levels, specified by trader.

![Length of trend](https://c.mql5.com/i/code/indicator.png)
[Length of trend](/en/code/13196)

The indicator shows the length of the trend line in points.