# Advanced_Fractal_Envelopes - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/23425

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/23425) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Advanced\_Fractal\_Envelopes - indicator for MetaTrader 5

[Scriptor](/en/users/scriptor)  |
[English](javascript:void(false);)

[Русский](/ru/code/23425) [Español](/es/code/23425)

Views:
:   8910

Rating:
:   (16)

Published:
:   7 February 2019, 08:48
:   [Advanced\_Fractal\_Envelopes.mq5](/en/code/download/23425/advanced_fractal_envelopes.mq5 "Advanced_Fractal_Envelopes.mq5")
    (15.61 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/23425.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Indicator Advanced Fractal Envelopes builds two envelopes on the mean prices of the pre-defined number of upper and lower fractals and the central line.

It has three adjustable parameters:

* **Average** - number of fractals to build a moving average on their prices
* **Show central line** - show the central line
* **Show fractals** - show the fractals

Calculations:

Top     = AvgFractUp  
Bottom  = AvgFractDn  
Central = (AvgFractUp + AvgFractDn) / 2.0

where:

AvgFractUp = SMA(SumAvgUp, Average)  
AvgFractDn = SMA(SumAvgDn, Average)

SumAvgUp - sum of the prices of upper fractals within the Average number  
SumAvgDn - sum of the prices of lower fractals within the Average number

![](https://c.mql5.com/18/77/Advanced_Fractal_Envelopes.png)

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/23425](/ru/code/23425)

**Last comments |
[Go to discussion](/en/forum/302474)**
(9)

![Artyom Trishkin](https://c.mql5.com/avatar/2022/7/62C4775C-ABD6.jpg "Artyom Trishkin")

**[Artyom Trishkin](/en/users/artmedia70)**
|
22 Dec 2021 at 20:27

**Urman Ru [#](/ru/forum/292542#comment_26629138):**  
 Is it possible to change the indicator code so that the lines do not "fall"? I understand that it is because of the fractal. It is very inconvenient to constantly overload the indicator. Is it so in all "fractal" indicators or only in this particular one?

Maybe. I haven't looked into the code, but it is usually solved by pre-initialisation of all buffers being drawn with an empty value on each tick. First, the buffers are filled with values that are used in the indicator as "empty", and then the main calculation of the indicator is performed.

![Алексей Тарабанов](https://c.mql5.com/avatar/2015/1/54C6F69A-22AF.JPG "Алексей Тарабанов")

**[Алексей Тарабанов](/en/users/tara)**
|
22 Dec 2021 at 20:35

**Artyom Trishkin [#](/ru/forum/292542#comment_26638714):**  

Maybe. I haven't looked into the code, but this is usually solved by preliminary initialisation of all buffers being drawn with an empty value on each tick. First, the buffers are filled with values that are used in the indicator as "empty", and then the main calculation of the indicator is performed.

Tired?

![Urman Ru](https://c.mql5.com/avatar/2020/9/5F5CF155-38B0.png "Urman Ru")

**[Urman Ru](/en/users/urmanru)**
|
23 Dec 2021 at 12:00

**Artyom Trishkin [#](/ru/forum/292542#comment_26638714):**  

Maybe. I haven't looked into the code, but usually it is solved by preliminary initialisation of all drawn buffers with an empty value on each tick. First, the buffers are filled with values that are used in the indicator as "empty", and then the main calculation of the indicator is performed.

Thank you. Can you give me an example of such an indicator or at least a "piece" of code from it? Or where can I read more about it?

![Artyom Trishkin](https://c.mql5.com/avatar/2022/7/62C4775C-ABD6.jpg "Artyom Trishkin")

**[Artyom Trishkin](/en/users/artmedia70)**
|
23 Dec 2021 at 20:17

**Urman Ru [#](/ru/forum/292542#comment_26652221):**  

Thank you. Can you give me an example of such an indicator or at least a "piece" of code from it? Or where can I read more about it?

Try adding these lines to the code:

```mql5
//--- Calculating the indicator
   for(int i=limit; i>=0 && !IsStopped(); i--)
     {
      BufferTop[i]=EMPTY_VALUE;
      BufferCentral[i]=EMPTY_VALUE;
      BufferBottom[i]=EMPTY_VALUE;
      BufferFractUP[i]=EMPTY_VALUE;
      BufferFractDN[i]=EMPTY_VALUE;
      double average=0, fractal=BufferFractUP[i];
      int k=1,total=1;
      if(fractal>0 && fractal<EMPTY_VALUE)
        {
         average=fractal;
      //--- Average
         while(total<period_avg && i+k<rates_total-2)
           {
```

![Urman Ru](https://c.mql5.com/avatar/2020/9/5F5CF155-38B0.png "Urman Ru")

**[Urman Ru](/en/users/urmanru)**
|
24 Dec 2021 at 14:48

**Artyom Trishkin [#](/ru/forum/292542#comment_26660783):**  

Try adding these lines to the code:

Thank you! I think I'm starting to understand something).

![Advanced_Fractal_Overlay](https://c.mql5.com/i/code/indicator.png)
[Advanced\_Fractal\_Overlay](/en/code/23423)

Indicator Advanced Fractal Overlay

![Fraktrak xonax](https://c.mql5.com/i/code/expert.png)
[Fraktrak xonax](/en/code/23421)

A trading system based on breaking through iFractals

![ColorPEMA_Digit](https://c.mql5.com/i/code/indicator.png)
[ColorPEMA\_Digit](/en/code/23426)

A five-fold exponential moving average that displays the most recent value as a price label with the possibility to round the indicator levels to the required number of orders

![MACD_Overlay](https://c.mql5.com/i/code/indicator.png)
[MACD\_Overlay](/en/code/23427)

Indicator MACD Overlay