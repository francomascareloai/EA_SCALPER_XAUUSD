# Expert - library for MetaTrader 5

Source: https://www.mql5.com/en/code/19003

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/19003) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# Expert - library for MetaTrader 5

[fxsaber](/en/users/fxsaber)  |
[English](javascript:void(false);)

[Русский](/ru/code/19003) [中文](/zh/code/19003) [Español](/es/code/19003) [Deutsch](/de/code/19003) [日本語](/ja/code/19003) [Português](/pt/code/19003) [한국어](/ko/code/19003) [Français](/fr/code/19003) [Italiano](/it/code/19003) [Türkçe](/tr/code/19003)

Views:
:   12486

Rating:
:   (53)

Published:
:   3 November 2017, 12:29
:   \MQL5\Scripts\fxsaber\Expert\

    [ExpertsRemove.mq5](/en/code/download/19003/expertsremove.mq5 "ExpertsRemove.mq5")
    (0.43 KB)
    [view](# "view")

    [ExpertsReopen.mq5](/en/code/download/19003/expertsreopen.mq5 "ExpertsReopen.mq5")
    (0.43 KB)
    [view](# "view")

    [ChartsClose.mq5](/en/code/download/19003/chartsclose.mq5 "ChartsClose.mq5")
    (0.29 KB)
    [view](# "view")

    [ExpertLoader\_Example.mq5](/en/code/download/19003/expertloader_example.mq5 "ExpertLoader_Example.mq5")
    (1.38 KB)
    [view](# "view")

    [ExpertsChange\_Example.mq5](/en/code/download/19003/expertschange_example.mq5 "ExpertsChange_Example.mq5")
    (2.82 KB)
    [view](# "view")

    [ExpertsAction.mqh](/en/code/download/19003/expertsaction.mqh "ExpertsAction.mqh")
    (1.34 KB)
    [view](# "view")

    \MQL5\Include\fxsaber\

    [Expert.mqh](/en/code/download/19003/expert.mqh "Expert.mqh")
    (8.49 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/19003.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The library can be connected using

```mql5
#include <fxsaber\Expert.mqh>
```

All other files on this page provide examples/scenarios of library application; they are not needed for the operation of the library.

### Features

```mql5
// Is the Expert Advisor running on the appropriate chart?
bool EXPERT::Is( const long Chart_ID = 0 );

// Deletes the Expert Advisor form the appropriate chart
bool EXPERT::Remove( const long Chart_ID = 0 );

// Restarts the Expert Advisor on the appropriate chart
bool EXPERT::Reopen( const long Chart_ID = 0 );

// Retrieves data of the EA running on the appropriate chart
bool EXPERT::Parameters( const long Chart_ID,    
                         MqlParam &Parameters[], // Path to the EA and values of its input parameters
                         string &Names[] );      // Names of input parameters

// Launches the EA on the appropriate chart
bool EXPERT::Run( const long Chart_ID,    
                  MqlParam &Parameters[] ); // Path to the EA and values of its input parameters
```

### Example

The library use examples/scenarios are attached to the description.

* ExpertsRemove.mq5

  ```mql5
  // Removes from all charts running Expert Advisors
  ```
* ExpertsReopen.mq5

  ```mql5
  // Restarts running Expert Advisors
  ```
* ChartsClose.mq5

  ```mql5
  // Closes all charts, on which there are no Expert Advisors (convenient for VPS)
  ```
* ExpertLoader\_Example.mq5 (in the source file, you can see how the Expert Advisor is launched, as well as how the script starts itself as an EA)

  ```mql5
  // Starts an Expert Advisor with specified parameters
  ```
* ExpertsChange\_Example.mq5

  ```mql5
  // Restarts running Expert Advisors and changes their input parameters
  ```

The above examples are the simplest scenarios of library use. It can also be useful in the development of various control panels, from which charts/Expert Advisors are managed, etc.

For a better understanding of how to use the library, here is a short source code:

```mql5
// Starts an Expert Advisor with specified parameters
#include <fxsaber\Expert.mqh>

void OnStart()
{
  MqlParam Params[2];
  
  // Path to the Expert Advisor
  Params[0].string_value = "Experts\\Advisors\ExpertMACD.ex5";

  // The first input parameter of the Expert Advisor
  Params[1].type = TYPE_STRING;
  Params[1].string_value = "Hello World!";

  // Launching the Expert Advisor on the new chart
  EXPERT::Run(ChartOpen(_Symbol, _Period), Params);
}
```

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/19003](/ru/code/19003)

**Last comments |
[Go to discussion](/en/forum/218714)**
(125)

![hini](https://c.mql5.com/avatar/2024/3/65e98921-0708.jpg "hini")

**[hini](/en/users/hini)**
|
14 Jun 2025 at 17:15

**fxsaber [#](/ru/forum/214590/page12#comment_56972381):**  

If there is a problem, please give ready mq5 files for playback.

```mql5
#define  MT4ORDERS_LIBRARY
#include "../../utils/MT4Orders.mqh" 
// #define REPORT_BROWSER // Creating a report with browser startup - requires DLL permission.
#define  TESTER_CUSTOM // Running the Expert Advisor in the User Tester
#include "../../utils/fxsaber/Tester/Tester.mqh" // https://www.mql5.com/en/code/24848

#define  Bid SymbolInfoDouble(_Symbol, SYMBOL_BID)
#define  Ask SymbolInfoDouble(_Symbol, SYMBOL_ASK)

#define  KEY_B 66
#define  KEY_S 83
#define  KEY_C 67

input int In1 = 1;
input group "label1"
input double In2 = 2.0;
// 
void OnChartEvent( const int id, const long &lparam, const double &dparam, const string &sparam ) {
  if (id == CHARTEVENT_KEYDOWN) {
    switch ((int)lparam) {
    case KEY_B: // buy
      OrderSend(_Symbol, OP_BUY, 1, Ask, 100, 0, 0);
      break;
    case KEY_S: // sell
      OrderSend(_Symbol, OP_SELL, 1, Bid, 100, 0, 0);
      break;
    case KEY_C: // close
      for (int i = OrdersTotal() - 1; i >= 0; i--)
        if (OrderSelect(i, SELECT_BY_POS) && (OrderType() <= OP_SELL))
          OrderClose(OrderTicket(), OrderLots(), OrderClosePrice(), 100);
    }
  }
}


void OnTick() {
  //Print(_Symbol, " ", SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_SIZE));
}
void OnTimer() { /* Comment(REPORT::OrdersToString(_Symbol, 0, 5)); */ }
int OnInit() {
  Print(_Symbol, " ", SymbolInfoDouble(_Symbol, SYMBOL_TRADE_TICK_SIZE));
  Print(_Symbol, " In2 = ", In2);
  return(INIT_SUCCEEDED);
}
//
void OnDeinit( const int ) {}
//
void OnTradeTransaction(const MqlTradeTransaction& trans, const MqlTradeRequest& request, const MqlTradeResult& result) {

}
//+------------------------------------------------------------------+
```

![](https://c.mql5.com/3/467/992920602773.png)  
 [![](https://c.mql5.com/3/467/4707851605379__1.png)](https://c.mql5.com/3/467/4707851605379.png "https://c.mql5.com/3/467/4707851605379.png")

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
17 Jun 2025 at 07:43

**hini [#](/ru/forum/214590/page12#comment_56959339):**  

This situation does not seem to be considered. When the parameter is a group, there is no specific value and the value obtained will be null, so no parameters after the group will be obtained.

The following code shows that everything is handled correctly.

```mql5
input int In1 = 1;
input group "label1"
input double In2 = 2.0;

#include <fxsaber\Expert.mqh> // https://www.mql5.com/en/code/19003

int GetAmountExperts()
{
  int Res = 0;
  
  for (long Chart = ChartFirst(); Chart != -1; Chart = ChartNext(Chart))
    Res += (ChartGetString(Chart, CHART_EXPERT_NAME) != "");
    
  return(Res);
}

void OnInit()
{
  if (GetAmountExperts() < 2)
  {
    MqlParam Params[];
    string Names[];
            
    const int Size = EXPERT::Parameters(0, Params, Names) - 1;
    
    ArrayPrint(Params);
    ArrayPrint(Names);
    
    for (uint i = Size; (bool)i--;)
      EXPERT::AddInputName(Params[i + 1], Names[i]);
            
    Params[Size].string_value = "7";
    EXPERT::Run(ChartOpen(_Symbol, _Period), Params);
  }
}
```

Result.

```mql5
    [type] [integer_value] [double_value]      [string_value]
[0]     14               0           0.00 "Scripts\Test6.ex5"
[1]     14               1           1.00 "1"                
[2]     14               0           0.00 null               
[3]     14               2           2.00 "2.0"              
"In1" null  "In2"
```

Expert Advisor launched through Expert.mqh.

![](https://c.mql5.com/3/467/3858678893621.png)

![hini](https://c.mql5.com/avatar/2024/3/65e98921-0708.jpg "hini")

**[hini](/en/users/hini)**
|
17 Jun 2025 at 14:36

```mql5
input bool InRun = true;
input group "label1"
input double In2 = 2.0;

#include <fxsaber\Expert.mqh> // https://www.mql5.com/en/code/19003


int GetAmountExperts()
{
  int Res = 0;
  
  for (long Chart = ChartFirst(); Chart != -1; Chart = ChartNext(Chart))
    Res += (ChartGetString(Chart, CHART_EXPERT_NAME) != "");
    
  return(Res);
}

void OnInit()
{
  if (InRun)
  {
    MqlParam Params[];
    string Names[];
            
    const int Size = EXPERT::Parameters(0, Params, Names) - 1;
    
    ArrayPrint(Params);
    ArrayPrint(Names);
    int nameSize = ArraySize(Names);
    for (int i = nameSize-1; i >= 0; i--) {
      if (Names[i] == "InRun")
        Params[i+1].string_value = "false";
      EXPERT::AddInputName(Params[i + 1], Names[i]);
    }  
            
    ArrayPrint(Params);
    ArrayPrint(Names);
    //Params[Size].string_value = "7";
    EXPERT::Run(ChartOpen(_Symbol, _Period), Params);
    return;
  }
  Print("In2 = ", In2);
}
```

The GetAmountExperts function runs for an unknown reason for a very long time with no result. I changed the code a bit - please run it again. You should not assign the value 7 to the In2 parameter (you will see that there is 0, not 2).

![](https://c.mql5.com/3/467/4315087929159.png)

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
17 Jun 2025 at 17:53

**hini [#](/ru/forum/214590/page12#comment_57028885):**  

I've changed the code a bit - please run it again.

This is an exemplary bug report: ran the concise code, which immediately showed the bug.

Made the correction, thanks.

![hini](https://c.mql5.com/avatar/2024/3/65e98921-0708.jpg "hini")

**[hini](/en/users/hini)**
|
18 Jun 2025 at 01:38

**fxsaber [#](/ru/forum/214590/page13#comment_57030587):**  

This is an exemplary bug report: ran concise code that immediately showed a bug.

I've made the correction, thank you.

I see, in case of problems I will make reports in the same format.

![ColorPsychological](https://c.mql5.com/i/code/indicator.png)
[ColorPsychological](/en/code/18958)

The Psychological indicator implemented as a color histogram, featuring alerts, push and email notifications.

![MASi_WaveHist](https://c.mql5.com/i/code/indicator.png)
[MASi\_WaveHist](/en/code/18957)

This is an implementation of the market cycle indicator described by Raghee Horner.

![History Deals and Orders](https://c.mql5.com/i/code/script.png)
[History Deals and Orders](/en/code/19019)

The 'History Deals and Orders' script shows absolutely all properties of deals and orders from the trading history over a given time interval.

![Pending orders UP](https://c.mql5.com/i/code/script.png)
[Pending orders UP](/en/code/19024)

The scripts places multiple pending orders higher than the current price.