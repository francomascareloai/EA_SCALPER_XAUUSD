# Trend Me Leave Me - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/19951

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/19951) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Trend Me Leave Me - expert for MetaTrader 5

Scriptor  |
[English](javascript:void(false);)

[Русский](/ru/code/19951) [中文](/zh/code/19951) [Español](/es/code/19951) [Deutsch](/de/code/19951) [日本語](/ja/code/19951) [Português](/pt/code/19951)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   7716

Rating:
:   (16)

Published:
:   1 March 2018, 11:56
:   [Trend Me Leave Me.mq5](/en/code/download/19951/trend_me_leave_me.mq5 "Trend Me Leave Me.mq5")
    (42.05 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/19951.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**The author of the idea**: [Scriptor](/en/users/scriptor "Scriptor (Scriptor)"), **the author of the MQL5 code**: [barabashkakvn](/en/users/barabashkakvn).

The Expert Advisor works with one position (can be used on netting accounts). The direction of a new open signal is calculated depending on the direction of the last closed position (BUY or SELL) and the way that position was closed (by Stop Loss or Take Profit).

General principle:

* If a position was closed by Take Profit, the next position will be opened in the same direction;
* If a position was closed by Stop Loss, then the next position should be opened in the opposite direction.

Type of closing is determined in OnTradeTransaction() using [ENUM\_DEAL\_REASON](/en/docs/constants/tradingconstants/dealproperties#enum_deal_reason "MQL5 Reference → Standard Constants, Enumerations and Structures → Trading Constants → Deal properties → ENUM_DEAL_REASON"): the transaction and its type is accessed in OnTradeTransaction() first:

[TRADE\_TRANSACTION\_DEAL\_ADD](/en/docs/constants/tradingconstants/enum_trade_transaction_type "MQL5 Reference → Standard Constants, Enumerations and Structures → Trading Constants → Types of Transactions ") - adding a deal to history. It is performed as a result of order execution or making operations with the account balance.

, and then the DEAL\_REASON property is checked.

If the Breakeven parameter is not equal to zero, the position will be moved to breakeven if possible.

After determining the direction in OnTradeTransaction(), check for further conditions:

* To open a BUY position, the SAR indicator on bar #0 must be less than the Close of bar #0, and ADX on bar #0 must be less than 20.
* To open a SELL position, the SAR indicator on bar #0 must be greater than the Close of bar #0, and ADX on bar #0 must be less than 20;

### Input Parameters

* **Stop Loss (in pips)** - Stop Loss value;
* **Take Profit (in pips)** - Take Profit value;
* **Risk in percent for a deal** - risk percent per trade;
* **Breakeven (in pips)** - the breakeven value;
* **ADX: averaging period** - ADX indicator parameter;
* **SAR: price increment step - acceleration factor** - SAR indicator parameter;
* **SAR: maximum value of step** - SAR indicator parameter.

Default parameters, EURUSD,M30 from 2017.01.08 to 2018.02.05

![Trend Me Leave Me](https://c.mql5.com/18/65/Trend_Me_Leave_Me.png "Trend Me Leave Me")

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/19951](/ru/code/19951)

**[Go to discussion](/en/forum/229134)**

![AO_Divergence](https://c.mql5.com/i/code/indicator.png)
[AO\_Divergence](/en/code/19950)

The indicator searches for divergences and displays them on the chart of the custom AO indicator.

![EMA Cross Contest Hedged](https://c.mql5.com/i/code/expert.png)
[EMA Cross Contest Hedged](/en/code/19945)

A trading system based on three indicators: two iMAs (Moving Average) and iMACD (Moving Average Convergence/Divergence, MACD).

![BB-Decimal](https://c.mql5.com/i/code/indicator.png)
[BB-Decimal](/en/code/19952)

Colored Bollinger Bands

![D_Oscillator](https://c.mql5.com/i/code/indicator.png)
[D\_Oscillator](/en/code/19953)

RSI+CCI in one window.