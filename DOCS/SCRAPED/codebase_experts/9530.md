# Universal trailing stop  - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/9530

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/9530) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Universal trailing stop - expert for MetaTrader 4

[Vladimir Khlystov](/en/users/cmillion)  |
[English](javascript:void(false);)

[Русский](/ru/code/9530) [Español](/es/code/9530) [Deutsch](/de/code/9530) [Português](/pt/code/9530)

Views:
:   49431

Rating:
:   (31)

Published:
:   9 March 2010, 09:33

Updated:
:   21 April 2014, 14:54
:   [TrailingStopFrCn.mq4](/en/code/download/9530/TrailingStopFrCn.mq4 "TrailingStopFrCn.mq4")
    (8.43 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/9530.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

### Description:

Can run as a single Expert Advisor or a script, together with any Expert Advisor.

Depending on the variable **TrailingStop**, trailing may be performed using the fractals, the extremal values of bar in the past or using the specified points.

* If **TrailingStop** is greater than 0, then trailing will be carried out with the specified points, which are defined in the variable TrailingStop. If TrailingStop is less than the minimal limit stops, trailing stops will be minimal.
* If **TrailingStop** = 0 and **Tip.Fr.or.Candl** = 0, then trailing will performed using the fractals. The first corresponding fractal is used for the trailing.
* If **TrailingStop** = 0 and **Tip.Fr.or.Candl** = 1, then trailing will performed using the minimal/ maximal price values of the previous candle.
* If **Magic** = 0, then the trailing will performde on all orders with of this character, without the magic number. If the variable specified Magic magic number, respectively, will only trailing orders with the number of Magic.
* If **OnlyProfit** = true, then trailed profit orders only.
* If **OnlyWithoutLoss** = true, then orders trailed to the price level without loss only.

### Visualization:

The screen displays information about the ongoing work of the script:

- Script settings;  
- Number of orders, that processed;  
- Current time  
- Minimum levels of Stop (-)  
- Current possible stop levels (price tags)

### Tips:

The script terminates when all orders are closed. If the program is running as an ExpertAdvisor, it can be terminated manually.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/9530](/ru/code/9530)

**Last comments |
[Go to discussion](/en/forum/27277)**
(20)

![Vladimir Khlystov](https://c.mql5.com/avatar/2022/6/62B496F5-1DBF.jpg "Vladimir Khlystov")

**[Vladimir Khlystov](/en/users/cmillion)**
|
28 Jul 2015 at 23:03

**Алена Verleyen:**  
 Тогда пожалуйста, обновите свой код и опубликовать его.

Я бы так давно и сделал, но только по какой то причине нет возможности редактировать данную статью.

Прикрепляю файл сюда в надежде, что модератор сможет его обновить.

![muruez](https://c.mql5.com/avatar/2015/8/55BCFF21-6151.gif "muruez")

**[muruez](/en/users/muruez)**
|
29 Jul 2015 at 14:50

hi this is the link for the old post where i download the code.

[https://www.mql5.com/en/code/9530](/en/code/9530)

thank you.

![Vladimir Khlystov](https://c.mql5.com/avatar/2022/6/62B496F5-1DBF.jpg "Vladimir Khlystov")

**[Vladimir Khlystov](/en/users/cmillion)**
|
30 Jul 2015 at 09:33

**muruez:**  

привет это ссылка на старый пост, где я скачать код.

[https://www.mql5.com/en/code/9530](/en/code/9530)

спасибо.

я в прошлом посту выложил исправленный вариант, пользуйтесь им

![muruez](https://c.mql5.com/avatar/2015/8/55BCFF21-6151.gif "muruez")

**[muruez](/en/users/muruez)**
|
31 Jul 2015 at 12:16

**Vladimir Khlystov:**  
 я в прошлом посту выложил исправленный вариант, пользуйтесь им

thank you soooo much it is working great.

thank you.

![murysco](https://c.mql5.com/avatar/avatar_na2.png "murysco")

**[murysco](/en/users/murysco)**
|
13 Nov 2016 at 13:35

Hello,

Great work you've done here. Can you please make an addition to trail by Heinken Ashi candles also? It'll be very great to have this option available.

Thanks.

![EnvelopeMA version 0.0.1.beta](https://c.mql5.com/i/code/expert.png)
[EnvelopeMA version 0.0.1.beta](/en/code/9533)

Uses the ideas of envelopes, moving averages and parabolic SARs for entry and exits. Made for M15.

![Multi Moving Average v2](https://c.mql5.com/i/code/indicator.png)
[Multi Moving Average v2](/en/code/9508)

Multi Moving Average v2 - is a new version of the indicator Multi Moving Average.

![Instrument ](https://c.mql5.com/i/code/indicator.png)
[Instrument](/en/code/9545) 

Displaying of candles of any instrument of any period.

![News Trader Strategy](https://c.mql5.com/i/code/expert.png)
[News Trader Strategy](/en/code/9549)

This is an example of the one of trading news strategies. It can be a part of bigger EA which can play news.