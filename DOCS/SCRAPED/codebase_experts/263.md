# Professional ZigZag - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/263

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/263) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Professional ZigZag - indicator for MetaTrader 5

[Aleksandr Chugunov](/en/users/alexstal)  |
[English](javascript:void(false);)

[Русский](/ru/code/263) [中文](/zh/code/263) [Español](/es/code/263) [Deutsch](/de/code/263) [日本語](/ja/code/263) [Português](/pt/code/263) [한국어](/ko/code/263) [Français](/fr/code/263) [Italiano](/it/code/263) [Türkçe](/tr/code/263)

Views:
:   48151

Rating:
:   (48)

Published:
:   19 January 2011, 10:54

Updated:
:   22 November 2016, 07:32
:   \MQL5\Include\

    [alexstal\_outsidebar.mqh](/en/code/download/263/alexstal_outsidebar.mqh "alexstal_outsidebar.mqh")
    (10.9 KB)
    [view](# "view")

    [alexstal\_zigzagprof.mq5](/en/code/download/263/alexstal_zigzagprof.mq5 "alexstal_zigzagprof.mq5")
    (17.29 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/263.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Attention! This version of ZigZag indicator is based on [ZigZag code](https://www.mql5.com/ru/code/10041), and published here with permission of its author,** **[PPC](https://www.mql5.com/ru/users/ppc). I have tested that version and fixed an error in algorithm.**

**This code is the MQL5 version of the [Zigzag indicator](https://www.mql5.com/ru/code/10074) for MetaTrader 4.**

Attention! The AlexSTAL\_OutsideBar.mqh library should be located in  ..\MQL5\Include\ folder of the MetaTrader 5 client terminal.

**That is it?**

I think that ZigZag is something like compression of the price chart. The ZigZag can be calculated using the price of the bar (for example, Close price) or High/Low prices of the bar (the most common used method)

While working with the standard ZigZag, proposed by MetaQuotes, I have found some errors. The main problem is that standard ZigZag doesn't proceed the case of the outside bar.

In 2007 **[Rashid Umarov](https://www.mql5.com/ru/users/Rosh) (Rosh)** have published the [Zigzag2 R](https://www.mql5.com/en/code/7762) code with outside bar processing (DRAW\_ZIGZAG style instead of DRAW\_SECTION).

Let's define the features of the "correct" ZigZag implementation:

* The Highs and Lows must be strictly alternated;
* The High must be higher (or equal) among the all bars on the right side until the next (opposite) Low;
* The Low must be lower (or equal) among the all bars on the left side until the next (opposite) High.

Let's consider using the example (EURUSD, H1, 2006, December 8-13). Here we have two cases with the outside bar. The typical ZigZag cannot constuct the "correct" picture.

![Figure 1. Typical ZigZag with input parameters [12;5;3] and [12;0;0]](https://c.mql5.com/18/1/zz_011.png "Figure 1. Typical ZigZag with input parameters [12;5;3] and [12;0;0]")

**Figure 1.** Typical [ZigZag](https://www.mql5.com/ru/code/11206) with input parameters [12;5;3] and [12;0;0]

![Figure 2. Zigzag2 R with input parameters [12;5;3]](https://c.mql5.com/18/1/zz_031.png "Figure 2. Zigzag2 R with input parameters [12;5;3]")

**Figure** **2.** [Zigzag2 R](https://www.mql5.com/ru/code/7762) with input parameters [12;5;3]

![Figure 3. Zigzag2 R with input parameters [12;0;0]](https://c.mql5.com/18/1/zz_021.png "Figure 3. Zigzag2 R with input parameters [12;0;0]")

**Figure** **3.** [Zigzag2 R](https://www.mql5.com/ru/code/7762) with input parameters [12;0;0]

At first glance, the correct construction is presented at  **Figure 3** but here are some features:

1. In this case it has been constructed correctly because of the input parameters, but generally the algorithm must work with any parameters.
2. The outside bar on the left side isn't correct, because of the order of High/Low formation of the bar:

![](https://c.mql5.com/18/1/zz_04.gif)

The ZigZag segments must be constucted this way.

**I have tested many cases of the following ZigZag algorithms:** ZigZag MT3, ZigZag, Zigzag R, Zigzag2 R, ZigZag\_NK, ZigZag\_ZUP89\_nen, ZigZag\_new\_nen4, CZigZag, Swing\_ZZ\_1, DT\_ZZ\_nen, ZigZag\_Talex, Reverse\_ZZ, Points\_ZZ\_1, i\_MF\_Fractal\_ZZ\_3in1, ang\_Amp\_ZZ, ZigzagFr\_v1, NonLagZigZag\_v2, ZZ\_FF\_v3, ZigZag Ensign, ZigZag tauber, SQZZ Товаровед, ZZ\_2L\_nen wellx, Channel ZZ, Azzx\_larryzz\_3\_0, RPoint, RPoint-m v2, ZigZagTF. **But none of them has solved the problem correctly.**

  

**Here are the figures with this indicator:**

![Figure 4. Professional ZigZag with input parameters [12;0]](https://c.mql5.com/18/1/zz_051.png "Figure 4. Professional ZigZag with input parameters [12;0]")

**Figure 4.** Professional ZigZag with input parameters [12;0]

![Figure 5. Professional ZigZag with input parameters [23;0]](https://c.mql5.com/18/1/zz_061.png "Figure 5. Professional ZigZag with input parameters [23;0]")

**Figure 5.** Professional ZigZag with input parameters [23;0]

  

**Some features of this version:**

* one-pass algorithm
* it recalculate and redraw only the last segment (the segment cannot be cancelled except the history update)
* it has the optimization algorithm for the calculations inside the bar (it doesn't use the recalculation on the tick, if price has changed inside the 0 (uncompleted) bar or price change is lower than threshold, defined by MinMotion input parameter)
* it has two algorithms for ordering of the High/Low formation: using the bar type (fast but not precise) using the data from the lower timeframe (it needs the history, you need to check for its presence and correctness or you need to modify the **OutsideBar** library)

**The ProExtra version is not published, because the correctness of the MetaTrader 5 quotes is not checked.**

### Here are some additional examples of ZigZag incorrect constructions:

![Figure 6. EURUSD, H1, November 29-December 7. (Red line: ZigZag with input parameters [7;0;0]. Blue line: Zigzag2 R with input parameters [7;0;0].)](https://c.mql5.com/18/1/zz_071.png "Figure 6. EURUSD, H1, November 29-December 7. (Red line: ZigZag with input parameters [7;0;0]. Blue line: Zigzag2 R with input parameters [7;0;0].)")

**Figure 6.** EURUSD, H1, November 29-December 7. (Red line: ZigZag with input parameters [7;0;0]. Blue line: [Zigzag2 R](https://www.mql5.com/ru/code/7762) with input parameters [7;0;0].)

![Figure 7. EURUSD, H1, 2010, November 29 - December 7. The correct construction of ZigZag segments.](https://c.mql5.com/18/1/zz_081.png "Figure 7. EURUSD, H1, 2010, November 29 - December 7. The correct construction of ZigZag segments.")

**Figure 7.** EURUSD, H1, 2010, November 29 - December 7. The correct construction of ZigZag segments.

**Conclusion**

Unfortunately this version is not perfect, but I am working on it.

Because of the channel algorithm (iHighest/iLowest), sometimes it skips the highs.

**Please inform me about the bugs and features of this indicator.**

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/263](/ru/code/263)

**Last comments |
[Go to discussion](/en/forum/2995)**
(11)

![RadekGdansk](https://c.mql5.com/avatar/avatar_na2.png "RadekGdansk")

**[RadekGdansk](/en/users/radekgdansk)**
|
4 Aug 2019 at 12:27

Great job Alexandr!

I'm not a professional coder, but I can analyse the data and I can confirm that your version of this indicator works in the best way among the other versions.

Unlike the original MT4 indicator it work fine in the [Strategy Tester](https://www.mql5.com/en/articles/239 "Article \"The Fundamentals of Testing in MetaTrader 5\""), it detects all the spikes and to put simply it just does the job.

Thanks very much for your effort.

I would like to use your indicator in my EA, and I need to extract from the ZZ the last point of support (both up and down),

I checked the buffers 0-4, and none of them keeps this value, I don't quite get where some values came from, ie (Gold, 15 Jul 2019, 8:30 AM, 1M chart):

Buffer value 0 = 1412.27

Buffer value 1 = 2147483647

Buffer value 2 = 2147483647

Buffer value 3 = 1412.27

Buffer value 4 = 1412.16

The last value (1412.16) is not any high nor low, it's a "extra" buffer.

But I would like to get just one value showing the last confirmed value (that is to say from a closed candle) to use it in further calculations.

I'm using MT4 version of your code, but the buffers will work the same on both I suppose.

Let me give a clean example- original ZigZag has only one buffer, and it stores the last high or low support point up until the next is confirmed, I would like to extract exactly the same information from your code- will you be so kind and give me some advice regarding the method of doing that?

![Amundo Stowers](https://c.mql5.com/avatar/avatar_na2.png "Amundo Stowers")

**[Amundo Stowers](/en/users/amundo)**
|
6 May 2021 at 11:39

Fantastic work, thank you very much for sharing this gem!

(Sorry for the necro post, considering how old the original is, but just had to give credit where it is due)

![Trader-san](https://c.mql5.com/avatar/2020/10/5F7EE7EE-22A5.png "Trader-san")

**[Trader-san](/en/users/pekayobavich)**
|
1 Dec 2021 at 13:49

Hello, is it possible to add an alert to this indicator?

![Vitaliy Kostrubko](https://c.mql5.com/avatar/2016/8/579E94F7-83FB.png "Vitaliy Kostrubko")

**[Vitaliy Kostrubko](/en/users/bbk30)**
|
10 Apr 2024 at 00:02

... Question, why can't you specify a period longer than 99 bars ?!! ... I want to test it on a period of 750 bars ... but only 2 digits are available to enter the period ... please explain :) thanks )

![vvm-55](https://c.mql5.com/avatar/avatar_na2.png "vvm-55")

**[vvm-55](/en/users/vvm-55)**
|
9 May 2024 at 19:23

Hello, I am an absolute beginner When I try to compile alexstal\_zigzagprof.mq5 file I get an error: event handling function not found In the file there is really no OnInit() or anything like that. For clarification/help I will be very grateful to you.

![MQL5 Wizard - Trade Signals Based on Crossover of Lines of  the Alligator Indicator](https://c.mql5.com/i/code/expert.png)
[MQL5 Wizard - Trade Signals Based on Crossover of Lines of the Alligator Indicator](/en/code/267)

Trade signals based on crossover of lines of the Alligator technical indicator is considered. The code of the Expert Advisor based on this strategy can be generated automatically using the MQL5 Wizard.

![MQL5 Wizard - Trade Signals Based on Crossover of Main and Signal lines of MACD indicator](https://c.mql5.com/i/code/expert.png)
[MQL5 Wizard - Trade Signals Based on Crossover of Main and Signal lines of MACD indicator](/en/code/262)

Trade signals based on crossover of main and signal lines of MACD indicator (CSignalMACD from MQL5 Standard Library) is considered. The code of the Expert Advisor based on this strategy can be generated automatically using the MQL5 Wizard.

![sChartsSynchroScroll_v2](https://c.mql5.com/i/code/script.png)
[sChartsSynchroScroll\_v2](/en/code/266)

New version of the sChartsSynchroScroll script.

![MQL5 Wizard - Trade Signals Based on Reversal Candlestick Patterns](https://c.mql5.com/i/code/expert.png)
[MQL5 Wizard - Trade Signals Based on Reversal Candlestick Patterns](/en/code/268)

Trade signals based on reversal candlestick patterns is considered. The code of the Expert Advisor based on this strategy can be generated automatically using the MQL5 Wizard.