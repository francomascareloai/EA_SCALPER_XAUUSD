# TrailingTakeProfit - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/19930

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/19930) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# TrailingTakeProfit - expert for MetaTrader 5

[Scriptor](/en/users/scriptor)  |
[English](javascript:void(false);)

[Русский](/ru/code/19930) [中文](/zh/code/19930) [Español](/es/code/19930) [Deutsch](/de/code/19930) [日本語](/ja/code/19930) [Português](/pt/code/19930)

Views:
:   10128

Rating:
:   (23)

Published:
:   1 March 2018, 11:54
:   [TrailingTakeProfit.mq5](/en/code/download/19930/trailingtakeprofit.mq5 "TrailingTakeProfit.mq5")
    (23.94 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/19930.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This non-trading Expert Advisor is designed for the simple trailing of take profit orders of open positions.

The EA only works on hedging accounts.

Principle of operation: when a new position is opened, the EA checks its take profit order. If there is none, the EA sets a take profit order at the size specified in the EA parameters. Then the EA starts to move the position take profit, if the price moves farther than the distance specified in the settings. Actions are similar to a simple stop loss trailing function.

You can set position type - any/buy/sell, the position symbol (any or the specified one), the magic number (any or the specified one) or the position ticket (any or the specified one). It is also possible to set the take profit trailing in the losing area - if this mode is not selected, take profit will not be trailed in the losing area, and will stop at the breakeven distance from the position open price. The breakeven value can be specified in the EA parameters.

To check the trailing operation in all modes, the EA can open positions on each new bar. This mode can only be applied in the Strategy Tester.

The EA has nine input parameters:

* **Take Profit size in points** - take profit value in points. It is also used for TrailingTake as a distance between the stop order and the price;
* **Positions type** - the type of positions to trail;
* **Positions symbol ("" - any symbol)** - the symbol of the positions to trail (an empty value means all symbols);
* **Positions magic number (0 - any magic)** - the magic number of positions to trail;
* **Position ticket (0 - all tickets)** - the ticket of positions to trail;
* **Trailing step** - if the price moves away from the position take profit at a distance greater than the step, take profit will be modified so as to have the size specified in **Take Profit size in points**;
* **Trailing in the unprofitable zone** - enable or disable trailing in the losing area. If disabled, take profit will not be set in the loss zone;
* **Breakeven in points** - breakeven value. A losing area starts below this value;
* **Spread multiplier** - spread multiplier for calculating a correct distance for stop orders.

For Stop Loss and Take Profit orders (as well as pending orders), there is a minimum allowed distance for placing such orders - **StopLevel**. I.e. Stop Loss and Take Profit (as well as pending orders) cannot be placed closer than this distance to the price. If **StopLevel** is zero, it does not mean its absence, it only means that **StopLevel** is floating. In this case, the minimum distance is usually equal to spread\*, but sometimes even the double spread is not enough. So, this parameter allows specifying a custom multiplier for the spread used to calculate the minimum distance for placing stop orders.

![](https://c.mql5.com/18/64/2018-02-05_14h41_16.gif)

Fig.1 Testing take profit trailing of a Buy position. Take profit is equal to 400 points, trailing step = 10, trailing is only applied in the profitable zone.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/19930](/ru/code/19930)

**Last comments |
[Go to discussion](/en/forum/229127)**
(6)

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
7 Feb 2018 at 16:17

```mql5
//+------------------------------------------------------------------+
//|| Trailing function|
//+------------------------------------------------------------------+
void Trailing(void)
  {
   int   total=PositionsTotal();
   for(int i=total; i>=0; i--)
     {
      ulong ticket=PositionGetTicket(i);
      if(ticket==0) continue;
      string symbol_name=PositionGetString(POSITION_SYMBOL);
      ulong  magic_number=(ulong)PositionGetInteger(POSITION_MAGIC);
      ENUM_POSITION_TYPE type=(ENUM_POSITION_TYPE)PositionGetInteger(POSITION_TYPE);
      if(InpPositionType>WRONG_VALUE && type!=(ENUM_POSITION_TYPE)InpPositionType) continue;
```

It is very expensive (especially string) to create dedicated variables before all continue checks.

Imagine a simple optimisation for 100,000 passes of 10,000,000 ticks. Then OnTick will be called one TRILLION times. Any extra action called a trillion times will take extra seconds/minutes/hours. Value your own and others' time.

![Artyom Trishkin](https://c.mql5.com/avatar/2022/7/62C4775C-ABD6.jpg "Artyom Trishkin")

**[Artyom Trishkin](/en/users/artmedia70)**
|
7 Feb 2018 at 16:22

**fxsaber:**  

It is very expensive (especially string) to create dedicated variables before all continue checks.

Imagine a simple optimisation for 100,000 passes of 10,000,000 ticks. Then OnTick will be called one TRILLION times. Any extra action called a trillion times will take extra seconds/minutes/hours. Value your time and other people's time.

This is not a trading EA. Why optimise it? It's just a trawl. And a weird one at that.

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
7 Feb 2018 at 16:30

**Artyom Trishkin:**  
 This is not a trading EA. Why optimise it? It's just a trawl. And a weird one at that.

It's a migrating Trailing function for training purposes.

![Artyom Trishkin](https://c.mql5.com/avatar/2022/7/62C4775C-ABD6.jpg "Artyom Trishkin")

**[Artyom Trishkin](/en/users/artmedia70)**
|
7 Feb 2018 at 16:41

**fxsaber:**  

This is a migrating Trailing function for training purposes.

It is not sufficient to be migrating. Only in the context of this code.

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
7 Feb 2018 at 16:44

**Artyom Trishkin:**  
 Insufficient for migrating. Only in the context of the code in question.

Migratory - when 90% of the code is borrowed.

![TimeEA](https://c.mql5.com/i/code/expert.png)
[TimeEA](/en/code/19916)

A Simple Expert Advisor The EA opens a position of the specified type at the time specified in the EA parameters. The position is closed at the time specified in the appropriate parameter.

![NTK 07](https://c.mql5.com/i/code/expert.png)
[NTK 07](/en/code/19914)

Implementation of multiple trailing types. Pending Buy Stop and Sell Stop orders. Limitation of the maximum total lot and the total number of positions. Several types of position volume calculation.

![RndTrade](https://c.mql5.com/i/code/expert.png)
[RndTrade](/en/code/19931)

Opening positions randomly after a certain time interval.

![Ambush](https://c.mql5.com/i/code/expert.png)
[Ambush](/en/code/19936)

The Expert Advisor uses Buy Stop and Sell Stop orders to trade news and large price movements.