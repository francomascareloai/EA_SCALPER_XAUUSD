# Smart Tunel Trading - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/22705

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/22705) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Smart Tunel Trading - expert for MetaTrader 4

[Deleted]

Views:
:   43818

Rating:
:   (74)

Published:
:   11 October 2018, 19:13

Updated:
:   18 October 2018, 09:42
:   [FxNode - Safe Tunnel.mq4](/en/code/download/22705/fxnode_-_safe_tunnel.mq4 "FxNode - Safe Tunnel.mq4")
    (53.16 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/22705.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Copyright 2018 Ali Sabbaghi.

FXnode Group.

![Smart Tunel view](https://c.mql5.com/18/75/03__2.png "Smart Tunel view")

### Description:

**Smart tunnel**is a smart ea that uses the Zigzag indicator to find out sensitivity situation of market price.

with this point, SMART tunnel automatically create trend line that market movement reacted in this point.

with zigzag find the highest and lowest price (support and resistance) and with this point EA crate trend line.

it changes and updates automatically ...

if price touches this line expert decide to act with it. BUY or SEll depended on the market situation.

you can manage your time that tells to ea to trade in the special hour of the day. for example trade at midnight.

this ea has a smart function to manage your RISK, manage your Time.

**Smart tunnel is really profitable.**

![profit](https://c.mql5.com/18/75/01.png "profit")

with 14% highest drawdown and Profit factor about 6.5

Recommended parameter:

1. Use an ECN broker account.
2. minimum deposit of 100$ USD.
3. use it in H1 time frame
4. recommended symbol is EURUSD

**input parameter:**

TrendType                Prefered Order Type - BUY or SELL

TakeProfit                Profit in points

MaxStopLoss             Max Stop Loss

FixTakeProfit            Profit in points to take away

TouchPipBuy             Pip Distance to touch trend line

TouchPipSell             Pip Distance to touch trend line

SlTrail                      Trail in point

StaticLot                  Position static size if you have no risk

MinLot                     Minimum Position size

MaxLot                    Maximum Position size

MaxSpread               Max Spread to allow tradeing

isk\_Percentage        Money Management Risk Percent

MaxOpenPosition     Maximum Opened Position

MagicNumber          Your Magic Number

TREND LINE parameter

InpDepth                Depth Of

InpDeviation            Deviation

InpBackstep             Backstep

ZigZagNum              Number Of High And Low

Color\_UPLine           Color Of Sell Line

Color\_DWLine          Color Of Buy Line

TimeManagment      Activate Time Managment

WeekenClose          Close Opened Order in weekends.

InpAtrPeriod        ATR Period

StochasticKperiod   Stochastic K Period

StochasticDperiod   Stochastic D Period

StochasticSlowing   Stochastic Slowing

BuyZone             Stochastic Low Zone line

SellZone            Stochastic High Zone line

CCIperiod           CCI Period

RSIperiod           CCI Period

**Last comments |
[Go to discussion](/en/forum/283597)**
(77)

![Giuseppe888](https://c.mql5.com/avatar/2017/2/58A33C35-34A6.jpg "Giuseppe888")

**[Giuseppe888](/en/users/giuseppe888)**
|
15 Dec 2019 at 19:37

**Richard Poster:**  
 Thanks for this fine EA and clever
strategy.  I tried using the Optimizer to optimize some of the parameters and noticed that the Optimizer gave different results
than the Backtester, for identical input data.  It turns out that the Optimizer cannot
[create
objects](/en/docs/constants/objectconstants/enum_object "MQL5 documentation: Object Types"), making it unreliable for optimization when Objects are used.  I verified this with a simple test program.

Hi **Richar,**

declare 2 global var.:

double gl\_LineValHigh;  // "FXNODE.HighLine"  
double gl\_LineValLow;   // "FXNODE.LowLine"

then set the global var in : void TrendLine()  
...

   if((highcount > 2) && (DrawLine == true))  
     {  
  
     
ObjectDelete("FXNODE.HighLine");
  
      //gl\_LineValHigh = ZigZagHigh[Secund\_High\_Candel];  
      gl\_LineValHigh =
ZigZagHigh[First\_High\_Candel];
  
      ObjectCreate("FXNODE.HighLine", OBJ\_TREND, 0,
Time[ZigHCandel[Secund\_High\_Candel]],ZigZagHigh[Secund\_High\_Candel],Time[ZigHCandel[First\_High\_Candel]],ZigZagHigh[First\_High\_Candel]);
  
...

   if((lowcount > 2) && (DrawLine == true))  
     {  
     
ObjectDelete("FXNODE.LowLine");
  
      //gl\_LineValLow = ZigZagLow[Secund\_Low\_Candel];  
      gl\_LineValLow =
ZigZagLow[First\_Low\_Candel];

At the end use it in: bool CheckToOpen()

...

   //LineValHigh = NormalizeDouble(ObjectGetValueByShift("FXNODE.HighLine", 0),Digits);  
  
//LineValLow  = NormalizeDouble(ObjectGetValueByShift("FXNODE.LowLine", 0),Digits);
  
  
   LineValHigh = NormalizeDouble(gl\_LineValHigh,Digits);  
   LineValLow =
NormalizeDouble(gl\_LineValLow,Digits);

Best Regards

![Giuseppe888](https://c.mql5.com/avatar/2017/2/58A33C35-34A6.jpg "Giuseppe888")

**[Giuseppe888](/en/users/giuseppe888)**
|
15 Dec 2019 at 20:20

**Felipe Ponce Aragon:**  
 Can someone explain to me why you say
that the EA is good? I get terrible results in
[backtest](/en/articles/2612 "Article \"Testing trading strategies on real ticks\"")
with ECN account and very low spread. Does anyone here have profitable settings? Help please.

Hi Felipe,

because with little modification the EA is not so bed on EURUSD - H1 - Spread 15 - 1 Year ,
obviously in simulation

The EA is still raw, profit factor
is too low

[![](https://c.mql5.com/3/301/immagine__1.png)](https://c.mql5.com/3/301/immagine.png "https://c.mql5.com/3/301/immagine.png")

[![](https://c.mql5.com/3/301/immagine__3.png)](https://c.mql5.com/3/301/immagine__2.png "https://c.mql5.com/3/301/immagine__2.png")

[![](https://c.mql5.com/3/301/immagine__5.png)](https://c.mql5.com/3/301/immagine__4.png "https://c.mql5.com/3/301/immagine__4.png")

Best Regards

![Faeze Bakhshayesh](https://c.mql5.com/avatar/avatar_na2.png "Faeze Bakhshayesh")

**[Faeze Bakhshayesh](/en/users/fafoolika)**
|
17 Jan 2020 at 12:06

I make a grate EA with it. Thank you my friend and thank for your sharing

![Faeze Bakhshayesh](https://c.mql5.com/avatar/avatar_na2.png "Faeze Bakhshayesh")

**[Faeze Bakhshayesh](/en/users/fafoolika)**
|
17 Jan 2020 at 15:42

**Giuseppe888:**  

Hi **Richar,**

declare 2 global var.:

double gl\_LineValHigh;  // "FXNODE.HighLine"  
double gl\_LineValLow;   // "FXNODE.LowLine"

then set the global var in : void TrendLine()  
...

   if((highcount > 2) && (DrawLine == true))  
     {  
  
     
ObjectDelete("FXNODE.HighLine");
  
      //gl\_LineValHigh = ZigZagHigh[Secund\_High\_Candel];  
      gl\_LineValHigh =
ZigZagHigh[First\_High\_Candel];
  
      ObjectCreate("FXNODE.HighLine", OBJ\_TREND, 0,
Time[ZigHCandel[Secund\_High\_Candel]],ZigZagHigh[Secund\_High\_Candel],Time[ZigHCandel[First\_High\_Candel]],ZigZagHigh[First\_High\_Candel]);
  
...

   if((lowcount > 2) && (DrawLine == true))  
     {  
     
ObjectDelete("FXNODE.LowLine");
  
      //gl\_LineValLow = ZigZagLow[Secund\_Low\_Candel];  
      gl\_LineValLow =
ZigZagLow[First\_Low\_Candel];

At the end use it in: bool CheckToOpen()

...

   //LineValHigh = NormalizeDouble(ObjectGetValueByShift("FXNODE.HighLine", 0),Digits);  
  
//LineValLow  = NormalizeDouble(ObjectGetValueByShift("FXNODE.LowLine", 0),Digits);
  
  
   LineValHigh = NormalizeDouble(gl\_LineValHigh,Digits);  
   LineValLow =
NormalizeDouble(gl\_LineValLow,Digits);

Best Regards

This is not work man  
Because  ZigZagLow[First\_Low\_Candel] is first point of a line...

this is maybe located in bar 20 or 30 or ...

But when you are trading with a point of line you want calculate if price touch a point of line in bar[0]

![Johann Baumgartner](https://c.mql5.com/avatar/2019/5/5CD6CFF8-C82D.jpg "Johann Baumgartner")

**[Johann Baumgartner](/en/users/j0hnnyb)**
|
17 Feb 2020 at 10:32

Its strange that even as I turned off the time management and it default says 01.00 open and 03.00 close its only starting to trade then.

I'm using the set files from page 5 for the 5Minutes TF.

Anyone else having good results so far?

![Market Open-Close Hours Indicator](https://c.mql5.com/i/code/indicator.png)
[Market Open-Close Hours Indicator](/en/code/22541)

Displays a line when the markets are opened.

![One Click (Hot Key Alt-C) close all order and take screen for keep your trading journal](https://c.mql5.com/i/code/script.png)
[One Click (Hot Key Alt-C) close all order and take screen for keep your trading journal](/en/code/22083)

1) Close all order on the Symbol Chart
2) Take screen for keep a Trading Journal

![Super Trend updated and simpler code](https://c.mql5.com/i/code/indicator.png)
[Super Trend updated and simpler code](/en/code/22750)

This is just another version of the well known Super Trend indicator.
The code is simplified but it has the same output on the chart screen.

![Dōteki Heikin Ashi (Dynamic Average Foot/Bar)](https://c.mql5.com/i/code/indicator.png)
[Dōteki Heikin Ashi (Dynamic Average Foot/Bar)](/en/code/22765)

A dynamic version of the standard Heikin Ashi indicator (code compatible with both MQL4 or MQL5).