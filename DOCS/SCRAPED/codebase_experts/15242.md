# RegularExpressions in MQL5 for working with regular expressions - library for MetaTrader 5

Source: https://www.mql5.com/en/code/15242

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/15242) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# RegularExpressions in MQL5 for working with regular expressions - library for MetaTrader 5

Microsoft Corporation  |
[English](javascript:void(false);)

[Русский](/ru/code/15242) [中文](/zh/code/15242) [Español](/es/code/15242) [Deutsch](/de/code/15242) [日本語](/ja/code/15242) [Português](/pt/code/15242) [한국어](/ko/code/15242) [Français](/fr/code/15242) [Italiano](/it/code/15242) [Türkçe](/tr/code/15242)

Published by:
:   [MetaQuotes](/en/users/metaquotes)

Views:
:   9057

Rating:
:   (40)

Published:
:   20 May 2016, 13:39

Updated:
:   15 November 2022, 09:51
:   \MQL5\Experts\RegExpressions Demo\

    [TableListView.mqh](/en/code/download/15242/TableListView.mqh "TableListView.mqh")
    (60.38 KB)
    [view](# "view")

    [Tests.mq5](/en/code/download/15242/Tests.mq5 "Tests.mq5")
    (139.55 KB)
    [view](# "view")

    [TradeHistoryParsing.mq5](/en/code/download/15242/TradeHistoryParsing.mq5 "TradeHistoryParsing.mq5")
    (55.11 KB)
    [view](# "view")

    \MQL5\Include\Internal\

    [Array.mqh](/en/code/download/15242/Array.mqh "Array.mqh")
    (22.32 KB)
    [view](# "view")

    [IComparable.mqh](/en/code/download/15242/IComparable.mqh "IComparable.mqh")
    (4.98 KB)
    [view](# "view")

    [DynamicMatrix.mqh](/en/code/download/15242/dynamicmatrix.mqh "DynamicMatrix.mqh")
    (22 KB)
    [view](# "view")

    [Wrappers.mqh](/en/code/download/15242/wrappers.mqh "Wrappers.mqh")
    (16.99 KB)
    [view](# "view")

    \MQL5\Include\Internal\Generic\

    [Collection.mqh](/en/code/download/15242/Collection.mqh "Collection.mqh")
    (12.54 KB)
    [view](# "view")

    [Dictionary.mqh](/en/code/download/15242/Dictionary.mqh "Dictionary.mqh")
    (42.58 KB)
    [view](# "view")

    [EqualityComparer.mqh](/en/code/download/15242/EqualityComparer.mqh "EqualityComparer.mqh")
    (8.65 KB)
    [view](# "view")

    [ICollection.mqh](/en/code/download/15242/ICollection.mqh "ICollection.mqh")
    (6.15 KB)
    [view](# "view")

    [IComparer.mqh](/en/code/download/15242/IComparer.mqh "IComparer.mqh")
    (6.62 KB)
    [view](# "view")

    [IDictionary.mqh](/en/code/download/15242/IDictionary.mqh "IDictionary.mqh")
    (6.88 KB)
    [view](# "view")

    [IEnumerable.mqh](/en/code/download/15242/IEnumerable.mqh "IEnumerable.mqh")
    (5.31 KB)
    [view](# "view")

    [IEnumerator.mqh](/en/code/download/15242/IEnumerator.mqh "IEnumerator.mqh")
    (10.39 KB)
    [view](# "view")

    [IEqualityComparer.mqh](/en/code/download/15242/IEqualityComparer.mqh "IEqualityComparer.mqh")
    (4.62 KB)
    [view](# "view")

    [IList.mqh](/en/code/download/15242/IList.mqh "IList.mqh")
    (5.7 KB)
    [view](# "view")

    [KeyValuePair.mqh](/en/code/download/15242/KeyValuePair.mqh "KeyValuePair.mqh")
    (6.34 KB)
    [view](# "view")

    [LinkedList.mqh](/en/code/download/15242/LinkedList.mqh "LinkedList.mqh")
    (28.3 KB)
    [view](# "view")

    [List.mqh](/en/code/download/15242/List.mqh "List.mqh")
    (38.62 KB)
    [view](# "view")

    \MQL5\Include\Internal\TimeSpan\

    [TimeSpan.mqh](/en/code/download/15242/TimeSpan.mqh "TimeSpan.mqh")
    (31.7 KB)
    [view](# "view")

    [TimeSpanFormat.mqh](/en/code/download/15242/TimeSpanFormat.mqh "TimeSpanFormat.mqh")
    (30.31 KB)
    [view](# "view")

    \MQL5\Include\RegularExpressions\

    [CharUnicodeCategory.txt](/en/code/download/15242/CharUnicodeCategory.txt "CharUnicodeCategory.txt")
    (23.5 KB)
    [view](# "view")

    [Regex.mqh](/en/code/download/15242/Regex.mqh "Regex.mqh")
    (58.05 KB)
    [view](# "view")

    [RegexBoyerMoore.mqh](/en/code/download/15242/RegexBoyerMoore.mqh "RegexBoyerMoore.mqh")
    (18.01 KB)
    [view](# "view")

    [RegexCapture.mqh](/en/code/download/15242/RegexCapture.mqh "RegexCapture.mqh")
    (7.86 KB)
    [view](# "view")

    [RegexCaptureCollection.mqh](/en/code/download/15242/RegexCaptureCollection.mqh "RegexCaptureCollection.mqh")
    (10.25 KB)
    [view](# "view")

    [RegexCharClass.mqh](/en/code/download/15242/RegexCharClass.mqh "RegexCharClass.mqh")
    (97.97 KB)
    [view](# "view")

    [RegexCode.mqh](/en/code/download/15242/RegexCode.mqh "RegexCode.mqh")
    (22.25 KB)
    [view](# "view")

    [RegexFCD.mqh](/en/code/download/15242/RegexFCD.mqh "RegexFCD.mqh")
    (31.22 KB)
    [view](# "view")

    [RegexGroup.mqh](/en/code/download/15242/RegexGroup.mqh "RegexGroup.mqh")
    (8.72 KB)
    [view](# "view")

    [RegexGroupCollections.mqh](/en/code/download/15242/RegexGroupCollections.mqh "RegexGroupCollections.mqh")
    (11.25 KB)
    [view](# "view")

    [RegexInterpreter.mqh](/en/code/download/15242/RegexInterpreter.mqh "RegexInterpreter.mqh")
    (49.66 KB)
    [view](# "view")

    [RegexMatch.mqh](/en/code/download/15242/RegexMatch.mqh "RegexMatch.mqh")
    (22.94 KB)
    [view](# "view")

    [RegexMatchCollection.mqh](/en/code/download/15242/RegexMatchCollection.mqh "RegexMatchCollection.mqh")
    (11.04 KB)
    [view](# "view")

    [RegexNode.mqh](/en/code/download/15242/RegexNode.mqh "RegexNode.mqh")
    (32.45 KB)
    [view](# "view")

    [RegexOptions.mqh](/en/code/download/15242/RegexOptions.mqh "RegexOptions.mqh")
    (14.82 KB)
    [view](# "view")

    [RegexParser.mqh](/en/code/download/15242/RegexParser.mqh "RegexParser.mqh")
    (93.26 KB)
    [view](# "view")

    [RegexReplacement.mqh](/en/code/download/15242/RegexReplacement.mqh "RegexReplacement.mqh")
    (20.83 KB)
    [view](# "view")

    [RegexRunner.mqh](/en/code/download/15242/RegexRunner.mqh "RegexRunner.mqh")
    (31.31 KB)
    [view](# "view")

    [RegexTree.mqh](/en/code/download/15242/RegexTree.mqh "RegexTree.mqh")
    (8.47 KB)
    [view](# "view")

    [RegexWriter.mqh](/en/code/download/15242/RegexWriter.mqh "RegexWriter.mqh")
    (24.52 KB)
    [view](# "view")

    [Expand (42)](javascript:void(false))
    [Collapse (42)](javascript:void(false))

    [Download as ZIP](/en/code/download/15242.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Real author:**

Microsoft Corporation. Source code taken from [.Net Framework 4.6.1](/go?link=https://github.com/microsoft/referencesource "https://github.com/microsoft/referencesource").

Note: The library works on the MetaTrader 5 build 1285 and higher.

Unzip the archive into the [terminal\_data\_folder](https://www.metatrader5.com/en/terminal/help/start_advanced/structure "https://www.metatrader5.com/en/terminal/help/start_advanced/structure").  
 The library codes are located in the: <terminal\_data\_folder>\MQL5\Include\RegularExpressions\  
 Sample test scripts can be found in the <terminal\_data\_folder>\MQL5\Scripts\RegularExpressionsExamples\

Here is a translation of the RegularExpressions from .Net Framework 4.6.1.

To work with the library, include the Regex.mqh file from the "\MQL5\Include\RegularExpressions\" directory in your code.

Several illustrative examples are provided with the library, which at the same time serve as the test cases. All the samples are taken from the official site of [Microsoft Corporation](/go?link=https://learn.microsoft.com/en-us/dotnet/api/system.text.regularexpressions?redirectedfrom=MSDN%26view=netframework-4.8 "https://msdn.microsoft.com/en-us/library/system.text.regularexpressions%28v=vs.110%29.aspx"), they vividly demonstrate the main differences from the regular expressions in C# and the features of their use in the MQL5.

Below is more detailed information about RegularExpressions MQL5 ported library packages:

| Packages | Description |
| --- | --- |
| **CharUnicodeInfo.mqh** | Archived txt file to determine the Unicode categories for all symbols (including non-Latin characters). |
| **RegexCapture.mqh** | Represents the results from a single successful subexpression capture. |
| **RegexCaptureCollection.mqh** | Represents the set of captures made by a single capturing group. |
| **RegexGroup.mqh** | Represents the results from a single capturing group. |
| **RegexGroupCollections.mqh** | Represents a collection of Group objects. |
| **RegexMatch.mqh** | Represents the results from a single regular expression match. |
| **RegexMatchCollection.mqh** | Represents a collection of successful matches found by iteratively applying the regular expression pattern to the input string. |
| **Regex.mqh** | Represents an immutable regular expression |
| **RegexOptions.mqh** | Provides enumerated values to use to set regular expression options. |

The regular expression parameters from the file **RegexOptions.mqh**:

| Parameter | Description |
| --- | --- |
| **None** | Specifies that no options are set. |
| **IgnoreCase** | Specifies case-insensitive matching. |
| **Multiline** | Specifies multiline mode. |
| **ExplicitCapture** | Do not capture unnamed groups. Specifies that the only valid captures are explicitly named or numbered groups of the form **(?<***name***>** *subexpression***)**. |
| **Singleline** | Specifies single-line mode. |
| **IgnorePatternWhitespace** | Eliminates unescaped white space from the pattern and enables comments marked with #. |
| **RightToLeft** | Specifies that the search will be from right to left instead of from left to right. |
| **Debug** | Specifies that the program works in the debug mode. |
| **ECMAScript** | Enables ECMAScript-compliant behavior for the expression. This value can be used only in conjunction with the IgnoreCase and Multiline values. |

**Working with RegularExpressions for MQL5:**

1. As withe the version for .Net, this library implements a storage (static cache) of regular expressions. All implicitly created regular expressions (instances of the Regex class) are written to that storage. This approach speeds up the operation of the scripts, as it eliminates the need to rebuild the regular expression if its pattern matches any of the existing ones. The default size of the storage is 15. The **Regex::CacheSize()** method returns or sets the maximum number of entries in the current static cache of the complied regular expressions.
2. The second feature of working with regular expression in MQL5 directly follows from the first one. And it lies in the fact that the above storage must be cleared. To do that, call the **Regex::ClearCache()** static function. It is recommended to call this function only after the work with the regular expressions has been completed, otherwise there is a risk to delete necessary pointers.
3. Unlike the .Net, the MQL5 does not implement the **foreach** loop, and hence the enumeration handling will be different. Example:

   ```mql5
   //--- Code in C#
   Regex rx = new Regex(@"\b(?<word>\w+)\s+(\k<word>)\b", RegexOptions.IgnoreCase);   
   string text = "The the quick brown fox  fox jumped over the lazy dog dog.";
   MatchCollection matches = rx.Matches(text);
   foreach (Match match in matches) 
     {
      //--- handling
     }
   
   //--- Code in MQL5
   Regex *rx = new Regex("\\b(?<word>\\w+)\\s+(\\k<word>)\\b", RegexOptions::IgnoreCase);        
   string text = "The the quick brown fox  fox jumped over the lazy dog dog.";
   MatchCollection *matches = rx.Matches(text);
   IEnumerator<Match*> *en = matches.GetEnumerator();
   while(en.MoveNext()) 
     {
      Match *match = en.Current();
      //--- handling
     }
   delete rx;
   delete matches;
   delete en;
   Regex::ClearCache();
   ```
4. As can be seen from the above example, the C# syntax allows to put the '@' symbol in front of the strings to ignore all formatting marks in it. In MQL5, this approach is not provided, so all control characters in a regular expression pattern should be explicitly defined.

**Example of working with RegularExpressions for MQL5:**

As an example of regular expressions, consider their application to parse the trading history downloaded from the terminal in the form of an html file.

To do that, create an expert with a single input parameter of the 'string' type, which will be the name of the [sandbox file](/en/docs/files):

![](https://c.mql5.com/18/49/RH__1.png)

This document contains two main tables: "Orders" and "Deals". 

Create a regular expression to parse the file:

```mql5
Regex *rgx=new Regex("(>)([^<>]*)(<)");
```

Consider this regular expression:

| (>) | Find the '>' character |
| (^[<>]\*) | Any symbol except '>' and '<', repeated zero or more times |
| (<) | Fin the '<' symbol |

Next, read the file line by line and get all the matches which correspond to this regular expression:

```mql5
string str=FileReadString(m_handel);
MatchCollection *matches=rgx.Matches(str);
```

The strings of the html file, that are entries (tuples) for the "Orders" and "Deals" tables, will have the most of such matches, namely 23 and 27 matches respectively. Therefore, the only thing left to do is to extract all the necessary information from these strings.

For the "Orders" table:

```mql5
if(matches.Count()==23)
  {
   string in[11];
   for(int i=0,j=1; i<11; i++,j+=2)
     {
      in[i]=StringSubstr(matches[j].Value(),1,StringLen(matches[j].Value())-2);
     }
   m_list1.Add(new OrderRecord(in));
  }
```

It has been confirmed that the number of matches is 23, and therefore, the handled entry is from the "Orders" table. Create a string array as the initial representation of our entry. Create iteration over all the odd matches, get the values of those matches using the **matches[j][.Value()** method, trim the first and the last characters of each match, which correspond to the characters '>' and '<'. Each formatted match is written to a previously declared **in** array. After that create an instance of the **OrderRecord(in)** class, which represents a single entry of the "Orders" table, and add it to the **m\_list1** list. This list will interpret the "Orders" table.

The "Deals" table will be processed in a similar way:

```mql5
if(matches.Count()==27)
  {
   string in[13];
   for(int i=0,j=1; i<13; i++,j+=2)
     {
      in[i]=StringSubstr(matches[j].Value(),1,StringLen(matches[j].Value())-2);
     }
   m_list2.Add(new DealRecord(in));
  }
```

Here **m\_list2**  is a list of pointers to the **DealRecord** class. It represents the "Deals" table.

Both these lists are members of the **TradeHistory** class. This class is the representation of the entire original html file. In addition, it allows to apply simple filters to the "Orders" and "Deals" tables using the methods: **FindAllOrders(const int columnIndex,const T value)** and **FindAllDeals(const int columnIndex,const T value)**.

Create a simple graphical interface in the EA to demonstrate these capabilities:

![](https://c.mql5.com/18/49/HistoryParsing__2.png)

When working with this form, select the desired table, select a column and its value to filter the table. Press the **Find** button, and the filtered table will be displayed below, along with some statistics on it. The **Save** button stores the currently displayed table to a csv file. The saved file will be located in the sandbox as well, and have the name **Result.csv**.

To learn more about the **RegularExpressions for MQL5** and its features, use the provided **Tests.mqh** expert. It implements numerous examples of regular expression usage, which cover all the main functionality of the library.

![](https://c.mql5.com/18/48/tests.png)

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/15242](/ru/code/15242)

**Last comments |
[Go to discussion](/en/forum/85482)**
(9)

![Earthy Stag beetle](https://c.mql5.com/avatar/avatar_na2.png "Earthy Stag beetle")

**[Earthy Stag beetle](/en/users/metamama)**
|
10 Oct 2023 at 17:05

[@MetaQuotes](/en/users/metaquotes) I am hitting conflicts between:

MQL5\Include\RegularExpressions\Regex.mqh

and...

MQL5\Include\Internal\IComparable.mqh  
MQL5\Include\Generic\Interfaces\IComparable.mqh

and others.

This matters because other non-regex libraries use the standard MQL5 #includes I have listed and won't compile when used in conjunction.

```mql5
//#define REGEX_CLASH_INCLUDE
#ifdef REGEX_CLASH_INCLUDE
#include <RegularExpressions\Regex.mqh>
#endif
#include <Generic\HashMap.mqh>
#include <Generic\Internal\DefaultEqualityComparer.mqh>
#include <Generic\Interfaces\IComparable.mqh>
#include <Generic\Internal\CompareFunction.mqh>


void OnStart()
{
   printf("Hello world!");
}
```

The script will build with the #define commented out. However if you uncomment the #define and try & build the script, you'll see something like the below:

[![](https://c.mql5.com/3/419/3115735138821__1.png)](https://c.mql5.com/3/419/3115735138821.png "https://c.mql5.com/3/419/3115735138821.png")

I'd be super grateful for either a workaround or a fix for this please.

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
10 Oct 2023 at 19:30

**Earthy Stag beetle [#](/en/forum/85482#comment_49852030):**  

I'd be super grateful for either a workaround or a fix for this please.

```mql5
namespace REGULAR
{
  #include <RegularExpressions\Regex.mqh> // delete these strings: #property strict
}

#include <Generic\HashMap.mqh>
#include <Generic\Internal\DefaultEqualityComparer.mqh>
#include <Generic\Interfaces\IComparable.mqh>
#include <Generic\Internal\CompareFunction.mqh>

void OnStart()
{
   printf("Hello world!");
}
```

![Earthy Stag beetle](https://c.mql5.com/avatar/avatar_na2.png "Earthy Stag beetle")

**[Earthy Stag beetle](/en/users/metamama)**
|
10 Oct 2023 at 20:05

Thanks fxsaber,

Whilst I was hopeful, I wasn't expecting a reply - especially so quickly.

I presume you mean remove the

[#property](https://www.mql5.com/en/docs/basis/preprosessor/compilation "MQL5 Documentation: Program Properties (#property)") strict

lines from all the regex header files?

With my best regards, ESB.

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
10 Oct 2023 at 21:03

**Earthy Stag beetle [#](/en/forum/85482#comment_49858709):**  

I presume you mean remove the

[#property](/en/docs/basis/preprosessor/compilation "MQL5 Documentation: Program Properties (#property)") strict

lines from all the regex header files?

Right.

![Earthy Stag beetle](https://c.mql5.com/avatar/avatar_na2.png "Earthy Stag beetle")

**[Earthy Stag beetle](/en/users/metamama)**
|
10 Oct 2023 at 21:24

OK fxsaber,

I have it built - and I learnt something new.

Thank you very much.

![MQL5 Wizard - GANN HiLo Signal](https://c.mql5.com/i/code/library.png)
[MQL5 Wizard - GANN HiLo Signal](/en/code/15456)

Signal based on the indicator Gann Hilo.

![MQL 5 Wizard - Simpler Intraday Time Filter](https://c.mql5.com/i/code/library.png)
[MQL 5 Wizard - Simpler Intraday Time Filter](/en/code/15457)

Filter based on the Intraday time filter offered by the standard library.

![Trends Accumulator](https://c.mql5.com/i/code/indicator.png)
[Trends Accumulator](/en/code/15642)

Accumulator of price movements. Defines the start and the end of a trend.

![Separators](https://c.mql5.com/i/code/script.png)
[Separators](/en/code/15729)

Adds period separators to your window, at a time of your choice.