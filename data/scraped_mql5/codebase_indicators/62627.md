# Trade By Retail Sentiment - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/62627

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/62627) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Trade By Retail Sentiment - expert for MetaTrader 4

[Sara Sabaghi](/en/users/ssabbaghi)

Views:
:   4627

Rating:
:   (2)

Published:
:   29 September 2025, 15:19

Updated:
:   6 October 2025, 08:19
:   [TradeBySentiment.mq4](/en/code/download/62627/TradeBySentiment.mq4 "TradeBySentiment.mq4")
    (29.04 KB)
    [view](# "view")

    \MQL4\Include\

    [JAson.mqh](/en/code/download/62627/JAson.mqh "JAson.mqh")
    (30.59 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/62627.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

### Ziwox Retail Sentiment Expert Advisor

### Retail Sentiment percentage from Ziwox API

**Description:**

This Expert Advisor (EA) leverages retail trader sentiment from the Ziwox API to make contrarian trading decisions combined with a simple technical filter. The idea is simple: if most retail traders are long, we consider selling, and if most are short, we consider buying. By combining sentiment analysis with moving average trend confirmation, the EA provides an intelligent approach to trading based on collective market behavior.

Code and implement comes from this [MQL5 Article](/en/articles/14108)

**Why Retail Sentiment Matters:**

Retail trader sentiment reflects the positions and biases of small traders in the market. It’s widely known that retail traders often take the wrong side of market moves due to emotional trading, poor risk management, or overreacting to news. By analyzing the long and short ratios of retail traders, we can adopt a contrarian strategy, which often aligns with institutional flow and broader market trends.

Sentiment analysis can help traders:

* Identify overextended market conditions.
* Detect potential reversals early.
* Enhance technical analysis with behavioral insights.
* Reduce risk by avoiding crowded trades.

**How the EA Works:**

This EA retrieves retail sentiment data via the Ziwox API and combines it with a moving average crossover filter:

1. **API Integration:**  
    Using the GetAPI function, the EA sends a web request to Ziwox’s endpoint to fetch sentiment data in JSON format. The data includes key fields such as Retail Long Ratio , Retail Short Ratio , and Risk Sentiment . The JSON is then parsed into an array ( APIJSON ) using JsonDataParse .
2. **Contrarian Logic:**

   * If Retail Long Ratio >= 60% and the fast MA is above the slow MA, the EA considers a sell trade.
   * If Retail Short Ratio >= 60% and the fast MA is below the slow MA, the EA considers a buy trade.  
      This ensures trades are taken contrarian to retail sentiment but still in line with technical trend confirmation.
3. **Technical Filter:**  
    Simple moving averages ( iMA ) with user-defined periods ( shortMAPeriod and longMAPeriod ) filter trades. Only trades that align with the moving average trend are executed.
4. **Automated Trading:**  
    When AutoTrade is enabled, the EA automatically opens orders, checks for new candles via IsNewCandle() , and ensures no duplicate trades with OrdersTotal() .
5. **Visualization:**  
    The EA draws sentiment indicators on the chart using DrawSentiment and ButtonCreate , showing retail long and short ratios in a clear, color-coded manner. Green indicates long positions, and red indicates short positions.

**Key Code Components Explained:**

* GetAPI : Handles API calls to Ziwox, manages rate limits, retries, and saves data to a JSON file.
* JsonDataParse : Reads the JSON file, parses sentiment values, and stores them in the APIJSON array for use in trading logic.
* OnTick : Checks conditions each tick, applies contrarian logic with MA trend filter, and sends orders if criteria are met.
* DrawSentiment & ButtonCreate : Visualizes sentiment directly on the MT4 chart for instant insight.
* IsNewCandle : Ensures trades are only checked once per new candle to avoid multiple executions on the same candle.

**Usage Instructions:**

1. Place the EA in the Experts folder of MT4.
2. Input your Ziwox API key in the APIKey field.
3. Adjust shortMAPeriod and longMAPeriod as needed.
4. Set AutoTrade to true if you want fully automated trading.
5. Load the EA on any symbol chart. It will fetch sentiment, visualize it, and trade according to the contrarian strategy.

**Conclusion:**

This EA combines behavioral finance insights from retail sentiment with technical analysis to provide a simple yet effective contrarian trading strategy. By monitoring the collective bias of retail traders, the system helps identify potential market reversals and avoids crowded trades, giving an edge to disciplined traders.

**Last comments |
[Go to discussion](/en/forum/496452)**
(6)

![Sara Sabaghi](https://c.mql5.com/avatar/2025/4/67fcdcc9-da13.png "Sara Sabaghi")

**[Sara Sabaghi](/en/users/ssabbaghi)**
|
3 Oct 2025 at 22:54

**hubrob [#](/en/forum/496452#comment_58178528):**  
 hello,  
I would like to test your EA, I followed your instructions, but where I input the Ziwox API key? in the code bade in  the  meta editor?  
Currently , I can't load the EA on chart. Hurry to test your idea.  
Let me know. TY and Regards

After compiling your EA,

Just enter your API key in inputs. you can set your API key in code too.

[![API key](https://c.mql5.com/3/476/Screenshot_2025-10-04_022258__1.png "API key")](https://c.mql5.com/3/476/Screenshot_2025-10-04_022258.png "https://c.mql5.com/3/476/Screenshot_2025-10-04_022258.png")

![Sulman Sajid](https://c.mql5.com/avatar/2014/2/52FB0145-FF71.jpg "Sulman Sajid")

**[Sulman Sajid](/en/users/sulmansajid)**
|
19 Oct 2025 at 15:29

hello,  
Your idea is intrusting and I am trying to test your EA, i managed to get the API, but i keep getting error :"API data Webrequest Error 4060 Check your webrequest on Metatrader Expert option.  
I have added the URL  ![](https://c.mql5.com/3/477/6002932336761.png) but still getting error. can you please suggest what am I missing?  
Please Let me know.

Regards

![Sara Sabaghi](https://c.mql5.com/avatar/2025/4/67fcdcc9-da13.png "Sara Sabaghi")

**[Sara Sabaghi](/en/users/ssabbaghi)**
|
19 Oct 2025 at 15:41

**Sulman Sajid [#](/en/forum/496452#comment_58305525):**  

hello,  
Your idea is intrusting and I am trying to test your EA, i managed to get the API, but i keep getting error :"API data Webrequest Error 4060 Check your webrequest on Metatrader Expert option.  
I have added the URL   but still getting error. can you please suggest what am I missing?  
Please Let me know.

Regards

Hi, thanks for interesting in this tool.

you miss the www in your links. [https://www.ziwox.com](/go?link=https://ziwox.com/ "https://ziwox.com/")

![frkul88](https://c.mql5.com/avatar/2019/1/5C379EAE-B52D.png "frkul88")

**[frkul88](/en/users/frkul88)**
|
8 Nov 2025 at 16:25

Hey,  
i cant even compile the file, do i miss something?  
 ![](https://c.mql5.com/3/478/6284416343647.png)  
thanks   
Greetings

![Sara Sabaghi](https://c.mql5.com/avatar/2025/4/67fcdcc9-da13.png "Sara Sabaghi")

**[Sara Sabaghi](/en/users/ssabbaghi)**
|
9 Nov 2025 at 16:11

**frkul88 [#](/en/forum/496452#comment_58466318):**  
 Hey,  
i cant even compile the file, do i miss something?  
   
thanks   
Greetings

Hi,

Yess, you miss the Json library.

You have to download and place it in include folder.

![Dollar Index Tracker - See the Dollar Index right below your chart.](https://c.mql5.com/i/code/indicator.png)
[Dollar Index Tracker - See the Dollar Index right below your chart.](/en/code/64246)

Dollar Index Tracker displays the US Dollar Index (USDX / DXY) directly below the chart of your current trading pair. This makes it easy to compare the strength of the US Dollar against a basket of major currencies while analyzing your pair at the same time.

![Stochastic Eclipse - MT4 EA](https://c.mql5.com/i/code/expert.png)
[Stochastic Eclipse - MT4 EA](/en/code/64117)

By identifying overbought and oversold conditions, it helps traders catch early reversals, ride strong momentum shifts, and filter false signals.

![CrossFire Alert - Fast alerts. Smarter entries.](https://c.mql5.com/i/code/indicator.png)
[CrossFire Alert - Fast alerts. Smarter entries.](/en/code/64331)

It’s a powerful moving average crossover indicator that instantly notifies you when two MAs cross, so you never miss a signal.

![Ichimoku Edge MT4 EA](https://c.mql5.com/i/code/expert.png)
[Ichimoku Edge MT4 EA](/en/code/64492)

Ichimoku Edge is based on the standard Ichimoku Kinko Hyo indicator with default settings. It generates Buy and Sell signals from the cross of the Chikou Span with the price, confirmed by the position of price and Chikou Span relative to the Kumo (cloud).