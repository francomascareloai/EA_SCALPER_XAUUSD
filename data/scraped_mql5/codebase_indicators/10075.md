# XIT_BuySellAutoStoploss.mq4 - Stoploss set from Fractal Levels, Money management Risk/Reward - script for MetaTrader 4

Source: https://www.mql5.com/en/code/10075

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/10075) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Scripts](https://c.mql5.com/i/code/script.png)

# XIT\_BuySellAutoStoploss.mq4 - Stoploss set from Fractal Levels, Money management Risk/Reward - script for MetaTrader 4

[Jeffrey West](/en/users/jeff10278)

Views:
:   32299

Rating:
:   (9)

Published:
:   11 January 2011, 18:33

Updated:
:   21 April 2014, 14:55
:   [XIT\_BuySellAutoStoploss.mq4](/en/code/download/10075/XIT_BuySellAutoStoploss.mq4 "XIT_BuySellAutoStoploss.mq4")
    (9.76 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/10075.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**XIT\_BuySellAutoStoploss.mq4 - Stoploss set from Fractal Levels, Money management Risk/Reward**

My main goal here with this script was to help improve my win ratio, by setting my stoploss at fractals with the best support. I had been using fixed stoploss values, and kept having the stop hit and within minutes the price went back into the correct direction. This script has really helped me spot out recent support/resistance levels, providing good stop levels.

Here are some of the features of the script, and a basic run threw of how to use it.

![](https://c.mql5.com/18/24/options.gif "XIT_BuySellAutoStoploss.mq4 - Options")

First off you must either choose to BUY or SELL. If both are left false you will get a message stating this and have to relaunch the script. Same error will occur if both are true.

![](https://c.mql5.com/18/24/false-false.gif "XIT_BuySellAutoStoploss.mq4 - False/False True/True error")

The next thing to do would be to set your Risk%, default is set at 2%.

The way that i calculate lots to risk in this script is as follows:

FreeMargin \* Risk% = RiskCapital

(RiskCapital / StopLossPips) / (Leverage / ExchangeRate) = Volume

This formula should give an accurate Risk/Stoploss pip volume. On accounts with small deposits you may end up risking more than the risk percentage you were hoping for. In this case you will get a message stating that you are risking more than your Risk%. You will have the option to continue or not.

![](https://c.mql5.com/18/24/highrisk.gif "XIT_BuySellAutoStoploss.mq4 - High Risk")

The Reward multiplier is fairly simple, basically if you want your takeprofit set to the same number of pips as the stoploss enter 1, for twice the stoploss pips 2 etc...

StopAdd, just adds x amount of pips to the fractal based stoploss level.

MaxSlip, sets the maximum price slippage allowed when opening trade.

MaxSpread, sets the maximum allowed spread.

Magic, sets the magic number for the trade. 0 if none.

The next thing to do is choose the Fractal level you wish to place your stop at. It is a good idea to have the fractal indicator on your chart so you can see a clearer picture of these levels. There will be a message asking if you want to place your stop at 0.3434 etc... if the first stop is where you want it, click no and go to the next Fractal and so on.

![](https://c.mql5.com/18/24/placestopat.gif "XIT_BuySellAutoStoploss.mq4 - Place stop at")

After clicking yes the script to run as intended and open your order. If there is an error, you should get a message stating what it is.

I hope this script can help some of you out, and please let me know if there issues with the script so that i can get them all fixed. Also if there are any additions or modifications that would make this script better please let me know..

Happy Trading

**Last comments |
[Go to discussion](/en/forum/27828)**
(9)

![ambarishbiswas](https://c.mql5.com/avatar/avatar_na2.png "ambarishbiswas")

**[ambarishbiswas](/en/users/ambarishbiswas)**
|
4 Jul 2011 at 13:56

the exact error msg is "Try running the script again". Any idea guys?

![Pankaj Bhaban](https://c.mql5.com/avatar/2013/4/5170CB5B-228A.JPG "Pankaj Bhaban")

**[Pankaj Bhaban](/en/users/pankajbhaban)**
|
20 Jul 2011 at 05:25

Nice work thanks.

![Demos4x](https://c.mql5.com/avatar/avatar_na2.png "Demos4x")

**[Demos4x](/en/users/demos4x)**
|
4 Nov 2017 at 01:07

Is it possible to convert this script to a EA in a way that only works when a position is open in the market?Â   
  
For example, the EA would be attached to the chart, and when a order was placed with the One Click Trader of metatrader the EA would execute but this time wouldn't need to ask if it was a buy or a sell.

![Natanael Meneses](https://c.mql5.com/avatar/2020/7/5F23090B-F401.jpg "Natanael Meneses")

**[Natanael Meneses](/en/users/khronos)**
|
31 Aug 2020 at 03:14

This script no longer works.

![](https://c.mql5.com/3/330/2561368745593.png)

![Juvenille Emperor Limited](https://c.mql5.com/avatar/2019/4/5CB0FE21-E283.jpg "Juvenille Emperor Limited")

**[Eleni Anna Branou](/en/users/eleanna74)**
|
1 Sep 2020 at 00:40

Its a 9 years old script, it would be a surprise if it was still working.

![MACD Ichimoku](https://c.mql5.com/i/code/indicator.png)
[MACD Ichimoku](/en/code/10070)

The MACD Ichimoku indicator uses the Ichimoku structure but applied to MACD values. It tells an entire story in itself which is one of the Ichimoku system strengths.

![MACD+Histogram](https://c.mql5.com/i/code/indicator.png)
[MACD+Histogram](/en/code/10065)

This is a normal MACD with Histogram. It's really simple coding but helpfull. I'm not testing on MT5 but i think it's ok with that. Let me know if you're tested.

![ZigZag of Orlov](https://c.mql5.com/i/code/indicator.png)
[ZigZag of Orlov](/en/code/10076)

Zigzag with a simple, clear and natural principle of work. By the Close prices. Without redrawing.

![CustomTimeframe Candles](https://c.mql5.com/i/code/indicator.png)
[CustomTimeframe Candles](/en/code/10080)

Shows custom Timeframes on the Main chart