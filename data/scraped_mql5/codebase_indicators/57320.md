# AveragePrice - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/57320

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/57320) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# AveragePrice - indicator for MetaTrader 5

[Francisco Gomes Da Silva](/en/users/franciscogomes5)  |
[English](javascript:void(false);)

[Русский](/ru/code/57320) [中文](/zh/code/57320) [Español](/es/code/57320) [Deutsch](/de/code/57320) [日本語](/ja/code/57320) [Português](/pt/code/57320) [한국어](/ko/code/57320) [Français](/fr/code/57320) [Italiano](/it/code/57320) [Türkçe](/tr/code/57320)

Views:
:   3101

Rating:
:   (7)

Published:
:   17 April 2025, 08:44
:   [AveragePrice.mq5](/en/code/download/57320/averageprice.mq5 "AveragePrice.mq5")
    (9.85 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/57320.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

MQL5 Indicator for Calculating the Average Price of a Hedge Account

[![](https://c.mql5.com/18/160/5495881397934__1.png)](https://c.mql5.com/18/160/5495881397934.png "https://c.mql5.com/18/160/5495881397934.png")

### Introduction

This code was generated by chatgpt, but I made some adjustments and posted the video on youtube:

In trading, it's common to use **hedge** accounts, where you can simultaneously hold long and short positions in the same asset. A common problem for traders operating in this model is determining the **average price of** open positions.

This article presents an **MQL5 indicator** that automatically calculates the average price of open positions for a given **symbol** and **Magic Number** and displays the result on a chart.

## How does the indicator work?

The indicator takes the following steps:

1. **Filters all** open**positions** in MetaTrader 4, checking the **asset (symbol)** and **Magic Number** configured by the user.
2. It**separates buy and sell trades**, calculating the volume and total cost of each type.
3. **Calculates the weighted average price**, taking into account the total volume bought and sold.
4. **Displays a line** on the chart corresponding to the average price of the net position.

## Code Explanation

### 1. **Calculating the Average Price**

The CalculateHedgeAveragePrice() function loops through all open positions and:

* Separates **purchases** and **sales**.
* Calculates the **weighted average price** for each direction.
* Determines whether the net position is long or short.
* Returns the corresponding average price.

### 2. **Initialising the indicator**

In the OnInit() function, we create the **buffer** that will store the average price for display on the chart.

### 3. **Filling the Buffer**

The OnCalculate() function updates the indicator buffer using ArrayFill() , making the code more efficient.

## How to Use in MetaTrader 5

1. **Copy and paste the code** into a new .mq5 file inside the Indicators folder.
2. **Compile** in **MetaEditor**.
3. **Add the indicator** to the chart in MetaTrader 5.
4. **Set the Magic Number of** the trades you want to monitor.

## Conclusion

This MQL5 indicator is useful for traders operating on **hedge accounts**, helping to monitor the average price of open positions. It can be customised for different assets and strategies.

Translated from Portuguese by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/pt/code/57320](/pt/code/57320)

**Last comments |
[Go to discussion](/en/forum/485151)**
(7)

![Vitaly Muzichenko](https://c.mql5.com/avatar/2025/11/691d3a3a-b70b.png "Vitaly Muzichenko")

**[Vitaly Muzichenko](/en/users/mvs)**
|
19 Apr 2025 at 17:01

The calculation does not include swaps and commissions, which is important.

![mawela](https://c.mql5.com/avatar/avatar_na2.png "mawela")

**[mawela](/en/users/mawela)**
|
27 May 2025 at 12:57

**Francisco Gomes Da Silva [#](/en/forum/485151#comment_56495764):**  

**thanks for the review**

Hi Francisco,

Great indicator. Can you please show summary of lots (Sum) and the actual average price ?

Thank you

Mawela

![Francisco Gomes Da Silva](https://c.mql5.com/avatar/2023/11/655a5120-f909.jpg "Francisco Gomes Da Silva")

**[Francisco Gomes Da Silva](/en/users/franciscogomes5)**
|
1 Jun 2025 at 14:37

**mawela [#](/en/forum/485151#comment_56796942):**  

Hi Francisco,

Great indicator. Can you please show summary of lots (Sum) and the actual average price ?

Thank you

Mawela

hello Mawela, if you press CTRL+D you can see the summary of lots on metatrader

![Fabio Cavalloni](https://c.mql5.com/avatar/2022/2/62191C69-D16B.png "Fabio Cavalloni")

**[Fabio Cavalloni](/en/users/kava93)**
|
1 Jun 2025 at 14:46

**Vitaly Muzichenko [#](/en/forum/485151#comment_56496102):**  
 The calculation does not include swaps and commissions, which is important.

Totally agree.

And also the net average price is wrong, because it's simply using buy avg price if there are more buy volume then sell, and viceversa, which is not correct.

Another variable should be used, in which buy info are added and sell info subtracted, there you will have the correct average price, but once again, without swaps and commissions.

In few words: good basic idea, but very bad realization.

![Kean Shi](https://c.mql5.com/avatar/2022/1/61D9C1D3-CAB7.jpg "Kean Shi")

**[Kean Shi](/en/users/keanshi)**
|
4 Aug 2025 at 08:36

Very nice work you have done!
I've been searching for this indicator for a long time!

![Better volume](https://c.mql5.com/i/code/indicator.png)
[Better volume](/en/code/56678)

Better Volume is an advanced indicator designed to analyse the behaviour of volume on price charts. It combines volume information with metrics such as candlestick range and moving averages to identify important patterns in the market, such as buy/sell climaxes, churn and weak candles. With its dynamic visual interface and volume categorisation, the indicator offers valuable insights for traders who want to make informed decisions based on volume flow.

![RiskManager with InfoPanel and Support](https://c.mql5.com/i/code/expert.png)
[RiskManager with InfoPanel and Support](/en/code/56126)

My first code on the site, which requires improvement. The idea to create an ideal tool for traders, in the work on the main component of any trading system-Risk Manager

![Spreads](https://c.mql5.com/i/code/indicator.png)
[Spreads](/en/code/57620)

Two Symbol Spread Indicator

![MACD Divergence](https://c.mql5.com/i/code/indicator.png)
[MACD Divergence](/en/code/57644)

MACD Divergence indicator