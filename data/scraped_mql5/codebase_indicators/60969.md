# HLPeak_Trend - indicator for MetaTrader 4

Source: https://www.mql5.com/en/code/60969

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/60969) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# HLPeak\_Trend - indicator for MetaTrader 4

[Elmo Ferrera](/en/users/fxcoolbyte)

Views:
:   9273

Rating:
:   (6)

Published:
:   30 June 2025, 01:33

Updated:
:   2 July 2025, 00:33
:   [HLPeak\_Trend.mq4](/en/code/download/60969/hlpeak_trend.mq4 "HLPeak_Trend.mq4")
    (7.38 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/60969.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Composed of 3-MA (Weighted, High, Low) + ATR with same period.

- Direction Up is set when Weighted MA crossed up with High MA.

- Direction Down is set when Weighted MA crossed down with Low MA.

- Multiplier for ATR as Channel Top and Bottom for Take Profit and dynamic Stop Loss.

![Indicator](https://c.mql5.com/18/164/HLPeak_Trend_1__2.png "Indicator")

Created from 3-MA + ATR

![3-MA](https://c.mql5.com/18/164/HLPeak_Trend_2__1.png "3-MA")

**Last comments |
[Go to discussion](/en/forum/490017)**
(7)

![sidra siddiqui](https://c.mql5.com/avatar/avatar_na2.png "sidra siddiqui")

**[sidra siddiqui](/en/users/forexpak)**
|
1 Jul 2025 at 07:13

here i check again same issue if i refresh chart or back [test indicator](https://www.metatrader5.com/en/terminal/help/algotrading/testing "User Guide: Testing indicators using the MetaTrader 5 strategy tester") signal result is change kindly solve this error

![Elmo Ferrera](https://c.mql5.com/avatar/avatar_na2.png "Elmo Ferrera")

**[Elmo Ferrera](/en/users/fxcoolbyte)**
|
2 Jul 2025 at 00:38

**sidra siddiqui [#](/en/forum/490017#comment_57377388):**  
 here i check again same issue if i refresh chart or back [test indicator](https://www.metatrader5.com/en/terminal/help/algotrading/testing "User Guide: Testing indicators using the MetaTrader 5 strategy tester") signal result is change kindly solve this error

I've reviewed the code and your images attached in your message.

Please see on this illustration images the issue:

![Issue#1](https://c.mql5.com/3/468/HLPeak_Trend_Issue_1.png "Issue#1")

The code have been modified by adding index buffer "bufDir[]" to hold the previous bar direction.

Signal is clculated in every tick of the current bar, and therefore posible repaint signal.

In your EA, you can use the first event signal changed and ignore the lock/unlock signal

to use as entry criteria.

Or on new bar event, take the previous bar signal as your entry criteria.

Please see my comments on the code.

Again, your continues testing and reporting the issue is highly appreciated.

![Meta2](https://c.mql5.com/avatar/avatar_na2.png "Meta2")

**[Meta2](/en/users/meta2)**
|
7 Jul 2025 at 14:23

Hi

can you please add an alarm and popup window as soon as the Indi shows "strong up" or "strong down" for the first time?

![Elmo Ferrera](https://c.mql5.com/avatar/avatar_na2.png "Elmo Ferrera")

**[Elmo Ferrera](/en/users/fxcoolbyte)**
|
8 Jul 2025 at 03:40

**Meta2 [#](/en/forum/490017#comment_57434204):**  

Hi

can you please add an alarm and popup window as soon as the Indi shows "strong up" or "strong down" for the first time?

Added Alert code on the attached file.

The alert was placed on new bar event based on the status of the previous bar, to avoid alert on possible multiple triggers of Up/Down signal on the current bar.

![Meta2](https://c.mql5.com/avatar/avatar_na2.png "Meta2")

**[Meta2](/en/users/meta2)**
|
9 Jul 2025 at 08:35

Many thanks !!

![Auto Tp](https://c.mql5.com/i/code/expert.png)
[Auto Tp](/en/code/60955)

Set Auto TP and SL:
Automatically setting Take Profit (TP) and Stop Loss (SL) helps manage risk and lock in profits without manual intervention. This feature ensures each trade has predefined exit levels, reducing emotional decision-making and improving trading discipline. Ideal for both beginners and experienced traders, it provides consistency and protection in volatile markets.

![Pending tread EA.](https://c.mql5.com/i/code/expert.png)
[Pending tread EA.](/en/code/60295)

Pending\_tread EA
This Expert Advisor automatically places a grid of pending orders above and below the current market price. It supports both buy and sell pending orders with user-configurable distance (in pips), lot size, and take profit levels. The EA maintains up to 10 pending orders per side, placing sell stop orders below the market and buy stop orders above, ideal for scalping strategies on any timeframe. Includes order management by MagicNumber to avoid conflicts with other EAs or manual trades.

![2 Moving Averages with Bollinger Bands](https://c.mql5.com/i/code/indicator.png)
[2 Moving Averages with Bollinger Bands](/en/code/61518)

"2 Moving Averages with Bollinger Bands" is a custom MT5 indicator that combines two configurable moving averages and optional Bollinger Bands. It generates real-time Buy and Sell arrows when crossovers occur, with optional alerts, sound, and email notifications. Suitable for all timeframes and symbols.

![Eliot Waves](https://c.mql5.com/i/code/expert.png)
[Eliot Waves](/en/code/25287)

"Eliot Waves" EA draws 2 Trend Lines with "zigzag" on chart and trades When a Eliot retracement is formed,has Trailing Stop Loss &Take Profit works with all time frames major forex pairs and stocks NASDAQ.