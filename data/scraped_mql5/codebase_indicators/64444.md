# Babi Ngepet - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/64444

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/64444) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Babi Ngepet - expert for MetaTrader 5

[Taufiqurrachman Assauqi](/en/users/zvickyhac)  |
[English](javascript:void(false);)

[Русский](/ru/code/64444) [中文](/zh/code/64444) [Español](/es/code/64444) [Deutsch](/de/code/64444) [日本語](/ja/code/64444) [Português](/pt/code/64444) [한국어](/ko/code/64444) [Français](/fr/code/64444) [Italiano](/it/code/64444) [Türkçe](/tr/code/64444)

Views:
:   5860

Rating:
:   (9)

Published:
:   4 October 2025, 19:45
:   [BabiNgepet\_07.mq5](/en/code/download/64444/BabiNgepet_07.mq5 "BabiNgepet_07.mq5")
    (49.42 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/64444.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

[![](https://c.mql5.com/18/169/1__1.png)](https://c.mql5.com/18/169/1.png "https://c.mql5.com/18/169/1.png")

## Expert Advisor Parameters (Inputs)

The EA provides several external parameters that the user can modify to control its behavior:

### General Parameters

| Parameter | Type | Description |
| --- | --- | --- |
| **MagicNumber** | int | A unique identifier for the EA's trades. |
| **InitialLot** | double | The starting lot size for the first trade in a series. |
| **AllowBuy** | bool | Flag to allow the EA to open Buy trades (initial and Martingale). |
| **AllowSell** | bool | Flag to allow the EA to open Sell trades (initial and Martingale). |
| **TakeProfit** | int | A fixed Take Profit in points/pips used when placing pending orders (though not for market execution). |
| **FindHighLowBackBars** | int | The number of previous bars to look back for determining the highest high and lowest low for initial pending order placement. |
| **ResetAfterBars** | int | The number of bars after which the initial pending orders will be deleted and re-evaluated (if no position is open). |

---

### Martingale Strategy

| Parameter | Type | Description |
| --- | --- | --- |
| **ReverseMartingale** | bool | If true , the subsequent Martingale trades will be in the **opposite** direction of the last trade in the series (this would typically be an anti-Martingale or hedging approach, but the code *opens* in the same direction if false ). **The current logic suggests opening in the *same* direction if ReverseMartingale is false .** |
| **LotMultiplier** | double | The factor by which the lot size is multiplied for the next trade in the loss-making series (e.g., 2.0 means doubling the lot). |
| **SecureProfitMartingaleTarget** | double | The **total floating profit** (in account currency) at which the entire series of open trades will be closed. |
| **DistanceMartingalePips** | int | The distance (in pips) the price must move against the last trade's open price before a new Martingale trade is opened. |
| **MaxTradesInSeries** | int | The maximum number of trades allowed in a single Martingale series. |

---

### Time Strategy

| Parameter | Type | Description |
| --- | --- | --- |
| **AllowMonday**... **AllowFriday** | bool | Flags to enable or disable trading on specific days of the week. |
| **ForbiddenDates** | string | A comma-separated list of dates (format YYYY.MM.DD) on which trading is prohibited. |

---

## Core Functions Overview

### OnInit() (Initialization)

Sets the EA's MagicNumber , margin mode, and deviation. It **resets the Martingale status** variables ( s\_currentLot , s\_totalTradesInSeries , etc.) to their initial values, preparing for a fresh start.

### OnDeinit() (Deinitialization)

A simple function for cleanup, printing a message when the EA is stopped or removed.

### IsTradingDateAllowed() and IsTradingDayAllowed() (Trading Filters)

These functions check the current day and date against the user-defined inputs ( AllowMonday to AllowFriday and ForbiddenDates ) to determine if trading is permitted.

### OpenTradeLogic(ENUM\_ORDER\_TYPE type, string tradeComment) (Market Execution)

This function handles opening new market positions (Buy or Sell).

1. It validates and normalizes the lot size against the broker's minimum, maximum, and step size.
2. It checks for **sufficient free margin** using CheckMargin() .
3. It executes the trade **without a fixed Take Profit or Stop Loss** ( tp\_calculated is 0).
4. It updates the global Martingale status variables: s\_currentLot , s\_lastOpenPrice , s\_seriesType , and s\_totalTradesInSeries .

### CloseAllPositions()

Iterates through all currently open positions and closes any that were opened by **this EA** (matching the MagicNumber ).

### PendingOrders(ENUM\_ORDER\_TYPE type, double price, double lotSize, string comment) (Pending Order Placement)

This function places **Buy Limit** or **Sell Limit** orders:

1. It validates the lot size and checks for sufficient margin.
2. It validates the entry price against the broker's minimum distance ( SYMBOL\_TRADE\_STOPS\_LEVEL ).
3. It calculates a fixed Take Profit ( tp ) based on the TakeProfit input.
4. It sends the trade request. **Note:** The UpdateHighLowAndOrders function *calls* this to place initial Buy Limit and Sell Limit orders.

### UpdateHighLowAndOrders() (Initial Entry Logic)

This is the **initial entry mechanism** when no positions are open:

1. It looks back FindHighLowBackBars to find the **Highest High** and **Lowest Low**.
2. It calculates priceSellLimit (Highest High + 1 tick) and priceBuyLimit (Lowest Low - 1 tick).
3. It checks if Buy Limit and Sell Limit orders with the EA's MagicNumber already exist.
4. It places an initial **Sell Limit** order just above the recent highest high and a **Buy Limit** order just below the recent lowest low, each using the InitialLot .

### OnTick() (Main Logic)

The core of the EA's execution logic:

1. **Time Check:** Prevents redundant calculations on the same tick.
2. **Filter Check:** If trading is not allowed by day/date, it deletes all pending orders.
3. **Profit Target Check (Series Exit):** If eaHasOpenPositions is true AND totalFloatingProfit is ≥ SecureProfitMartingaleTarget , it calls CloseAllPositions() and **resets all Martingale status variables** to start a new series.
4. **Initial Order Placement:** If !eaHasOpenPositions AND trading is allowed, it **resets the Martingale status** and checks if a new bar has formed.

   * If a new bar is formed, it checks if barsCount is ≥ ResetAfterBars . If so, it deletes pending orders and calls UpdateHighLowAndOrders() to place new initial orders. If not, it just calls UpdateHighLowAndOrders() .
5. **Martingale Step Logic:** If eaHasOpenPositions is true AND s\_totalTradesInSeries is $< MaxTradesInSeries`:

   * It checks if totalFloatingProfit is **negative** AND the price has moved against the last open trade by at least DistanceMartingalePips .
   * If both conditions are met, it calculates the nextLot by multiplying s\_currentLot by LotMultiplier .
   * It determines the orderToOpen direction (either the same direction as the series or the reverse, based on ReverseMartingale ).
   * It calls OpenTradeLogic() to open the new, multiplied position, continuing the Martingale series.

---

## Summary of Strategy

The "Babi Ngepet" EA implements a risky but potentially high-reward Martingale strategy combined with a breakout/range-reversal initial entry:

1. **Initial Entry:** The EA places an initial **Buy Limit** (below recent low) and a **Sell Limit** (above recent high). This suggests an initial assumption of **range-bound behavior**—it enters a buy when the price drops to a low, and a sell when the price rises to a high.
2. **Trade Management:** If one of the initial trades is triggered and the position moves into an aggregate loss (negative floating profit), and the price continues to move against the open positions by a defined distance, the EA opens a **new position** in the same direction with a **larger lot size** (Martingale).
3. **Exit Strategy:** The series of trades continues to increase lot size until the aggregate floating profit of all trades in the series reaches the SecureProfitMartingaleTarget , at which point all positions are closed, and the EA resets for a new series.

**Warning:** The Martingale strategy is known for high drawdowns and high risk of capital loss because the lot size increases after every losing step.

**Last comments |
[Go to discussion](/en/forum/496848)**
(7)

![Adin Wahyu Pratama](https://c.mql5.com/avatar/avatar_na2.png "Adin Wahyu Pratama")

**[Adin Wahyu Pratama](/en/users/adinwp)**
|
6 Oct 2025 at 11:41

**allvpsmt5 [#](/en/forum/496848#comment_58198747):**  
 Very very good effort, Keep it up, I checked it on tester, after some modification it's giving me 120% per month result. But after 4.5 months I lost account, so it is advice able to withdraw every month. It works good for fix income not for grow up.

would you mind share your modification setting? and which pair you are testing it?

![Lfatih Hafiedz](https://c.mql5.com/avatar/avatar_na2.png "Lfatih Hafiedz")

**[Lfatih Hafiedz](/en/users/cakebitt)**
|
7 Oct 2025 at 07:01

**adinwp [#](/en/forum/496848#comment_58199873):**  
 would you mind share your modification setting? and which pair you are testing it?

how to used

![BayarJavhklan](https://c.mql5.com/avatar/2023/2/63e2450e-b10f.jpg "BayarJavhklan")

**[BayarJavhklan](/en/users/bayarjavhklan)**
|
7 Oct 2025 at 12:30

this bot is just like a gambling bot!

![Conor Mcnamara](https://c.mql5.com/avatar/2025/9/68dab3ec-4506.png "Conor Mcnamara")

**[Conor Mcnamara](/en/users/phade)**
|
7 Oct 2025 at 18:46

**BayarJavhklan [#](/en/forum/496848#comment_58209296):**  
 this bot is just like a gambling bot!

It's already known. It's martingale.

![Kamil Danak](https://c.mql5.com/avatar/avatar_na2.png "Kamil Danak")

**[Kamil Danak](/en/users/urosforbes)**
|
12 Oct 2025 at 21:57

nic nedělá. neobchoduje

![Candle Move](https://c.mql5.com/i/code/indicator.png)
[Candle Move](/en/code/64360)

CandleMove - Pips & Percentage Movement Display
A visual tool that helps you quickly gauge the strength of each candle by displaying its price change directly on the chart.

![Volatility Step Channel](https://c.mql5.com/i/code/indicator.png)
[Volatility Step Channel](/en/code/64332)

A channel which calculates local highs and local lows with volatility-adjusted lines

![Renko_Subwindow_ATRTrend](https://c.mql5.com/i/code/indicator.png)
[Renko\_Subwindow\_ATRTrend](/en/code/63485)

A combination of many known indicators

![Trading Session Mapping](https://c.mql5.com/i/code/script.png)
[Trading Session Mapping](/en/code/64546)

A tool to align the trading sessions names with broker server time, and local time