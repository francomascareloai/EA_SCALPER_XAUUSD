# Divergence Awesome Ocilator - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/56820

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/56820) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Divergence Awesome Ocilator - indicator for MetaTrader 5

[Francisco Gomes Da Silva](/en/users/franciscogomes5)  |
[English](javascript:void(false);)

[Русский](/ru/code/56820) [中文](/zh/code/56820) [Español](/es/code/56820) [Deutsch](/de/code/56820) [日本語](/ja/code/56820) [Português](/pt/code/56820) [한국어](/ko/code/56820) [Français](/fr/code/56820) [Italiano](/it/code/56820) [Türkçe](/tr/code/56820)

Views:
:   4152

Rating:
:   (4)

Published:
:   11 June 2025, 11:56
:   [Divergence Awesome Ocilator.mq5](/en/code/download/56820/divergence_awesome_ocilator.mq5 "Divergence Awesome Ocilator.mq5")
    (28.63 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/56820.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This MQL5 code is a custom indicator designed to detect and visualise **divergences** between price action and the **Awesome Oscillator (AO)**. Divergences occur when the price movement and the oscillator movement are not aligned, often signalling potential reversals or continuations in the market. The indicator plots buy/sell signals, a histogram of the AO, and trendlines to highlight these divergences.

[![divergence from buying](https://c.mql5.com/18/160/divergence-awesome-ociltator-buying__1.jpg "divergence from buying")](https://c.mql5.com/18/160/divergence-awesome-ociltator-buying.jpg "https://c.mql5.com/18/160/divergence-awesome-ociltator-buying.jpg")

[![](https://c.mql5.com/18/160/divergence-awesome-ociltator__1.jpg)](https://c.mql5.com/18/160/divergence-awesome-ociltator.jpg "https://c.mql5.com/18/160/divergence-awesome-ociltator.jpg")

---

### **Key Features of the Indicator:**

1. **Divergence Detection**:

   * Detects **bullish divergences** (price makes lower lows while AO makes higher lows).
   * Detects **bearish divergences** (price makes higher highs while AO makes lower highs).
2. **Visualisation**:

   * **Buy/Sell Arrows**: Plots arrows on the chart to indicate potential buy or sell signals based on divergences.
   * **Histogram**: Displays the Awesome Oscillator (AO) values as a histogram.
   * **Trendlines**: Draws trendlines on the chart to highlight the divergences between price and AO.
3. **Custom Buffers**:

   * Uses four buffers to store data:
     + BuyBuffer and SellBuffer for buy/sell signals.
     + HistogramBuffer for AO values.
     + PointsCounterBuffer to track aligned points for divergence confirmation.
4. **Dynamic Trendline Drawing**:

   * Uses CChartObjectTrend to dynamically draw trendlines on the chart for price and AO.
5. **Crossing Check**:

   * Includes a function ( CheckCrossing ) to verify if the price or AO crosses a trendline, which helps confirm or invalidate a divergence.
6. **Interpolation**:

   * Uses linear interpolation ( CalculateIntermediateValue ) to calculate intermediate values between two points, which is used to check for crossings.

---

### **How it works:**

1. **Initialisation**:

   * The OnInit() function sets up the indicator buffers, assigns properties (e.g., colours, styles), and initializes the Awesome Oscillator (AO) handle.
2. **Main Calculation**:

   * The OnCalculate() function processes price and AO data to detect divergences:
     + Identifies **bottoms** (lower lows) and **tops** (higher highs) in both price and AO.
     + Checks for divergences by comparing price and AO trends.
     + Plots buy/sell signals and draws trendlines when a divergence is confirmed.
3. **Divergence Confirmation**:

   * Uses conditions like IsBullishTrend and IsBearishTrend to confirm divergences.
   * Ensures no crossing occurs between the price and AO trendlines to validate the divergence.
4. **Dynamic Updates**:

   * The indicator dynamically updates with each new bar, recalculating divergences and redrawing trendlines as needed.

---

### **Key Functions:**

1. **IsBottom() and IsTop()** :

   * Detect local minima (bottoms) and maxima (tops) in an array (price or AO).
2. **CheckCrossing()** :

   * Checks if the price or AO crosses a trendline, which can invalidate a divergence.
3. **CalculateIntermediateValue()** :

   * Calculates intermediate values using linear interpolation for trendline analysis.
4. **AddUniqueCoordinates()** :

   * Ensures unique coordinates are added to the array for trendline drawing.
5. **TotalAligned()** :

   * Counts the number of aligned points to confirm divergence strength.

---

### **Usage:**

* This indicator is useful for traders who rely on divergence strategies to identify potential reversals or continuations in the market.
* It provides visual cues (arrows, trendlines, and histograms) to help traders make informed decisions.

---

### **Example Scenario:**

* If the price is making **lower lows** (bearish), but the AO is making **higher lows** (bullish), a **bullish divergence** is detected. The indicator will plot a **buy arrow** and draw trendlines to highlight the divergence.
* Conversely, if the price is making **higher highs** (bullish), but the AO is making **lower highs** (bearish), a **bearish divergence** is detected. The indicator will plot a **sell arrow** and draw trendlines.

---

### **Technical Details:**

* **Platform**: MetaTrader 5 (MT5).
* **Language**: MQL5.
* **Dependencies**: Uses the Awesome Oscillator ( iAO ) for calculations.
* **Custom Objects**: Utilises CChartObjectTrend for drawing trendlines and CArrayInt for managing arrays of coordinates.

---

This indicator is a powerful tool for traders who want to automate divergence detection and visualisation, saving time and improving accuracy in their trading strategies.

Translated from Portuguese by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/pt/code/56820](/pt/code/56820)

**Last comments |
[Go to discussion](/en/forum/488837)**
(1)

![13945671567](https://c.mql5.com/avatar/avatar_na2.png "13945671567")

**[13945671567](/en/users/13945671567)**
|
11 Sep 2025 at 08:11

Hello, thanks for providing the indicator, how to set double line [MACD](https://www.metatrader5.com/en/terminal/help/indicators/oscillators/macd "MetaTrader 5 Help: MACD Indicator") and divergence in one MACD window

![Partial close Sell Orders](https://c.mql5.com/i/code/script.png)
[Partial close Sell Orders](/en/code/60233)

Partially close active sell orders

![Partial Close Buy Orders](https://c.mql5.com/i/code/script.png)
[Partial Close Buy Orders](/en/code/60232)

Script for partially close active buy orders

![Tuyul GAP](https://c.mql5.com/i/code/expert.png)
[Tuyul GAP](/en/code/60347)

Trading Gap Weekend, is it profitable?

![GZIP - Decode](https://c.mql5.com/i/code/library.png)
[GZIP - Decode](/en/code/59309)

Unpack GZIP archives from \*.gz files or responses from sites compressed with this format.