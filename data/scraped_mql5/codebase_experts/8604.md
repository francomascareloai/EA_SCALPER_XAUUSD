# Attempt to create an Expert Advisor based on the Center of Gravity indicator - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/8604

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/8604) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Attempt to create an Expert Advisor based on the Center of Gravity indicator - expert for MetaTrader 4

[Vitaliy](/en/users/alik345)  |
[English](javascript:void(false);)

[Русский](/ru/code/8604)

Views:
:   26086

Rating:
:   (11)

Published:
:   1 July 2016, 09:21
:   [Center\_of\_Gravity.mq4](/en/code/download/8604/Center_of_Gravity.mq4 "Center_of_Gravity.mq4")
    (5.69 KB)
    [view](# "view")

    [create1.mq4](/en/code/download/8604/create1.mq4 "create1.mq4")
    (1.88 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/8604.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Please help me with my idea.

The idea has existed for a long time - based on the "Conservative intraday scalping" strategy, but I could not find a suitable indicator in MT4.

I found the indicator ([Center of Gravity.mq4](/en/code/7068)). Now I am trying to attach it to an EA, but the EA stubbornly refuses to open trades (neither on demo, nor in testing). Question - why?

The idea: indicator generates 5 lines parallel to the trend. Trades can be opened at the intersections of the extreme lines (of course, preferably with trailing). My idea is that a moving average with a period of 1 (SMA based on LOW prices) crossing the lower line of the indicator from below, i.e. return to the trend channel, would serve as the signal for opening a trade, for example BUY. For SELL, the opposite - moving average 1, SMA, HIGH crosses the upper line from above. The idea can be further developed indefinitely, but currently it is necessary to deal with this.

Indicator: Center of Gravity.mq4

Expert Advisor: C\_S\_intraday.mq4 /in simple form, no control of the deposit, timeframes, no trailing, etc.

[![](https://c.mql5.com/18/19/11_small.jpg "Bitmap")](https://c.mql5.com/18/19/11.jpg)  
Bitmap

  

```mql5
//+---------------------------------------------------------------------+
//|                              C_S_intraday.mq4                       |
//|                                                                     |
//+---------------------------------------------------------------------+
//
//
//
extern double    lots=0.1;
//extern int       StopLoss=30 ;
//extern int       TrailingStop=15;
//extern int       Slippage=2;

extern int BB = 125;
extern int MM = 2;
extern int II = 0;
extern double KK = 2.0;
extern int NN = 1102;

double  maH0,maH1,maL0,maL1;
//+------------------------------------------------------------------+
//+------------------------------------------------------------------+
//| expert start function                                            |
//+------------------------------------------------------------------+
int start()
  {
maH0=iMA(NULL,0,1,0,MODE_LWMA,PRICE_HIGH,0); //moving average based on high
maH1=iMA(NULL,0,1,0,MODE_LWMA,PRICE_HIGH,1); //moving average based on high
maL0=iMA(NULL,0,1,0,MODE_LWMA,PRICE_LOW,0);  //moving average based on low
maL1=iMA(NULL,0,1,0,MODE_LWMA,PRICE_LOW,1);  //moving average based on low

   int      B= BB;         // 
   int      M= MM;         // 
   int      I= II;         // 
   double   K= KK;         // 
   int      N= NN;         // 
   
   double cgh = iCustom(NULL,0,"Center of Gravity",B,M,I,K,N,3,0);
   double cgl = iCustom(NULL,0,"Center of Gravity",B,M,I,K,N,4,0);
   


if (cgl<maL0)  //if moving average (low) crosses the lowest line of the indicator from below
   {
   OrderSend(NULL,OP_BUY,lots,Ask,2,Ask-10*Point,Ask+20*Point,"create1",123,0,Lime);
   }
/*
if (cgh>maH0)
   {
   OrderSend(NULL,OP_SELL,lots,Bid,2,Bid+10*Point,Bid-20*Point,"create1",123,0,Red);
   }  
*/   
//----
   return(0);
  }
//+------------------------------------------------------------------+
```

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/8604](/ru/code/8604)

**Last comments |
[Go to discussion](/en/forum/90322)**
(4)

![Hans Krijgsman](https://c.mql5.com/avatar/avatar_na2.png "Hans Krijgsman")

**[Hans Krijgsman](/en/users/hansspain)**
|
8 Jul 2016 at 18:26

Hello Vitaliy,

I like your idea. See the code. It has to be improved in order to make it profitable.

Hope to hear from you and other people to contribute to this idea.

```mql5
//+------------------------------------------------------------------+
//|                                                   COG_MA_X_1.mq4 |
//|                                   Copyright 2016, Hans Krijgsman |
//|                                             https://www.mql5.com |
//+------------------------------------------------------------------+
#property copyright "Copyright 2016, Hans Krijgsman"
#property link      "https://www.mql5.com"
#property version   "1.00"
#property strict
#property description ""

#include <stdlib.mqh>
#include <stderror.mqh>

//--- input parameters
input double   lots=0.1;
input string   Info1="COG Indicator values";
input int      bars_back=125;
input int      m=2;
input int      i=0;
input double   kstd=2.0;
input int      sName=1102;
input bool     Audible_Alerts=true;

//--- internal parameters
int ticket;
datetime time_order; //used when opening order and/or sending alert
double MyPoint; //initialized in OnInit
static datetime dt=Time[0]; //timestamp of New Bar open
bool BuyOpportunity; // opportunity for possible Buy order
bool SellOpportunity; // opportunity for possible Sell order
int BuyOpportunityCount; // counter for Buy opportunities
int SellOpportunityCount; // counter for Sell opportunities
//+------------------------------------------------------------------+
//| Expert initialization function                                   |
//+------------------------------------------------------------------+
int OnInit()
  {
//---
   MyPoint=Point;
   if(Digits==3 || Digits==5) MyPoint=Point*10;
//---
   BuyOpportunityCount=0;
   SellOpportunityCount=0;
//---
   return(INIT_SUCCEEDED);
  }
//+------------------------------------------------------------------+
//| Expert deinitialization function                                 |
//+------------------------------------------------------------------+
void OnDeinit(const int reason)
  {
//---

  }
//+------------------------------------------------------------------+
//| Expert tick function                                             |
//+------------------------------------------------------------------+
void OnTick()
  {
//---
   if(NewBar())
     {
      //--- reset
      ticket=0;
      BuyOpportunity  = false;
      SellOpportunity = false;
      //--- previous moving average values
      double maH1 = iMA(NULL,0,1,0,MODE_LWMA,PRICE_HIGH,1);
      double maL1 = iMA(NULL,0,1,0,MODE_LWMA,PRICE_LOW,1);
      //--- previous COG extreme values
      double cgH1 = iCustom(NULL,0,"Center of Gravity",bars_back,m,i,kstd,sName,3,1); //COG high extreme
      double cgL1 = iCustom(NULL,0,"Center of Gravity",bars_back,m,i,kstd,sName,4,1); //COG low extreme
      //--- check opportunities
      if(maL1<cgL1)
        {
         BuyOpportunity=true;
         BuyOpportunityCount++;
         myAlert("indicator",StringFormat("Buy Opportunity [%d]",BuyOpportunityCount));
        }
      if(maH1>cgH1)
        {
         SellOpportunity=true;
         SellOpportunityCount++;
         myAlert("indicator",StringFormat("Sell Opportunity [%d]",SellOpportunityCount));
        }
     }

//--- ONLY OPEN ONE POSITION PER BAR
   if(Time[0]!=time_order)
     {
      //--- actual moving average values
      double maH0 = iMA(NULL,0,1,0,MODE_LWMA,PRICE_HIGH,0);
      double maL0 = iMA(NULL,0,1,0,MODE_LWMA,PRICE_LOW,0);
      //--- actual COG extreme values
      double cgH0 = iCustom(NULL,0,"Center of Gravity",bars_back,m,i,kstd,sName,3,0); //COG high extreme
      double cgL0 = iCustom(NULL,0,"Center of Gravity",bars_back,m,i,kstd,sName,4,0); //COG low extreme

      //--- BUY
      if(BuyOpportunity && maL0<cgL0)
        {
         ticket=OrderSend(Symbol(),OP_BUY,lots,Ask,3,NormalizeDouble(Ask-(10*MyPoint),Digits),NormalizeDouble(Ask+(20*MyPoint),Digits),"COG_MA_X_1",123,0,Lime);
         
         if(ticket>0)
           {
            myAlert("order",StringFormat("Buy position opened [%d]",BuyOpportunityCount));
            time_order=Time[0];
           }
         else
           {
            myAlert("error",StringFormat("error opening Buy position [%d]",BuyOpportunityCount));
           }
        }

      //--- SELL
      if(SellOpportunity && maH0>cgH0)
        {
         ticket=OrderSend(Symbol(),OP_SELL,lots,Bid,2,NormalizeDouble(Bid+(10*MyPoint),Digits),NormalizeDouble(Bid-(20*MyPoint),Digits),"COG_MA_X_1",123,0,Red);
         
         if(ticket>0)
           {
            myAlert("order",StringFormat("Sell position opened [%d]",SellOpportunityCount));
            time_order=Time[0];
           }
         else
           {
            myAlert("error",StringFormat("error opening Sell position [%d]",SellOpportunityCount));
           }
        }
     }

//--- SCREEN INFO  
   string str_opp=StringFormat("\n* Buy Opportunities : %d \n* Sell Opportunities : %d",BuyOpportunityCount,SellOpportunityCount);
   Comment(str_opp);
  }
//+------------------------------------------------------------------+

//--- FUNCTIONS -----------------------------------------------------+
//+------------------------------------------------------------------+
//| Returns true when a New Bar has occured, else false.             |
//+------------------------------------------------------------------+
bool NewBar(){if(dt!=Time[0]){dt=Time[0]; return(true);} return(false);}
//+------------------------------------------------------------------+
//| Alerts, Messages                                                 |
//+------------------------------------------------------------------+
void myAlert(string type,string message)
  {
   if(type=="print")
      Print(message);
   else if(type=="error")
     {
      Print(type+" | COG_MA_X_1 @ "+Symbol()+","+TF2String()+" | "+message);
     }
   else if(type=="order")
     {
      if(Audible_Alerts) Alert(type+" | COG_MA_X_1 @ "+Symbol()+","+TF2String()+" | "+message);
     }
   else if(type=="modify")
     {
     }
   else if(type=="indicator")
     {
      if(Audible_Alerts) Alert(type+" | COG_MA_X_1 @ "+Symbol()+","+TF2String()+" | "+message);
     }
  }
//+------------------------------------------------------------------+
//| Returns a visual representation for the given timeperiod.        |
//+------------------------------------------------------------------+
string TF2String()
  {
   string tfs="N/A";
   switch(_Period)
     {
      case PERIOD_M1:  tfs="M1"; break;
      case PERIOD_M5:  tfs="M5"; break;
      case PERIOD_M15: tfs="M15"; break;
      case PERIOD_M30: tfs="M30"; break;
      case PERIOD_H1:  tfs="H1"; break;
      case PERIOD_H4:  tfs="H4"; break;
      case PERIOD_D1:  tfs="D1"; break;
      case PERIOD_W1:  tfs="W1"; break;
      case PERIOD_MN1: tfs="MN";
     }
   return(tfs);
  }
//+------------------------------------------------------------------+
```

![golad](https://c.mql5.com/avatar/avatar_na2.png "golad")

**[golad](/en/users/golad)**
|
13 Oct 2016 at 18:16

**Hans Krijgsman:**  

Hello Vitaliy,

I like your idea. See the code. It has to be improved in order to make it profitable.

Hope to hear from you and other people to contribute to this idea.

Thank you Hans for your code.

I have add to my MT4 chart on [demo account](/en/docs/constants/environment_state/accountinformation#enum_account_trade_mode "MQL5 documentation: Account Properties"), will see how it works.

Will this EA send ALERT to my push notification email, which I have set

in the TOOLS > OPTIONS > EMAIL.

I would love if you can help me. How / where do I add custom indicator mq4 file for

additional entry point? Like MA crossover arrow indicator. Add to which block?

Thanks in advance.

![9409269](https://c.mql5.com/avatar/avatar_na2.png "9409269")

**[9409269](/en/users/9409269)**
|
8 Aug 2025 at 12:37

as in your picture you have the gravity indicator plotted directly on your chart may you please provide me the code for that indicator i actually only need indicator only

![Fernando Carreiro](https://c.mql5.com/avatar/2025/9/68d40cf8-38fb.png "Fernando Carreiro")

**[Fernando Carreiro](/en/users/fmic)**
|
8 Aug 2025 at 12:50

**[@9409269](/en/users/9409269) [#](/en/forum/90322#comment_57759459):**as in your picture you have the gravity indicator plotted directly on your chart may you please provide me the code for that indicator i actually only need indicator only

Use the desktop browser (not a mobile device) and click on the links ...

> ![](https://c.mql5.com/3/471/1796940871582.png)
>
> [![](https://c.mql5.com/3/471/2863162085903__1.png)](https://c.mql5.com/3/471/2863162085903.png "https://c.mql5.com/3/471/2863162085903.png")

![i1AMA](https://c.mql5.com/i/code/indicator.png)
[i1AMA](/en/code/8603)

Another attempt to adapt the moving average.

![ParabolicM](https://c.mql5.com/i/code/indicator.png)
[ParabolicM](/en/code/8571)

Simplified Parabolic

![Hans123_Trader](https://c.mql5.com/i/code/expert.png)
[Hans123\_Trader](/en/code/8614)

Good EA, good optimization results. The unfailing EUR/USD pair and H1 timeframe.

![MA with a price](https://c.mql5.com/i/code/expert.png)
[MA with a price](/en/code/8615)

MA with a price.