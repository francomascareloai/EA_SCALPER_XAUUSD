# TP SL Trailing - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/22001

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/22001) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# TP SL Trailing - expert for MetaTrader 5

TheLiteShadow  |
[English](javascript:void(false);)

[Русский](/ru/code/22001) [中文](/zh/code/22001) [Español](/es/code/22001) [Deutsch](/de/code/22001) [日本語](/ja/code/22001) [Português](/pt/code/22001)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   14995

Rating:
:   (30)

Published:
:   25 October 2018, 15:49
:   [TP SL Trailing.mq5](/en/code/download/22001/tp_sl_trailing.mq5 "TP SL Trailing.mq5")
    (21.72 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/22001.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**The author of the idea** - [Sergey Efimenko](/en/users/theliteshadow "Sergey Efimenko (TheLiteShadow)")

**mq5 code author** - [barabashkakvn](/en/users/barabashkakvn)

Stop loss (**Stop Loss**) and take profit (**Take Profit**) initial setting if these properties are not set for the position. Trailing works only for profitable positions.

If **Only zero values** is "true" - this means searching for positions having either stop loss, or take profit equal to zero. As soon as such a position is found:

* If this is a BUY position

+ a stop loss is set: current price (**Bid**) minus stop loss
+ a take profit is set: current price (**Bid**) plus take profit

* If this is a SELL position

+ a stop loss is set: current price (**Ask**) plus stop loss
+ a take profit is set: current price (**Ask**) minus take profit

If the **Only zero values** parameter is "false", stop loss (**Stop Loss**) and take profit (**Take Profit**) parameters are disabled.

The EA works for all positions on the current symbol - unique magic number is not considered.

To see how it all works, uncomment the strings:

```mql5
   ExtStopLoss    = InpStopLoss     * m_adjusted_point;
   ExtTakeProfit  = InpTakeProfit   * m_adjusted_point;
   ExtTrailingStop= InpTrailingStop * m_adjusted_point;
   ExtTrailingStep= InpTrailingStep * m_adjusted_point;

//m_trade.Buy(2.0);
//m_trade.Sell(1.0);
//---
   return(INIT_SUCCEEDED);
  }
```

and launch the EA in the strategy tester.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/22001](/ru/code/22001)

**Last comments |
[Go to discussion](/en/forum/285561)**
(29)

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
27 Jan 2022 at 16:05

**tonyalcapon [#](/en/forum/285561#comment_27345941) :**  

For example I have 3 Buys opened orders with TP and SL set.

And I have also 15 limit buy pendings with SL set but no TP because it will depends where the trend will go.

During the night (because I am trading on H4 and i need to sleep) maybe 3 limit buy will be trigered but without TP set.

So if this EA could copy the already existing TP from opened positions that would be a huge help!

Broken logic. Each position (note: a POSITION, not an ORDER) can have its own Take profit.

This logic is better: if a pending order has triggered (and even better: if a new position has appeared), then the adviser checks whether the position has Take profit or not.

![Rosita Kazuka](https://c.mql5.com/avatar/2022/5/6295086D-2365.jpg "Rosita Kazuka")

**[Rosita Kazuka](/en/users/rositakkizo)**
|
19 Jul 2022 at 17:16

Hello, thanks for your code.

but what is trailing stop and trailing step? what's the difference?

for example:

my [stop loss](https://www.metatrader5.com/en/terminal/help/trading/general_concept "User Guide: Types of orders") is 50 pip,

(now for trailing)

i want for each 10 pip in profit,

move stoploss 20 pip,

what should i do?

![Achmad Muchtar](https://c.mql5.com/avatar/2022/10/63394109-5a03.jpg "Achmad Muchtar")

**[Achmad Muchtar](/en/users/naruto_bekantan)**
|
30 Nov 2022 at 15:30

The only expert advisor worth using [on VPS](https://www.mql5.com/en/vps "Forex VPS for MetaTrader 4/5").

![Alexander Bervinov](https://c.mql5.com/avatar/avatar_na2.png "Alexander Bervinov")

**[Alexander Bervinov](/en/users/gitarist)**
|
14 Apr 2023 at 03:15

**Андрей [#](/ru/forum/274942#comment_10249058):**  
 That's what I figured. Okay, thank you for your help, have a nice day.

**Vladimir Karputov [#](/ru/forum/274942#comment_10248981):**  

The current symbol for this EA is the symbol on which the EA is running.

I confirm, the EA does not set stops. What is wrong ?

![Evgenij Litvintsev](https://c.mql5.com/avatar/2017/5/5926DD11-1A12.jpg "Evgenij Litvintsev")

**[Evgenij Litvintsev](/en/users/alex0779)**
|
27 Feb 2024 at 07:38

Definitely the right EA for scalpers

![XDeMarker_Histogram_Vol](https://c.mql5.com/i/code/indicator.png)
[XDeMarker\_Histogram\_Vol](/en/code/22002)

DeMarker\_Histogram\_Vol indicator with additional averaging of the resulting histogram

![Breadandbutter2](https://c.mql5.com/i/code/expert.png)
[Breadandbutter2](/en/code/22003)

Trading system based on iADX (Average Directional Movement Index, ADX) and iAMA (Adaptive Moving Average, AMA) indicators. The system works on a new bar only.

![SSL_NRTR](https://c.mql5.com/i/code/indicator.png)
[SSL\_NRTR](/en/code/22000)

NRTR type trend indicator based on exiting the channel formed by averaging High and Low of the price series

![Exp_TrendManager_Tm_Plus](https://c.mql5.com/i/code/expert.png)
[Exp\_TrendManager\_Tm\_Plus](/en/code/21998)

The trading system based on TrendManager indicator signals with the possibility to set a fixed position holding time