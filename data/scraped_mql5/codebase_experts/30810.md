# Theil_Sen Indicator Free - indicator for MetaTrader 4

Source: https://www.mql5.com/en/code/30810

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/30810) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Theil\_Sen Indicator Free - indicator for MetaTrader 4

Dwaine Hinds

Published by:
:   [Dwaine Hinds](/en/users/megatr0n)

Views:
:   20988

Rating:
:   (14)

Published:
:   27 August 2020, 19:13

Updated:
:   5 September 2020, 02:48
:   \MQL4\Include\

    [TheilSen\_Indicator\_Free.mqh](/en/code/download/30810/theilsen_indicator_free.mqh "TheilSen_Indicator_Free.mqh")
    (14.67 KB)
    [view](# "view")

    [BreakPoint.mqh](/en/code/download/30810/breakpoint.mqh "BreakPoint.mqh")
    (9.69 KB)
    [view](# "view")

    [theilsen\_gradient.mq4](/en/code/download/30810/theilsen_gradient.mq4 "theilsen_gradient.mq4")
    (20.4 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/30810.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This is essentially a tool to estimate the general trajectory of a line drawn from a collection of data points. The estimated line is derived by first performing regression on the series of values and then calculating the slope of this resulting regression line.  The data set selection can be a simple moving average, exponential moving average, close prices, high/low prices and they are automatically collected from the meta trader chart . You only need to select one type of data you want to collect. It support multiple currencies.

```mql5
iTSlope(asymbol,timeframe,regperiod,adataset,rmp,rtc,slope,line_nickname,enable_text,ashift);
//This is the main function to use in your EA. Just input your own parameters. 
//Manual traders can use this or use the indicator directly.
```

[![theil_sen_indicator](https://c.mql5.com/18/93/theil_sen_slope__1.jpg "theil_sen_indicator")](https://c.mql5.com/18/93/theil_sen_slope.jpg "https://c.mql5.com/18/93/theil_sen_slope.jpg")

As usual, this supports **multiple currencies** at the same time and I am including the "BreakPoint" tool here but it is not needed by the indicator itself.

This is what the trend-line look like in a ranging market:

[![ranging market](https://c.mql5.com/18/93/ranging1__1.jpg "ranging market")](https://c.mql5.com/18/93/ranging1.jpg "https://c.mql5.com/18/93/ranging1.jpg")

[![randing market with tendency](https://c.mql5.com/18/93/ranging2__1.jpg "randing market with tendency")](https://c.mql5.com/18/93/ranging2.jpg "https://c.mql5.com/18/93/ranging2.jpg")

Now this is what the trend-line looks like on a trending market:

[![trending](https://c.mql5.com/18/93/trending__1.jpg "trending")](https://c.mql5.com/18/93/trending.jpg "https://c.mql5.com/18/93/trending.jpg")

Here is a demo expert advisor:

```mql5
//+------------------------------------------------------------------+
//|                                                         demo.mq4 |
//|                         Copyright 2020, Everybody Software Corp. |
//|                                             https://anywhere.com |
//+------------------------------------------------------------------+
#property copyright "Copyright 2020, Everybody Software Corp."
#property link      "https://anywhere.com"
#property version   "1.00"
#property strict
#include <TheilSen_Indicator.mqh>
#include <BreakPoint.mqh>//<--- not required
//+------------------------------------------------------------------+
//| Expert initialization function                                   |
//+------------------------------------------------------------------+
int OnInit()
  {
   return(INIT_SUCCEEDED);
  }
  
//+------------------------------------------------------------------+
//| Expert deinitialization function                                 |
//+------------------------------------------------------------------+
void OnDeinit(const int reason)
  { 
  }
  
//+------------------------------------------------------------------+
//| Expert tick function                                             |
//+------------------------------------------------------------------+
void OnTick()
  {
   //---------these variables are created empty but they will contain data after iTSlop() is used below.------//
   double slope=0;//the slope of the regression line.
   
   ENUM_TIMEFRAMES timeframe=0;//this is the timeframe for the symbol. 0 means current chart timeframe.
   
   int 
   regperiod=20,//the regression period. how many bars do you want to perform regression on.
   ashift=1;//the shift of the bar where you want the regression line to be drawn over.
   
   string 
   asymbol="",//this is the symbol/currency pair you want to perform the calculations on. "" means current symbol.
   adataset="ema_close",//the type of data you want to perform regression on.
   line_nickname="anything_goes_here",
   rmp,//the calculated "market phase" which is a specific description of the market 
   rtc;//the calculated "market tendency" which is a general description of the market.
   
   bool enable_text=true;//when set = true, textual data is displayed on the current chart.
     
   iTSlope(asymbol,timeframe,regperiod,adataset,rmp,rtc,slope,line_nickname,enable_text,ashift);//single currency
   //if(rmp == "trending")BreakPoint("","","",true,"rmp",rmp,"rtc",rtc,"asymbol",asymbol);
  }
//+------------------------------------------------------------------+
```

Special thanks whroeder and others who helped clarify the concept.

**Last comments |
[Go to discussion](/en/forum/349880)**
(9)

![Dwaine Hinds](https://c.mql5.com/avatar/2020/4/5E940247-3C14.jpg "Dwaine Hinds")

**[Dwaine Hinds](/en/users/megatr0n)**
|
3 Sep 2020 at 18:14

**dapotoyin:**  
 The indicator is not loading on mt4. How can i load it pls

Why not? Please, give me a clue as to what you are seeing.

![dapotoyin](https://c.mql5.com/avatar/avatar_na2.png "dapotoyin")

**[dapotoyin](/en/users/dapotoyin)**
|
14 Sep 2020 at 22:13

The indicator cannot be attached to the chart

![Dwaine Hinds](https://c.mql5.com/avatar/2020/4/5E940247-3C14.jpg "Dwaine Hinds")

**[Dwaine Hinds](/en/users/megatr0n)**
|
15 Sep 2020 at 04:40

**dapotoyin:**  
 The indicator cannot be attached to the chart

I am not at my computer right now. Try this:

\* Ensure that the file with the ".mq4" extension is already in the "Indicators" folder. If it is not there then move it to the "Indicators" folder.

\* After doing the above, double click the file with the ".mq4" extension to open it in MetaEditor.

\* Once the mq4 file is opened in MetaEditor, just click the "Compile" button. You can click it a few times to make sure. Now try attaching the Indicator to any chart.

![latest tricks](https://c.mql5.com/avatar/2019/12/5DF895FF-2DDB.jpg "latest tricks")

**[latest tricks](/en/users/latesttricks)**
|
28 Sep 2020 at 10:23

**Can I have indicator ploting two most traded open interest from option chain of the stock.

Also another indicator ploting gap up or gap down.**

Can I have indicator ploting two most traded open interest from option chain of the stock.

Also another indicator ploting gap up or gap down.

![Dwaine Hinds](https://c.mql5.com/avatar/2020/4/5E940247-3C14.jpg "Dwaine Hinds")

**[Dwaine Hinds](/en/users/megatr0n)**
|
1 Oct 2020 at 06:56

**latest tricks:**  

Can I have indicator ploting two most traded open interest from option chain of the stock.

Also another indicator ploting gap up or gap down.

Currently, no. Only the default price data from mt4 has been coded into this indicator. However, if you can get this data from an external indicator then this could be added in.

![DXYvsEXY for MT4](https://c.mql5.com/i/code/indicator.png)
[DXYvsEXY for MT4](/en/code/30714)

Indicator DXYvsEXY is the USDX vs EURX with Awesome Oscillator Indicator for MT4.

![VR Watch List and Linker Lite](https://c.mql5.com/i/code/expert.png)
[VR Watch List and Linker Lite](/en/code/30601)

Synchronous change of a trading instrument in all charts

![CCI H MTF Colored](https://c.mql5.com/i/code/indicator.png)
[CCI H MTF Colored](/en/code/30850)

Fully customizable: Period, TimeFrame, Color, and Price.
Above 0: Chartreuse
Below 0: Red
Above 100: Marron
Below -100: Dark Green

![ATR adaptive SMA](https://c.mql5.com/i/code/indicator.png)
[ATR adaptive SMA](/en/code/30856)

ATR adaptive SMA (Simple Moving Average)