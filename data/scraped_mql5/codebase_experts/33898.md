# Display optimised for console-type chart text output - library for MetaTrader 5

Source: https://www.mql5.com/en/code/33898

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/33898) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# Display optimised for console-type chart text output - library for MetaTrader 5

[Mihail Matkovskij](/en/users/cyberdev)  |
[English](javascript:void(false);)

[Русский](/ru/code/33898) [中文](/zh/code/33898) [Español](/es/code/33898) [Deutsch](/de/code/33898) [日本語](/ja/code/33898) [Português](/pt/code/33898) [한국어](/ko/code/33898) [Français](/fr/code/33898) [Italiano](/it/code/33898) [Türkçe](/tr/code/33898)

Views:
:   1220

Rating:
:   (17)

Published:
:   4 April 2025, 10:53
:   \MQL5\Experts\canvas-vs-labels\demo\cyberdev\

    [ChartDisplay.mqh](/en/code/download/33898/chartdisplay.mqh "ChartDisplay.mqh")
    (12.77 KB)
    [view](# "view")

    \MQL5\Experts\canvas-vs-labels\demo\

    [Demo.mq5](/en/code/download/33898/demo.mq5 "Demo.mq5")
    (9.48 KB)
    [view](# "view")

    \MQL5\Experts\canvas-vs-labels\measurement\cyberdev\

    [ChartDisplay.mqh](/en/code/download/33898/chartdisplay.mqh "ChartDisplay.mqh")
    (12.97 KB)
    [view](# "view")

    \MQL5\Experts\canvas-vs-labels\measurement\

    [CanvasVsLabels.mq5](/en/code/download/33898/canvasvslabels.mq5 "CanvasVsLabels.mq5")
    (15.2 KB)
    [view](# "view")

    [CanvasVsLabelsTester.mq5](/en/code/download/33898/canvasvslabelstester.mq5 "CanvasVsLabelsTester.mq5")
    (13.6 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/33898.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The library contains two types of displays. The first, LabelsDisplay, is based on CChartObjectLabel. The second,  CanvasDisplay, is based on CCanvas. The displays are optimised for rendering frequency. Besides the main Expert Advisor demonstrating the work of displays Demo.mq5, there are two more variants, CanvasVsLabelsTester.mq5, to perform measurements exclusively in the tester, on ticks. And the universal CanvasVsLabels.mq5, which performs measurements both in the tester and on the chart. These measurements can be compared with each other. For more details on comparing the speed of displays, please see the link [Canvas vs Labels](/ru/forum/364640).

[![Measurements of drawing speed in the chart](https://c.mql5.com/18/161/Video_2021-03-14_195717__1.gif "Measurements of drawing speed in the chart")](https://c.mql5.com/18/161/Video_2021-03-14_195717.gif "https://c.mql5.com/18/96/Video_2021-03-14_195717.gif")

[![Method of entering the chart](https://c.mql5.com/18/161/2021-03-12_123055__1.png "Method of entering the chart")](https://c.mql5.com/18/161/2021-03-12_123055.png "https://c.mql5.com/18/96/2021-03-12_123055.png")

```mql5
//+------------------------------------------------------------------+
//|ChartDisplayDemo.mq5 |
//|Copyright 2021, © Cyberdev |
//| https://www.mql5.com/en/users/cyberdev/seller |
//+------------------------------------------------------------------+
#property copyright "Copyright 2021, © Cyberdev."
#property link      "https://www.mql5.com/en/users/cyberdev/seller"
#property version   "1.00"

//+------------------------------------------------------------------+
//||
//+------------------------------------------------------------------+
#include "cyberdev\ChartDisplay.mqh"

//+------------------------------------------------------------------+
//||
//+------------------------------------------------------------------+
enum OutType { 
  otCanvas, // Canvas
  otLabels  // Labels
};

//+------------------------------------------------------------------+
//||
//+------------------------------------------------------------------+
input OutType outType = otLabels; // outType - display type
input int nLines = 50; // nLines - number of lines on the display
input bool optimizeUpdate = false; // optimiseUpdate - optimisation for Labels
input int bWidth = 406; // bWidth - display width
input int lY_Dist = 14; // lY_Dist - distance between lines
input bool back = false; // back - background for Labels

//+------------------------------------------------------------------+
//||
//+------------------------------------------------------------------+
Strings * display;
CChart Chart;

//+------------------------------------------------------------------+
//| Expert initialisation function|
//+------------------------------------------------------------------+
int OnInit() {
  Chart.Attach(ChartID());
  Chart.ShowGrid(false);
  Chart.ColorBackground(C'194,231,197');
  Chart.ColorBarUp(clrDodgerBlue);
  Chart.ColorBarDown(clrBlueViolet);
  Chart.ColorCandleBull(clrDodgerBlue);
  Chart.ColorCandleBear(clrBlueViolet);
  Chart.ColorForeground(clrBlack);
  switch (outType) {
  case otCanvas:
    display = new CanvasDisplay();
    break;
  case otLabels:
    display = new LabelsDisplay();
    break;
  default:
    return INIT_FAILED;
  }
  if ((outType == otLabels && back &&
       !dynamic_cast<LabelsDisplay *>(display).createExt(nLines, 10, 10, bWidth, lY_Dist)) || 
       !display.create(nLines, 10, 15, bWidth, lY_Dist))
    return INIT_FAILED;
  return(INIT_SUCCEEDED);
}
//+------------------------------------------------------------------+
//| Expert deinitialisation function|
//+------------------------------------------------------------------+
void OnDeinit(const int reason) {
  if (CheckPointer(display) == POINTER_DYNAMIC)
    delete display;
  Chart.Detach();
}

//+------------------------------------------------------------------+
//||
//+------------------------------------------------------------------+
#define  concatenate(_rate)                                                         \
 ("Open: " + DoubleToString(rates[_rate].open, digits) +                           \
  "; High: " + DoubleToString(rates[_rate].high, digits) +                         \
  "; Low: " + DoubleToString(rates[_rate].low, digits) +                           \
  "; Close: " + DoubleToString(rates[_rate].close, digits) + ".")   
  

//+------------------------------------------------------------------+
//| Expert tick function|
//+------------------------------------------------------------------+
void OnTick() {
  MqlRates rates[];
  int digits = (int)SymbolInfoInteger(_Symbol, SYMBOL_DIGITS);
  static datetime time = 0;
  datetime cTime;
  static bool firstRun = true;
  bool triggered = false;
  if (CopyRates(NULL, PERIOD_CURRENT, 0, 2, rates) != 2)
    return;
  display.setText(concatenate(1));
  cTime = rates[0].time;
  if (cTime != time) {
    if (!firstRun) {
      display.push();
      display.setText(concatenate(0));
    }
    time = cTime;
    firstRun = false;
    triggered = true; 
  }
  if(outType == otLabels && optimizeUpdate) {
    if (triggered)
      display.update();
    else
      dynamic_cast<LabelsDisplay *>(display).updateOne();
  }
  else
    display.update();
}
//+------------------------------------------------------------------+
```

To update the top line, you need to call the setText method of the class you are using. To shift the text to the line below, the push method of the used class  is called . And to display the added/updated text on the display use the update method of any of the classes. In addition to this method, the LabelsDisplay class has an additional method  updateOne, which can speed up the display more than 2 times. It is called only when the top line needs to be updated. If the push method was called, then after it you should call the update method instead of updateOne .

### Input parameters

* **outType** - display type
* **nLines** - number of lines on the display
* **optimiseUpdate** -**optimize**  for Labels
* **bWidth** - width of the display
* **lY\_Dist** - distance between lines
* **back** - background for Labels

With **outType**  you can select the display type from **Canvas**  or **Labels** values. The **nLines**  change sets the number of lines that will be saved after scrolling by the push method. The **optimiseUpdate**  parameter enables economical updating of only one line, if the push method has not been called and therefore the rest of the lines do not need to be updated (see above). With **bWidth**  you can set the width of the display (relevant for Canvas and Labels using background). With the **lY\_Dist**  parameter you can achieve the desired font size. The font size is taken from **lY\_Dist** , from which the part set by the fDec coefficient is subtracted, which allows to change the real line height, not the font size, without taking into account the distance between lines. The **back**  parameter enables the background in **Labels** mode**.**

Thus, it is possible to display information in the chart in 5 different modes.

1. Canvas
2. Labels
3. Labels with optimised  textoutput
4. Labels with Canvas background
5. Labels with background, plus, optimisation

Using a background in outType**:**  Labels mode gives about the same load as using other additional chart objects. That is, it slightly increases the time it takes to output text to the display.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/33898](/ru/code/33898)

**Last comments |
[Go to discussion](/en/forum/484142)**
(2)

![Mihail Matkovskij](https://c.mql5.com/avatar/2015/8/55C14DA3-CC6B.jpg "Mihail Matkovskij")

**[Mihail Matkovskij](/en/users/cyberdev)**
|
13 Mar 2021 at 10:05

The [source code](https://forge.mql5.io/help/en/guide "MQL5 Algo Forge: Cloud Workspace for Algorithmic Trading Development") has been updated. Now you can adjust the height of the lines of output text, as well as add a background for Labels.

![Mihail Matkovskij](https://c.mql5.com/avatar/2015/8/55C14DA3-CC6B.jpg "Mihail Matkovskij")

**[Mihail Matkovskij](/en/users/cyberdev)**
|
14 Mar 2021 at 19:38

Another update. Added limitation of the frequency of display updates, which allowed to significantly increase their performance. Added a [universal Expert Advisor](/en/articles/2166 "Article: Universal Trading Expert: Strategy Trading Modes (Part 1) ") for measuring in the chart as well as in the tester.

![MultiTester](https://c.mql5.com/i/code/library.png)
[MultiTester](/en/code/26132)

Multiple runs/optimisations in Tester.

![Pan PrizMA No leverage 72](https://c.mql5.com/i/code/indicator.png)
[Pan PrizMA No leverage 72](/en/code/25229)

Construct a moving line with a polynomial of 4 degrees. Extrapolates the sinusoidal and its axial. The constructed lines remove one value at each bar and a sliding line of extrapolated values is constructed which is not redrawn.

![Manual Position Tracking Panel](https://c.mql5.com/i/code/expert.png)
[Manual Position Tracking Panel](/en/code/36412)

Panel based on CDialog class. Work on the current symbol. Deleting, setting Take Profit, setting Breakeven on a group of positions

![iCHO Trend CCIDualOnMA Filter](https://c.mql5.com/i/code/expert.png)
[iCHO Trend CCIDualOnMA Filter](/en/code/37799)

Strategy based on the standard indicator iCHO (Chaikin Oscillator, CHO) and custom indicator 'CCIDualOnMA'