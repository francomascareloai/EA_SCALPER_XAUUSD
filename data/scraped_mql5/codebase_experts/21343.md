# Exp_GStop_Tm - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/21343

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/21343) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Exp\_GStop\_Tm - expert for MetaTrader 5

[Nikolay Kositsin](/en/users/godzilla)  |
[English](javascript:void(false);)

[Русский](/ru/code/21343) [中文](/zh/code/21343) [Español](/es/code/21343) [Deutsch](/de/code/21343) [日本語](/ja/code/21343) [Português](/pt/code/21343)

Views:
:   3680

Rating:
:   (12)

Published:
:   13 July 2018, 16:08
:   [Exp\_GStop\_Tm.mq5](/en/code/download/21343/exp_gstop_tm.mq5 "Exp_GStop_Tm.mq5")
    (34.01 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/21343.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

An Expert Advisor for closing all positions, in case of the total profits on those positions exceeded the Take Profit level fixed in inputs or the total losses on those positions exceeded the Stop Loss level fixed in inputs, or where it is necessary to close all positions beyond the time interval fixed in the settings. In a manner, this EA works as a global take profit function and a global stop loss function for all open positions simultaneously. The fact itself of stopping the losses and commanding to close positions is placed by the EA in a log file as relevant comments.

```mql5
//+----------------------------------------------+
//|  Options to calculate the losses             |
//+----------------------------------------------+
enum StopMode
  {
   ENUM_PERCENT,     //losses and profits in percents
   ENUM_CARRENCY     //losses and profits in the deposit currency units
  };
//+----------------------------------------------+
//| Input parameters of the EA indicator         |
//+----------------------------------------------+
input StopMode LMode=ENUM_PERCENT;  //method of detecting losses and profits
input double StopLoss=20.0;         //stop loss level
input double TakeProfit=100.0;         //take profit level
```

The EA provides an option of closing positions only beyond the time interval defined in its input variables:

```mql5
input bool TimeTrade=true; //Permission to trade by time intervals
input HOURS StartH=ENUM_HOUR_0; //Trading start (Hours)
input MINUTS StartM=ENUM_MINUT_0; //Trading start (Minutes)
input HOURS EndH=ENUM_HOUR_23; //Trading end (Hours)
input MINUTS EndM=ENUM_MINUT_59; //Trading end (Minutes)
```

Two variables (hours and minutes) are provided for the operation start time, and two similar variables for the end time.

Default settings enable the Expert Advisor to trade the whole trading session from 0:00, while all positions are closed at 23:59.

If the start time is later than the specified end time, the Expert Advisor will close positions the next day, at the specified time

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/21343](/ru/code/21343)

**Last comments |
[Go to discussion](/en/forum/265401)**
(3)

![north459](https://c.mql5.com/avatar/avatar_na2.png "north459")

**[north459](/en/users/north459)**
|
25 Jul 2018 at 08:19

Is it possible to set a trailing stop for overall profitability.

![YAO YAO](https://c.mql5.com/avatar/2020/1/5E16D28B-1FE2.jpg "YAO YAO")

**[YAO YAO](/en/users/sjjc2015)**
|
31 Aug 2020 at 11:52

The position is still not closed at the specified time?

I have ordered an algorithmic trade, I opened a position manually and then set the [EA trading](https://www.mql5.com/en/market/mt5/ "A Market of Applications for the MetaTrader 5 and MetaTrader 4") time, for example, I set the closing time at 12:15, I executed the algorithmic trade, but at 12:15, I did not close the position, but I did not close the position, and I did not close the position.

![YAO YAO](https://c.mql5.com/avatar/2020/1/5E16D28B-1FE2.jpg "YAO YAO")

**[YAO YAO](/en/users/sjjc2015)**
|
31 Aug 2020 at 17:55

Can't close the position, can't close the position.

![Exp_GTakeProfit_Tm](https://c.mql5.com/i/code/expert.png)
[Exp\_GTakeProfit\_Tm](/en/code/21342)

An Expert Advisor for closing all positions, in case of the total profits on those positions exceeded the Take Profit level fixed in inputs, or where it is necessary to close all positions beyond the time interval fixed in the settings.

![Exp_GStopLoss_Tm](https://c.mql5.com/i/code/expert.png)
[Exp\_GStopLoss\_Tm](/en/code/21341)

An Expert Advisor for closing all positions, in case of the total losses on those positions exceeded the Stop Loss level fixed in inputs, or where it is necessary to close all positions beyond the time interval fixed in the settings.

![AOCCI](https://c.mql5.com/i/code/expert.png)
[AOCCI](/en/code/21345)

An Expert Adviswor based on two indicators: iCCI (Commodity Channel Index, CCI) and iAO (Awesome Oscillator, AO)

![Ozymandias_System](https://c.mql5.com/i/code/indicator.png)
[Ozymandias\_System](/en/code/21347)

An indicator that colors candlesticks going beyond channel Ozymandias.