# GZIP - Decode - library for MetaTrader 5

Source: https://www.mql5.com/en/code/59309

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/59309) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# GZIP - Decode - library for MetaTrader 5

[Forester](/en/users/elibrarius)  |
[English](javascript:void(false);)

[Русский](/ru/code/59309) [中文](/zh/code/59309) [Español](/es/code/59309) [Deutsch](/de/code/59309) [日本語](/ja/code/59309) [Português](/pt/code/59309) [한국어](/ko/code/59309) [Français](/fr/code/59309) [Italiano](/it/code/59309) [Türkçe](/tr/code/59309)

Views:
:   1356

Rating:
:   (3)

Published:
:   12 June 2025, 11:56
:   \MQL5\Scripts\

    [GZIP\_test.mq5](/en/code/download/59309/gzip_test.mq5 "GZIP_test.mq5")
    (3.05 KB)
    [view](# "view")

    \MQL5\Include\

    [GZIP.mqh](/en/code/download/59309/gzip.mqh "GZIP.mqh")
    (8.89 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/59309.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The library allows you to decrypt GZIP archives from \*.gz files or responses from sites compressed with this format. Tested on files with up to 0.5 GB of text packed in them.

The library can automatically check by the flag in the 4th byte whether the archive is a compressed file or compressed data from the site, in the second case there is no file name in the data.

Input data for decompression should be represented in an array of char type.

The terminal function CryptDecode(CRYPT\_ARCH\_ZIP, tmp, key, tx) is used for decompression;

The GZIP class contains methods:

```mql5
isGZIP(char& gz[])
```

- checks against the first three characters of the received data to see if it is compressed in GZIP format.

After this check, one of the overloads of the unGZIP method can be called:

```mql5
bool unGZIP(char& gz[], char& tx[], string& fname, bool printTime=false){}
```

the preferred use case in terms of speed and memory consumption. During decompression, the char array tx is filled. Then data from it can be processed by CSV or JSON parser. This way we get the result without gluing the array into a string and then dividing it by strings or other characters.

If you still need to get a string, you can use one of the overloads:

```mql5
bool unGZIP(char& gz[], string& out, bool printTime=false, uint codepage=CP_ACP){}
```

return true if unpacking is successful, the unpacked string is in the string out

or

```mql5
string unGZIP(char& gz[], bool printTime=false, uint codepage=CP_ACP){}
```

return string. If unpacking fails, the string will be empty.

Care should be taken when using concatenation of data into a single string.  
 If you unpacked an archive with 0.5GB of data, the string will require another 0.5GB, then you can split it into an array of strings, which will require another 0.5GB. Plus the time cost of all these operations.

Example use case for reading compressed data from a website and then reading from a file: (this script is attached for download)

```mql5
#property copyright "Copyright 2023, Forester"
#property link      "https://www.mql5.com"
#property version   "1.00"

#include <GZIP.mqh>
GZIP gzip;

void OnStart(){
      Print("GZipped webpage read sample:");
      string url="https://............";
      char out[]; 
      if(http_req(url, out,"GET","Accept-Encoding: gzip, deflate\r\n", 1,0)){
          if(gzip.isGZIP(out)){
            Print("GZIP detected");
            string txt; if(!gzip.unGZIP(out, txt, 1, CP_UTF8)){return;}//CP_ACP
            Print(txt);
         }else{
         Print("No GZIP");Print(CharArrayToString(out, 0, WHOLE_ARRAY, CP_UTF8));
         }
      }
      
      Print("File read sample:");
      bool is_common=1;
      string fn="3.csv.gz";
      bool is_zip=1;

      int h;
      if(is_zip){
         h = FileOpen(fn,FILE_READ|FILE_BIN|FILE_READ|(is_common?FILE_COMMON:0));
      }else{
         h = FileOpen(fn,FILE_READ|FILE_CSV|FILE_ANSI|(is_common?FILE_COMMON:0));
      }
      if( h!=INVALID_HANDLE){
         Print ("Start gzip");
         char gz[],tx[];
         FileReadArray(h, gz); FileClose(h); 
         
         if(gzip.isGZIP(gz)){
            Print("GZIP detected");
            string fname;
            if(!gzip.unGZIP(gz, tx,fname,1)){return;}
            //string txt; if(!unGZIP(gz, txt, 1, CP_ACP)){return;}//CP_UTF8
            //string txt=unGZIP(gz, 1, CP_ACP);if(txt==""){return;}
            if(fname!=NULL){Print("File name: ",fname,", file size: ",ArraySize(tx));}
            string t=  CharArrayToString(tx,0,100);Print("Filr content: ",t);t=  CharArrayToString(tx,ArraySize(tx)-100,100);Print("... ",t);

 
            //ulong mcs = GetMicrosecondCount();
            //string csvRow[];int columns=0, next=0; char sep=',', newLine='\n';
            //while(getCSVRow(tx, csvRow, columns, next, sep, newLine) && !IsStopped()){//get next row
              // for(int c=0; c<columns; c++){
               //Print();
              // }
               //Print(next);
            //}
            //Print("CSV parse time: ",(GetMicrosecondCount()-mcs)," mcs");
            //ArrayPrint(csvRow);

        }else{}
      }
}

int getCSVRow(char& csv[], string& outAr[], int& cols, int& next, char& sep, char& newLine){//get next row
   for(int i=next; i<ArraySize(csv); i++){
      if(csv[i] == newLine){
         cols=StringSplit(CharArrayToString(csv,next,i-next),sep,outAr);// process 1 line separately - 5-10% faster than parseCSV and e has memory for 1 large array.
         next=i+1;
         return true;
      }
   }
   return false;
}



bool http_req(string url, char& out[],string method="GET",string headers_request=NULL, bool printTime=false,bool debug=false){
   ulong mcs = (printTime?GetMicrosecondCount():0);
   bool retVal=false;
   ResetLastError();
   char data[];string headers=NULL;
   int r=WebRequest(method, url, headers_request, 5000, data, out, headers);
   if(r==-1){Print("Error in WebRequest. Err code =",GetLastError());MessageBox("It is necessary to add the address '"+url+"' to the list of allowed URLs in the 'Advisors' tab","Error",MB_ICONINFORMATION);}
   else{if(r==200){ retVal=  true; }else{PrintFormat("Download error '%s', responce code %d",url,r);Print("Error in WebRequest. Err code =",GetLastError());}}if(debug){PrintFormat("Responce headers: %s\r\nResponce:",headers);Print(CharArrayToString(out));}//
   if(printTime){Print("WebRequest time: ",(GetMicrosecondCount()-mcs)," mcs");}
   return retVal;
}
```

This example reads a file from the files folder, and decompresses it into an array.   
 The first and last 100 characters from the unpacked file are printed.   
 The array can then be sent to a CSV or JSON parser. For JSON there is JASON library in kodobase. It can parse data received as a char array.

Example of output when unpacking a compressed CSV file of 120 MB, the source file is 463 MB:

2025.05.12 15:08:40.510    GZipped webpage read sample:  
 2025.05.12 15:08:41.319    WebRequest time: 809637 mcs  
 2025.05.12 15:08:41.319    GZIP detected  
 2025.05.12 15:08:41.319    UnGZIP time: 3 mcs  
 2025.05.12 15:08:41.319    {"retCode":0,"retMsg":"OK","result":{"category":"linear","list":[... Юя  
 2025.05.12 15:08:41.319    File read sample:  
 2025.05.12 15:08:41.320    Start gzip  
 2025.05.12 15:08:41.384    GZIP detected  
 2025.05.12 15:08:42.582    UnGZIP time: 1198136 mcs  
 2025.05.12 15:08:42.593    File name: BTCUSD2025-05-09.csv, file size: 486006135  
 2025.05.12 15:08:42.593    Filr content: timestamp,symbol,side,size,price,tickDirection,trdMatchID,grossValue,homeNotional,foreignNotional,RP  
 2025.05.12 15:08:42.593    ... 36.00,ZeroPlusTick,e92fbea7-1471-591e-95f7-4dc0edde771c,971.4774228646926,1,9.714774228646926e-06,0

Unpacking took about 1.2 seconds.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/59309](/ru/code/59309)

![Tuyul GAP](https://c.mql5.com/i/code/expert.png)
[Tuyul GAP](/en/code/60347)

Trading Gap Weekend, is it profitable?

![Divergence Awesome Ocilator](https://c.mql5.com/i/code/indicator.png)
[Divergence Awesome Ocilator](/en/code/56820)

This MQL5 custom indicator detects divergences between price action and the Awesome Oscillator (AO), signalling potential market reversals or continuations. It plots buy/sell arrows on the chart, displays the AO as a histogram, and draws trendlines to highlight divergences.

![EXSR](https://c.mql5.com/i/code/expert.png)
[EXSR](/en/code/60413)

EXSR.mq5: A counter‑trend MT5 EA that catches reversals by combining RSI(14) extremes with Bollinger Band breakouts and a reversal candlestick, placing one trade per symbol with fixed SL/TP.

![TradeReportExporter](https://c.mql5.com/i/code/script.png)
[TradeReportExporter](/en/code/56662)

The TradeReportExporter script is designed to export the history of trades (trades) into a convenient CSV file. It automatically collects data on all trades for the last year for the instrument it is installed on. The file includes such data as date and time, transaction type (buy/sell), price, volume, commission and profit/loss. The result is saved in a file that can be opened in Excel or any other spreadsheet editor.