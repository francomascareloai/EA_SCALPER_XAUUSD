# EA_MALR - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/1198

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/1198) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# EA\_MALR - expert for MetaTrader 5

[Alexander Puzikov](/en/users/im_hungry)  |
[English](javascript:void(false);)

[Русский](/ru/code/1198) [中文](/zh/code/1198) [Español](/es/code/1198) [Deutsch](/de/code/1198) [日本語](/ja/code/1198) [Português](/pt/code/1198)

Views:
:   9558

Rating:
:   (34)

Published:
:   12 December 2012, 13:13

Updated:
:   22 November 2016, 07:32
:   [sets\_reports.zip](/en/code/download/1198/sets_reports.zip "sets_reports.zip")
    (827.9 KB)

    [ea\_malr\_v\_1-01.mq5](/en/code/download/1198/ea_malr_v_1-01.mq5 "ea_malr_v_1-01.mq5")
    (14.94 KB)
    [view](# "view")

    \MQL5\Indicators\

    [malr.mq5](/en/code/download/1198/malr.mq5 "malr.mq5")
    (4.35 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/1198.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The Expert Advisor drawn on the basis of the MALR indicator. Trailing stop, lot increase, averaging and reversal functions are available.

The EA\_MALR Expert Advisor is drawn on the basis of the MALR indicator (the author is unknown). A sell is opened after crossing top to bottom of the <MALRHH> line (the most upper line) by price, a buy is opened after crossing the <MALRLL> line (the lowest line) by price.

It includes the following functions:

* position averaging on a new signal,
* position reversal when the signal changes to the opposite one,
* trailing stop with additional settings,
* lot increase to the set equity drawdown.

**The testing result since 2000 at EURUSD. Initial lot 0.10, initial deposit 10000$, 1:500,** **MetaQuotes-Demo.**

Charts with and without lot increase are represented below.

Averaging and reversal are not used (only Stop Loss/Take Profit are used).

![](https://c.mql5.com/18/8/no_overturn_-_no_averaging_-_no_increase.jpg)

![](https://c.mql5.com/18/8/no_overturn_-_no_averaging_-_increase.png)

AVERAGING function is enabled (reversal function is disabled).

![](https://c.mql5.com/18/8/no_overturn_-_averaging_-_no_increase.png)

![](https://c.mql5.com/18/8/no_overturn_-_averaging_-_increase.png)

REVERSAL function is enabled  (averaging function  is disabled).

![](https://c.mql5.com/18/8/overturn_-_no_averaging_-_no_increase.png)

![](https://c.mql5.com/18/8/overturn_-_no_averaging_-_increase.png)

Both REVERSAL and AVERAGING functions are enabled.

![](https://c.mql5.com/18/8/overturn_-_averaging_-_no_increase.png)

![](https://c.mql5.com/18/8/overturn_-_averaging_-_increase.png)

The Expert Advisor is protected from data loss when there are bond cutting, errors in networks and restart of the Expert Advisor (terminal).

The main settings of the Expert Advisor (when zero these settings are not used):

* sl/tp - set after opening the position.

* N\_modify\_sltp - the number of times to install Stop Loss/Take Profit in an unsuccessful deal.

* use\_Averaging - enable averaging in the set loss (loss\_forAveraging) in points. Opening of an additional basic lot when a new single directed signal appears.

* loss\_forAveraging - the number of points in loss from the previous open price (last averaging).

* Position\_overturn - position reversal when the signal on the indicator changes to the opposite. Lot reversal multiplies by a reversal coefficient (koff\_multiplication).

* use\_increase - lot increase to the given drawdown (Max\_drawdown) when opening and averaging of the position.

* Trail\_StopLoss - enable trailing stop StopLoss in points (trail). When there are reversal and averaging, trailing stop is saved.

* Activate\_by\_profit - inclusion of trailing stop in set profit in points (profit) from open price. In case of averaging open price is equal to averaging price of all openings.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/1198](/ru/code/1198)

**Last comments |
[Go to discussion](/en/forum/9346)**
(6)

![MONEY7](https://c.mql5.com/avatar/avatar_na2.png "MONEY7")

**[MONEY7](/en/users/money7)**
|
14 Nov 2012 at 20:23

Good afternoon! Please make it possible to download the EA immediately on MetaTreider 5

![lev1lev](https://c.mql5.com/avatar/avatar_na2.png "lev1lev")

**[lev1lev](/en/users/lev1lev)**
|
28 Dec 2012 at 05:08

For some reason the owl isn't working(((

![surubabs Suresh Kakkattil](https://c.mql5.com/avatar/2013/2/512F92BD-BA5A.jpg "surubabs Suresh Kakkattil")

**[surubabs Suresh Kakkattil](/en/users/surubabs)**
|
10 Apr 2013 at 15:38

One of the well Written EA,In a Good order,

If Some one hungry for a well written code, just have this one,

Thanks a loooot to the Author,

I still wonder, why dont others comment on this ea.

![63839348](https://c.mql5.com/avatar/avatar_na2.png "63839348")

**[63839348](/en/users/63839348)**
|
16 Aug 2023 at 17:36

fund some error in new version of mql5 anyone please fix this

* ')' - expression expected
* 'close' - invalid [array access](/en/docs/basis/variables#array_define "MQL5 Documentation: Arrays")

```mql5
void OnTick()
  {
   bool pos=PositionSelect(Symbol());
   if(!pos || (pos && (use_Averaging || Position_overturn)))
     {
      datetime Now_time[1];
      int coptTime=CopyTime(Symbol(),NULL,0,1,Now_time);
      if(Now_time[0]>_time && coptTime!=-1)
        {
         int type=-1;
         double propn=0,prev_lot=0;
         if((use_Averaging || Position_overturn) && pos)
           {
            prev_lot=PositionGetDouble(POSITION_VOLUME);
            type=(int)PositionGetInteger(POSITION_TYPE);
            if(type==0 && prev_open!=0) propn = prev_open-SymbolInfoDouble(Symbol(),SYMBOL_ASK);
            if(type==1 && prev_open!=0) propn = SymbolInfoDouble(Symbol(),SYMBOL_BID)-prev_open;
           }
         ArrayInitialize(high_extr,0);
         ArrayInitialize(low_extr,0);
         int cop1 = CopyBuffer(handle_MALR,3,1,2,high_extr);
         int cop2 = CopyBuffer(handle_MALR,4,1,2,low_extr);
         if(cop1==2 || cop2==2 || high_extr[0]>0 || high_extr[1]>0 || low_extr[0]>0 || low_extr[1]>0)
           {
            double close[2];
            int copy_close = CopyClose(Symbol(),NULL,1,2,close);
            if(copy_close==2)
              {
               if(high_extr[0]<=close[0] && high_extr[1]>=close[1])
                 {

                  if(Position_overturn)
                    {
                     if(type==0)
                       {
                        if(close())
                          {
                           if(!open(1,prev_lot,3)) return;
                          }
                        _time=Now_time[0];
                        return;
                       }
                     if(!use_Averaging && pos)
                       {
                        _time=Now_time[0];
                        return;
                       }
                    }
                  if(use_Averaging)
                    {
                     if(type!=-1)
                       {
                        if(type==1 && propn>=loss_forAveraging*point && propn!=0)
                           if(!open(1,prev_avlot,2)) return;
                       }
                     else if(!open(1,0,1)) return;
                     _time=Now_time[0];
                     return;
                    }
                  else
                    {
                     if(!open(1,0,1)) return;
                    }
                 }
               if(low_extr[0]>=close[0] && low_extr[1]<=close[1])
                 {
                  if(Position_overturn)
                    {
                     if(type==1)
                       {
                        if(close())
                          {
                           if(!open(0,prev_lot,3)) return;
                          }
                        _time=Now_time[0];
                        return;
                       }
                     if(!use_Averaging && pos)
                       {
                        _time=Now_time[0];
                        return;
                       }
                    }
                  if(use_Averaging)
                    {
                     if(type!=-1)
                       {
                        if(type==0 && propn>=loss_forAveraging*point && propn!=0)
                           if(!open(0,prev_avlot,2)) return;
                       }
                     else if(!open(0,0,1)) return;
                     _time=Now_time[0];
                     return;
                    }
                  else
                    {
                     if(!open(0,0,1)) return;
                    }
                 }
               _time=Now_time[0];
              }
           }
        }
      else return;
     }
```

![kooff](https://c.mql5.com/avatar/avatar_na2.png "kooff")

**[kooff](/en/users/kooff)**
|
20 Aug 2023 at 14:59

**63839348 [#](/en/forum/9346#comment_48779248):**  
 fund some error in new version of mql5 anyone please fix this

* ')' - expression expected
* 'close' - invalid [array access](/en/docs/basis/variables#array_define "MQL5 Documentation: Arrays")

Change close() to Close(). Make the first upper case.

Although it has another error. the unsupported filling type error.

![Exp_MAMA](https://c.mql5.com/i/code/expert.png)
[Exp\_MAMA](/en/code/1203)

The Exp\_MAMA Expert Advisor drawn using the entry when crossing Moving Averages of the MAMA indicator

![Dserg - LinRegression Breakout](https://c.mql5.com/i/code/indicator.png)
[Dserg - LinRegression Breakout](/en/code/1205)

The indicator for automatic drawing of consolidation areas and channels on the basis of the linear regression

![Color RMACD](https://c.mql5.com/i/code/indicator.png)
[Color RMACD](/en/code/1206)

The MACD histogram drawn on the basis of the RVI technical indicator and the TRVI custom indicator.

![Exp_RMACD](https://c.mql5.com/i/code/expert.png)
[Exp\_RMACD](/en/code/1207)

Trading system using the RMACD histogram.