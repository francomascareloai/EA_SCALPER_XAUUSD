# UltraCCI - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/740

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/740) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# UltraCCI - indicator for MetaTrader 5

dm34@mail.ru  |
[English](javascript:void(false);)

[Русский](/ru/code/740) [中文](/zh/code/740) [Español](/es/code/740) [Deutsch](/de/code/740) [日本語](/ja/code/740) [Português](/pt/code/740) [한국어](/ko/code/740) [Français](/fr/code/740) [Italiano](/it/code/740) [Türkçe](/tr/code/740)

Published by:
:   [Nikolay Kositsin](/en/users/godzilla)

Views:
:   11717

Rating:
:   (15)

Published:
:   2 February 2012, 10:50

Updated:
:   29 March 2023, 13:44
:   \MQL5\Include\

    [smoothalgorithms.mqh](/en/code/download/740/smoothalgorithms.mqh "smoothalgorithms.mqh")
    (133.8 KB)
    [view](# "view")

    [ultracci.mq5](/en/code/download/740/ultracci.mq5 "ultracci.mq5")
    (13.64 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/740.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Real author:**

dm34@mail.ru

This indicator is based on CCI ([Commodity Channel Index](https://www.metatrader5.com/en/terminal/help/indicators/oscillators/cci "https://www.metatrader5.com/en/terminal/help/indicators/oscillators/cci")) and the analysis of a trend direction of its multiple signal lines. Signal lines calculation algorithm is as follows. We have indicator input parameters as source data:

* StartLength - minimum initial value of the first signal line;
* Step - period change step;
* StepsTotal - number of period changes.

Any period value from the multitude of signal lines is calculated using arithmetic progression:

SignalPeriod(Number)  =  StartLength + Number \* Step

where the value of Number variable ranges from zero to StepsTotal. Obtained values of the periods are added to the variables array and are used at each indicator tick to get the array of smoothed RSI indicator values. Directions of the current trend for each of the smoothings are calculated and also the number of positive and negative trends for the whole array of CCI smoothed values is determined. The final number of positive and negative trends is smoothed in its turn and used as the indicator lines that form a color cloud displayed with the help of the [DRAW\_FILLING](/en/docs/customind/indicators_examples/draw_filling) style class.

A trend direction in this indicator is determined by the cloud color, while its power is determined by the cloud width. You can use the overbought (UpLevel) and oversold (DnLevel) levels that are set in percent value from the indicator maximum amplitude.

Also, the indicator provides the possibility to determine the direction of trend power change speed displayed as color dots. In case a trend power increases, the color of these dots will match the cloud color, otherwise, the dots will be colored in the opposite color.

Smoothing algorithms can be selected out of ten possible versions:

1. [SMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") - simple moving average;
2. [EMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") - exponential moving average;
3. [SMMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") - smoothed moving average;
4. [LWMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") - linear weighted moving average;
5. [JJMA](/en/code/427) - JMA adaptive average;
6. [JurX](/en/code/436) - ultralinear smoothing;
7. [ParMA](/en/code/433) - parabolic smoothing;
8. [T3](/en/code/424) - Tillson's multiple exponential smoothing;
9. [VIDYA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/vida "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/vida") - smoothing with the use of Tushar Chande's algorithm;
10. [AMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ama "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ama") - smoothing with the use of Perry Kaufman's algorithm.

It should be noted that Phase parameters for different smoothing algorithms have completely different meaning. For JMA it is an external Phase variable changing from -100 to +100. For T3 it is a smoothing ratio multiplied by 100 for better visualization, for VIDYA it is a CMO oscillator period and for AMA it is a slow EMA period. In other algorithms these parameters do not affect smoothing. For AMA fast EMA period is a fixed value and is equal to 2 by default. The ratio of raising to the power is also equal to 2 for AMA.

The indicator uses SmoothAlgorithms.mqh library classes (must be copied to the terminal\_data\_folder\MQL5\Include). The use of the classes was thoroughly described in the article ["Averaging Price Series for Intermediate Calculations Without Using Additional Buffers"](/en/articles/180).

**Indicator input parameters:**

```mql5
//+----------------------------------------------+
//| Indicator input parameters                   |
//+----------------------------------------------+
input int CCI_Period=13;                           // CCI indicator period
input ENUM_APPLIED_PRICE Applied_price=PRICE_CLOSE; // Applied price
//----
input Smooth_Method W_Method=MODE_JJMA;           // Smoothing method
input int StartLength=3;                          // Initial smoothing period                    
input int WPhase=100;                             // Smoothing parameter
//----  
input uint Step=5;                                // Period change step
input uint StepsTotal=10;                         // Number of period changes
//----
input Smooth_Method SmoothMethod=MODE_JJMA;      // Smoothing method
input int SmoothLength=3;                        // Smoothing depth
input int SmoothPhase=100;                       // Smoothing parameter
//----                          
input uint UpLevel=80;                            // Overbought level, %%
input uint DnLevel=20;                            // Oversold level, %%
input color UpLevelsColor=DarkViolet;             // Overbought level color
input color DnLevelsColor=DarkViolet;             // Oversold level color
input STYLE Levelstyle=DASHDOTDOT_;              // Levels style
input WIDTH LevelsWidth=Width_1;                 // Levels width                       
//+----------------------------------------------+
```

![UltraCCI](https://c.mql5.com/18/6/UltraCCI.png "UltraCCI")

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/740](/ru/code/740)

**Last comments |
[Go to discussion](/en/forum/6063)**
(2)

![Sergey Golubev](https://c.mql5.com/avatar/2012/12/50D09349-3D90.jpg "Sergey Golubev")

**[Sergey Golubev](/en/users/newdigital)**
|
14 Dec 2013 at 06:16

[Forum on trading, automated trading systems and testing trading strategies](/en/forum)

[Indicators: Commodity Channel Index (CCI)](/en/forum/219#comment_587153)

[newdigital](/en/users/newdigital), 2013.08.30 11:45

[Commodity Channel Index (CCI) Indicator](/go?link=https://www.tradeforextrading.com/index.php/commodity-channel-index "http://www.tradeforextrading.com/index.php/commodity-channel-index")

![Sergey Golubev](https://c.mql5.com/avatar/2012/12/50D09349-3D90.jpg "Sergey Golubev")

**[Sergey Golubev](/en/users/newdigital)**
|
2 Jan 2014 at 18:34

[Forum on trading, automated trading systems and testing trading strategies](/en/forum)

[Indicators: FX\_Sniper\_Ergodic\_CCI](/en/forum/10806#comment_703454)

[newdigital](https://www.mql5.com/en/users/newdigital "https://www.mql5.com/en/users/newdigital"), 2013.12.19 07:55

[How Forex Traders Use CCI](https://www.mql5.com/go?link=https://www.dailyfx.com/forex/education/trading_tips/chart_of_the_day/2013/12/19/How_Forex_Traders_Use_CCI_to_Trade_GBPUSD.html "http://www.dailyfx.com/forex/education/trading_tips/chart_of_the_day/2013/12/19/How_Forex_Traders_Use_CCI_to_Trade_GBPUSD.html")

* Since the July lows, GBPUSD has rallied 1671 pips in a strong uptrend.
* The Commodity Channel Index (CCI) measures deviations from the moving average while showing overbought and oversold conditions
* When CCI crosses up above the -100 line, a buy signal is generated

Don’t get thrown off by the lengthy name “Commodity Channel Index” as it is not a new 24-hour cable broadcast devoted to pork bellies and soybeans; though you could use it to trade either of these. CCI is a popular indicator used by Forex traders to identify oversold and over bought conditions much in the same way that RSI or Stochastics is used. But instead of 30 and 70 representing oversold and overbought areas, CCI uses -100 and +100. Though Donald Lambert created CCI back in 1980 to identify cyclical turns in commodities it is very effective with currencies. By measuring the current price relative to the average price of a set period like 14, CCI is low during time prices are below their average and high when prices are above their average. This gives us the oversold and overbought regions.

Why is this important you may ask? Well, it is simple. When we have a strong uptrend, the best place to buy is at price point where traders are no longer selling or selling pressure begins to subside. This is called being “oversold”. How do we know when something is oversold? This is a great question too! Forex traders have several tools and methods at their disposal to show them when prices have fallen too far too fast and when bargain hunters may step in sending prices higher. Candlestick pattern, oscillators and support/resistance levels are the primary tools. With CCI, Forex traders look to buy when CCI crosses above -100.

![](https://c.mql5.com/3/27/cci1.png)

Similar to real estate investing, without the headache and a lot more fun, Forex traders want to buy the “worse house in the best neighborhood at the lowest price.” In our analogy, the best neighborhood is a strong trend; the “worse house” is the entry zone for our trade. Like the real estate investor, we look for the value of our holdings to increase over time. Since we have bought at a relatively low price, our risk is small relative to the potential gain. Unlike real estate fixer-uppers, Forex traders can forget remodeling as time and trend work to increase the value of the position

![](https://c.mql5.com/3/27/cci2.png)

Trading Setup

The current trading setup below shows a GBPUSD daily chart uptrend from August 2013. The chart depicts four successful by signals given by CCI as it crossed down below the -100 line and turned up. Forex trend traders would filter out the sell signals generated when CCI crossed down below the +100 line as more pips are gained when trading with the trend than against it. In an uptrend, traders Forex Traders will take buy signals using CCI and use CCI sell signals to take profits. Waiting for CCI to turn above -100 and looking for price to confirm the move, traders will enter the market long and then place a protective stop order about 4-10 pips below the last swing low.

The Trading Plan

Currently, GBPUSD has just bounce from the 1.6220 area and CCI has generated a buy signal when it crossed above the -100 line. A stop could be placed just below that swing low for a target of 1.6671. Remember to always use stops and to only risk no more than 2% of your account equity on any trade. If the stop is hit, then we look for another trade! CCI is simple way to visually identify potential entries.

![BBSqueeze](https://c.mql5.com/i/code/indicator.png)
[BBSqueeze](/en/code/745)

Unnormalized symmetrical oscillator based on the linear regression algorithm with the simplest trend power indicator.

![Ultra Momentum](https://c.mql5.com/i/code/indicator.png)
[Ultra Momentum](/en/code/741)

This indicator is based on Momentum and its multiple signal lines analysis.

![X2MA_BBx3_Cloud](https://c.mql5.com/i/code/indicator.png)
[X2MA\_BBx3\_Cloud](/en/code/738)

Bollinger Bands displayed as colored background.

![StopOutPrice](https://c.mql5.com/i/code/script.png)
[StopOutPrice](/en/code/795)

The script calculates Stop Out price (at this price position will be closed by broker) of the opened position and the price, at which Free Margin became negative (LockOut price).