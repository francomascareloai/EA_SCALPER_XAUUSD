# xoshiro256 Random Number Generator - library for MetaTrader 5

Source: https://www.mql5.com/en/code/42098

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/42098) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# xoshiro256 Random Number Generator - library for MetaTrader 5

[amrali](/en/users/amrali)

Views:
:   11306

Rating:
:   (22)

Published:
:   5 January 2023, 22:42

Updated:
:   2 October 2025, 13:24
:   [Xoshiro256.mqh](/en/code/download/42098/Xoshiro256.mqh "Xoshiro256.mqh")
    (43.44 KB)
    [view](# "view")

    [demo\_examples.mq5](/en/code/download/42098/demo_examples.mq5 "demo_examples.mq5")
    (7.19 KB)
    [view](# "view")

    [speed\_benchmark.mq5](/en/code/download/42098/speed_benchmark.mq5 "speed_benchmark.mq5")
    (3.07 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/42098.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

### Xoshiro256\*\* Random Number Generator

xoshiro256\*\* (named after its operations: XOR, shift, rotate) is a pseudorandom number generator designed by Sebastiano Vigna in collaboration with David Blackman [https://prng.di.unimi.it/](/go?link=https://prng.di.unimi.it/ "https://prng.di.unimi.it/")

This is a 64-bit all-purpose, rock-solid generator. It has excellent (sub-ns) speed, a state size (256 bits) that is large enough for any parallel application, and it passes all known statistical tests.

The xoshiro256\*\* algorithm is not suitable for cryptographic purposes, but is very fast and has excellent statistical properties.

It is presently used in Microsoft's .NET framework and the JavaScript engines of Chrome, Node.js, Firefox, Safari and Microsoft Edge.

The algorithm used here is translated from the [https://prng.di.unimi.it/xoshiro256starstar.c](/go?link=https://prng.di.unimi.it/xoshiro256starstar.c "https://prng.di.unimi.it/xoshiro256starstar.c") reference source code by David Blackman and Sebastiano Vigna.

For MetaTrader programmers and traders, this is highly relevant for:

* **Monte Carlo Simulations**: Accurately simulating price movements, option pricing, or other stochastic processes.
* **Backtesting and Strategy Optimization**: Generating random data or events to test the robustness of a trading strategy under various market conditions.
* **Indicator and Expert Advisor (EA) Development**: Providing a reliable source of randomness for EAs that use randomized logic, such as in genetic algorithms for optimization.
* **Research and Analysis**: The RandomDoubleHighRes method is particularly useful for researchers and quantitative analysts who require a higher degree of precision for their simulations and models, ensuring more accurate and reliable results than standard [MathRand](/en/docs/math/mathrand)().

---

### Class Xoshiro256

The class provides an easy interface for random number generation.

```mql5
//+------------------------------------------------------------------+
//| Class Xoshiro256                                                 |
//| Usage: Provides an implementation of the Xoshiro256** algorithm. |
//+------------------------------------------------------------------+
class Xoshiro256
  {
public:
   // Constructor and destructor
                     Xoshiro256(void);                                   // Auto-seeded constructor
                    ~Xoshiro256(void) {   }

   // Setting the internal state for the generator
   void              Seed(ulong seed);
   void              Seed(ulong a,ulong b,ulong c,ulong d);

   // Public methods for generating random numbers
   int               RandomInteger(void);                                // Random integer [0, INT_MAX]
   int               RandomInteger(const int max);                       // Random integer [0, max)
   int               RandomInteger(const int min,const int max);         // Random integer [min, max)

   long              RandomLong(void);                                   // Random long [0, LONG_MAX]
   long              RandomLong(const long max);                         // Random long [0, max)
   long              RandomLong(const long min,const long max);          // Random long [min, max)

   double            RandomDouble(void);                                 // Random double [0.0, 1.0)
   double            RandomDouble(const double max);                     // Random double [0.0, max)
   double            RandomDouble(const double min,const double max);    // Random double [min, max)

   double            RandomDoubleHighRes(void);                          // Random double [0.0, 1.0)
   double            RandomDoubleHighRes(const double max);              // Random double [0.0, max)
   double            RandomDoubleHighRes(const double min,const double max); // Random double [min, max)

   bool              RandomBoolean(void);                                // Random true/false (equal probability)
   bool              RandomBoolean(const double prob_true);              // Random true/false (with prob_true)

   double            RandomNormal(void);                                 // Random double (normal distribution with mean 0, std dev 1)
   double            RandomNormal(const double mu,const double sigma);   // Random double (normal distribution)

   // Sampling utilities
   template<typename T>
   void              Shuffle(T &arr[]);                                  // Shuffle array arr[] in place using Fisher-Yates
   template<typename T>
   bool              Sample(const T &arr[], T &dest[], int k);           // Sample k unique items from arr[] without replacement
   template<typename T>
   bool              SampleWithReplacement(const T &arr[], T &dest[], int k);
  };
```

If your are doing a lot of Monte Carlo simulations, then this xoshiro256\*\* generator will be much faster and more accurate than MQL's MathRand():

```mql5
//+------------------------------------------------------------------+
//|                                              speed_benchmark.mq5 |
//|                                        Copyright © 2018, Amr Ali |
//|                             https://www.mql5.com/en/users/amrali |
//+------------------------------------------------------------------+
#include "Xoshiro256.mqh"
//--- the random number generator object
Xoshiro256 prng;

#define ITER (500*1000*1000)  // 500 millions
//+------------------------------------------------------------------+
//|                                                                  |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- MathRand() benchmark.
   uint t1 = GetTickCount();
   for(int i = 0; i < ITER; i++)
     {
      MathRand();
     }
   uint ticks1 = GetTickCount() - t1;

//--- Xoshiro256 benchmark.
   uint t2 = GetTickCount();
   for(int i = 0; i < ITER; i++)
     {
      prng.RandomInteger();
     }
   uint ticks2 = GetTickCount() - t2;

//--- Display results.
   PrintFormat("Generating %d random integers: ", ITER);
   PrintFormat("MathRand() -> %u millisec", ticks1);
   PrintFormat("Xoshiro256 -> %u millisec", ticks2);
   PrintFormat("Speed-up factor is %.1fx", (double)ticks1/ticks2);
  }
//+------------------------------------------------------------------+

// sample output:
/*
 Generating 500000000 random integers:
 MathRand() -> 968 millisec
 Xoshiro256 -> 422 millisec
 Speed-up factor is 2.3x
*/
```

Updates:

2023.01.06 - v.1.01 :

* Updated the class to use the more robust 64-bits xoshiro256\*\* random number generator, instead of the 32-bits xoshiro128\*\*.

2025.08.01 - v.1.02 :

* Using a *SplitMix64* generator to seed the state to avoid correlation on similar seeds, as recommended by the original authors.
* Added a seedable constructor with a single ulong. The four 64-bit state variables would be generated using SplitMix64 function.
* Increased performance of all the public methods for generating random numbers.

2025.08.03 - v.1.03 :

* Added *RandomDoubleHighRes*, a new method for generating high-resolution random doubles in the range of [0.0, 1.0). This method is designed to be more precise than *RandomDouble*, as it can generate all possible double-precision floating-point values within the specified interval, a feature important for scientific simulations and other high-precision applications.
* Corrected potential infinite loop bugs in *RandomDouble* and *RandomDoubleHighRes* methods.
* Corrected the implementation of *RandomBoolean*.

2025.08.03 - v.1.04 :

* Faster generation of unbiased random integers in a range by using [Lemire's fastrange](/go?link=https://github.com/lemire/fastrange "https://github.com/lemire/fastrange") method. This technique replaces the slow modulo reduction with a debiased integer multiplication.

2025.08.28 - v.1.05

* Improved RNG seeding mechanism to enforce strong bit-avalanche.
* Ensures even closely related seeds (e.g., 0 vs. 1) generate different sequences.
* Prevents correlations between runs and overlap across concurrent RNG instances

2025.09.13 - v.1.06

* Allow richer initialization by using full entropy from all four 64-bit seeds independently.

2025.09.16 - v.1.07

* Implemented SHA-256 based seeding (uses [CryptEncode](/en/docs/common/cryptencode) with CRYPT\_HASH\_SHA256) to preserve full 256-bit entropy,

2025.09.19 - v.1.08

* Added sampling utilities (Shuffle, Sample, SampleWithReplacement) to the Xoshiro256 class.

2025.10.02 - v.1.09

* Implemented a dedicated boundedUInt32 function using the 32-bit variant of Lemire's fastrange to improve performance.

A BITMAP generated from xoshiro256\*\* Random Number Generator

![](https://c.mql5.com/18/168/Capture__10.png)

The code is also mirrored on Algo Forge here: [https://forge.mql5.io/amrali/Xoshiro256](/go?link=https://forge.mql5.io/amrali/Xoshiro256 "https://forge.mql5.io/amrali/Xoshiro256")

**Last comments |
[Go to discussion](/en/forum/439245)**
(6)

![amrali](https://c.mql5.com/avatar/2021/7/60EB6C17-183F.jpg "amrali")

**[amrali](/en/users/amrali)**
|
6 Jan 2023 at 15:12

**6 January 2023**

Updated the class to use the more robust 64-bits xoshiro256\*\* [random number generator](https://www.mql5.com/en/docs/math/mathsrand "MQL5 documentation: MathSrand function"), instead of the 32-bits xoshiro128\*\*.

![amrali](https://c.mql5.com/avatar/2021/7/60EB6C17-183F.jpg "amrali")

**[amrali](/en/users/amrali)**
|
3 Aug 2025 at 14:38

**3 August 2025 - Version 1.04**

* Faster generation of unbiased random integers in a range by using [Lemire's fastrange](/go?link=https://github.com/lemire/fastrange "https://github.com/lemire/fastrange") method. This technique replaces the slow modulo reduction with a debiased integer multiplication.

![amrali](https://c.mql5.com/avatar/2021/7/60EB6C17-183F.jpg "amrali")

**[amrali](/en/users/amrali)**
|
16 Sep 2025 at 00:11

**16 Sept. 2025 - Version 1.07**

* Implemented SHA-256 based seeding (uses [CryptEncode](/en/docs/common/cryptencode) with CRYPT\_HASH\_SHA256) to preserve full 256-bit entropy,

![Fernando Carreiro](https://c.mql5.com/avatar/2025/9/68d40cf8-38fb.png "Fernando Carreiro")

**[Fernando Carreiro](/en/users/fmic)**
|
16 Sep 2025 at 00:27

Author: [@amrali](/en/users/amrali)

Could I encourage you to also place all of your CodeBase publication's code [into a public AlgoForge repository](/go?link=https://forge.mql5.io/amrali "https://forge.mql5.io/amrali")?

It will be easier for users to Clone (or Fork) and be kept up to date on updates, instead of manual downloads from the publications.

This is what I have done for my own publications, having a single public repository containing all of their code.

![amrali](https://c.mql5.com/avatar/2021/7/60EB6C17-183F.jpg "amrali")

**[amrali](/en/users/amrali)**
|
16 Sep 2025 at 05:33

**Fernando Carreiro [#](/en/forum/439245#comment_58042735):**  

Could I encourage you to also place all of your CodeBase publication's code [into a public AlgoForge repository](/go?link=https://forge.mql5.io/amrali "https://forge.mql5.io/amrali")?

It will be easier for users to Clone (or Fork) and be kept up to date on updates, instead of manual downloads from the publications.

This is what I have done for my own publications, having a single public repository containing all of their code.

Dear Fernando, I just knew it exists, It seems similar to GIT hub.  
Thank you for the tip.

![RSI Bot MT5](https://c.mql5.com/i/code/expert.png)
[RSI Bot MT5](/en/code/41739)

RSI Bot, send alert buy when RSI<=20, send alert sell when RSI>=80

![Time Segmented Volume (TSV)](https://c.mql5.com/i/code/indicator.png)
[Time Segmented Volume (TSV)](/en/code/42000)

Based on the original “Time Segmented Volume (TSV)” developed by Worden Brothers, Inc.

![XP Forex Trade Manager Grid MT5](https://c.mql5.com/i/code/expert.png)
[XP Forex Trade Manager Grid MT5](/en/code/42179)

Forex Trade Manager Grid MT5 helps you to managing orders and achieve the goal.

![XP Forex Trade Manager MT5](https://c.mql5.com/i/code/expert.png)
[XP Forex Trade Manager MT5](/en/code/42180)

Forex Trade Manager MT5 simplifies managing open orders in MetaTrader 5.