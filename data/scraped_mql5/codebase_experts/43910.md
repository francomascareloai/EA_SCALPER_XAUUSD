# Benchmark - library for MetaTrader 5

Source: https://www.mql5.com/en/code/43910

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/43910) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# Benchmark - library for MetaTrader 5

[amrali](/en/users/amrali)

Views:
:   4061

Rating:
:   (14)

Published:
:   17 April 2023, 19:24

Updated:
:   27 April 2023, 08:59
:   \MQL5\Include\Benchmark\

    [Benchmark.mqh](/en/code/download/43910/benchmark.mqh "Benchmark.mqh")
    (9.43 KB)
    [view](# "view")

    [Stopwatch.mqh](/en/code/download/43910/stopwatch.mqh "Stopwatch.mqh")
    (11.37 KB)
    [view](# "view")

    \MQL5\Scripts\

    [benchmark\_test.mq5](/en/code/download/43910/benchmark_test.mq5 "benchmark_test.mq5")
    (1.45 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/43910.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The include file "**Benchmark.mqh**" has a set of macros to benchmark various functions for their execution speeds to decide which is the fastest one.

```mql5
//+------------------------------------------------------------------+
//| Macro to measure the execution time a function.                  |
//| Prints the elapsed time in microseconds per call (µsec/call).    |
//| TimeIt(sum += ArrayBsearch(arr, value));                         |
//+------------------------------------------------------------------+
#define TimeIt(func_invocation)


//+------------------------------------------------------------------+
//| Macro to execute a function for a fixed number of times.         |
//| Prints the elapsed time in milliseconds (msec).                  |
//| Benchmark(repeats, sum += ArrayBsearch(arr, value));             |
//+------------------------------------------------------------------+
#define Benchmark(repeats, func_invocation)


//+------------------------------------------------------------------+
//| Macro to execute a function for a fixed duration in msec.        |
//| Prints the number of operations per second (ops/sec).            |
//| Benchmark_opsec(msec, sum += ArrayBsearch(arr, value));          |
//+------------------------------------------------------------------+
#define Benchmark_opsec(msec, func_invocation)

```

The library is based on public source codes of **timeit module** in python [https://docs.python.org/3/library/timeit.html](/go?link=https://docs.python.org/3/library/timeit.html "https://docs.python.org/3/library/timeit.html") and **Stopwatch Class** from C# [https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.stopwatch](/go?link=https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.stopwatch?view=net-7.0 "https://learn.microsoft.com/en-us/dotnet/api/system.diagnostics.stopwatch?view=net-7.0")

  

Here is an example script for usage:

```mql5
//+------------------------------------------------------------------+
//|                                               benchmark_test.mq5 |
//|                                        Copyright © 2018, Amr Ali |
//|                             https://www.mql5.com/en/users/amrali |
//+------------------------------------------------------------------+
#include <Benchmark\Benchmark.mqh>

//+------------------------------------------------------------------+
//| The function returns integer numeric value closest from below.   |
//+------------------------------------------------------------------+
double FastFloor(const double v)
  {
   double k = (double)(long)v;
   return k - (v < k);
  }

//+------------------------------------------------------------------+
//|                                                                  |
//+------------------------------------------------------------------+
void OnStart(void)
  {
   int repeats = 1e8;
   Print("repeats=",repeats);

//--- if result of the expression is not used, compiler optimizes out
//--- (i.e., ignores) the function call.
   double sum = 0;

   Benchmark(repeats, sum += MathFloor(__i));
   Benchmark(repeats, sum += FastFloor(__i));

   Print("sum=",sum);
  }
//+------------------------------------------------------------------+

// sample output:
/*
 repeats=100000000
 sum+=MathFloor(__i) -> 599 msec
 sum+=FastFloor(__i) -> 138 msec
 sum=9999999922280040.0
*/
```

**Last comments |
[Go to discussion](/en/forum/445765)**
(21)

![amrali](https://c.mql5.com/avatar/2021/7/60EB6C17-183F.jpg "amrali")

**[amrali](/en/users/amrali)**
|
26 Apr 2023 at 20:37

**fxsaber [#](/en/forum/445765/page2#comment_46511875):**  

I expected to see something like this.

ah..Then do not. Use your library. Mine does not fit.

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
26 Apr 2023 at 22:34

**amrali [#](/en/forum/445765/page2#comment_46512336):**  

ah..Then do not. Use your library. Mine does not fit.

I propose to improve the usability of your library.

![amrali](https://c.mql5.com/avatar/2021/7/60EB6C17-183F.jpg "amrali")

**[amrali](/en/users/amrali)**
|
27 Apr 2023 at 00:34

**fxsaber [#](/en/forum/445765/page2#comment_46514849):**  

I propose to improve the usability of your library.

I think you have some confusion about two separate concepts: micro-benchmarking vs macro-benchmarking.

According to this article [https://www.adservio.fr/post/what-is-microbenchmarking](/go?link=https://www.adservio.fr/post/what-is-microbenchmarking "https://www.adservio.fr/post/what-is-microbenchmarking")

*"If you're looking to track the overall performance of your application or otherwise take a "big picture" point of view to a problem, you might not find microbenchmarks suited to your use case. Microbenchmarks deal with the smallest of all benchmarks, and they represent a very simple and easy-to-define metric that tracks and measures the performance of a small and specific piece of code. In contrast of macro-benchmarking, which is the process of running a computer program to evaluate how well the runtime environment performs. Source code instrumentation: This technique is used to modify source code to insert appropriate code (usually conditionally compiled so you can turn it off). Instrumentation is limited by execution coverage. If the program never reaches a particular point of execution, then instrumentation at that point collects no data. For instance, if a word processor application is instrumented, but the user never activates the print feature, then the instrumentation can say nothing about the routines which are used exclusively by the printing feature."*

Edit

I missed including the citation source.

What fits your previous example is code instrumentation, tracing and profiling which was not the main intent (actually outside the scope) of my library. The process of performance testing usually begins with macro-benchmarking to identify hot code paths, then use micro-benchmarks to test other faster alternatives for slow routines in the program.

![Jarnail Singh](https://c.mql5.com/avatar/2024/3/65fc3efb-8a1b.jpg "Jarnail Singh")

**[Jarnail Singh](/en/users/quantcoderpro)**
|
21 Mar 2024 at 15:54

I have gone thorough a lot of similar code but this is good one and well commented. I appreciate the programmer. Regards

![](https://c.mql5.com/avatar/avatar_na2.png)

**[Deleted]**
|
2 Apr 2024 at 06:57

you right I agree with you

![Money Management](https://c.mql5.com/i/code/expert.png)
[Money Management](/en/code/43904)

Close trades when the percentage profit or risk of the account is reached

![Tick Speed Indicator](https://c.mql5.com/i/code/script.png)
[Tick Speed Indicator](/en/code/43889)

This example was created to see how long it takes to reach 100 ticks.
So this indicator is a seconds / "centick" (centick = 100 ticks).
It helps you trade orders flow.

![Volume Average Groups For Comparison](https://c.mql5.com/i/code/script.png)
[Volume Average Groups For Comparison](/en/code/44007)

Learn how to split the volume data into different groups so that you can compare them and create a strategy based on volume average.

![ChartButton Class MT5](https://c.mql5.com/i/code/expert.png)
[ChartButton Class MT5](/en/code/43779)

This class allows you to create buttons on the chart as if they were chart objects(have time and price coordinates) these objects can be dragged on the chart and when scrolling they stay at the same place. If you wan't to learn some Object Oriented Programming or if you wan't to understand how chartevents work or you wan't to create graphical interfaces, you can learn a lot from this.