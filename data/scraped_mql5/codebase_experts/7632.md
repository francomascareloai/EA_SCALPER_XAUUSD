# exp_iCustom_v1 - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/7632

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/7632) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# exp\_iCustom\_v1 - expert for MetaTrader 4

[Dmitry Fedoseev](/en/users/integer)  |
[English](javascript:void(false);)

[Русский](/ru/code/7632) [中文](/zh/code/7632) [Deutsch](/de/code/7632) [日本語](/ja/code/7632)

Views:
:   21159

Rating:
:   (27)

Published:
:   16 May 2016, 11:02

Updated:
:   22 November 2016, 07:32
:   [exp\_iCustom\_v1.zip](/en/code/download/7632/exp_iCustom_v1.zip "exp_iCustom_v1.zip")
    (10.37 KB)

    [exp\_iCustom\_v2.zip](/en/code/download/7632/exp_iCustom_v2.zip "exp_iCustom_v2.zip")
    (8.89 KB)

    [exp\_iCustom\_v3.zip](/en/code/download/7632/exp_iCustom_v3.zip "exp_iCustom_v3.zip")
    (9.07 KB)

    [exp\_iCustom\_v4.zip](/en/code/download/7632/exp_iCustom_v4.zip "exp_iCustom_v4.zip")
    (13.24 KB)

    [Download as ZIP](/en/code/download/7632.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Purpose of the EA**

The EA is designed for working with any Custom that draws buy/sell arrows, except the indicators with string parameters.

The name of the Custom indicator is specified in the parameters of the EA, as well as the list of the indicator parameters and numbers of the buffers for drawing the buy/sell arrows.

[![](https://c.mql5.com/18/49/1_5_en__2.png)](https://c.mql5.com/18/49/1_5_en__1.png)

Despite the use of a string list of parameters, it is possible to optimize up to five parameters of the indicator. Instead of any of the variables of the iCustomParam string list, it is possible to use the value of any of the variables Opt\_1\_Value - Opt\_5\_Value.

![](https://c.mql5.com/18/49/2_1_en.png)

**Parameters of the Expert Advisor**

* TimeFrame - working timeframe of the EA: 0 - timeframe of the chart the EA is running on, or which was selected in the tester. Or a specific value 1,5,15,30,60,240,1440...
* iCustomName - name of the Custom indicator.
* iCustomParam - the list of parameters delimited by "/". For the boolean variables, use 1 instead of true, 0 instead of false. If the indicator parameters contain string variables, the EA will not work!
* iBuyBufIndex - index of the buffer with the buy arrows.
* iSellBufIndex - index of the buffer with the sell arrows.
* iShift - offset of the indicator. 1 - work on the formed bars, 0 - on the forming bar (not recommended). It is also possible to enter a value 2,3,4...
* Opt\_1\_Use - enable usage of the variable 1 to be optimized. When the variable to be optimized is activated instead of the value from the iCustomParam string, defined by the Opt\_X\_Index variable, the value of the Opt\_X\_Value variable will be used.
* Opt\_1\_Index - index of the variable 2 to be optimized in the parameter array (in the iCustomParam string). The numbering starts with zero.
* Opt\_1\_Value - the value of the variable 1 to be optimized.
* Opt\_2\_Use - enable usage of the variable 2 to be optimized.
* Opt\_2\_Index - index of the variable 2 to be optimized in the parameter array (in the iCustomParam string). The numbering starts with zero.
* Opt\_2\_Value - the value of the variable 2 to be optimized.
* Opt\_3\_Use - enable usage of the variable 3 to be optimized.
* Opt\_3\_Index - index of the variable 3 to be optimized in the parameter array (in the iCustomParam string). The numbering starts with zero.
* Opt\_3\_Value - the value of the variable 3 to be optimized.
* Opt\_4\_Use - enable usage of the variable 4 to be optimized.
* Opt\_4\_Index - index of the variable 4 to be optimized in the parameter array (in the iCustomParam string). The numbering starts with zero.
* Opt\_4\_Value - the value of the variable 4 to be optimized.
* Opt\_5\_Use - enable usage of the variable 5 to be optimized.
* Opt\_5\_Index - index of the variable 5 to be optimized in the parameter array (in the iCustomParam string). The numbering starts with zero.
* Opt\_5\_Value - the value of the variable 5 to be optimized.
* MMMethod - ММ method: 0-Lots, 1-part (Risk) of the free margin, 2-part (Risk) of the free margin normalized by the MeansStep (for example, Risk=0.1, MeansStep=1000, if the margin is less than 2000, the lot equals 0.1, if the margin is greater than 2000 or more - 0.2 lot, 3000 or more - 0.3 lot and so on)
* Lots - the number of lots at MMMethod=0.
* Risk - risk. The value based on funds at FixedLot=false.
* MeansType - type of funds used in lot calculation. 1 - Balance, 2 - Equity, 3 - FreeMargin.
* MeansStep - step of the funds. Used at MMMethod=2.
* LotsDigits - the number of decimal places in the lot value.
* Slippage - allowed deviation from the requested price.
* StopLoss - stop loss.
* TakeProfit - take profit.
* Magic\_N - magic number.
* MaxOrdersCount - allowed total number of the opened orders. -1 - not limited.
* MaxBuyCount - allowed number of opened buy orders. -1 - not limited.
* MaxSellCount - allowed number of opened sell orders. -1 - not limited.
* SleepBars - timeout after opening an order as a number of bars of the working timeframe.
* CancelSleeping - activation of the timeout cancellation when opening an order in the opposite direction.
* CloseOnRev - close orders of the opposite direction before opening.
* TrailingStop\_Use - activation of the trailing stop function.
* TrailingStopStart - profit of the order to activate the trailing stop.
* TrailingStop - the trailing stop level.
* BreakEven\_Use - activation of the breakeven function.
* BreakEvenStart - order profit to activate the breakeven.
* BreakEvenLevel - the level to place the stop loss from the breakeven activation price.

**Note**

The archive with the expert contains the file test\_example.set with the example of settings for using the ind\_Test indicator (crossing of two МАs) and the variables to be optimized. The ind\_Test indicator is attached.

**Version 2**

1. Added the ability to use different indicators for opening and closing signals. The parameters for opening indicator start with the prefix \_O\_, for closing indicator - with the prefix \_C\_.  
   
 There are three possible modes for using the opening and closing indicators (defined by the \_OС\_Mode variable):

* Mode 1 - indicator is not used for closing. Closing is only possible by stop loss and take profit.
* Mode 2 - the closing indicator is not used. Apart from closing by stop loss and take profit, the closing of opposite orders is performed by the opening signals. The stop loss and take profit can be disabled - set the value 0 to the variables StopLoss and/or TakeProfit (applies to all modes).
* Mode 3 - Separate closing signals based on the closing indicator (\_C\_) are used. In this mode it is possible to use an additional mode for copying the parameters of the opening indicator to the parameters of the closing indicator (the C\_UseOpenParam variable), at the same time the indicator name and its parameters are copied. This mode is made for the indicators which generate opening and closing signals for increasing the speed of optimization (the optimized parameters are also copied).

2. It is possible to use not only the indicators with arrows, but indicators with lines as well. It is possible to use two lines (crossing of the main and signal lines) and one line - its crossing with the levels. Use the \_O\_Mode variable (and \_С\_Mode in the closing block) to select the indicator type.

* Mode 1 - the indicator draws arrows. The \_O\_M1\_iBuyBufIndex and \_O\_M1\_iSellBufIndex variables are used for specifying the buffer numbers, and in the closing block - \_C\_M1\_iCloseBuyBufIndex and \_C\_M1\_iCloseSellBufIndex.
* Mode 2 - the main and signal line of the indicator are used. If the main line crosses the signal line from below - signal for opening Buy or closing Sell. The \_O\_M2\_iMainBufIndex, \_O\_M2\_iSignalBufIndex and \_C\_M2\_iMainBufIndex, \_C\_M2\_iSignalBufIndex variables are used for specifying the buffers.
* Mode 3 - one indicator line is used. The buffer number is specified in the \_O\_M3\_iBufIndex variable (or \_С\_M3\_iBufIndex in the closing block). The \_O\_M3\_BuyLevel and \_O\_M3\_SellLevel (\_O\_M3\_CloseBuyLevel and \_C\_M3\_CloseSellLevel in the closing block) are used for specifying the level values. Crossing of the Buy level from below - buy, crossing of the Sell level from above - sell.

**Version 3**

Added another \_O\_Mode mode (and \_S\_Mode)  
   
 Mode 4 - Extremum by three points. Uses one indicator line. The buffer number is specified in the \_O\_M4\_iBufIndex (or \_С\_M4\_iBufIndex in the closing block) variable.

![](https://c.mql5.com/18/16/1_6.gif)

**Version 4**

1. Added working with pending orders.  
 2. Added section separators in the properties window (from string variables).   
   
 Selection of the order type is performed by the **OrdType** variable: 0 - market, 1 - stop, 2 - limit (the variable is in the "Order" section).

The "Pending orders" variable section for managing the pending order operation:

* **PendLevel** - the level from the current market price to place the pending order
* **PendPromPrice** - the price to place the pending order is calculated from the price of the zero bar, at the value PendPromPrice=0 - from the close price (corresponds to the current market price), 1 - from the bat open price.
* **PendNewSigMode** - the method of controlling the pending order on a new trading signal: 0 - if an order has already been placed, then no action is taken when a new trading signal appears, 1 - replace the order on a new signal, 2 - on a new signal the order is replaced only to a "better level" - buy-stop only down, buy-limit only up, sell-stop only up, sell-limit only down.
* **PendPriceFollow** - price following mode. The order is modified at every change of a certain variable PendPromPrice, the order is replaced only to a "better price" (see the description of the PendNewSigMode variable).
* **PendDelete** - delete the pending order on an opposite trading signal. At the value false, it is possible for two pending orders in different directions to exist simultaneously.
* **PendExpiration** - order expiration time in minutes (the minimum value is 11 minutes).

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/7632](/ru/code/7632)

**Last comments |
[Go to discussion](/en/forum/84813)**
(3)

![chim](https://c.mql5.com/avatar/avatar_na2.png "chim")

**[chim](/en/users/chim)**
|
8 Jun 2016 at 18:15

I have tried using this ea with fx5 divergence v2.1 indicator with no success. The indicator is [removed](https://www.mql5.com/en/docs/integration/python_metatrader5/mt5copyratesfrom_py "MQL5 Documentation: copy_rates_from function"). I need help, please.

![Pro71Jezr](https://c.mql5.com/avatar/avatar_na2.png "Pro71Jezr")

**[Pro71Jezr](/en/users/pro71jezr)**
|
18 Jun 2016 at 12:06

Perfect , thanx a lot. 1 question , can I set this to fixed nano lots , 0.01 for example? I would like to test it without the MMMethod during the firts month.

![chim](https://c.mql5.com/avatar/avatar_na2.png "chim")

**[chim](/en/users/chim)**
|
7 Jul 2016 at 14:28

Me too I have tried it it cant. Maybe you can try a micro account.

![MyFriend](https://c.mql5.com/i/code/expert.png)
[MyFriend](/en/code/7628)

Expert Advisor that has been repeatedly discussed on the forum.

![NinaEA](https://c.mql5.com/i/code/expert.png)
[NinaEA](/en/code/7627)

The NinaEA Expert Advisor. It uses the NINA indicator. And NINA uses 0\_IndInverse.

![MAMA_NK](https://c.mql5.com/i/code/indicator.png)
[MAMA\_NK](/en/code/7646)

This indicator version was created using the code for Omega, written by John Ehlers

![ArtificialIntelligence_Right](https://c.mql5.com/i/code/expert.png)
[ArtificialIntelligence\_Right](/en/code/7650)

The Expert Advisor using artificial intelligence - a single-layer neural network. The "Perceptron" is used for identification of the quotes movement direction.