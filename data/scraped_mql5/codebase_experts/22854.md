# MA MACD Position averaging v2 - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/22854

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/22854) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# MA MACD Position averaging v2 - expert for MetaTrader 5

[Vladimir Karputov](/en/users/barabashkakvn)  |
[English](javascript:void(false);)

[Русский](/ru/code/22854) [中文](/zh/code/22854) [Español](/es/code/22854) [Deutsch](/de/code/22854) [日本語](/ja/code/22854) [Português](/pt/code/22854)

Views:
:   9019

Rating:
:   (27)

Published:
:   28 December 2018, 12:56

Updated:
:   17 January 2019, 11:29
:   [MA MACD Position averaging v2.mq5](/en/code/download/22854/ma_macd_position_averaging_v2.mq5 "MA MACD Position averaging v2.mq5")
    (59.29 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/22854.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Improvement of the first version ([MA MACD Position averaging](/en/code/22834)). The EA features the trading signal reversal upon initial opening (when there are no positions). The reverse is managed via the **Use reverse trade signal** parameter.

The EA only checks for a trading signal or an addition to the position when a new bar appears.

The EA is based on indicators iMA (Moving Average, MA) and iMACD (Moving Average Convergence/Divergence, MACD). If a position has a loss exceeding **Step lossing** pips, open yet another position (in the loss-making position direction) with an increased lot (**Lot coefficient** is considered).

The EA holds only one position or multiple positions of the same direction. The EA features two parameters: **Indent price from MA** and **Ratio of MAIN to SIGNAL** (both are displayed on the image below)

![MA MACD Position averaging](https://c.mql5.com/18/76/MA_MACD_Position_averaging__1.png "MA MACD Position averaging")

Sample BUY signal: MACD indicator is below "0.0", the main line (MAIN) exceeds the signal line (SIGNAL) and the current price is higher than Moving Average. Two filters are added to this condition:

* **Ratio of MAIN to SIGNAL**
* **Indent price from MA**

You can select a bar to be checked - on a zero (current) one or on bar #1. This is defined by the **Bar Current** parameter.

EA operation

The following data is collected on a new bar: Number of BUY and SELL positions and the most loss-making (according to the number of pips) BUY and SELL positions. If it turns out that there are both BUY and SELL positions at the same time, this is considered to be an error and ALL positions are closed. If the most loss-making position is found and it is unprofitable by more than**Step lossing**pips, then the parameters of this position (the ticket and the number of lots) are remembered.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/22854](/ru/code/22854)

**Last comments |
[Go to discussion](/en/forum/296606)**
(9)

![wsj9984](https://c.mql5.com/avatar/avatar_na2.png "wsj9984")

**[wsj9984](/en/users/wsj9984)**
|
18 Jan 2024 at 09:59

I downloaded and installed it, but the EA won't open the position.

![MAS-Trading](https://c.mql5.com/avatar/2025/8/688c528e-cb90.jpg "MAS-Trading")

**[MAS-Trading](/en/users/mas-trading)**
|
1 Oct 2024 at 02:43

Hi Vladimir, I have just notice that the EA does not trade on Commodity pairs and only trades on Currency pairs. Is there any way to fix this small problem?

![firdaus.jailani](https://c.mql5.com/avatar/avatar_na2.png "firdaus.jailani")

**[firdaus.jailani](/en/users/firdaus.jailani)**
|
5 Apr 2025 at 14:40

How to download this code please?

![Juvenille Emperor Limited](https://c.mql5.com/avatar/2019/4/5CB0FE21-E283.jpg "Juvenille Emperor Limited")

**[Eleni Anna Branou](/en/users/eleanna74)**
|
5 Apr 2025 at 14:43

**firdaus.jailani [#](/en/forum/296606#comment_56369745):**  
 How to download this code please?

Check the link in the first post: [MA MACD Position averaging v2](/en/code/22854)

![firdaus.jailani](https://c.mql5.com/avatar/avatar_na2.png "firdaus.jailani")

**[firdaus.jailani](/en/users/firdaus.jailani)**
|
5 Apr 2025 at 16:33

**Eleni Anna Branou [#](/en/forum/296606#comment_56369756):**  

Check the link in the first post: [MA MACD Position averaging v2](/en/code/22854)

  
Thanks. Didn't realised I couldn't download from mobile browser, but managed to download from a laptop. Anyway, this EA requires a separate expert in order to manage auto trading? based on the settings, I need a seperate expert to backtest.

![RVI_Histogram_Alert](https://c.mql5.com/i/code/indicator.png)
[RVI\_Histogram\_Alert](/en/code/22863)

Indicator RVI\_Histogram provides alerts and sends email and push notifications when the main and signal lines intersect, accompanied by a change in the color of the signal cloud

![Stochastic_Histogram_Alert](https://c.mql5.com/i/code/indicator.png)
[Stochastic\_Histogram\_Alert](/en/code/22864)

Indicator Stochastic\_Histogram provides alerts and sends email and push notifications when the main and signal lines intersect, accompanied by a change in the color of the signal cloud

![XFisher_org_v2_Candle](https://c.mql5.com/i/code/indicator.png)
[XFisher\_org\_v2\_Candle](/en/code/22849)

Indicator XFisher\_org\_v2\_Candle highlights the candles, the Close prices of which are closed within overbought/oversold zones

![Stochastic_Histogram_HTF](https://c.mql5.com/i/code/indicator.png)
[Stochastic\_Histogram\_HTF](/en/code/22848)

Indicator Stochastic\_Histogram with the timeframe selection option available in its input parameters