# Risk Management EA Based on ATR Volatility - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/59001

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/59001) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Risk Management EA Based on ATR Volatility - expert for MetaTrader 5

[Duy Van Nguy](/en/users/wazatrader)  |
[English](javascript:void(false);)

[Русский](/ru/code/59001) [中文](/zh/code/59001) [Español](/es/code/59001) [Deutsch](/de/code/59001) [日本語](/ja/code/59001) [Português](/pt/code/59001) [한국어](/ko/code/59001) [Français](/fr/code/59001) [Italiano](/it/code/59001) [Türkçe](/tr/code/59001)

Views:
:   10061

Rating:
:   (5)

Published:
:   4 May 2025, 07:03

Updated:
:   28 October 2025, 09:17
:   [Risk Management EA Based on ATR Volatility.mq5](/en/code/download/59001/Risk_Management_EA_Based_on_ATR_Volatility.mq5 "Risk Management EA Based on ATR Volatility.mq5")
    (35.05 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/59001.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

## 

## Key Features

### Smart Risk Management

* Automatic lot size calculation based on account risk percentage
* Maximum risk cap in monetary value
* Dynamic stop loss based on ATR volatility
* Lot normalization according to broker requirements (min/max/step)

### Technical Analysis

* Moving Average Crossover for entry signals
* ATR Volatility Filter for market volatility measurement
* Performance optimized - trades only on new bar formation
* Position verification to avoid duplicate trades

### Flexible Customization

* Risk selection by percentage or fixed value
* Enable/disable dynamic or static stop loss
* Adjustable MA and ATR periods
* Unique magic number for each strategy

### Detailed Monitoring

* Complete position sizing information logs
* Risk/reward display before order execution
* Clear error warnings with troubleshooting guidance
* Comprehensive reports on EA startup/shutdown

## Outstanding Advantages

* Capital safety: Never risks more than allowed
* 100% automated: From analysis to order execution
* Optimized code: Minimizes lag, calculates only when needed
* Broker compliant: Checks stop levels and lot sizes
* User-friendly: Clear input parameters with descriptions

## Suitable For

* Traders prioritizing strict capital management
* Trading systems requiring dynamic position sizing
* Trend-following strategies with MA crossover
* Accounts wanting to control drawdown

## 

[![](https://c.mql5.com/18/170/5104437808539__1.png)](https://c.mql5.com/18/170/5104437808539.png "https://c.mql5.com/18/170/5104437808539.png")

**Last comments |
[Go to discussion](/en/forum/485959)**
(5)

![reghu raj](https://c.mql5.com/avatar/2025/5/68162130-C7BE.png "reghu raj")

**[reghu raj](/en/users/reghuraj7)**
|
5 May 2025 at 07:09

Which time frame does this strategy work optimally ? It wasnt working on the 1 minute time frame. any suggestions ?

![Duy Van Nguy](https://c.mql5.com/avatar/2025/6/68454827-85be.jpg "Duy Van Nguy")

**[Duy Van Nguy](/en/users/wazatrader)**
|
5 May 2025 at 08:47

**reghu raj [#](/en/forum/485959#comment_56618999):**  
 Which time frame does this strategy work optimally ? It wasnt working on the 1 minute time frame. any suggestions ?

The optimal time frame depends on your product, strategy, and risk tolerance. The 1-minute time frame may not suit your setup. I suggest patiently backtesting to find parameters that provide a long-term edge.

![reghu raj](https://c.mql5.com/avatar/2025/5/68162130-C7BE.png "reghu raj")

**[reghu raj](/en/users/reghuraj7)**
|
5 May 2025 at 09:59

**Duy Van Nguy [#](/en/forum/485959#comment_56619752):**  

The optimal time frame depends on your product, strategy, and risk tolerance. The 1-minute time frame may not suit your setup. I suggest patiently backtesting to find parameters that provide a long-term edge.

Thank you

![秀 加藤](https://c.mql5.com/avatar/avatar_na2.png "秀 加藤")

**[秀 加藤](/en/users/hide.11231208)**
|
6 May 2025 at 05:54

It says "You will no longer be able to withdraw funds from your account. Please contact the service desk." But I don't really understand that. I can't withdraw funds from my account. I can't add an account. I can't deposit funds.

![Duy Van Nguy](https://c.mql5.com/avatar/2025/6/68454827-85be.jpg "Duy Van Nguy")

**[Duy Van Nguy](/en/users/wazatrader)**
|
6 May 2025 at 10:00

**秀 加藤 [#](/en/forum/485959#comment_56628732):**  
 It says "You will no longer be able to withdraw funds from your account. Please contact the service desk." But I don't really understand that. I can't withdraw funds from my account. I can't add an account. I can't deposit funds.

This is indeed a standard procedure and it is usually performed in sellers that for some reason have drawn some attention to the MQL5.com administration.  
  
This can take a few days or a couple of weeks, so stay close the these messages and the Service Desk and if you haven't done anything strange, you have nothing to worry about.

![Stoch Cross EA – Buy Below 20, Sell Above 80 (H1)](https://c.mql5.com/i/code/script.png)
[Stoch Cross EA – Buy Below 20, Sell Above 80 (H1)](/en/code/58942)

A simple and effective Expert Advisor based on Stochastic Oscillator reversal signals on the H1 timeframe.
Buy signals are triggered when %K crosses above %D below the 20 level.
Sell signals are triggered when %K crosses below %D above the 80 level.
Risk is calculated based on the account balance, with the lot size set to 0.1 (adjustable as needed).
Take Profit (TP) is set to 300 points for all positions.
Stop Loss (SL) is dynamically calculated based on the opposite crossover signal. The position is closed when a crossover in the opposite direction occurs, as well as when TP or SL is reached

![Brooky Trend Strength for MT5](https://c.mql5.com/i/code/indicator.png)
[Brooky Trend Strength for MT5](/en/code/58838)

This indicator calls 3 other subwindow indicators. All files go in your Indicators folder.

![Creating a Simple News Filter for XAUUSD Trading on MT5](https://c.mql5.com/i/code/script.png)
[Creating a Simple News Filter for XAUUSD Trading on MT5](/en/code/59130)

Trading XAUUSD (Gold) is often influenced by major economic news events like USD, GBP, or EUR releases. To mitigate risks during these volatile periods, using a News Filter in your Expert Advisor (EA) is essential. In this article, I’ll share how to create a simple News Filter on MT5 and apply it to XAUUSD trading.

![Multi-Day Dynamic VWAP](https://c.mql5.com/i/code/indicator.png)
[Multi-Day Dynamic VWAP](/en/code/59157)

Dynamic VWAP level which can be averaged over multiple days