# Ichimoku Kinko Hyo2 - indicator for MetaTrader 4

Source: https://www.mql5.com/en/code/27467

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/27467) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Ichimoku Kinko Hyo2 - indicator for MetaTrader 4

Dwaine Hinds

Published by:
:   [Dwaine Hinds](/en/users/megatr0n)

Views:
:   35377

Rating:
:   (14)

Published:
:   27 December 2019, 03:29

Updated:
:   7 June 2020, 19:14
:   \MQL4\Include\

    [BreakPoint.mqh](/en/code/download/27467/breakpoint.mqh "BreakPoint.mqh")
    (9.69 KB)
    [view](# "view")

    [multipairsfunctions.mqh](/en/code/download/27467/multipairsfunctions.mqh "multipairsfunctions.mqh")
    (4.85 KB)
    [view](# "view")

    [io\_arrays.mqh](/en/code/download/27467/io_arrays.mqh "io_arrays.mqh")
    (14.02 KB)
    [view](# "view")

    [Ichimoku2\_Kinko\_Hyo\_Indicator.mqh](/en/code/download/27467/ichimoku2_kinko_hyo_indicator.mqh "Ichimoku2_Kinko_Hyo_Indicator.mqh")
    (3.86 KB)
    [view](# "view")

    [Ichimoku2.mq4](/en/code/download/27467/ichimoku2.mq4 "Ichimoku2.mq4")
    (25.5 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/27467.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Greetings to all. This is my rendition of what version 2 of the Ichimoku Kinko Hyo indicator should be. Primarily, it was rebuilt to suit mostly expert advisors trading multiple currencies at the same time but it can still be used by manual traders or single currency expert advisors just as the original version.

Usage(updated 7.6.2020):

```mql5
double tenkan,kijun,chikou,spa,spb;//these are created empty but they will contain the request data at the specified shift.
string kiv1;
string kshape,ksentiment;

int aMagicNumber=1234;

//iIchimoku2("",0,3,tenkan,kijun,chikou,spa,spb,kiv1,kshape,ksentiment,1);//OLD useage
iIchimoku2("",0,3,tenkan,kijun,chikou,spa,spb,kiv1,kshape,ksentiment,aMagicNumber,1);//NEW


//"" means current symbol, however you can specify a symbol e.g. 'EURUSD'.
// 0 means current chart, however you can specify a chart period e.g. 240.
// 3 is the period to use for calculating kumo implied volatility.
//tenkan variable now contains the indicator value at the specified shift which is 1.
//kijun variable now contains the indicator value at shift which is 1.
//chikou variable now contains the indicator value at shift which is 1.
//spa variable now contains the indicator value at shift which is 1.
//spb variable now contains the indicator value at shift which is 1.
//kiv1 variable now contains the kumo implied volatility at shift which is 1.¬†¬†
//kshape variable now contains the description of the kumo's shape: flatop/flatbottom.
//ksentiment variable now contains a description of the kumo's sentiment: bullish/bearish.                                                                                                      ¬†¬†
```

The variables such as kijun,chikou... also contain their respective values at the specified shift as well. Remember to put "¬† #include <Ichimoku2\_Kinko\_Hyo\_Indicator.mqh>" at the top of your EA before using this function.

Why?

The original mql4 ichimoku indicator worked correctly and it will continue to do so for most us. I think it was built primarily with the manual trader in mind. Another situation I faced while rebuilding this was that any problem or inefficiency will be amplified when used on multiple currencies simultaneously. To remedy this, I modified the indicator to only run when it is necessary i.e. run only when a new bar is completed. The original version would run on every tick, which i think would consume unnecessary cpu cycles.

When one reads ichimoku literature, frequently one will encounter a reference to the Kumo as "fat", "thick" or "thin". To an experienced ichimoku practioner, it is easy to describe a kumo as "fat" or "thin" because she knows what the usual kumo thickness is for a pair. For beginners, like myself, it is very difficult to describe a kumo because we don't know what to objectively compare it to. I think a solution for this problem would be to compare the kumo to itself over a specific period. This is the approach taken when writing the " GetKumoRelativeSize()" function.

[![Ichimoku Kinko Hyo2](https://c.mql5.com/18/87/ichimoku2__1.jpg "Ichimoku Kinko Hyo2")](https://c.mql5.com/18/87/ichimoku2.jpg "https://c.mql5.com/18/87/ichimoku2.jpg")

(Please see newer usage below)

Enjoy.

**Last comments |
[Go to discussion](/en/forum/329311)**
(7)

![Dwaine Hinds](https://c.mql5.com/avatar/2020/4/5E940247-3C14.jpg "Dwaine Hinds")

**[Dwaine Hinds](/en/users/megatr0n)**
|
18 Jan 2020 at 23:32

**Dwaine Hinds:**  
 Any questions? Or suggestions?
Or problems?

Updated "io\_arrays.mqh" file today.

![Dwaine Hinds](https://c.mql5.com/avatar/2020/4/5E940247-3C14.jpg "Dwaine Hinds")

**[Dwaine Hinds](/en/users/megatr0n)**
|
11 Apr 2020 at 03:31

Updated "Ichimoku2.mq4" file
today.

There are some users who still prefer to use this indicator manually and although it was rebuilt to suit expert advisors, I don't think we should
¬†risk leaving out the manual traders. I have now included a little section to display a summary of all the relevant data the indicator
has presented at a specific **SHIFT**. To see this, you must ensure that the "display\_summary" is set to "yes". This can only be set in the
"Ichimoku2.mq4" file. I know the advanced ichimoku practitioners will find this info unnecessary, as they already can get this by glancing
at the lines on the chart. However, this indicator was rebuilt to assist the novices as well. This should be the last update.

[![Ichimoku Summary Comments](https://c.mql5.com/3/315/ichimoku2_summary__1.jpg "Ichimoku Summary Comments")](https://c.mql5.com/3/315/ichimoku2_summary.jpg "https://c.mql5.com/3/315/ichimoku2_summary.jpg")

If you are going to use this in an expert advisor I would recommend you set "display\_summary" to "no", since the EA already extracts this
information itself. And also we don't want to overwhelm our eyes with too much data, so setting it to "no" will reduce cluttering of the chart.
The ichimoku indicator already has a lot of lines, I think I have succeeded in making the indicator less complicated. The summary comments
apply only to the indicator values at specified shift.

![Thomas Patterson](https://c.mql5.com/avatar/2020/4/5E9148CE-3B93.jpg "Thomas Patterson")

**[Thomas Patterson](/en/users/thomaspatterson)**
|
11 Apr 2020 at 04:35

I want to subscribe

![Dwaine Hinds](https://c.mql5.com/avatar/2020/4/5E940247-3C14.jpg "Dwaine Hinds")

**[Dwaine Hinds](/en/users/megatr0n)**
|
18 Apr 2020 at 15:52

**Thomas Patterson:**  
 I want to subscribe

We are working on this. Just trying to complete a few other [important](https://www.mql5.com/en/economic-calendar/united-states/imports "US Economic Calendar: Imports") projects. üëç

![Dwaine Hinds](https://c.mql5.com/avatar/2020/4/5E940247-3C14.jpg "Dwaine Hinds")

**[Dwaine Hinds](/en/users/megatr0n)**
|
7 Jun 2020 at 11:10

Just made some [important](https://www.mql5.com/en/economic-calendar/united-states/imports "US Economic Calendar: Imports") changes to the code today. The reason for the change is because the previous indicator code could only be used by a single EA, utilizing it on multiple charts, on multiple symbols, simultaneously. The newer code should allow¬†**multiple EA**s, utilizing it on multiple charts, on multiple symbols, simultaneously.

Please note the newer useage:

```mql5
int aMagicNumber=1234;
...
¬†¬† iIchimoku2(NULL,0,3,tk,kj,ch,spa,spb,kiv1,kshape1,ksentiment1,aMagicNumber,shift);
...
```

This should be my last update. The updated indicator now requires your EA's magic number. Of course, this does not affect manual users.

![Bid-Ask-Spread](https://c.mql5.com/i/code/indicator.png)
[Bid-Ask-Spread](/en/code/27460)

The indicator shows BID-ASK-SPREAD information on chart

![iWPR+](https://c.mql5.com/i/code/indicator.png)
[iWPR+](/en/code/27457)

iWPR+ is an iWPR %Range function with a positive value.

![X Man](https://c.mql5.com/i/code/expert.png)
[X Man](/en/code/27492)

"X Man" EA uses Equity Stop from total Equity, you can use it as hedging grid EA or a single trade EA.

![TimerEA](https://c.mql5.com/i/code/expert.png)
[TimerEA](/en/code/27509)

It's an expert to open and close orders on a specific day and time.