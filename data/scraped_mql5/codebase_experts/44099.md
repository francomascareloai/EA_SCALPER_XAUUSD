# Dynamic Trailing Stop Loss and Profit Target Management - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/44099

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/44099) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Dynamic Trailing Stop Loss and Profit Target Management - expert for MetaTrader 5

[Ohene Kofi Akuoku Osei](/en/users/pamo1980)

Views:
:   17336

Rating:
:   (18)

Published:
:   27 April 2023, 18:03

Updated:
:   19 May 2023, 07:58
:   [test.mq5](/en/code/download/44099/test.mq5 "test.mq5")
    (3 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/44099.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This code is a risk management strategy for an Expert Advisor in MetaTrader that manages existing trades based on the input parameters. It focuses on closing trades when a profit or loss threshold is reached and employs a trailing stop loss to lock in profits as the trade moves in the trader's favor.

![](https://c.mql5.com/18/147/Annotation_2023-05-19_085804.png)

Here is a brief explanation of the code:

1. Necessary header files are included for trade and symbol information classes.
2. Input parameters are defined for risk percentage, profit percentage, and trailing stop points.
3. Global variables are declared for trade and symbol information objects.
4. The OnInit function initializes the symbol information object and checks for errors.
5. The OnDeinit function does nothing in this case.
6. The OnTick function is called every time a new tick is received, and it calls the CheckTrades function.
7. The CheckTrades function iterates through all open positions and checks if the position belongs to the current symbol. If it does, it calculates the current profit and determines whether the profit or loss thresholds have been reached. If either threshold is reached, it closes the position.
8. If neither threshold is reached, the code checks if the position type is a buy or sell order and updates the stop loss level with a trailing stop loss. If the new stop loss level is more favorable than the current stop loss level, the position is modified with the new stop loss level.

This code provides a simple risk management strategy to manage existing trades by adjusting the stop loss level dynamically based on a trailing stop loss and closing trades when profit or loss thresholds are reached.

**Last comments |
[Go to discussion](/en/forum/446408)**
(6)

![simoncveracity](https://c.mql5.com/avatar/avatar_na2.png "simoncveracity")

**[simoncveracity](/en/users/simoncveracity)**
|
26 May 2023 at 00:37

I'm super new here - first day, but for me this just doesn't work in MetaTrader5 (on Mac, anyway). I'm a software engineer so have tried to work out why - and I found the *symbolInfo.Bid()* returns 0.0.

It turns out the correct fix (for me at least) is to use:

```mql5
MqlTick tick;
if (SymbolInfoTick(_Symbol, tick))
{
   Print("Bid =", tick.bid, "Ask =", tick.ask);
}
```

... which does output the correct bid price, then the code starts working. Full updating working code is here (in case anyone is interested)...

![Hich Laaraj](https://c.mql5.com/avatar/avatar_na2.png "Hich Laaraj")

**[Hich Laaraj](/en/users/hlaaraj)**
|
4 Jun 2023 at 12:32

**simoncveracity [#](/en/forum/446408#comment_47114379):**  

I'm super new here - first day, but for me this just doesn't work in MetaTrader5 (on Mac, anyway). I'm a software engineer so have tried to work out why - and I found the *symbolInfo.Bid()* returns 0.0.

It turns out the correct fix (for me at least) is to use:

... which does output the correct bid price, then the code starts working. Full updating working code is here (in case anyone is interested)...

same probleme for me.  
here is my fix :

```mql5
   double ask = SymbolInfoDouble(_Symbol, SYMBOL_ASK);
   double bid = SymbolInfoDouble(_Symbol, SYMBOL_BID);
```

![madumetja samuel](https://c.mql5.com/avatar/2021/7/60FAA282-8079.jpg "madumetja samuel")

**[madumetja samuel](/en/users/madumetjasamuel)**
|
16 Jan 2024 at 13:34

SFX

![Jason](https://c.mql5.com/avatar/2023/10/6528BA1C-7CC4.png "Jason")

**[Jason](/en/users/95jason)**
|
11 Mar 2024 at 07:37

Hello, this EA is great, but it seems wrong. No matter how the parameters are set, the position will be closed as soon as there is an order. Please correct it, thank you!

![Michael Charles Schefe](https://c.mql5.com/avatar/2021/5/60ADC6A5-6810.gif "Michael Charles Schefe")

**[Michael Charles Schefe](/en/users/ausimike)**
|
22 Mar 2024 at 19:51

**Jason [#](/en/forum/446408#comment_52680347):**  
 Hello, this EA is great, but it seems wrong. No matter how the parameters are set, the position will be closed as soon as there is an order. Please correct it, thank you!

did you make the changes described in the messages earlier?

![Expert Advisor for Opening Multiple Buy and Sell Orders Based on User Input](https://c.mql5.com/i/code/expert.png)
[Expert Advisor for Opening Multiple Buy and Sell Orders Based on User Input](/en/code/44079)

This MT5 Expert Advisor opens multiple buy and sell orders based on user input, featuring a simple interface with Buy and Sell buttons. The EA calculates lot size, checks the spread against slippage, and places orders accordingly. It is essential to test this EA in a demo account before using it in live trading.

![VPS Trailing Stop Service](https://c.mql5.com/i/code/services.png)
[VPS Trailing Stop Service](/en/code/44071)

VPS Trailing Stop Service

![Equity and Balance as an indicator for MT5](https://c.mql5.com/i/code/indicator.png)
[Equity and Balance as an indicator for MT5](/en/code/44136)

This is a very easy-to-use indicator that displays the changes in Equity and balance of the trading account as it dynamically moves.
Particularly useful on the back tester and good for beginners to read this very easy MQL5 code.

![Martingale Levels For Money Management](https://c.mql5.com/i/code/expert.png)
[Martingale Levels For Money Management](/en/code/44558)

To use martingale money management when a position is in loss and price hits any of specific distances.