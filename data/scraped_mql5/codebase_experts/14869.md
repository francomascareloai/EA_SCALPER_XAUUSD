# 1 Click To Close All Open Positions at Current Attached Chart - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/14869

MetaTrader 4 /
Experts

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

# 1 Click To Close All Open Positions at Current Attached Chart - expert for MetaTrader 4

[grandaevus](/en/users/grandaevus)

21771

(30)

Click **"Close All"** button to close all your open positions at current attached chart.

Select CloseOnlyManualTrades = **true** to close only manual trades.

Select CloseOnlyManualTrades = **false** to close manual trades and/or other trades opened by an Expert Advisor.

This new version **doesn't contain** the code written below that previous versions had which may cause an infinite loop .

```mql5
if(checkOrderClose==false) continue;
```

but instead brings **an error control system** to prevent an infinite loop while still closing all trades.

```mql5
if(checkOrderClose == false)
         {
         int errorCode = GetLastError();
         
         if (errorCode == 1 || errorCode == 2 || errorCode == 5 || errorCode == 6 || errorCode == 64 || errorCode == 65 || errorCode == 132 || errorCode == 133 || errorCode == 139) break;
         else continue;        
         } 
```

![](https://c.mql5.com/18/46/Screenshot_from_2016-02-18_20-12-08__1.png)

grandaevus:

Here's my answers  1)  When trading disabled on client side you can't run an expert advisor so you don't have to worry 2)  High slippage due to high volatility, news. Well, this expert advisor closes your orders with OrderClosePrice() which means no matter what the bid/ask price is,  I can assure you all your orders will be closed. 3) .....? Me too.

Alain Verleyen:

Forum on trading, automated trading systems and testing trading strategies Experts: 1 Click To Close All Open Positions Alain Verleyen , 2016.03.19 17:40 That's fine...if you don't want to listen, don't listen, if you don't want to learn, don't learn. Stuart said it very nicely "In coding, you can't think in terms of "it will never happen". W hen using your code for your self, and you don't have problem to restart MT4 to fix an issue, it's ok. W hen you post code publicly, you have a responsibility, at least it's how I am seeing things. My conclusion to everyone. Don't use this code on a real account , it could lead to undesirable issues.

grandaevus:

Forum on trading, automated trading systems and testing trading strategies Experts: 1 Click To Close All Open Positions grandaevus , 2016.03.19 18:01 To whom it may concern, Those who're afraid of an infinite loop,  Just delete this sentence from the code

grandaevus:

Forum on trading, automated trading systems and testing trading strategies Experts: 1 Click To Close All Open Positions grandaevus , 2016.03.22 05:20 Code has been fixed and sent to be published. This new version  doesn't contain  the code written below that previous versions had which may cause an infinite loop .

juno yong:

hi, do you know how to edit the code make this EA can immediately close all trade instead of close 1 by 1 ?

[Read more comments and leave your own ones >>](/en/forum/74212)