# Schaff Trend Cycle - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/486

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/486) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Schaff Trend Cycle - indicator for MetaTrader 5

Doug Schaff  |
[English](javascript:void(false);)

[Русский](/ru/code/486) [中文](/zh/code/486) [Español](/es/code/486) [Deutsch](/de/code/486) [日本語](/ja/code/486) [Português](/pt/code/486) [한국어](/ko/code/486) [Français](/fr/code/486) [Italiano](/it/code/486) [Türkçe](/tr/code/486)

Published by:
:   [Nikolay Kositsin](/en/users/godzilla)

Views:
:   26305

Rating:
:   (31)

Published:
:   19 October 2011, 17:09

Updated:
:   29 March 2023, 13:43
:   \MQL5\Include\

    [smoothalgorithms.mqh](/en/code/download/486/smoothalgorithms.mqh "smoothalgorithms.mqh")
    (133.8 KB)
    [view](# "view")

    [schafftrendcycle.mq5](/en/code/download/486/schafftrendcycle.mq5 "schafftrendcycle.mq5")
    (9.96 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/486.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Real author:**

Doug Schaff

Schaff Trend Cycle indicator is a cyclical oscillator created by calculating the [Stochastic](https://www.metatrader5.com/en/terminal/help/indicators/oscillators/so "https://www.metatrader5.com/en/terminal/help/indicators/oscillators/so") over [MАСD](https://www.metatrader5.com/en/terminal/help/indicators/oscillators/macd "https://www.metatrader5.com/en/terminal/help/indicators/oscillators/macd") line using cycles. As a result, the developers managed to achieve more stable and reliable results of the indicator script operation. A chart is almost unaffected by the short-term trends that inevitably emerge on the market. But the indicator generates an appropriate alert in case of some sharp changes of the market situation.

The author of the Schaff Trend Cycle indicator is Doug Schaff, the economist, whose observations of trading results on financial markets allowed him to develop and mathematically prove that currency trends almost never behave spontaneously. As time passes, the trend direction reverts to the basic one and the cycle of its ascending and descending starts to repeat, i.e. there is some periodicity. And the reliability of the market indicator/oscillator can be considerably increased, in case this periodicity is considered. This theory was confirmed in 2008 after mass researches had been conducted. After that Doug Schaff's mathematical model was used in the development of the new Schaff Trend Cycle indicator.

Aside from trends periodicity consideration, combination of two different methods of trends direction changes calculation was used to improve reliability of the Schaff Trend Cycle indicator and lessen the quantity of its false activations. These methods are smoothed stochastic oscillator and MACD.

For illustration purposes the indicator's operational field is graduated in standard units ranged from 0 up to 100. Two trigger levels are used — 25 and 75.

The following parameters are used as input ones for the Schaff Trend Cycle indicator setting:

* MAShort that is equal to 23 by default. This parameter indicates the value of the fast moving average period during MACD line calculation. It must be considered during its correction that its value must not be lower than MALong parameter value;
* MALong parameter has the default value equal to 50. It sets the value of the slow moving average period for MACD line chart calculation. It must always exceed the value of the MAShort parameter to provide normal operation of the indicator;
* Cycle (by default = 10). This parameter sets the length of a cycle in a chart periods. The resulting cycle is twice as long because two stochastics are calculated consequentially.

The simplest method of Forex trading using the Schaff Trend Cycle indicator is to sell the currency when the indicator line goes down past the level 80 and to buy it when the indicator line goes up past the level 20. To minimize the quantity of false signals, Doug Schaff suggested to trace the following models of a chart behaviour. For a buy signal, the bar following the trigger bar should close above the high of the trigger bar. For a sell signal, the bar following the trigger bar should close below the low of the trigger bar. Trigger bar is the bar formed above the signal lines with levels 20 or 80.

The presented variant of this popular indicator allows to select the smoothing algorithm out of ten possible variants:

1. [SMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") - simple moving average;
2. [EMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") - exponential moving average;
3. [SMMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") - smoothed moving average;
4. [LWMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ma") - linear weighted moving average;
5. [JJMA](/en/code/427) - JMA adaptive average;
6. [JurX](/en/code/436) - ultralinear smoothing;
7. [ParMA](/en/code/433) - parabolic smoothing;
8. [T3](/en/code/424) - Tillson's multiple exponential smoothing;
9. [VIDYA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/vida "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/vida") - smoothing with the use of Tushar Chande's algorithm;
10. [AMA](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ama "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/ama") - smoothing with the use of Perry Kaufman's algorithm.

It should be noted that Phase parameter has completely different meaning for different smoothing algorithms.

* For JMA it is an external Phase variable changing from -100 to +100.
* For T3 it is a smoothing ratio multiplied by 100 for better visualization;
* For VIDYA it is a CMO period, for AMA it is a slow EMA period;
* For AMA fast EMA period is a fixed value and is equal to 2 by default. The ratio of raising to the power is also equal to 2 for AMA.

The indicator uses SmoothAlgorithms.mqh library classes (must be copied to the **terminal\_data\_folder**\MQL5\Include). The use of the classes was thoroughly described in the article ["Averaging Price Series for Intermediate Calculations Without Using Additional Buffers"](/en/articles/180).

![Schaff Trend Cycle](https://c.mql5.com/18/4/SchaffTrendCycle__1.png "Schaff Trend Cycle")

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/486](/ru/code/486)

**Last comments |
[Go to discussion](/en/forum/4971)**
(12)

![Dr Matthias Hammelsbeck](https://c.mql5.com/avatar/2019/1/5C4C7BAA-35CB.jpg "Dr Matthias Hammelsbeck")

**[Dr Matthias Hammelsbeck](/en/users/bobcat)**
|
27 Jul 2014 at 21:53

Hi,

I have downloaded the 2 files schafftrendcycle.mq5 and smootalgorithms.mqh and tried to compile them.

I get some warnings:

 "[check](https://www.mql5.com/en/docs/common/GetTickCount64 "MQL5 Documentation: GetTickCount64 function") operator precedence for possible error; use parentheses to clarify precedence"   in Line 3137

and similar warnings inside the procedures BarCheck2 to BarCheck5.

To put things better I added a lot of parentheses in the if-Expressions in the procedures BarCheck1 to BarCheck5:

```mql5
//+------------------------------------------------------------------+
//| Checking if a bar is within the calculation range                |
//+------------------------------------------------------------------+
bool CMovSeriesTools::BarCheck1(int begin,int bar,bool Set)
// BarCheck1(begin, bar, Set)
  {
//----
   //if(!Set && bar<begin || Set && bar>begin) return(true);
   // Bobcat
   if(((!Set) && (bar<begin)) || (Set && (bar>begin))) return(true);
//----
   return(false);
  }
//+------------------------------------------------------------------+
//| Checking the bar for the calculation start                       |
//+------------------------------------------------------------------+
bool CMovSeriesTools::BarCheck2(int begin,int bar,bool Set,int Length)
// BarCheck2(begin, bar, Set, Length)
  {
//----
   //if(!Set && bar==begin+Length-1 || Set && bar==begin-Length+1)
   // Bobcat
   if(((!Set) && (bar==(begin+Length-1))) || (Set && (bar==(begin-Length+1))))
      return(true);
//----
   return(false);
  }
//+------------------------------------------------------------------+
//| Checking the bar for absence of bars for smoothing               |
//+------------------------------------------------------------------+
bool CMovSeriesTools::BarCheck3(int begin,int bar,bool Set,int Length)

// BarCheck3(begin, bar, Set, Length)
  {
//----
   //if(!Set && bar<begin+Length-1 || Set && bar>begin-Length+1)
   // Bobcat
   if(((!Set) && (bar<(begin+Length-1))) || (Set && (bar>(begin-Length+1))))
      return(true);
//----
   return(false);
  }
//+------------------------------------------------------------------+
//| Checking the bar at the moment of the data saving                |
//+------------------------------------------------------------------+
bool CMovSeriesTools::BarCheck4(int rates_total,int bar,bool Set)
// BarCheck4(rates_total, bar, Set)
  {
//----
//---- Saving the values of the variables
   //if(!Set && bar==rates_total-2 || Set && bar==1) return(true);
   // Bobcat
   if(((!Set) && (bar==(rates_total-2))) || (Set && (bar==1))) return(true);
//----
   return(false);
  }
//+------------------------------------------------------------------+
//| Checking the bar at the moment of the data restoring             |
//+------------------------------------------------------------------+
bool CMovSeriesTools::BarCheck5(int rates_total,int bar,bool Set)
// BarCheck5(rates_total, begin, bar, set)
  {
//----
//---- Restoring the values of the variables
   //if(!Set && bar==rates_total-1 || Set && bar==0) return(true);
   // Bobcat
   if(((!Set) && (bar==(rates_total-1))) || (Set && (bar==0))) return(true);
//----
   return(false);
  }
```

Is this correct??? I hope so.

 Another warning arises in line 742 in procedure bPriceSeries:

"cannot be used for static allocated array"

I removed the statement  "ArraySetAsSeries(series,true);". I think this is not necessary since the array size of series is only one.

Is this correct and in your intention?

Bobcat

![Victor Ziborov](https://c.mql5.com/avatar/2017/9/59B9108F-ACAC.png "Victor Ziborov")

**[Victor Ziborov](/en/users/ziborov)**
|
30 Jun 2017 at 21:17

It is not very clear to me, or rather not clear at all, how to trade using this indicator. Is it an indicator? The second line of the description says"I managed to achieve more stable and reliable results of the script". But that's fine. How canthis Schaff Trend Cycle be useful?

![amin514](https://c.mql5.com/avatar/avatar_na2.png "amin514")

**[amin514](/en/users/amin514)**
|
13 Oct 2018 at 11:44

Hi,

when i compile the indicator this error appears:

'MODE\_EMA' - cannot convert enum    schafftrendcycle.mq5    92    32

what can i do?

![Aleksander Gladkov](https://c.mql5.com/avatar/2017/9/59B3C417-FC27.jpg "Aleksander Gladkov")

**[Aleksander Gladkov](/en/users/alex_mt4)**
|
1 Nov 2019 at 09:13

There are two errors:

1. file \MQL5\Include\SmoothAlgorithms.mqh

...........

enum Smooth\_Method  
 {  
 MODE\_SMA\_, //SMA  
 MODE\_EMA\_, //EMA  
 MODE\_SMMA\_, //SMMA   
 MODE\_LWMA\_, //LWMA  
 MODE\_JJMA, //JJMA  
 MODE\_JurX, //JurX   
 MODE\_ParMA, //ParMA  
 MODE\_T3, //T3  
 MODE\_VIDYA, //VIDYA   
 MODE\_AMA //AMA  
 };  
//+------------------------------------------------------------------+  
//| Universal smoothing algorithm|   
//+------------------------------------------------------------------+  
 class CXMA  
 {  
 public:  
<the Smooth\_Method declaration has been moved outside the class>

.....

2. MQL5\Indicators\486\schafftrendcycle.mq5

//+-----------------------------------+  
//| Indicator input parameters |

//+-----------------------------------+

was :

input Smooth\_Method MA\_SMethod=MODE\_EMA; //Histogram [smoothing method](https://www.mql5.com/en/docs/constants/indicatorconstants/enum_ma_method "MQL5 documentation: Smoothing Methods")

should:

input Smooth\_Method MA\_SMethod=MODE\_EMA\_; //Histogram smoothing method

If this is corrected, the indicator is compiled and displayed on the chart.

Thank you.

![stason22 Колесников Станислав](https://c.mql5.com/avatar/avatar_na2.png "stason22 Колесников Станислав")

**[stason22 Колесников Станислав](/en/users/stason22)**
|
30 Jan 2022 at 07:54

input Smooth\_Method MA\_SMethod=MODE\_EMA\_; //Histogram [smoothing method](https://www.mql5.com/en/docs/constants/indicatorconstants/enum_ma_method "MQL5 documentation: Smoothing Methods")

It doesn't compile. Who has a working version? Send it to me in private

![ASCtrend](https://c.mql5.com/i/code/indicator.png)
[ASCtrend](/en/code/491)

The indicator generates signals for entering the market.

![3LineBreak](https://c.mql5.com/i/code/indicator.png)
[3LineBreak](/en/code/485)

The indicator that paints the bars in blue for a bullish trend and in red for a bearish one.

![iSimpleClock](https://c.mql5.com/i/code/indicator.png)
[iSimpleClock](/en/code/590)

This indicator shows the simple clock in comment.

![Stalin](https://c.mql5.com/i/code/indicator.png)
[Stalin](/en/code/487)

Stalin is one of the so-called «signal» indicators, as it provides a trader with accurate market entry points.