# 2 MA Crossing - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/34176

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/34176) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# 2 MA Crossing - expert for MetaTrader 4

[Yulianto Hiu](/en/users/signalforex.id)

Views:
:   16610

Rating:
:   (32)

Published:
:   30 March 2021, 10:18

Updated:
:   30 March 2021, 10:20
:   [MACross.mq4](/en/code/download/34176/macross.mq4 "MACross.mq4")
    (6.57 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/34176.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

We will start creating this EA by defining the input variables.

```mql5
//--- input parameters
input    int      period_ma_fast = 8;  //Period Fast MA
input    int      period_ma_slow = 20; //Period Slow MA

input    double   takeProfit  = 20.0;  //Take Profit (pips)
input    double   stopLoss    = 20.0;  //Stop Loss (pips)

input    double   lotSize     = 0.10;  //Lot Size
input    double   minEquity   = 100.0; //Min. Equity ($)

input    int Slippage = 3;       //Slippage
input    int MagicNumber = 889;  //Magic Number
```

followed by defining global variables. variables with this global scope will be known or accessible to all functions.

```mql5
//Variabel Global
double   myPoint    = 0.0;
int      mySlippage = 0;
int      BuyTicket   = 0;
int      SellTicket  = 0;
```

When EA is executed, the first function that is executed is OnInit (). So that we often use this function to validate and initialize global variables that will be used.

```mql5
int OnInit()
{
   //validasi input, sebaiknya kita selalu melakukan validasi pada initialisasi data input
   if (period_ma_fast >= period_ma_slow || takeProfit < 0.0 || stopLoss < 0.0 || lotSize < 0.01 || minEquity < 10){
      Alert("WARNING - Input data inisial tidak valid");
      return (INIT_PARAMETERS_INCORRECT);
   }
   
   double min_volume=SymbolInfoDouble(Symbol(),SYMBOL_VOLUME_MIN);
   if(lotSize<min_volume)
   {
      string pesan =StringFormat("Volume lebih kecil dari batas yang dibolehkan yaitu %.2f",min_volume);
      Alert (pesan);
      return(INIT_PARAMETERS_INCORRECT);
   }
   
   myPoint = GetPipPoint(Symbol());
   mySlippage = GetSlippage(Symbol(),Slippage);

   return(INIT_SUCCEEDED);
}
```

When the market price moves (tick), the OnTick () function will be called and execute all instructions / functions contained in this OnTick () function block.

Inside the OnTick () function will call various other functions.

Starting to call the checkMinEquity () function to control the adequacy of trading equity. If the equity funds are sufficient (exceeding the minimum equity), it will be followed by a signal variable declaration and followed by a call to the NewCandle () function which functions to inform when a new candle is formed.

The getSignal () function will read the values on both moving average indicators and return signal information whether an upward or downward cross occurs as a signal for a buy / sell signal.

Based on this signal information, it will be forwarded to the transaction () function to set open buy or sell positions.

And it will be continued by calling the setTPSL () function which functions to set the take profit and stop loss prices.  
  
If equity does not meet the minimum equity requirement, an alert will be displayed and this EA will be terminated.

```mql5
void OnTick()
{
   if (cekMinEquity()){
      
      
      int signal = -1;
      bool isNewCandle = NewCandle(Period(), Symbol());
      
      signal = getSignal(isNewCandle);
      transaction(isNewCandle, signal);
      setTPSL();
      
      
   }else{
      //Stop trading, karena equity tidak cukup
      Print("EA akan segera diberhentikan karena equity tidak mencukup");
   }
}
```

Function to setTPSL()

```mql5

void setTPSL(){
   int   tOrder = 0;
   string   strMN = "", pair = "";
   double sl = 0.0, tp = 0.0;
   
   pair = Symbol();
   
   tOrder = OrdersTotal();
   for (int i=tOrder-1; i>=0; i--){
      bool hrsSelect = OrderSelect(i, SELECT_BY_POS, MODE_TRADES);
      strMN = IntegerToString(OrderMagicNumber());
      if (StringFind(strMN, IntegerToString(MagicNumber), 0) == 0 && StringFind(OrderSymbol(), pair, 0) == 0 ){
         if (OrderType() == OP_BUY && (OrderTakeProfit() == 0 || OrderStopLoss() == 0) ){
            if (takeProfit > 0) {
               tp = OrderOpenPrice() + (takeProfit * myPoint);
            }else{
               tp = OrderOpenPrice();
            }
            if (stopLoss > 0) {
               sl = OrderOpenPrice() - (stopLoss * myPoint);
            }else{
               sl = OrderStopLoss();
            }
            if (OrderTakeProfit() != tp || OrderStopLoss() != sl ){
               if(OrderModify(OrderTicket(), OrderOpenPrice(), sl, tp, 0, clrBlue)){
                  Print ("OrderModify Successful");
               }
            }
         }
         if (OrderType() == OP_SELL && (OrderTakeProfit() == 0 || OrderStopLoss() == 0) ){
            if (takeProfit > 0) {
               tp = OrderOpenPrice() - (takeProfit * myPoint);
            }else{
               tp = OrderOpenPrice();
            }
            if (stopLoss > 0) {
               sl = OrderOpenPrice() + (stopLoss * myPoint);
            }else{
               sl = OrderStopLoss();
            }
            if (OrderTakeProfit() != tp || OrderStopLoss() != sl ){
               if (OrderModify(OrderTicket(), OrderOpenPrice(), sl, tp, 0, clrRed)){
                  Print ("OrderModify Successful");
               }
            }
         }
         
      }//end if magic number && pair
      
   }//end for
}
```

for education and sharing in Indonesian, please join us in the telegram group [t.me/codeMQL](/go?link=https://t.me/codeMQL "https://t.me/codeMQL")

If you are looking for an App to support your trading, please download our SignalForex app in the play store

[https://play.google.com/store/apps/details?id=com.autobotfx.signalforex](/go?link=https://play.google.com/store/apps/details?id=com.autobotfx.signalforex "https://play.google.com/store/apps/details?id=com.autobotfx.signalforex")

**Last comments |
[Go to discussion](/en/forum/366105)**
(1)

![Xiong Wu Ceng](https://c.mql5.com/avatar/avatar_na2.png "Xiong Wu Ceng")

**[Xiong Wu Ceng](/en/users/13528892059)**
|
25 Sep 2022 at 08:51

Thank you very much for this article, I would like to ask, I set a stop loss of 100 points and a [take profit](https://www.mql5.com/en/articles/7113 "Article: Scratching Profits to the Last Pip ") of 300 points, but during the test, the EA did not stop loss when it lost 100 points, and did not take profit when it made a profit of 300 points, why? ?

![EA - The Simple Trading Panel - MT4](https://c.mql5.com/i/code/expert.png)
[EA - The Simple Trading Panel - MT4](/en/code/34066)

The simple trading panel is a trading tool that is very interesting because it will allow you to predefine your StopLoss and your TakeProfit in term of pips.

![Pivot_Points_Lines_v1.3 MT4](https://c.mql5.com/i/code/indicator.png)
[Pivot\_Points\_Lines\_v1.3 MT4](/en/code/34062)

Draws Pivot Points Formulas

![Trailing Stop with MagicNumber](https://c.mql5.com/i/code/expert.png)
[Trailing Stop with MagicNumber](/en/code/34177)

Add on tool to support our trading by shifting stoploss (SL) to the profit area

![Close Orders By Target or Cut Loss](https://c.mql5.com/i/code/expert.png)
[Close Orders By Target or Cut Loss](/en/code/34194)

This EA is used as a trading tool to help us close all orders with a specific target in the form of money or cut loss.
We can filter orders by magic number.