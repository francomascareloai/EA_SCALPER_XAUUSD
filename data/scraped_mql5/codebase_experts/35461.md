# OnTester Commission Calculator - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/35461

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/35461) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# OnTester Commission Calculator - expert for MetaTrader 5

[Dark Ryd3r](/en/users/darkryd3r)

Views:
:   5485

Rating:
:   (29)

Published:
:   30 June 2021, 05:21

Updated:
:   30 June 2021, 14:08
:   [Commission\_Calculator.mq5](/en/code/download/35461/commission_calculator.mq5 "Commission_Calculator.mq5")
    (14.28 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/35461.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Update :**  *Now it also calculates the commission on "end of test" result on Tester*

[![](https://c.mql5.com/18/98/4762831643683__1.png)](https://c.mql5.com/18/98/4762831643683.png "https://c.mql5.com/18/98/4762831643683.png")

I was testing my Expert Advisor while i found that i have to calculate commission charged by my broker as well otherwise the profit shown by strategy could not be true, So i tried to use in built commission feature on Metatrader5 but this did not work!

[https://www.mql5.com/en/forum/372056](/en/forum/372056)

So i decided to code this feature externally.

This code can be used in your own expert advisor to calculate the commission (you may need to know programming)

This EA works for testing Market Order, Limit Order, Stop Limit Order and Stop Market Order and same can be selected from SelectMode Input

Fee in percentage can be added. Like my broker charges 0.04% commission so i added there

After adding Entry, SL and TP you can run this EA on strategy tester

[![](https://c.mql5.com/18/98/2593136019336__1.png)](https://c.mql5.com/18/98/2593136019336.png "https://c.mql5.com/18/98/2593136019336.png")

[![](https://c.mql5.com/18/98/5680721602631__1.png)](https://c.mql5.com/18/98/5680721602631.png "https://c.mql5.com/18/98/5680721602631.png")

On testing you can see i have total 4 deals executed

[![](https://c.mql5.com/18/98/1659965762852__1.png)](https://c.mql5.com/18/98/1659965762852.png "https://c.mql5.com/18/98/1659965762852.png")

For each deal, the commission should be calculated that is set on input : 0.04%

Lets test in on excel

![](https://c.mql5.com/18/98/4142216678492.png)

As you can see for 0.1 qty its 1.2546 for Limit Buy Order and 1.284 for Take Profit Order

so summing up 1.2546 + 1.284 = 2.5386

and total trades are 2

so 2.5386 \*2 = 5.0772

so at the end of Strategy Tester Report in Journal Tab, the Total Commission is Printed

[![](https://c.mql5.com/18/98/445923205590__1.png)](https://c.mql5.com/18/98/445923205590.png "https://c.mql5.com/18/98/445923205590.png")

I hope this calculation method will help you testing your EA with more accurate profit when it excludes commissions which your broker charges

**[Go to discussion](/en/forum/372305)**

![Momentum-based Adaptive Channel](https://c.mql5.com/i/code/indicator.png)
[Momentum-based Adaptive Channel](/en/code/34277)

The Momentum-based Adaptive Channel is a version of the adaptive channel based on the Euclidean distance. It is designed to adapt according to the dynamic market as needed.

![String Manipulation Functions](https://c.mql5.com/i/code/library.png)
[String Manipulation Functions](/en/code/35395)

A collection of useful string manipulation functions.

![The Enhanced Signal To Noise Ratio](https://c.mql5.com/i/code/indicator.png)
[The Enhanced Signal To Noise Ratio](/en/code/35472)

"The Enhanced Signal To Noise Ratio" was created by John Ehlers and published in the book "Rocket Science for Traders", pg.87-88.

![time bomb](https://c.mql5.com/i/code/expert.png)
[time bomb](/en/code/35479)

pips in time