# Exp_ATR_Trailing - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/1016

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/1016) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Exp\_ATR\_Trailing - expert for MetaTrader 5

[Nikolay Kositsin](/en/users/godzilla)  |
[English](javascript:void(false);)

[Русский](/ru/code/1016) [中文](/zh/code/1016) [Español](/es/code/1016) [Deutsch](/de/code/1016) [日本語](/ja/code/1016) [Português](/pt/code/1016)

Views:
:   8528

Rating:
:   (21)

Published:
:   10 October 2012, 13:00

Updated:
:   22 November 2016, 07:32
:   \MQL5\Indicators\

    [atr\_trailing.mq5](/en/code/download/1016/atr_trailing.mq5 "atr_trailing.mq5")
    (6.08 KB)
    [view](# "view")

    [exp\_atr\_trailing.mq5](/en/code/download/1016/exp_atr_trailing.mq5 "exp_atr_trailing.mq5")
    (18.04 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/1016.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The Expert Advisor moves Stop Loss of the open position along the border of the channel built using ATR\_Trailing. Stop Loss is modified only when the bar is changed based on the newly closed bar's data in case Stop Loss will be eventually pinned to the current price.

The Expert Advisor provides a possibility to display the indicator used in it on the current chart directly from the Expert Advisor. There is no need to install the indicator on the chart manually. This is quite convenient, as the indicator is displayed on the chart automatically after the Expert Advisor is installed on the chart. This indicator always has input parameters identical to the Expert Advisor's ones.

Below is the code allowing users to implement such a feature:

```mql5
//+------------------------------------------------------------------+
//| Inclusion of CChart class in expert                              |
//+------------------------------------------------------------------+
#include <Charts\Chart.mqh>
//---- declaration of a global variable as CChart type
CChart cchart;
//+------------------------------------------------------------------+
//| Expert initialization function                                   |
//+------------------------------------------------------------------+
int OnInit()
  {
//---- getting handle of the ATR_Trailing indicator
   InpInd_Handle=iCustom(Symbol(),PERIOD_CURRENT,"ATR_Trailing",Period_ATR,Sell_Factor,Buy_Factor);
   if(InpInd_Handle==INVALID_HANDLE) Print(" Failed to get handle of ATR_Trailing indicator");

//--- resetting error code to zero
   ResetLastError();

//--- cchart object works with the current chart (ID=0) , the expert is attached to
   cchart.Attach(0);

//---- adding of ATR_Trailing indicator on the chart  
   if(!cchart.IndicatorAdd(0,InpInd_Handle)) Print(" Failed to add ATR_Trailing indicator on the chart");
```

### Expert Advisor input parameters:

```mql5
//+----------------------------------------------+
//| Expert Advisor input parameters              |
//+----------------------------------------------+
input int Period_ATR=14;  //АТR period
input double Sell_Factor=2.0;
input double Buy_Factor=2.0;
input uint Deviation=10;  //slippage
```

### Image:

![Exp_ATR_Trailing working chart](https://c.mql5.com/18/7/Exp_ATR_Trailing.png "Exp_ATR_Trailing working chart")

Exp\_ATR\_Trailing working chart

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/1016](/ru/code/1016)

**Last comments |
[Go to discussion](/en/forum/8223)**
(1)

![tungus](https://c.mql5.com/avatar/avatar_na2.png "tungus")

**[tungus](/en/users/tungus)**
|
4 Oct 2013 at 10:21

Can you tell me why the EA is not working?

![i-AnyRange2](https://c.mql5.com/i/code/indicator.png)
[i-AnyRange2](/en/code/1015)

The indicator of two unspecified time intervals.

![TimeSeries - Function Library for Working with Time Series](https://c.mql5.com/i/code/library.png)
[TimeSeries - Function Library for Working with Time Series](/en/code/1008)

Function Library for Working with Time Series: iTime, iOpen, iHigh, iLow, iClose, iHighest, iLowest, iBarshift. Short invocation version is available for all functions (with the current chart's symbol and period).

![PositionInfo](https://c.mql5.com/i/code/indicator.png)
[PositionInfo](/en/code/1017)

The simple indicator for displaying some relevant information about a position right in the chart window.

![ColorStochastic_HTF](https://c.mql5.com/i/code/indicator.png)
[ColorStochastic\_HTF](/en/code/1020)

Standard Stochastic oscillator displayed as a cloud that can be located by setting the indicator timeframe value different from the chart one.