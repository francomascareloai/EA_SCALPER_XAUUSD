# Previous Candle Breakdown 2 - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/21983

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/21983) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Previous Candle Breakdown 2 - expert for MetaTrader 5

[Vladimir Karputov](/en/users/barabashkakvn)  |
[English](javascript:void(false);)

[Русский](/ru/code/21983) [中文](/zh/code/21983) [Español](/es/code/21983) [Deutsch](/de/code/21983) [日本語](/ja/code/21983) [Português](/pt/code/21983)

Views:
:   6217

Rating:
:   (17)

Published:
:   25 October 2018, 15:51
:   [Previous Candle Breakdown 2.mq5](/en/code/download/21983/previous_candle_breakdown_2.mq5 "Previous Candle Breakdown 2.mq5")
    (53.24 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/21983.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This EA is a further development of the first [Previous Candle Breakdown](/en/code/20879) version

Added the parameters

* Start time (hour) - operation start hour
* Start time (minute) - operation start minute
* End time (hour) - operation end hour
* End time (hour) - operation end minute

Besides, trailing now works at each tick.

The EA waits for breaking down any timframe from 1 minute through 1 month. Bar #1 is checked for breakdown at a specified timeframe **Breakdown previous candle**. It is also possible to enable two filters - Moving Average.

NOTE! For the filters to operate, it is necessary that averaging periods **Fast: av. period** and **Slow: av. period** are above zero.

In the EA, trailing is implemented that (at the first modification of the Stop Loss level) moves Stop Loss to breakeven.

Position size can be both permanent (**Lots** above zero and **Risk** is equal to zero) and dynamically calculated in the risk percents per trade (**Risk** above zero and **Lots** is equal to zero).

NOTE! No situations may be allowed, where:

* Both "Lots" and "Risk" are above zero;
* both "Lots" and "Risk" are equal to zero.

Upon reaching the target profit **Close all positions when profit is achieved**, all positions will be closed. The EA ensures that no more than one position in each direction is opened at the specified timeframe **Previous Candle Breakdown**.

![Breakdown Previous Candle](https://c.mql5.com/18/72/Breakdown_Previous_Candle.png "Breakdown Previous Candle")

Fig. 1. Current timeframe: M15, breakdown is set to H4

### Inputs

* **Previous Candle Breakdown** - timeframe of the candlestick to be broken down;
* **Indent from High or Low** - indent from High and Low of the broken-down candlestick;
* **Fast: av. period** - Moving Average "Fast": Averaging period; if it is set to zero, the filter from indicators "Fast" and "Slow" will not be used;
* **Fast: horizontal shift** - Moving Average "Fast": Horizontal shift of the indicator;
* **Fast: type of price** - Moving Average "Fast": Type of the price, on which the indicator is calculated;
* **Slow: av. period** - Moving Average "Slow": averaging period; if it is set to zero, the filter from indicators "Fast" and "Slow" will not be used;
* **Slow: horizontal shift** - Moving Average "Slow": horizontal shift of the indicator;
* **Slow: type of price** - Moving Average "Slow": type of the price, on which the indicator is calculated;
* **Fast and Slow: smoothing type** - averaging type (common for both "Fast" and "Slow");
* **Stop Loss** - stop loss;
* **Take Profit** - take profit;
* **Trailing Stop** - trailing (it works as breakeven at the first modification of Stop Loss);
* **Trailing Step** - trailing step;
* **Lots** - lot size is permanent (**Risk** must be set to zero);
* **Risk** - lot size is calculated dynamically in the risk percents per trade (**Lots** must be set to zero);
* **Maximum number of positions in one direction**;
* **Close all positions when profit is achieved**.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/21983](/ru/code/21983)

**Last comments |
[Go to discussion](/en/forum/285565)**
(10)

![alex123456](https://c.mql5.com/avatar/avatar_na2.png "alex123456")

**[alex123456](/en/users/alex123456)**
|
31 Aug 2018 at 14:50

If you write the third variant, it will be more flexible and perfect EA than it was. If you will improve this development, please take into account one more thing.

. In this type of accounts, when opening an opposite position, the old position is closed. In this Expert Advisor, for example, with an [open position](https://www.metatrader5.com/en/terminal/help/trading/performing_deals#position_manage "Help: Opening and closing positions in the MetaTrader 5 trading terminal") on buy 5 lots (5 lots are accumulated by adding one lot each time the conditions for buy appear), then with a position on sell closes not one lot but the entire position. so there would be 4 lots. . Price often reverses and these 4 lots can be recouped.

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
31 Aug 2018 at 16:02

**alex123456:**  

If you write the third variant, it will be more flexible and perfect EA than it was. If you will improve this development, please take into account one more point.

. In this type of accounts, when opening an opposite position, the old position is closed. In this Expert Advisor, for example, with an [open position](https://www.metatrader5.com/en/terminal/help/trading/performing_deals#position_manage "Help: Opening and closing positions in the MetaTrader 5 trading terminal") on buy 5 lots (5 lots are accumulated by adding one lot each time the conditions for buy appear), then with a position on sell closes not one lot but the entire position. so there would be 4 lots. . Price often reverses and these 4 lots can be recouped.

I don't take nettnings into account. By running my Expert Advisors on netting you act at your own risk.  

Hedge only. Only hardcore.

Added: I don't like to support two systems in one code - often the code can grow unnecessarily and become hard to read. Besides, I am not interested in nettnig on Forex, and netting on the stock exchange is not available to me. This is such a collision.

![alex123456](https://c.mql5.com/avatar/avatar_na2.png "alex123456")

**[alex123456](/en/users/alex123456)**
|
3 Sep 2018 at 05:58

Do not underestimate yourself, your programs work well on the stock exchange, at least on a demo account. Regarding netting accounts on Forex. Brokers with Russian jurisdiction in the majority have netting accounts, so the interest to them has reasons. If it is not difficult to implement your proposal - introduce a new parameter: the maximum total [volume of position](https://www.mql5.com/en/docs/constants/tradingconstants/positionproperties#enum_position_property_double "MQL5 Documentation: Position Properties") (or positions) opened by the Expert Advisor. Thank you.

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
3 Sep 2018 at 06:29

**alex123456:**  
 Do not underestimate yourself, your programs work well on the stock exchange, at least on a demo account. Regarding netting accounts on Forex. Brokers with Russian jurisdiction in the majority have netting accounts, so the interest to them has reasons. If it is not difficult to implement your proposal - introduce a new parameter: the maximum total [volume of position](/en/docs/constants/tradingconstants/positionproperties#enum_position_property_double "MQL5 Documentation: Position Properties") (or positions) opened by the Expert Advisor. Thank you.

I have already introduced it. Awaiting publication code [Previous Candle Breakdown 3](/en/code/22145/ "Previous Candle Breakdown 3")

![jasonliu199](https://c.mql5.com/avatar/avatar_na2.png "jasonliu199")

**[jasonliu199](/en/users/jasonliu199)**
|
17 Aug 2022 at 06:17

Available on MT4?

![Iin_MA_Signal_Candle](https://c.mql5.com/i/code/indicator.png)
[Iin\_MA\_Signal\_Candle](/en/code/21994)

Iin\_MA\_Signal indicator displaying the current trend using candles color

![Exp_TrendManager_Tm_Plus](https://c.mql5.com/i/code/expert.png)
[Exp\_TrendManager\_Tm\_Plus](/en/code/21998)

The trading system based on TrendManager indicator signals with the possibility to set a fixed position holding time

![Iin_MA_Signal_NRTR_HTF](https://c.mql5.com/i/code/indicator.png)
[Iin\_MA\_Signal\_NRTR\_HTF](/en/code/21981)

Iin\_MA\_Signal\_NRTR indicator with the timeframe selection option available in input parameters

![Exp_XCCI_Histogram_Vol_Direct](https://c.mql5.com/i/code/expert.png)
[Exp\_XCCI\_Histogram\_Vol\_Direct](/en/code/21980)

The trading system based on XCCI\_Histogram\_Vol\_Direct indicator signals