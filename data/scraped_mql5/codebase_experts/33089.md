# MQLUnit - Tiny Unit Tests Framework For Complex Expert Advisors - script for MetaTrader 5

Source: https://www.mql5.com/en/code/33089

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/33089) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Scripts](https://c.mql5.com/i/code/script.png)

# MQLUnit - Tiny Unit Tests Framework For Complex Expert Advisors - script for MetaTrader 5

Niklas Schlimm

Published by:
:   [Niklas Rolf Alexander Schlimm](/en/users/programminggeek)

Views:
:   7234

Rating:
:   (12)

Published:
:   18 January 2021, 18:55

Updated:
:   23 September 2021, 13:58
:   [MQLUnit.zip](/en/code/download/33089/mqlunit.zip "MQLUnit.zip")
    (438.08 KB)

    [MQLUnitTestAsserts.mqh](/en/code/download/33089/mqlunittestasserts.mqh "MQLUnitTestAsserts.mqh")
    (13.42 KB)
    [view](# "view")

    [MQLUnitTestLibrary.mqh](/en/code/download/33089/mqlunittestlibrary.mqh "MQLUnitTestLibrary.mqh")
    (2.15 KB)
    [view](# "view")

    [MQLUnitTestSuite.mqh](/en/code/download/33089/mqlunittestsuite.mqh "MQLUnitTestSuite.mqh")
    (16.3 KB)
    [view](# "view")

    [SimpleTestSuite.mq5](/en/code/download/33089/simpletestsuite.mq5 "SimpleTestSuite.mq5")
    (2.28 KB)
    [view](# "view")

    [SuiteTemplate.mq5](/en/code/download/33089/suitetemplate.mq5 "SuiteTemplate.mq5")
    (1.24 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/33089.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

As a Java developer for 20 years I am used to writing more complex programs using test driven development technique. When I started writing more complex expert advisors I was missing a solid framework that supports me in doing unit tests in MQL5. Therefore I have developed my own simple yet straight forward solution, MQLUnit was born. It simplifies the test writing so that it can be integrated in everyones development process. I recommend to use it as soon you develop a more complex MQL5 program. What does "more complex" mean exactly? Whenever your code exceeds a certain number of code lines, you usually create components to cope with complexity. When you have multiple components its time to seriously think about a good test strategy to ensure the quality of your code.

Feature list:

* Seperate setup, unit test and tear down functions
* Various test asserts
* Each test suite simply runs as Expert Advisor scripts in Strategy Tester
* Define exactly on which candle of the Strategy Tester chart each test case runs
* Visual feedback on failure and success (green and red chart)
* Immediate feedback as Strategy Tester chart comment during the test
* Test single functions and step through your code by adding break points
* Repeat the unit tests with specified same test data settings (Tools > Options > Debug/Profiling)

### Getting started

Download the zip file and export it either to your MQL5/Include directory or directly into your expert advisor project. MQLUnit is made up of some classes you can use when writing your unit tests. Users of MQLUnit create an instance of¬†**CUnitTestSuite**to compose and run their unit tests. The following snippet shows a simple test suite that executes a set-up function and a unit test.

```mql5
//+------------------------------------------------------------------+
//|¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†MQLUnit |
//|¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† Copyright 2021, Niklas Schlimm |
//|¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬† https://github.com/nschlimm/MQL5Unit |
//+------------------------------------------------------------------+
#property copyright "Copyright 2021, Niklas Schlimm"
#property version¬†¬† "1.00"

#include "MQLUnitTestLibrary.mqh"

int m_movingAverageHandle;

void OnInit() {
¬†¬† m_testSuite = ComposeTestsuite();
};

//+------------------------------------------------------------------+
//| Simple test example on moving average indicator
//+------------------------------------------------------------------+
CUnitTestSuite* ComposeTestsuite()
¬†¬†{
¬†¬† CUnitTestSuite* testSuite = new CUnitTestSuite();
¬†¬† testSuite.AddSetupFunction(1, Test_Indicators_copyBuffer_setup);
¬†¬† testSuite.AddUnitTestFunction(2,Test_Indicators_copyBuffer);
¬†¬† testSuite.AddTearDownFunction(3, Test_Indicators_copyBuffer_tearDown);
¬†¬† return testSuite;
¬†¬†}

//+------------------------------------------------------------------+
//| Setup method to initialize indicator
//+------------------------------------------------------------------+
void Test_Indicators_copyBuffer_setup()
¬†¬†{
// initialize indicator
¬†¬† m_movingAverageHandle=iMA(_Symbol, PERIOD_CURRENT,10,0,MODE_SMA,PRICE_CLOSE);
¬†¬†}

//+------------------------------------------------------------------+
//| Tear down and remove indicator
//+------------------------------------------------------------------+
void Test_Indicators_copyBuffer_tearDown()
¬†¬†{
// remove indicator
¬†¬† m_movingAverageHandle=NULL;
¬†¬†}

//+------------------------------------------------------------------+
//| Test on indicator
//+------------------------------------------------------------------+
CUnitTestAsserts* Test_Indicators_copyBuffer()
¬†¬†{
¬†¬† CUnitTestAsserts* ut = new CUnitTestAsserts("Test_Indicators_copyBuffer");
¬†¬† double movingAverageData[];
¬†¬† CopyBuffer(m_movingAverageHandle,0,1,10,movingAverageData);
¬†¬† // check if data is copied to local array
¬†¬† ut.IsTrue(__FILE__, __LINE__, movingAverageData[0] > 0);
¬†¬† return ut;
¬†¬†}

//+------------------------------------------------------------------+
```

Here is what you need to do:

1. Create an mq5-file, let's say you call that file MyTestsuite.mq5 for example.
2. Include the MQLUnitTestLibrary.mqh.
3. Define your test object as a variable available to your test cases. What ever your test object is, in the simple example above we are testing indicators - for the sake of simplicity - so we have the handle defined as state available to the unit test. Sometimes you do not need state available to all your test cases, sometimes you do. That depends on the test subject.
4. Write some unit test functions. These functions use your test object and also use CUnitTestAsserts class to make test asserts. Unit test functions return the instance of CUnitTestAsserts. In the example above Test\_Indicators\_copyBuffer is a unit test function.
5. Sometimes you need to prepare some stuff for your test cases, you may want to define setup-Methods like¬†Test\_Indicators\_copyBuffer\_setup above.
6. Then you need to glue your setup-Methods and unit test functions together to form a test suite. Write the ComposeTestsuite() method to register the unit test functions with the test suite. The ComposeTestsuite method returns the CUnitTestSuite. On the¬†CUnitTestSuite::AddUnitTestFunction you register the test case. You can also specify exactly **on which chart candle** the test case should run. This is important when you test complex business rules. Using the¬†CUnitTestSuite::AddSetupFunction you can also register the setup functions for your test cases. They can also run on opening of specific chart candles.
7. Start the¬†MyTestsuite.mq5 using the debugger in your MetaEditor. You start it like if you would test an expert advisor in the Strategy Tester Debugger.

If everything works you can see the results of your test cases in the Strategy Tester journal, like shown in the picture below.

[![Testoutput in Strategy Tester](https://c.mql5.com/18/95/Testoutput__1.PNG "Testoutput in Strategy Tester")](https://c.mql5.com/18/95/Testoutput.PNG "https://c.mql5.com/18/95/Testoutput.PNG")

That's all. You've defined your test case. You can use the simple framework to first write unit tests that define the interfaces of your program components. The result is a much more clean design and better testibility. And it should certainly improve the program quality. Another advantage is, that you can re-run all tests as regression test when you make changes to your program.

If you have questions or suggestions, please get in contact. I'm happy to answer all questions and make improvements to the framework !!

**Last comments |
[Go to discussion](/en/forum/360627)**
(4)

![Mustafa Nail Sertoglu](https://c.mql5.com/avatar/2021/11/618E1649-9997.PNG "Mustafa Nail Sertoglu")

**[Mustafa Nail Sertoglu](/en/users/nail_mql5)**
|
18 Jan 2021 at 22:32

Thanks for your contributions. Hope I may examine and get what you want add to code developers mind and or decisions.

![Niklas Rolf Alexander Schlimm](https://c.mql5.com/avatar/2021/1/6005E158-6DF1.jpeg "Niklas Rolf Alexander Schlimm")

**[Niklas Rolf Alexander Schlimm](/en/users/programminggeek)**
|
18 Jan 2021 at 23:36

**nail sertoglu:**  
 Thanks for your contributions. Hope I may examine and get what you want add to code developers mind and or decisions.

Thanks mate ! Appreciate it! üëç

![Holger David Julian Krause](https://c.mql5.com/avatar/avatar_na2.png "Holger David Julian Krause")

**[Holger David Julian Krause](/en/users/mrhoga)**
|
4 Apr 2021 at 18:53

Hello,

first of thank you for sharing this [project](https://www.mql5.com/en/articles/7863 "Article: Projects allow you to create profitable trading robots! But it is not exactly")!  
I started using it and reached the first hurdles so I wanted to ask you what you would suggest because you surely use it for some time already.  
I'm developing an EA and I want to unit test different classes, each with it's own corresponding test set in its own mql file.  
Because a project only allows one entry point (OnInit()) I'm currently removing the 'real' EA mql file from the project and include the unit tests file each time before I can run the tests.¬†  
That is of course very tedious. Do you have a suggestion on how to get around this?  
  
Thanks in advance,

Holger

![Thanh Nguyen Chi](https://c.mql5.com/avatar/2025/3/67da3b26-24a5.png "Thanh Nguyen Chi")

**[Thanh Nguyen Chi](/en/users/mrleo)**
|
6 Oct 2025 at 15:16

Greate

![shell sort - array sorting algorithm](https://c.mql5.com/i/code/library.png)
[shell sort - array sorting algorithm](/en/code/32967)

an in-place comparison sort

![Candle Pattern EA /test](https://c.mql5.com/i/code/expert.png)
[Candle Pattern EA /test](/en/code/32957)

This is a simple EA test code I made for adapting Candlepatterns.mqh

![NoiseEliminationTechnology](https://c.mql5.com/i/code/indicator.png)
[NoiseEliminationTechnology](/en/code/33093)

Published by John Ehlers in "Stocks & Commodities Dec. 2020" (16-18).

![selection sort - array sorting algorithm](https://c.mql5.com/i/code/library.png)
[selection sort - array sorting algorithm](/en/code/33104)

an in-place comparison sorting algorithm