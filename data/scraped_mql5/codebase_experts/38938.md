# Expert History Export - library for MetaTrader 5

Source: https://www.mql5.com/en/code/38938

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/38938) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# Expert History Export - library for MetaTrader 5

[Yuriy Bykov](/en/users/antekov)

Views:
:   3473

Rating:
:   (31)

Published:
:   9 April 2022, 17:23

Updated:
:   29 June 2022, 11:52
:   [ExpertHistoryExample.mq5](/en/code/download/38938/experthistoryexample.mq5 "ExpertHistoryExample.mq5")
    (2.87 KB)
    [view](# "view")

    \MQL5\Include\

    [ExpertHistory.mqh](/en/code/download/38938/experthistory.mqh "ExpertHistory.mqh")
    (38.82 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/38938.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

Adds the ability to automatically export the history of deals after running an Expert Advisor in the Strategy Tester.

The file is saved in the shared terminal folder   **Common/Files** or in the terminal folder   **MQL5/Files.**

The file name is generated automatically or set manually when calling the method   **Export()**

The history file can be used to simulate the same sequence of trades on another trading server using an EA [Simple History Receiver](/ru/market/product/75527) .

### Basic usage

1. Instantiate the object in the global scope:

CExpertHistory expertHistory();

2. Add to the function call   **OnTester()** method call   **Export()**   :

double OnTester(void) {

    ...

    expertHistory.Export();

    ...

}

### Extended use

1. Instantiate the object in the global scope:

string expertName = "SomeExpert";

string expertVersion = "1.00";     // Not required

CExpertHistory expertHistory(expertName, expertVersion);

2. Add to function **OnInit()**   any pairs of parameter names and values:

input double SL = 500;

input double TP = 1000;

int OnInit() {

    ...

    expertHistory.AddParam("Symbol", Symbol());

    expertHistory.AddParam("TP", TP);

    expertHistory.AddParam("SL", SL);

    ...

}

3. Add to the function call   **OnTester()** method call   **Export()** :

double OnTester(void) {

     ...

     if(!MQLInfoInteger(MQL\_OPTIMIZATION)) { // If you want save history only in single tester run

         expertHistory.Export();

     }

     ...

}

At the method   **Export()**   there are options:

void Export(  
   string export FileName = "", // The name of the file to export. If empty, it will be generated according to the exportFileNameFormat parameter

   ENUM\_HISTORY\_EXPORT\_FORMAT exportFormat = HEF\_INI\_FULL, // Export format. By default, in the file in addition to the transactions  
                                                           // account parameters are recorded, testing period, max. drawdown and so on.

   ENUM\_HISTORY\_FILENAME\_FORMAT exportFileNameFormat = HFF\_FULL, // File name format. By default, the file name includes the server name, the testing period, max. drawdown and so on.

   int commonFlag=FILE\_COMMON // Save a file to a shared terminal folder. If it is equal to 0, then save to a non-shared folder.  
);

**Last comments |
[Go to discussion](/en/forum/393075)**
(3)

![amrali](https://c.mql5.com/avatar/2021/7/60EB6C17-183F.jpg "amrali")

**[amrali](/en/users/amrali)**
|
12 Apr 2022 at 00:05

use [FILE\_ANSI](https://www.mql5.com/en/docs/constants/io_constants/fileflags "MQL5 documentation: File Opening Flags") to correctly display .csv files within Excel 2013 and above.

```mql5
   m_file = FileOpen(exportFileName, commonFlag | FILE_WRITE | FILE_CSV | FILE_ANSI, ',');
```

![Yuriy Bykov](https://c.mql5.com/avatar/avatar_na2.png "Yuriy Bykov")

**[Yuriy Bykov](/en/users/antekov)**
|
12 Apr 2022 at 11:52

Thank you, amrali

I will pay attention to it in the next version. For correct display in Excel, we will also need to add the ability to select the separator character and decimal point sign.

![Yuriy Bykov](https://c.mql5.com/avatar/avatar_na2.png "Yuriy Bykov")

**[Yuriy Bykov](/en/users/antekov)**
|
13 Apr 2022 at 23:29

I added the use [of FILE\_ANSI](/en/docs/constants/io_constants/fileflags "MQL5 documentation: File Opening Flags") , but the problem with opening correctly in Excel without the import wizard may still be the use of incorrect data separator characters and integer and fractional parts in real numbers. Added two parameters to the constructor so that you can set the desired separators:

CExpertHistory(string p\_expertName = "SomeExpert", string p\_expertVersion = "", string p\_sep = "," , string p\_decimalPoint = "." );

![Account History Export](https://c.mql5.com/i/code/script.png)
[Account History Export](/en/code/38935)

Export the history of transactions on the trading account.

![MA plus](https://c.mql5.com/i/code/indicator.png)
[MA plus](/en/code/38916)

Standard MA + Hull MA + DEMA + TEMA

![Extending the Rectangle](https://c.mql5.com/i/code/indicator.png)
[Extending the Rectangle](/en/code/38944)

An indicator to monitor the appearance (or change) of a rectangle whose name starts with ...

![CHO Smoothed Arrow](https://c.mql5.com/i/code/indicator.png)
[CHO Smoothed Arrow](/en/code/38963)

Signals (Arrow objects) of iCHO indicator (Chaikin Oscillator, CHO) and smoothed iCHO intersections