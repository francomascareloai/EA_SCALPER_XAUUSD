# Divergences Template Indicator - indicator for MetaTrader 4

Source: https://www.mql5.com/en/code/48583

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/48583) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Divergences Template Indicator - indicator for MetaTrader 4

[Yashar Seyyedin](/en/users/yashar.seyyedin)

Views:
:   11809

Rating:
:   (5)

Published:
:   10 March 2024, 14:41

Updated:
:   11 March 2024, 12:12
:   [divergence\_template.mq4](/en/code/download/48583/divergence_template.mq4 "divergence_template.mq4")
    (11.94 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/48583.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

![DivEurusd](https://c.mql5.com/18/159/EURUSD.DIV.png "DivEurusd")

### How template works?

This indicator provides a template to be used to plot divergences based on your desired oscillator.

Depending on which oscillator you choose(whether it is CCI, RSI or even your custom indicator) you may modify this part of the code:

```mql5
   /////////////////////////////////////////////
   //Load indicator data into indicator buffer
   //You can easily replace RSI with any indicator you like
   int BARS=MathMax(rates_total-IndicatorCounted()-pivots_period,1);
   for(int i=BARS;i>=0;i--)
   {
      indicatorBuffer[i]=iRSI(_Symbol, PERIOD_CURRENT, 14, PRICE_CLOSE, i);
   }
   //End of load indicator section
   /////////////////////////////////////////////
```

### 

### signal buffers

This indicator has four different buffers as below to keep track of signals generated. There is a signal whenever the corresponding buffer hold non-empty value.

```mql5
   SetIndexBuffer(3,bull_reg_divBuffer);
   SetIndexBuffer(4,bear_reg_divBuffer);
   SetIndexBuffer(5,bull_hid_divBuffer);
   SetIndexBuffer(6,bear_hid_divBuffer);
```

### 

### inputs section

```mql5
input int pivots_period=5; //period to find indicator pivots
input int alert_confirm_candles=1; //#candles for confirmation(0=disable alert)
```

Finding **pivot highs** and **pivot lows** in *indicatorBuffer* depends on *pivots\_period* input. The bigger you choose this value it will search larger swings for possible divergences.

Another input is alert\_confirm\_candles which defines how many bars to wait for confirming a signal. Divergence indicators are mostly lagging and issue a lot of false signals. The bigger you choose this value it will wait more and the number of false signals reduce. It is a compromise whether you want on-time signals or you want confirmed ones.

Normally you are not allowed to apply  *pivots\_period* < 2.

### Repaint issue

Indicators that rely on pivot calculations has to wait as long as *pivots\_period* to get a confirmation of the recent high/low. So this indicator needs to repaint signals as far as *pivots\_period* back in time.

```mql5
   BARS=MathMax(rates_total-IndicatorCounted()-pivots_period,pivots_period);
   for(int i=BARS;i>=0;i--)
   {
      PHBuffer[i]=pivothigh(indicatorBuffer, pivots_period, pivots_period, i);
      PLBuffer[i]=pivotlow(indicatorBuffer, pivots_period, pivots_period, i);
      bull_reg_divBuffer[i]=BullRegDiv(i);
      bear_reg_divBuffer[i]=BearRegDiv(i);
      bull_hid_divBuffer[i]=BullHidDiv(i);
      bear_hid_divBuffer[i]=BearHidDiv(i);
   }   
```

**Last comments |
[Go to discussion](/en/forum/463773)**
(2)

![speXnce](https://c.mql5.com/avatar/avatar_na2.png "speXnce")

**[speXnce](/en/users/x4nqt_2pg7_m)**
|
31 Oct 2024 at 13:10

I love it! Excellent job on this indicator. Especially when I get a [bearish divergence](https://www.mql5.com/en/articles/5703 "Article: A New Approach to the Interpretation of Classical and Reverse Divergence. Part 2") on gold!

![Michael Charles Schefe](https://c.mql5.com/avatar/2021/5/60ADC6A5-6810.gif "Michael Charles Schefe")

**[Michael Charles Schefe](/en/users/ausimike)**
|
8 Dec 2024 at 04:36

i would love this for mt5 version.

![Take Profit based on current profit](https://c.mql5.com/i/code/library.png)
[Take Profit based on current profit](/en/code/48469)

Many Expert Advisors (EAs) tend to close orders at the take profit level, considering the pip distance from the purchase price.

![Buy Sell Close Manual trading EA for trading newbies](https://c.mql5.com/i/code/expert.png)
[Buy Sell Close Manual trading EA for trading newbies](/en/code/48412)

[@Buy\_Sell\_Close] Manual trading EA for trading newbies, EA can be used in backtesting visual mode, EA can also be used in live trading.
You can practice your own trading system in backtesting.

![Moving Averages-14 different types](https://c.mql5.com/i/code/indicator.png)
[Moving Averages-14 different types](/en/code/48621)

This is an indicator to calculate 14 types of moving averages based on close price.

![Trail SL](https://c.mql5.com/i/code/expert.png)
[Trail SL](/en/code/48773)

simple trail stop loss code example.