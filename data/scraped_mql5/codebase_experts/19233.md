# MACD Stochastic - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/19233

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/19233) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# MACD Stochastic - expert for MetaTrader 5

Firmin  |
[English](javascript:void(false);)

[Русский](/ru/code/19233) [中文](/zh/code/19233) [Español](/es/code/19233) [Deutsch](/de/code/19233) [日本語](/ja/code/19233) [Português](/pt/code/19233)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   20073

Rating:
:   (36)

Published:
:   3 November 2017, 12:39

Updated:
:   28 February 2018, 14:02
:   [MACD Stochastic.mq5](/en/code/download/19233/macd_stochastic.mq5 "MACD Stochastic.mq5")
    (50.17 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/19233.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**The author of the idea**: [Firmin](/en/users/firmin "Firmin (Firmin)"), **the mq5 code author**: [barabashkakvn](/en/users/barabashkakvn).

The Expert Advisor uses two indicators, including [iMACD](/en/docs/indicators/imacd "MQL5 Reference → Technical Indicators → iMACD") (Moving Average Convergence/Divergence, MACD) and [iStochastic](/en/docs/indicators/istochastic "MQL5 Reference → Technical Indicators → iStochastic") (Stochastic Oscillator). No more than one position per bar can be opened. It uses three time intervals to determine entries.

### Input Parameters

* **MACD: period for Fast average calculation** - fast moving average period.
* **MACD: period for Slow average calculation** - slow moving average period.
* **MACD: period for their difference averaging** - the period for averaging the difference.
* **Use Stochastic** - enable/disable the use of Stochastic.
* **Bars to check Stochastic** - the number of bars for calculating the Stochastic signal.
* **STO: K-period (number of bars for calculations)** - K period (number of bars for calculations).
* **STO: D-period (period of first smoothing)** - D period (period for the primary smoothing).
* **STO: final smoothing** - final smoothing.
* **STO: type of smoothing** - type of smoothing.
* **STO: stochastic calculation method** - Stochastic calculation method.
* **Lots** - the volume of position to open.
* **Stop Loss (in pips)** - Stop Loss value.
* **Take Profit (in pips)** - Take Profit value.
* **Trailing Stop (in pips)** - trailing value.
* **Trailing Step (in pips)** - trailing step value.
* **Max positions** - the maximum number of positions.
* **No Loss stop (in pips)** - the minimum breakeven level.
* **When set "No Loss stop" (in pips)** - minimum distance from the price to set breakeven.
* **Start period #1 (only hours and minutes are valid)** - beginning of period #1.
* **End period #1 (only hours and minutes are valid)** - end of period #1.
* **Start period #2 (only hours and minutes are valid)** - beginning of period #2.
* **End period #2 (only hours and minutes are valid)** - end of period #2.
* **Start period #3 (only hours and minutes are valid)** - beginning of period #3.
* **End period #3 (only hours and minutes are valid)** - end of period #3.

Testing results on all pairs from 2017.03.06 to 2017.10.08:

| Symbol | Pass | Result | Profit | Expected Payoff | Profit Factor | Recovery Factor | Sharpe Ratio | Custom | Equity DD % | Trades |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| GBPJPY | 19 | 11120,25 | 1120,25 | 28,01 | 1,86 | 2,96 | 0,31 | 0 | 3,70 | 40 |
| EURAUD | 13 | 11070,28 | 1070,28 | 22,30 | 1,84 | 2,29 | 0,31 | 0 | 4,64 | 48 |
| CHFJPY | 11 | 10819,40 | 819,40 | 16,39 | 1,44 | 1,11 | 0,18 | 0 | 7,19 | 50 |
| GBPCHF | 18 | 10661,42 | 661,42 | 21,34 | 1,54 | 1,39 | 0,22 | 0 | 4,60 | 31 |
| EURJPY | 15 | 10602,62 | 602,62 | 13,70 | 1,35 | 1,28 | 0,14 | 0 | 4,61 | 44 |
| NZDUSD | 0 | 10540,46 | 540,46 | 16,89 | 1,39 | 1,03 | 0,17 | 0 | 5,01 | 32 |
| GBPUSD | 2 | 10537,58 | 537,58 | 12,22 | 1,27 | 0,66 | 0,13 | 0 | 7,62 | 44 |
| AUDUSD | 6 | 10316,09 | 316,09 | 7,53 | 1,16 | 0,57 | 0,08 | 0 | 5,11 | 42 |
| AUDNZD | 7 | 10315,69 | 315,69 | 7,52 | 1,24 | 1,24 | 0,11 | 0 | 2,51 | 42 |
| AUDCAD | 8 | 10047,39 | 47,39 | 1,16 | 1,03 | 0,08 | 0,02 | 0 | 5,92 | 41 |
| EURCHF | 14 | 10040,68 | 40,68 | 1,45 | 1,03 | 0,08 | 0,02 | 0 | 4,97 | 28 |
| AUDCHF | 9 | 10028,50 | 28,50 | 0,75 | 1,00 | 0,04 | 0,12 | 0 | 6,72 | 38 |
| EURNZD | 16 | 9935,54 | -64,46 | -1,43 | 0,96 | -0,07 | -0,02 | 0 | 9,14 | 45 |
| AUDJPY | 10 | 9927,16 | -72,84 | -1,92 | 0,96 | -0,08 | -0,02 | 0 | 8,44 | 38 |
| USDCHF | 3 | 9901,90 | -98,10 | -3,16 | 0,94 | -0,23 | -0,02 | 0 | 4,19 | 31 |
| USDCAD | 5 | 9752,49 | -247,51 | -6,69 | 0,84 | -0,39 | -0,08 | 0 | 6,20 | 37 |
| EURCAD | 17 | 9635,41 | -364,59 | -8,89 | 0,79 | -0,42 | -0,11 | 0 | 8,49 | 41 |
| EURUSD | 1 | 9573,66 | -426,34 | -13,32 | 0,77 | -0,47 | -0,12 | 0 | 8,88 | 32 |
| CADCHF | 20 | 9006,63 | -993,37 | -25,47 | 0,60 | -0,62 | -0,24 | 0 | 15,84 | 39 |
| USDJPY | 4 | 8729,71 | -1270,29 | -25,41 | 0,54 | -0,80 | -0,29 | 0 | 15,85 | 50 |
| EURGBP | 12 | 7996,09 | -2003,91 | -50,10 | 0,44 | -0,88 | -0,43 | 0 | 22,26 | 40 |

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/19233](/ru/code/19233)

**Last comments |
[Go to discussion](/en/forum/218742)**
(13)

![Sergio66631](https://c.mql5.com/avatar/avatar_na2.png "Sergio66631")

**[Sergio66631](/en/users/sergio66631)**
|
22 Oct 2017 at 03:41

hint what can be the reason - it does not join the chart - it writes in the log 2017.10.22 04:36:40.563  Experts  initialising of [MACD](https://www.metatrader5.com/en/terminal/help/indicators/oscillators/macd "MetaTrader 5 Help: MACD Indicator") Stochastic (EURUSD,M5) failed

It is tested normally in the tester

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
22 Oct 2017 at 05:13

**Sergio66631:**  

hint what can be the reason - it does not join the chart - it writes in the log 2017.10.22 04:36:40.563  Experts  initialising of MACD Stochastic (EURUSD,M5) failed

It is tested normally in the tester

Have you looked at the "Experts" tab in the terminal? Please check the messages in the "Experts" tab.

![Danja88](https://c.mql5.com/avatar/avatar_na2.png "Danja88")

**[Danja88](/en/users/danja88)**
|
22 Nov 2017 at 18:11

**Automated-Trading:**  

[MACD Stochastic](/en/code/19233):

Author: [Vladimir Karputov](/en/users/barabashkakvn "barabashkakvn")

I have found errors on lines 205 and 216 that prevent the Stoch from working.  Where you are setting the 'signal' variable, you have "POSITION\_TYPE\_BUY" and should be "SIGNAL\_LINE".

Love the EA and looking at incorporating it into my strategy - though adding Stoch check did NOT add value to my testing.  I like to go back as far in the past as possible and I get the best results with EURUSD H1 on 2015 to present data.  Also updating first start time from 8:15 to 6:15 helped as well.

Thanks!

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
22 Nov 2017 at 18:26

**Danja88 :**   

I have found errors on lines 205 and 216 that prevent the Stoch from working.  Where you are setting the 'signal' variable, you have "POSITION\_TYPE\_BUY" and should be "SIGNAL\_LINE".

Love the EA and looking at incorporating it into my strategy - though adding Stoch check did NOT add value to my testing.  I like to go back as far in the past as possible and I get the best results with EURUSD H1 on 2015 to present data.  Also updating first start time from 8:15 to 6:15 helped as well.

Thanks!

  

Thank you for message. Follow the update: version 1.001 will be released in the Russian part.

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
24 Nov 2017 at 10:04

Posted version   "1.001": [MACD Stochastic](/ru/code/19233/ "MACD Stochastic")

![Nova](https://c.mql5.com/i/code/expert.png)
[Nova](/en/code/19218)

The Expert Advisor checks the direction in which the price has been moving for the last 10 seconds, and opens a position in accordance with the movement. The EA sets Stop Loss and Take Profit.

![e-Skoch pending orders](https://c.mql5.com/i/code/expert.png)
[e-Skoch pending orders](/en/code/19207)

Works with pending stop orders (Buy Stop and Sell Stop). Monitors spread %.

![Resistance & Support](https://c.mql5.com/i/code/indicator.png)
[Resistance & Support](/en/code/19241)

The indicator of support and resistance lines calculated based on the iFractals (Fractals) indicator values.

![CDictionary](https://c.mql5.com/i/code/library.png)
[CDictionary](/en/code/19314)

An implementation of the dictionary (associative array) data structure in MQL5, based on CArrayObj and CList.