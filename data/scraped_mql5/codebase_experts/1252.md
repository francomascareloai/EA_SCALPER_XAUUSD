# sHistoryExport - handy script to export the historical data in the МetaТrader 4 format - script for MetaTrader 5

Source: https://www.mql5.com/en/code/1252

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/1252) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Scripts](https://c.mql5.com/i/code/script.png)

# sHistoryExport - handy script to export the historical data in the МetaТrader 4 format - script for MetaTrader 5

[Andrey Khatimlianskii](/en/users/komposter)  |
[English](javascript:void(false);)

[Русский](/ru/code/1252) [中文](/zh/code/1252) [Español](/es/code/1252) [Deutsch](/de/code/1252) [日本語](/ja/code/1252) [Português](/pt/code/1252)

Views:
:   19015

Rating:
:   (64)

Published:
:   19 December 2012, 13:06

Updated:
:   22 November 2016, 07:32
:   [shistoryexport.mq5](/en/code/download/1252/shistoryexport.mq5 "shistoryexport.mq5")
    (5.88 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/1252.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Script for historical data export.**

Problems with history in MetaTrader 4? Load the detailed history of any depth from MetaTrader 5!

**Step 1: Set up**

Load script in the "terminal\_data\_folder\MQL5\scripts\".

Load libraries [CheckHistory](/en/code/1251) and [String](/en/code/1250) to the "terminal\_data\_folder\MQL5\Include\komposter\".

Compile the script.

**Step 2: Set the depth of the history**

Go to the menu "Tools - Options" (Ctr+O), or on the tab "Charts" specify how many bars you want to export ("Max. bars in the window"). History of М1 per one year it is about 370 000 bars.

![](https://c.mql5.com/18/8/1__5.png)

Click "ОК" and restart МТ.

**Step 3: Set the instruments list**

If you want to load the history on many parameters at once, add them to "Market Watch", and hide the unnecessary instruments:

![](https://c.mql5.com/18/8/2__4.png)

**Step 4: Run script**

Drag the script to any chart and set the external variables value:

* **SymbolsList**: A list of symbols divided by a comma (for example, "EURUSD,GBPUSD").  
  If you set "all", all the characters from the "Market Watch" will be used;
* **TimeFramesList**: time frame list divided by a comma (for example, "M1,M5,M15").  
  If set "all", all the МТ4 time frames smaller D1 will be used .
* **BarsToDownload**: number of bars to export.  
  If set 0, all bars visible on the chart will be exported ("Max. bars in the window").

![](https://c.mql5.com/18/8/3.png)

Click "ОК", and waiting for the shutdown message . The progress you can follow on the "Expert Advisors" tab of the terminal:

2013.03.28 11:42:55 sHistoryExport (EURUSD,H1) GBPJPY, PERIOD\_M1: history synchronized within 1.5 sec

2013.03.28 11:43:25 sHistoryExport (EURUSD,H1) GBPJPY,
PERIOD\_M1: 1100000 bars have been written to "History
(MetaQuotes-Demo)\GBPJPYM1.csv" and "History
(MetaQuotes-Demo)\GBPJPY1.hst" within 30.0 sec!

2013.03.28 11:43:27 sHistoryExport (EURUSD,H1) EURJPY, PERIOD\_M1: history synchronized within 1.6 sec

2013.03.28 11:43:55 sHistoryExport (EURUSD,H1) EURJPY,
PERIOD\_M1: 1100000 bars have been written to "History
(MetaQuotes-Demo)\EURJPYM1.csv" and "History
(MetaQuotes-Demo)\EURJPY1.hst" within 28.6 sec!

2013.03.28 11:43:57 sHistoryExport (EURUSD,H1) NZDUSD, PERIOD\_M1: history synchronized within 1.6 sec

2013.03.28 11:44:26 sHistoryExport (EURUSD,H1) NZDUSD,
PERIOD\_M1: 1100000 bars have been written to "History
(MetaQuotes-Demo)\NZDUSDM1.csv" and "History
(MetaQuotes-Demo)\NZDUSD1.hst" within 29.0 sec!

2013.03.28 11:44:28 sHistoryExport (EURUSD,H1) AUDUSD, PERIOD\_M1: history synchronized within 1.7 sec

2013.03.28 11:44:56 sHistoryExport (EURUSD,H1) AUDUSD,
PERIOD\_M1: 1100000 bars have been written to "History
(MetaQuotes-Demo)\AUDUSDM1.csv" and "History
(MetaQuotes-Demo)\AUDUSD1.hst" within 28.2 sec!

2013.03.28 11:44:59 sHistoryExport (EURUSD,H1) USDCAD, PERIOD\_M1: history synchronized within 1.8 sec

2013.03.28 11:45:27 sHistoryExport (EURUSD,H1) USDCAD,
PERIOD\_M1: 1100000 bars have been written to "History
(MetaQuotes-Demo)\USDCADM1.csv" and "History
(MetaQuotes-Demo)\USDCAD1.hst" within 28.3 sec!

2013.03.28 11:45:31 sHistoryExport (EURUSD,H1) USDCHF, PERIOD\_M1: history synchronized within 3.9 sec

2013.03.28 11:46:00 sHistoryExport (EURUSD,H1) USDCHF,
PERIOD\_M1: 1100000 bars have been written to "History
(MetaQuotes-Demo)\USDCHFM1.csv" and "History
(MetaQuotes-Demo)\USDCHF1.hst" within 28.5 sec!

2013.03.28 11:46:01 sHistoryExport (EURUSD,H1) GBPUSD, PERIOD\_M1: history synchronized within 1.5 sec

2013.03.28 11:46:31 sHistoryExport (EURUSD,H1) GBPUSD,
PERIOD\_M1: 1100000 bars have been written to "History
(MetaQuotes-Demo)\GBPUSDM1.csv" and "History
(MetaQuotes-Demo)\GBPUSD1.hst" within 29.5 sec!

2013.03.28 11:46:33 sHistoryExport (EURUSD,H1) USDJPY, PERIOD\_M1: history synchronized within 2.6 sec

2013.03.28 11:47:03 sHistoryExport (EURUSD,H1) USDJPY,
PERIOD\_M1: 1100000 bars have been written to "History
(MetaQuotes-Demo)\USDJPYM1.csv" and "History
(MetaQuotes-Demo)\USDJPY1.hst" within 29.4 sec!

2013.03.28 11:47:04 sHistoryExport (EURUSD,H1) EURUSD, PERIOD\_M1: history synchronized within 1.5 sec

2013.03.28 11:47:33 sHistoryExport (EURUSD,H1) EURUSD,
PERIOD\_M1: 1100000 bars have been written to "History
(MetaQuotes-Demo)\EURUSDM1.csv" and "History
(MetaQuotes-Demo)\EURUSD1.hst" within 28.8 sec!

2013.03.28 11:47:33 sHistoryExport (EURUSD,H1) History export finished within 279.6 sec! 9 files have been written to:

2013.03.28 11:47:33 sHistoryExport (EURUSD,H1) D:\\_Forex\MetaTrader 5 Work\MQL5\Files\History (MetaQuotes-Demo)\

If you set larger number of instruments and/or time frames and/or loaded bars, script can work **very long** or in general **hang** due to lack of core memory! Adequately assess the potential of your hardware.

**Step 5: Done!**

Loading all the necessary history, the script displays a window with information and exits. The name of the folder where the files are stored, you can copy directly from the Alert window:

![](https://c.mql5.com/18/8/ScreenShot078.png)

csv-files, written by a script, ready to import in MetaTrader 4 ("Quotes archive - Import"):

![](https://c.mql5.com/18/30/ScreenShot121.png)

  

**The history of changes**

2013.03.25:

* [\*] If there is no sufficient depth history by the instrument/timeframe on
  the server, the script will download and save the whole available
  history (before it outputted an error and didn't save anything).

2013.03.28:

* [+] Write to "hst" is added.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/1252](/ru/code/1252)

**Last comments |
[Go to discussion](/en/forum/9512)**
(45)

![alex alex](https://c.mql5.com/avatar/2020/12/5FDE7E7A-80DF.png "alex alex")

**[alex alex](/en/users/sigvolt)**
|
9 Apr 2021 at 11:27

**Andrey Khatimlianskii**

Could you please tell me how to configure the script so that it adds quotes every minute?

![Greff](https://c.mql5.com/avatar/avatar_na2.png "Greff")

**[Greff](/en/users/greff)**
|
28 Apr 2021 at 09:35

Compilation results (MetaEditor v5. bld 2897 ) :

'StringToPeriod' - cannot convert enum  sHistoryExport.mq5  75  45

'PeriodToString' - undeclared identifier  sHistoryExport.mq5  105  85

['period](https://www.mql5.com/en/docs/check/period "MQL5 documentation: Period function")' - some operator expected  sHistoryExport.mq5  105  102

implicit conversion from 'number' to 'string'  sHistoryExport.mq5  105  85

'+' - unexpected token  sHistoryExport.mq5  105  113

23 errors, 5 warnings  24  6

![Andrey Khatimlianskii](https://c.mql5.com/avatar/2022/10/63528ae6-0b8c.jpg "Andrey Khatimlianskii")

**[Andrey Khatimlianskii](/en/users/komposter)**
|
28 Apr 2021 at 22:44

**Greff:**  

Compilation results (MetaEditor v5. bld 2897 ) :

'StringToPeriod' - cannot convert enum  sHistoryExport.mq5  75  45

'PeriodToString' - undeclared identifier  sHistoryExport.mq5  105  85

['period](/en/docs/check/period "MQL5 documentation: Period function")' - some operator expected  sHistoryExport.mq5  105  102

implicit conversion from 'number' to 'string'  sHistoryExport.mq5  105  85

'+' - unexpected unexpected token  sHistoryExport.mq5  105  113

23 errors, 5 warnings  24  6

**Step 1: Installation**

Upload the script to the <data directory>\MQL5\scripts\ directory.

Load the [CheckHistory](/en/code/1251) and [String](/en/code/1250) libraries into the <data directory>\MQL5\Include\komposter\ directory.

Compile the script.

![TT7749](https://c.mql5.com/avatar/avatar_na2.png "TT7749")

**[TT7749](/en/users/tt7749)**
|
5 May 2022 at 15:39

Thanks Andrey,  the code works very well.

Is it possible to add a timer to automatically download the csv periodically every x minutes?

Or even set a specific time to download?

[https://www.mql5.com/en/docs/event\_handlers/ontimer&nbsp](https://www.mql5.com/en/docs/event_handlers/ontimer%C2%A0 "https://www.mql5.com/en/docs/event_handlers/ontimer&nbsp");

Thank you.

![mbjen](https://c.mql5.com/avatar/avatar_na2.png "mbjen")

**[mbjen](/en/users/mbjen)**
|
5 Oct 2024 at 15:01

Terminal crashes

```mql5
PR      3       16:53:57.997    History 'GTN' file write error [18]
EH      3       16:53:57.997    HistorySymbol   synchronization selection failed [GTN]
OM      2       16:56:01.040    Terminal        crashlog generated
```

![Exp_UltraFatl](https://c.mql5.com/i/code/expert.png)
[Exp\_UltraFatl](/en/code/1256)

The Expert Advisor using the UltraFatl oscillator.

![CheckHistory - Check and load history function](https://c.mql5.com/i/code/library.png)
[CheckHistory - Check and load history function](/en/code/1251)

Slightly modified history load function from MetaQuotes.

![Exp_DSSBressert](https://c.mql5.com/i/code/expert.png)
[Exp\_DSSBressert](/en/code/1255)

Trading system using the DSSBressert indicator

![JS-Stoh-BB-RSI](https://c.mql5.com/i/code/indicator.png)
[JS-Stoh-BB-RSI](/en/code/1259)

Multiple indicator system using the RSI oscillators and stochastic with Bollinger Bands.