# iMA iStochastic Custom - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/23386

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/23386) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# iMA iStochastic Custom - expert for MetaTrader 5

[Vladimir Karputov](/en/users/barabashkakvn)  |
[English](javascript:void(false);)

[Русский](/ru/code/23386) [Español](/es/code/23386)

Views:
:   9490

Rating:
:   (15)

Published:
:   7 February 2019, 08:46
:   [iMA iStochastic Custom.mq5](/en/code/download/23386/ima_istochastic_custom.mq5 "iMA iStochastic Custom.mq5")
    (70.35 KB)
    [view](# "view")

    \MQL5\Indicators\

    [Custom Moving Average Levels.mq5](/en/code/download/23386/custom_moving_average_levels.mq5 "Custom Moving Average Levels.mq5")
    (20.17 KB)
    [view](# "view")

    [Stochastic Custom.mq5](/en/code/download/23386/stochastic_custom.mq5 "Stochastic Custom.mq5")
    (10.38 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/23386.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The EA uses custom indicators [Custom Moving Average Levels](/en/code/18106) and [Stochastic Custom](/en/code/23385).

![iMA iStochastic Custom](https://c.mql5.com/18/77/2018-11-26_14h32_13.png "iMA iStochastic Custom")

The EA only operates when a new bar appears. It can be averaged, i.e., open multiple position in the same direction. Exit a position:

* By Stop Loss triggering
* By Take Profit triggering
* By the opposite signal

There is the reverse of trading signals.

Trading signals. Here, ***close[1]*** is the Close price on bar #1, ***ma\_down[1]*** - the value of the Down buffer of indicator **Custom Moving Average Levels** on bar #1, , ***ma\_up[1]*** - the value of the UP buffer of indicator **Custom Moving Average Levels** on bar #1, ***sto\_main[1]*** - the value of the Main buffer of indicator **Stochastic Custom** on bar #1, and ***sto\_signal[1]*** - the value of the Signal buffer of indicator **Stochastic Custom** on bar #1:

```mql5
   if(close[1]<ma_down[1] && (sto_main[1]<Inp_STO_Level2 || sto_signal[1]<Inp_STO_Level2))
     {
      if(!InpReverse)
         m_need_open_sell=true;
      else
         m_need_open_buy=true;
     }
   else if(close[1]>ma_up[1] && (sto_main[1]>Inp_STO_Level1 || sto_signal[1]>Inp_STO_Level1))
     {
      if(!InpReverse)
         m_need_open_buy=true;
      else
         m_need_open_sell=true;
     }
```

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/23386](/ru/code/23386)

**Last comments |
[Go to discussion](/en/forum/302455)**
(13)

![Shara1](https://c.mql5.com/avatar/avatar_na2.png "Shara1")

**[Shara1](/en/users/shara1)**
|
28 Nov 2018 at 11:12

**Vladimir Karputov:**  

When you do a single test, a single pass of the Optimisation tab doesn't look.

Run the single test in visual mode. After that, READ what is written in the "Log" tab of the TESTER.

I did what you told me to do. Here is the "Log" of the TESTER. It writes some kind of error. Nothing is clear.

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
28 Nov 2018 at 11:17

**Shara1:**  

I did what you told me to do. Here's the "log" of the tester. It's writing some kind of error. Nothing is clear.

If it is not clear, then always do the following: set the default parameters of the [Expert Advisor](https://www.mql5.com/en/market/mt5/ "A Market of Applications for the MetaTrader 5 and MetaTrader 4").

Then change ONE parameter and check the result (look in the log).

Never change several parameters at once.

I recommend to translate what these two parameters mean with a dictionary:

```mql5
input ENUM_LOT_OR_RISK IntLotOrRisk=risk;    // Money management: Lot OR Risk
input double   InpVolumeLorOrRisk= 1.0;      // The value for "Money management"
```

![Shara1](https://c.mql5.com/avatar/avatar_na2.png "Shara1")

**[Shara1](/en/users/shara1)**
|
28 Nov 2018 at 12:33

**Vladimir Karputov:**  

If it is not clear, then always do the following: set the default parameters of the Expert Advisor.

Then change ONE parameter and check the result (look in the log).

Never change several parameters at once.

It is recommended to translate with a dictionary what these two parameters mean:

Google first translated:ENUM much or risk IntLotOrRisk, and the second:Volume Inp Lor or risk. What is it? Are my settings wrong?

It used to be that when I tested an Expert Advisor in a regular tester, it showed optimisation parameters. Why is it so complicated with this Expert Advisor?

By default it didn't work at all. It has MA: Level Down step 1, but now it works with step -1. Here are my settings.

[![](https://c.mql5.com/3/254/3__1.png)](https://c.mql5.com/3/254/3.png "https://c.mql5.com/3/254/3.png")

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
28 Nov 2018 at 14:55

In general, for the last time: set all EA parameters to default.

How to do it:

* in the [strategy tester](https://www.metatrader5.com/en/terminal/help/algotrading/testing "Help: Strategy Tester in MetaTrader 5 Client Terminal"), select the Expert Advisor,
* then go to the "Parameters" tab of the tester.
* in this tab, right click and "Default".
* run the test in the "All ticks" mode.
* That's it.

![Shara1](https://c.mql5.com/avatar/avatar_na2.png "Shara1")

**[Shara1](/en/users/shara1)**
|
28 Nov 2018 at 15:19

**Vladimir Karputov:**  

In general, for the last time: set all EA parameters to default.

How to do it:

* in the [strategy tester](https://www.metatrader5.com/en/terminal/help/algotrading/testing "Help: Strategy Tester in MetaTrader 5 Client Terminal"), select the Expert Advisor,
* then go to the "Parameters" tab of the tester.
* in this tab, right click and "Default".
* run the test in the "All ticks" mode.
* That's it.

Thank you. I'll do it now.

![Stochastic Custom](https://c.mql5.com/i/code/indicator.png)
[Stochastic Custom](/en/code/23385)

A modification of standard indicator iStochastic (Stochastic Oscillator, STO) - now you can manage levels #1 and #2 from your EA.

![iMA iSAR EA](https://c.mql5.com/i/code/expert.png)
[iMA iSAR EA](/en/code/23383)

A trading system based on three indicators iMA (Moving Average, MA) and two indicators iRSI (Relative Strength Index, RSI)

![Stalin_Signal](https://c.mql5.com/i/code/indicator.png)
[Stalin\_Signal](/en/code/23387)

Indicator Stalin\_Signal displays information on the current trend, using the values of indicator Stalin\_NRTR with a fixed timeframe

![FitFul 13](https://c.mql5.com/i/code/expert.png)
[FitFul 13](/en/code/23394)

The EA focuses on the OHLC of timeframe W1