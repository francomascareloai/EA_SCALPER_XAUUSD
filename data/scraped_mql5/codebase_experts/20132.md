# BHS system - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/20132

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/20132) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# BHS system - expert for MetaTrader 5

fortrader.ru  |
[English](javascript:void(false);)

[Русский](/ru/code/20132) [中文](/zh/code/20132) [Español](/es/code/20132) [Deutsch](/de/code/20132) [日本語](/ja/code/20132) [Português](/pt/code/20132)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   4973

Rating:
:   (15)

Published:
:   18 April 2018, 17:07
:   [BHS system.mq5](/en/code/download/20132/bhs_system.mq5 "BHS system.mq5")
    (47.18 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/20132.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**The author of the idea**:  [Yuri](/en/users/fortrader.ru "Yuri (fortrader.ru)"), **the mq5 code author**: [barabashkakvn](/en/users/barabashkakvn).

The Expert Advisor calculates the nearest upper and lower "round" price depending on **Step of the "round" number** (to see how the calculation of the "round" price is performed, comment out the line in OnDeinit:

```mql5
//+------------------------------------------------------------------+
//| Expert deinitialization function                                 |
//+------------------------------------------------------------------+
void OnDeinit(const int reason)
  {
//--- how Math() function works:
   return;
```

An example will be printed in the Experts tab when you unload the EA from the chart). The EA checks the position of the price and the iAMA (Adaptive Moving Average, AMA) indicator to place an initial pending order.

* If the Close price of bar #0 is above the indicator, a pending Buy Stop order will be placed at the upper round price.
* If the Close price of bar #0 is below the indicator, a pending Sell Stop order will be placed at the lower round price.

Lifetime is set for each pending order: **Life time of the pending order** (in hours) is added to the last known server time.

Separate trailing methods are applied for BUY and SELL positions. They are configured in **Trailing Stop BUY** and **Trailing Stop SELL**.

### Input Parameters

* **Lots** - volume;
* **Stop Loss BUY** - stop loss for the Buy Stop order;
* **Stop Loss SELL** - stop loss for the Sell Stop order;
* **Trailing Stop BUY** - trailing stop for Buy positions;
* **Trailing Stop SELL** - trailing stop for Sell positions;
* **Step of the "round" number** - the step value for the round price;
* **Life time of the pending order (in hours)** - pending order life time in hours;
* **AMA: Period of calculation** - AMA period;
* **AMA: Period of fast MA** - fast moving average period;
* **AMA: Period of slow MA** - slow moving average period;
* **AMA: Horizontal shift** - horizontal shift of the indicator;
* **AMA: Type of price** - price type used for the indicator calculation;
* **magic number** - unique identifier for the EA.

Testing on EURUSD, H1:

![BHS system](https://c.mql5.com/18/66/BHS_system.png "BHS system")

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/20132](/ru/code/20132)

**[Go to discussion](/en/forum/238277)**

![MathCeilRoundFloor](https://c.mql5.com/i/code/script.png)
[MathCeilRoundFloor](/en/code/20131)

Example of functions MathCeil, MathRound and MathFloor.

![Fractured Fractals](https://c.mql5.com/i/code/expert.png)
[Fractured Fractals](/en/code/20127)

The Expert Advisor uses the Fractals indicator signals to place pending orders and trail the Stop Loss level of positions.

![Fractal_TL](https://c.mql5.com/i/code/indicator.png)
[Fractal\_TL](/en/code/20138)

An indicator for automatic drawing of trendlines based on fractals of a given timeframe.

![Ichimoku](https://c.mql5.com/i/code/expert.png)
[Ichimoku](/en/code/20148)

An Expert Advisor based on the iIchimoku (Ichimoku Kinko Hyo) indicator. Separate Stop Loss, Take Profit and Trailing Stop for BUY and SELL positions. The EA operation time is configurable. A check is performed on the current bar: only one position can be opened.