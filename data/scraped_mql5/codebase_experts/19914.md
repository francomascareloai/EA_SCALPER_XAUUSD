# NTK 07 - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/19914

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/19914) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# NTK 07 - expert for MetaTrader 5

runik  |
[English](javascript:void(false);)

[Русский](/ru/code/19914) [中文](/zh/code/19914) [Español](/es/code/19914) [Deutsch](/de/code/19914) [日本語](/ja/code/19914) [Português](/pt/code/19914)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   8746

Rating:
:   (17)

Published:
:   1 March 2018, 11:54
:   [NTK 07.mq5](/en/code/download/19914/ntk_07.mq5 "NTK 07.mq5")
    (83.5 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/19914.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**The author of the idea**: [Nikolay](/en/users/runik "Nikolay (runik)"), **the mq5 code author**: [barabashkakvn](/en/users/barabashkakvn).

The Expert Advisor manages Buy and Sell positions (applies Trailing Stop) and sets pending Buy Stop and Sell Stop orders.

### Parameters

* **Fixed Lot** - the pending order lot is not calculated, and a manually specified value is used instead (the **Money management** parameter should be set to **Fixed Lot**).
* **Max total lots** - the total volume of positions and pending orders (suppose we have BUY 0.03, BUY 0.04, SELL 0.09 and BUY STOP 0.05, then the total volume is 0.21);
* **Max total Position** - the maximum number of positions and pending orders (suppose we have BUY 0.03, BUY 0.04, SELL 0.09 and BUY STOP 0.05, then the total number is 4).
* **Net step** - pending orders are placed at a distance of **Net step** from the current price. **Net step** cannot be equal to "0".
* **Take Profit** - if **Take Profit** is set to "0", the parameter will be completely disabled, i.e. after triggering of a pending order, the Take Profit of the resulting position will always be equal to "0".
* **Stop Loss** - if **Stop Loss** is set to "0", the Stop Loss of the resulting position can be modified using one of the available trailing stop methods.

  The following limitation shall apply here: **Stop Loss** cannot be set to zero if the **Money management** parameter is other than **Fixed Lot**.

  If **Stop loss** is set to zero (**Money management** must always be equal to **Fixed Lot**) and only one **Trailing Stop** method is enabled, the trailing will act as the breakeven function: the first Stop Loss of a position will be set in the profitable zone.
* **Lot increase rate** - lot multiplier for the next position. The volume of each subsequent position is calculated as **Lot increase rate** \* previous position volume.
* **Position Trailing**

  Multiple methods for modifying Stop Loss are implemented in the Expert Advisor (several trailing stop types). **Trailing Stop** can either be an independent trailing type (**Trailing Stop** is not equal to zero, **Trailing at High and Low** is set to false and **Trailing at Moving Average** is set to false) or be used (as a parameter) in one of trailing methods (**Trailing at High and Low** or **Trailing at Moving Average**). Thus, **Trailing Stop** cannot be set to zero.

  If you accidentally choose (in addition to **Trailing Stop**) two or more types of trailing, a warning message will pop up, and the EA will be unloaded from the chart.

  **Trailing at High and Low prices**

  + At each iteration, the EA checks if the position is profitable:
    - For a BUY position, the EA checks if placing a Stop Loss at bar #1 Low is possible: if the position is profitable at the bar #1 Low level, the Stop Loss will be set at bar #1 Low;
    - For a SELL position, the EA checks if placing a Stop Loss at bar #1 High is possible: if the position is profitable at the bar #1 High level, the Stop Loss will be set at bar #1 High.  

  **Trailing at Moving Average**

  + At each iteration, the EA checks if the position is profitable.
  + Once the profit distance in points form the Moving Average value at bar #0 becomes equal to or greater than **Trailing Stop** + **Trailing Step** (in this EA, **Trailing Step** is hidden from the user and is always calculated as half of **Trailing Stop**), an automated command is generated to modify Stop Loss by a value of Moving Average at bar #0.  

  **Trailing Stop** - classic trailing stop.

  + At each iteration, the EA checks if the position is profitable.
  + Once the profit in points becomes equal to or greater than **Trailing Stop** + **Trailing Step** (in this EA, **Trailing Step** is hidden from the user and is always calculated as half of **Trailing Stop**), an automated command is generated to modify Stop Loss to a distance of **Trailing Stop** from the current price.
  + If price moves increasing the position profit, Stop Loss automatically moves together with the price.
  + Otherwise, the position is not modified. Thus, trading position's profit is fixed automatically.
* **Money management** - the volume of a position (or a pending order) can be calculated in one of three ways:

  + **Fixed Lot** - a fixed value (set manually in the **Fixed Lot** parameter);
  + **Fixed Margin** - as risk (the **Risk in % for a deal** parameter) per deal in percentage of free margin;
  + **Fixed Risk** - as risk percent (**Risk in % for a deal**) per deal.
* **Risk in % for a deal** - risk percent per deal (only for "Fixed Margin" and "Fixed Risk)
* **Min FreeMargin** - minimum amount of free margin. If the free margin is less than **Min FreeMargin**, the EA does not place new pending orders and stops managing positions.
* **Moving Average** - parameters of the Moving Average indicator, which is used for **Trailing at Moving Average**.
* **Hour start**, **Hour end** - working time settings (the EA will work from **Hour start** till **Hour end**), only applies when there are no positions and pending orders.
* **Period in bars** - the number of bars to calculate the range for placing initial pending orders (when there are no open positions), the range between High and Low over the number of bars set in **Period in bars**. Two types of trading can be selected for the range (**Type of trade**). "1" and "2" are two identical values.
* **Type of trade** - trading type. This parameter only applies when there are no positions or pending orders. Two types are available:

  + **trade from edges of range** - trading from the borders of the range;
  + **trade from the centre of range** - trading from the center of the range, the center is calculated as (High + Low) / 2.0 +-1 points (four-digit quotes).

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/19914](/ru/code/19914)

**[Go to discussion](/en/forum/229125)**

![Percentage_Crossover_Channel_EA](https://c.mql5.com/i/code/expert.png)
[Percentage\_Crossover\_Channel\_EA](/en/code/19913)

An Expert Advisor, which trades in a channel based on the Percentage\_Crossover\_Channel indicator.

![Diff_TF_MA_EA](https://c.mql5.com/i/code/expert.png)
[Diff\_TF\_MA\_EA](/en/code/19906)

An Expert Advisor based on the Diff\_TF\_MA indicator.

![TimeEA](https://c.mql5.com/i/code/expert.png)
[TimeEA](/en/code/19916)

A Simple Expert Advisor The EA opens a position of the specified type at the time specified in the EA parameters. The position is closed at the time specified in the appropriate parameter.

![TrailingTakeProfit](https://c.mql5.com/i/code/expert.png)
[TrailingTakeProfit](/en/code/19930)

This non-trading Expert Advisor is designed for the simple trailing of take profit orders of open positions.