# The exp_iCustom_v5 Expert Advisor - expert for MetaTrader 4

Source: https://www.mql5.com/en/code/8524

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/8524) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# The exp\_iCustom\_v5 Expert Advisor - expert for MetaTrader 4

[Dmitry Fedoseev](/en/users/integer)  |
[English](javascript:void(false);)

[Русский](/ru/code/8524)

Views:
:   20258

Rating:
:   (18)

Published:
:   1 July 2016, 09:12

Updated:
:   22 November 2016, 07:32
:   [exp\_iCustom\_v5.mq4](/en/code/download/8524/exp_iCustom_v5.mq4 "exp_iCustom_v5.mq4")
    (127.38 KB)
    [view](# "view")

    [exp\_iCustom\_v6.mq4](/en/code/download/8524/exp_iCustom_v6.mq4 "exp_iCustom_v6.mq4")
    (139.19 KB)
    [view](# "view")

    [exp\_iCustom\_v7.zip](/en/code/download/8524/exp_iCustom_v7.zip "exp_iCustom_v7.zip")
    (19.72 KB)

    [Download as ZIP](/en/code/download/8524.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

New versions of the [exp\_iCustom](/en/code/7632) Expert Advisor, which works with any Custom indicator, and draws buy/sell arrows.

**Version 5:**

**Change the type of variables \_O\_M3\_BuyLevel, \_O\_M3\_SellLevel, \_C\_M3\_CloseBuyLevel, \_C\_M3\_CloseSellLevel, from int to double, to allow input of fractional numbers.**

More details can be found on the [**exp\_iCustom\_v1**](/en/code/7632) page.

**Version 6:**

Implemented the ability to include additional checks when closing orders based on the indicator: check of the order profit (close only orders with profit not less than specified), check of the order stop loss location (if stop loss fixes the specified profit, the order is not closed).

**Variables:**

* **==== Additional rules for closing ====**
* **CheckProfit** - Check the order profit when closing, orders with less than MinimalProfit profit are not closed
* **MinimalProfit** - see the CheckProfit variable
* **CheckSL** - If the stop loss of the order fixes a profit not less than MinimalSLProfit, the order is not closed
* **MinimalSLProfit** - see the CheckSL variable

**\* \* \***

Added ability of trailing based on custom indicator.

Any indicator can be used, for example, the [PriceChannel Stop NK](/en/code/8809) channel, two-colored alternating [NRTR WATR](/en/code/9819), that draws dots or arrows, and the order modification will only happen if a dot or arrow is present.

**Variables:**

* **=== Trailing by indicator ===**
* **\_TS\_ON** - enable trailing by indicator;
* **\_TS\_iCustomName** - name of the Custom indicator;
* **\_TS\_iCustomParam** - the list of parameters delimited by "/". For the boolean variables, use 1 instead of true, 0 instead of false. If the indicator parameters contain string variables, the EA will not work!!!;
* **\_TS\_iForBuyBufIndex** - index of the buffer for buy orders;
* **\_TS\_iForSellBufIndex** - index of the buffer for sell orders;
* **\_TS\_iShift** - indicator shift. 1 - on the formed bars, 0 - on the forming bar (not recommended). It is also possible to enter a value 2,3,4...
* **\_TS\_Opt\_1\_Use** - enable usage of the optimized variable 1. When the optimized variable is activated instead of the value from the iCustomParam string, defined by the Opt\_X\_Index variable, the value of the Opt\_X\_Value variable will be used;
* **\_TS\_Opt\_1\_Index** - index of the optimized variable 1 in the parameter array (in the iCustomParam string). The numbering starts with zero;
* **\_TS\_Opt\_1\_Value** - the value of the optimized variable 1;
* **\_TS\_Opt\_2\_Use** - enable usage of the optimized variable 2;
* **\_TS\_Opt\_2\_Index** - index of the optimized variable 2 in the parameter array (in the iCustomParam string). The numbering starts with zero;
* **\_TS\_Opt\_2\_Value** - the value of the optimized variable 2;
* **\_TS\_Opt\_3\_Use** - enable usage of the optimized variable 3;
* **\_TS\_Opt\_3\_Index** - index of the optimized variable 3 in the parameter array (in the iCustomParam string). The numbering starts with zero;
* **\_TS\_Opt\_3\_Value** - the value of the optimized variable 3;
* **\_TS\_Opt\_4\_Use** - enable usage of the optimized variable 4;
* **\_TS\_Opt\_4\_Index** - index of the optimized variable 4 in the parameter array (in the iCustomParam string). The numbering starts with zero;
* **\_TS\_Opt\_4\_Value** - the value of the optimized variable 4;
* **\_TS\_Opt\_5\_Use** - enable usage of the optimized variable 5;
* **\_TS\_Opt\_5\_Index** - index of the optimized variable 5 in the parameter array (in the iCustomParam string). The numbering starts with zero;
* **\_TS\_Opt\_5\_Value** - the value of the optimized variable 5;
* \_**TS\_Indent** - indent (in points) from the indicator value;
* **\_TS\_TrailInProfit** - minimum trailed profit. The stop loss is moved only in case it fixes not less than \_TS\_TrailInProfit points of profit.

**Version 6:**

Added the ability to use two-colored indicators **(\_O\_Mode=5, \_C\_Mode=5**). It is possible to use indicators like [NRTR NK](/en/code/8799), or colored moving averages, for example, [MA\_In\_Color\_wAppliedPrice](/en/code/7478).

A very large number of colored indicators can not be used, some indicators paint one bar in the past (in this case it is worth trying to increase the values of \_O\_iShift and \_C\_iShift by 1), others simply overlay lines of one color with lines of another color (these can not be used).

Added the MarketWatch mode - opening market orders without stop loss/take profit, which are set afterwards.

**New parameters:**

In the "Indicator for opening" parameters section:

* **\_O\_M5\_iBuyBufIndex** - index of the buffer for the line displayed during an uptrend;
* **\_O\_M5\_iSellBufIndex** - index of the buffer for the line displayed during a downtrend.

In the "Indicator for closing" parameters section:

* **\_C\_M5\_iBuyBufIndex** - index of the buffer for the line displayed during an uptrend;
* **\_C\_M5\_iSellBufIndex** - index of the buffer for the line displayed during a downtrend.

In the "Order" parameters section:

* **MW\_Mode** - enable the MarketWatch mode.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/8524](/ru/code/8524)

**Last comments |
[Go to discussion](/en/forum/90316)**
(3)

![chim](https://c.mql5.com/avatar/avatar_na2.png "chim")

**[chim](/en/users/chim)**
|
27 Jul 2016 at 14:59

Thank you very much. I have had
this indicator that i tried but
the problem is that it takes only
one trade and doesnt take any
other trade using your EA. What
might be the problem?

![DAtradr](https://c.mql5.com/avatar/avatar_na2.png "DAtradr")

**[DAtradr](/en/users/datradr)**
|
24 Apr 2022 at 11:04

Nice work...could you please add the option to use a second indicator(ema) to use for comfirmation for the main indicator the ea is using?

Ive played with the code, ema now running along side the main indy, but unfortunetly it still allows the main indy to trade that are not with the same trend of the ema,

![Ivan Razanen](https://c.mql5.com/avatar/2021/2/6025BAC4-9A5F.png "Ivan Razanen")

**[Ivan Razanen](/en/users/ivanrazanen)**
|
28 Apr 2023 at 17:30

Very good stuff! PLEASE do for mt5

![Brandy](https://c.mql5.com/i/code/expert.png)
[Brandy](/en/code/8508)

EA based on MA. As easy as pie :)

![Macd Support and Resistance](https://c.mql5.com/i/code/indicator.png)
[Macd Support and Resistance](/en/code/8506)

MACD on the chart.

![Open BUY v2](https://c.mql5.com/i/code/script.png)
[Open BUY v2](/en/code/8532)

The script opens a BUY order for a specified part of the FreeMargin (second edition).

![Euler - Euler number calculation](https://c.mql5.com/i/code/script.png)
[Euler - Euler number calculation](/en/code/8535)

The script demonstrates a simple and quick way to calculate the Euler number.