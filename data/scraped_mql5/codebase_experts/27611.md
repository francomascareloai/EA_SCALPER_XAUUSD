# SingleTesterCache - library for MetaTrader 5

Source: https://www.mql5.com/en/code/27611

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/27611) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# SingleTesterCache - library for MetaTrader 5

[fxsaber](/en/users/fxsaber)  |
[English](javascript:void(false);)

[Русский](/ru/code/27611) [中文](/zh/code/27611) [Español](/es/code/27611) [Deutsch](/de/code/27611) [日本語](/ja/code/27611) [Português](/pt/code/27611) [한국어](/ko/code/27611) [Français](/fr/code/27611) [Italiano](/it/code/27611) [Türkçe](/tr/code/27611)

Views:
:   1158

Rating:
:   (16)

Published:
:   3 April 2025, 11:15
:   \MQL5\Include\fxsaber\SingleTesterCache\

    [ExpTradeSummarySingle.mqh](/en/code/download/27611/exptradesummarysingle.mqh "ExpTradeSummarySingle.mqh")
    (10.32 KB)
    [view](# "view")

    [TesterPositionProfit.mqh](/en/code/download/27611/testerpositionprofit.mqh "TesterPositionProfit.mqh")
    (1.4 KB)
    [view](# "view")

    [TesterTradeState.mqh](/en/code/download/27611/testertradestate.mqh "TesterTradeState.mqh")
    (1.06 KB)
    [view](# "view")

    [TradeOrder.mqh](/en/code/download/27611/tradeorder.mqh "TradeOrder.mqh")
    (8.38 KB)
    [view](# "view")

    [ExpTradeSummaryExt.mqh](/en/code/download/27611/exptradesummaryext.mqh "ExpTradeSummaryExt.mqh")
    (10.08 KB)
    [view](# "view")

    [TradeDeal.mqh](/en/code/download/27611/tradedeal.mqh "TradeDeal.mqh")
    (16.52 KB)
    [view](# "view")

    [String.mqh](/en/code/download/27611/string.mqh "String.mqh")
    (1.79 KB)
    [view](# "view")

    [SingleTestCacheHeader.mqh](/en/code/download/27611/singletestcacheheader.mqh "SingleTestCacheHeader.mqh")
    (14.58 KB)
    [view](# "view")

    [SingleTesterCache.mqh](/en/code/download/27611/singletestercache.mqh "SingleTesterCache.mqh")
    (33.39 KB)
    [view](# "view")

    \MQL5\Scripts\fxsaber\

    [SingleTesterCache\_Example.mq5](/en/code/download/27611/singletestercache_example.mq5 "SingleTesterCache_Example.mq5")
    (0.4 KB)
    [view](# "view")

    \MQL5\Include\

    [TypeToBytes.mqh](/en/code/download/27611/typetobytes.mqh "TypeToBytes.mqh")
    (20.45 KB)
    [view](# "view")

    [Expand (11)](javascript:void(false))
    [Collapse (11)](javascript:void(false))

    [Download as ZIP](/en/code/download/27611.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

This library allows you to read/write tst files - MT5-Tester single pass format.

Some variants of use

[Forum on trading, automated trading systems and testing trading strategies](/ru/forum)

[MetaTrader 5 platform beta build 2155: Areas of visibility in MQL5, global update of strategy tester and inbuilt hosting](/ru/forum/322734/page9#comment_13428710)

[fxsaber](/ru/users/fxsaber), 2019.10.04 07:18 pm.

If they open the format of tst-files and **place the cache folder of the Tester in the sandbox**, it is possible to create Market products of a new type, which will be analysers/correctors of the Tester results.

For example, it will be possible to write a Market-combine that shows all single passes available in the cache.

* You select the necessary ones with the mouse and it shows the combined statistics.
* It cleans the cache from unnecessary passes.
* Calculates the optimal portfolio with appropriate weighting coefficients from the passes.
* Shows the best trading intervals for each pass.
* Offers its own interactive visualisation of statistics, including filters.
* Calculates the optimal MM.
* For each hedge position in history shows OrderOpenPriceBest (the best opening price during the lifetime of the position), OrderClosePriceBest (similar), OrderOpenPriceLength (how long the price was not worse than OrderOpenPrice during the lifetime of the position), OrderClosePriceLength (similar), OrderProfitBest (the highest possible profit of a similar position during the lifetime of the original position).
* Shows the efficiency of each hedge position.
* Calculates the result when latency is enabled.
* Calculates the result at different [order execution](/ru/docs/constants/tradingconstants/orderproperties#enum_order_property_integer "MQL5 Documentation: Order Properties") settings (whether they slide, etc.) and commissions.
* Shows the result of the TS on a different tick history.
* ...

You don't need to launch the Tester to implement each item.

All this can be done now, if you put the cache folder into the sandbox via mklink. You only need tst-format.

Whoever feels the strength in himself should probably start writing such a product. I would gladly join the team of its developers and purchase it. The niche is completely empty.

If cache-folder is not sandboxed, there may be an increased chance that similar products will appear outside the MQ ecosystem, as they will be written in other languages.

### Examples.

```mql5
#include <fxsaber\SingleTesterCache\SingleTesterCache.mqh> // Tester's single pass data.

void OnStart()
{  
  SINGLETESTERCACHE SingleTesterCache; // Created a tester cache object.
  
  SingleTesterCache.Set(); // Put the real story of the bidding in it.
  
// ..\.\.\MQL5\Files/Test.tst.
  Print(SingleTesterCache.Save("Test.tst")); // Write it to a file that can be imported into the Tester.
}
```

This script corrals real account trading history into tst format. It is imported into the Tester as follows.

[![](https://c.mql5.com/18/160/SingleTesterCache1__1.png)](https://c.mql5.com/18/160/SingleTesterCache1.png "https://c.mql5.com/18/87/SingleTesterCache1.png")

It turns out something like this.

[![](https://c.mql5.com/18/160/SingleTesterCache2__1.png)](https://c.mql5.com/18/160/SingleTesterCache2.png "https://c.mql5.com/18/87/SingleTesterCache2.png")

[![](https://c.mql5.com/18/160/SingleTesterCache3__1.png)](https://c.mql5.com/18/160/SingleTesterCache3.png "https://c.mql5.com/18/87/SingleTesterCache3.png")

DLL-solutions cannot be placed in KB, so below is the source code of another script, which is not included in KB delivery.

```mql5
#include <fxsaber\SingleTesterCache\SingleTesterCache.mqh> // Tester's single pass data.

#include <Graphics\Graphic.mqh>
#include <fxsaber\MultiTester\MTTester.mqh> // https://www.mql5.com/en/code/26132

#define  MIN_WIDTH 10

// Creating a graph.
string GraphPlot( const double &Y1[], const double &Y2[],
                  int Width = 0, int Height = 0, const ENUM_CURVE_TYPE Type = CURVE_NONE,
                  const string CurveName1 = NULL, const string CurveName2 = NULL, string ObjName = NULL )
{
  Width = Width ? Width : (int)::ChartGetInteger(0, CHART_WIDTH_IN_PIXELS);
  Height = Height ? Height : (int)::ChartGetInteger(0, CHART_HEIGHT_IN_PIXELS);
  ObjName = (ObjName == NULL) ? __FUNCTION__ : ObjName;

  CGraphic Graphic;

  const bool Res = (::ObjectFind(0, ObjName) >= 0) ? Graphic.Attach(0, ObjName) : Graphic.Create(0, ObjName, 0, 0, 0, Width, Height);

  if (Res)
  {
    const int Size1 = ::ArraySize(Y1);
    const int Size2 = ::ArraySize(Y2);

    Graphic.CurveAdd(Y1, ((Type == CURVE_NONE) && Size1) ? ((Width / Size1 < MIN_WIDTH) ? CURVE_LINES : CURVE_POINTS_AND_LINES) : Type, CurveName1);
    Graphic.CurveAdd(Y2, ((Type == CURVE_NONE) && Size2) ? ((Width / Size2 < MIN_WIDTH) ? CURVE_LINES : CURVE_POINTS_AND_LINES) : Type, CurveName2);

    Graphic.CurvePlotAll();
    Graphic.Update();
  }

  return (Res ? Graphic.ChartObjectName() : NULL);
}

void OnStart()
{  
  uchar Bytes2[];
  
  if (MTTESTER::GetLastTstCache(Bytes2) != -1) // If it was possible to read the last cache record of a single run
  {
    const SINGLETESTERCACHE SingleTesterCache(Bytes2); // Drive it into the corresponding object.

    SingleTesterCache.SaveSet(NULL, true, "Created by " + __FILE__); // Save the set file with details.
    
    double Balance[];
    double Equity[];
  
    // Print the balance and equity chart.
    if (SingleTesterCache.GetBalance(Balance) && SingleTesterCache.GetEquity(Equity))
      GraphPlot(Balance, Equity, 1200, 500, CURVE_NONE, "Balance", "Equity");
      
    Print(SingleTesterCache.Header.ToString());  // Output the header of a single pass.
    Print(SingleTesterCache.Summary.ToString()); // Statistica.
    Print(SingleTesterCache.Inputs);             // Input parameters.
  }
}
```

This script will automatically pick up the data of the last single pass and output its data, including a balance/equity graph.

[![](https://c.mql5.com/18/160/SingleTesterCache4__1.png)](https://c.mql5.com/18/160/SingleTesterCache4.png "https://c.mql5.com/18/87/SingleTesterCache4.png")

### Acknowledgements.

> Thanks to the developers for creating the Tester caches and helping me to unpack its formats.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/27611](/ru/code/27611)

**Last comments |
[Go to discussion](/en/forum/484122)**
(44)

![Forester](https://c.mql5.com/avatar/2013/10/52601B64-7C6E.jpg "Forester")

**[Forester](/en/users/elibrarius)**
|
18 Nov 2023 at 12:57

**fxsaber [#](/ru/forum/330333/page4#comment_50601731):**  

I may surprise you, but tst-file does not store majics (and milliseconds): [orders](/ru/code/viewcode/27611/286869/tradeorder.mqh), [deals](/ru/code/viewcode/27611/286869/tradedeal.mqh). The tst-file stores already [calculated statistics](/ru/forum/1111/page3415#comment_50389363). Therefore, any change of the trading history in the tst-file will not affect the statistics. Importing a tst-file into the Tester is only visualisation of the file contents, but not calculation.

You can stuff tst into Virtual (either [directly](/ru/blogs/post/746170) or via [objects](/ru/blogs/post/749562)) and filter/feed it to the same Report or even to an already built CustomReport. You can feed Virtual to any third-party MQL4 code[(example](/ru/blogs/post/754817)).

Thank you. I decided to send trades unnecessary for the report to the virtual tester, and the necessary ones to the real one. I think this is the best option.

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
18 Nov 2023 at 13:10

**Forester [#](/ru/forum/330333/page4#comment_50601810):**  
 Thank you. I decided to send unnecessary deals to the virtual tester and necessary ones to the real one. I think this is the optimal option.

I see the value of importing tst-file only in convenient visualisation of statistics and transfer of trading history (any history can be transferred to another). In Virtual [part of TesterStatistics is available](/ru/code/viewcode/22577/290021/historyorders.mqh) at any moment, so without additional calculations you can make a converter Virtual->tst. I myself optimise everything only in Virtual, and do single trades without Virtual. This way I can achieve the highest optimisation speed and convenience of single passes[(TesterDashboard](/ru/blogs/post/746249), etc.).

![traveller00](https://c.mql5.com/avatar/avatar_na2.png "traveller00")

**[traveller00](/en/users/traveller00)**
|
22 Jan 2024 at 12:16

Has something been updated?

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
22 Jan 2024 at 12:30

**traveller00 [#](/ru/forum/330333/page5#comment_51852856):**  
 Anything updated?

Two files at the bottom.

![fxsaber](https://c.mql5.com/avatar/2019/8/5D67260D-44C9.png "fxsaber")

**[fxsaber](/en/users/fxsaber)**
|
13 Mar 2024 at 11:06

TesterString and GetMaxLengthDD have been added.

![PSAR Zigzag (Non lagging)](https://c.mql5.com/i/code/indicator.png)
[PSAR Zigzag (Non lagging)](/en/code/57724)

A zigzag based on the trend change of the parabolic sar

![Candlestick Analysis EA R1](https://c.mql5.com/i/code/expert.png)
[Candlestick Analysis EA R1](/en/code/57689)

This MT5 Expert Advisor combines multi-timeframe candlestick pattern analysis with fundamental event filtering to execute trades with disciplined risk management.

![Calendar](https://c.mql5.com/i/code/library.png)
[Calendar](/en/code/32430)

Calendar - fundamental analysis on history and real-time.

![Detecting the start of a new bar or candle](https://c.mql5.com/i/code/expert.png)
[Detecting the start of a new bar or candle](/en/code/41601)

Detecting the start of a new bar or candle in an Expert Advisor's OnTick() event handler.