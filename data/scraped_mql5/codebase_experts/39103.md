# Detecting the start of a new bar or candle - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/39103

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/39103) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Detecting the start of a new bar or candle - expert for MetaTrader 5

[Fernando Carreiro](/en/users/fmic)

Views:
:   10876

Rating:
:   (36)

Published:
:   24 April 2022, 00:38

Updated:
:   25 April 2022, 09:58
:   [NewBar.mq5](/en/code/download/39103/newbar.mq5 "NewBar.mq5")
    (2.8 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/39103.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

For an *Expert Advisor (EA)*, when a new tick quote arrives, the *MetaTrader* terminal calls the default [***OnTick()***](/en/docs/event_handlers/ontick) event handling function. However, there is no default event handling function for when a new bar (candle) starts or opens.

To detect this, one needs to monitor the opening time of the currently most recent bar. Once it changes, it signifies the start of a new bar, and one can react to it and handle the event. The following sample code, compatible with both MQL4 and MQL5, shows one such method on how this can be achieved:

> ```mql5
> // Default tick event handler
>    void OnTick()
>    {
>       // Check for new bar (compatible with both MQL4 and MQL5).
>          static datetime dtBarCurrent  = WRONG_VALUE;
>                 datetime dtBarPrevious = dtBarCurrent;
>                          dtBarCurrent  = iTime( _Symbol, _Period, 0 );
>                 bool     bNewBarEvent  = ( dtBarCurrent != dtBarPrevious );
> 
>       // React to a new bar event and handle it.
>          if( bNewBarEvent )
>          {
>             // Detect if this is the first tick received and handle it.
>                /* For example, when it is first attached to a chart and
>                   the bar is somewhere in the middle of its progress and
>                   it's not actually the start of a new bar. */
>                if( dtBarPrevious == WRONG_VALUE )
>                {
>                   // Do something on first tick or middle of bar ...
>                }
>                else
>                {
>                   // Do something when a normal bar starts ...
>                };
> 
>             // Do something irrespective of the above condition ...
>          }
>          else
>          {
>             // Do something else ...
>          };
> 
>       // Do other things ...
>    };
> ```

In the above code, the [static variable](/en/docs/basis/variables/static) keeps track of the bar's opening time, even when returning from the *OnTick()* function. Unlike a normal local variable, it memorizes its data content and does not release it when leaving the function. This is the key to detecting a change in the opening time of the current bar.

It's also important to note, that when the EA is first placed on a chart, the above code reacts as if the bar has just opened. This condition requires special handling if the situation needs to be handled differently.

Please note, that all my *CodeBase* publications' source code are now also available in "Public Projects" tab of *MetaEditor* under the name "FMIC".

**Last comments |
[Go to discussion](/en/forum/403164)**
(2)

![Fernando Carreiro](https://c.mql5.com/avatar/2025/9/68d40cf8-38fb.png "Fernando Carreiro")

**[Fernando Carreiro](/en/users/fmic)**
|
23 Nov 2022 at 19:29

**[Private Message]: hi i came across in codebase the code you wrote for "Detecting the start of a new bar or candle" i am trying to make my EA look at the signal indicator after every 60 minutes would this piece of code help me or is there another project in codebase that could help explain to me better what i am trying to do.**

Yes, if you use the H1 time-frame or place the EA on a H1 chart then at the start of each H1 bar you can retrieve the indicator data.

![Fernando Carreiro](https://c.mql5.com/avatar/2025/9/68d40cf8-38fb.png "Fernando Carreiro")

**[Fernando Carreiro](/en/users/fmic)**
|
1 Sep 2023 at 14:37

[Forum on trading, automated trading systems and testing trading strategies](/en/forum)

[I want place an order at the beginning of a new candle in Renko chart.](/en/forum/441379/page2#comment_44977398)

[Fernando Carreiro](/en/users/FMIC), 2023.02.13 11:29

> ```mql5
> // Default tick event handler
>    void OnTick() {
>       // Check for new renko brick
>          static datetime dtBrickTimeCurrent  = WRONG_VALUE;
>          static double   dbBrickOpenCurrent  = WRONG_VALUE;
>                 datetime dtBrickTimePrevious = dtBrickTimeCurrent;
>                 double   dbBrickOpenPrevious = dbBrickOpenCurrent;
>                          dtBrickTimeCurrent  = iTime( _Symbol, _Period, 0 );
>                          dbBrickOpenCurrent  = iOpen( _Symbol, _Period, 0 );
>                 bool     bNewBrickEvent      = ( dtBrickTimeCurrent != dtBrickTimePrevious ) ||
>                                                ( dbBrickOpenCurrent != dbBrickOpenPrevious );
>       // React to a new brick event and handle it.
>          if( bNewBrickEvent ) {
>             // Detect if this is the first tick received and handle it.
>                /* For example, when it is first attached to a chart and
>                   the brick is somewhere in the middle of its progress and
>                   it's not actually the start of a new brick. */
>                if( dtBrickTimePrevious == WRONG_VALUE ||
>                    dbBrickOpenPrevious == WRONG_VALUE    ) {
>                   // Do something on first tick or middle of brick ...
>                } else {
>                   // Do something when a normal brick starts ...
>                };
>             // Do something irrespective of the above condition ...
>          } else {
>             // Do something else ...
>          };
>       // Do other things ...
>    };
> ```

![Trend Two Lines](https://c.mql5.com/i/code/indicator.png)
[Trend Two Lines](/en/code/39075)

The indicator in the subwindow shows a comparison of High and Low prices

![Listing all MT5 Signals' properties to a CSV file](https://c.mql5.com/i/code/script.png)
[Listing all MT5 Signals' properties to a CSV file](/en/code/39071)

This simple quick & dirty script code will output a CSV file of all the Signals' properties as reported by the MQL5 Trade Signals functionality.

![Trading Volume Line](https://c.mql5.com/i/code/indicator.png)
[Trading Volume Line](/en/code/39107)

The indicator compares OHLC prices

![ZigZagExtremaOnArray](https://c.mql5.com/i/code/library.png)
[ZigZagExtremaOnArray](/en/code/39114)

The ZigZagExtremaOnArray is an mqh include file which contains the calculation function of MetaQuotes' Examples ZigZag, BUT you can use it on any buffer that contains curves or histograms, similarly to the MovingAverages.mqh from include. The idea was to get highs and lows of an indicator curve quickly with the help of an "onBuffer" function.