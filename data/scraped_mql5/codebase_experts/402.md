# Donchian Channels - indicator for MetaTrader 5

Source: https://www.mql5.com/en/code/402

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/402) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Indicators](https://c.mql5.com/i/code/indicator.png)

# Donchian Channels - indicator for MetaTrader 5

[Nikolay Kositsin](/en/users/godzilla)  |
[English](javascript:void(false);)

[Русский](/ru/code/402) [中文](/zh/code/402) [Español](/es/code/402) [Deutsch](/de/code/402) [日本語](/ja/code/402) [Português](/pt/code/402) [한국어](/ko/code/402) [Français](/fr/code/402) [Italiano](/it/code/402) [Türkçe](/tr/code/402)

Views:
:   54680

Rating:
:   (69)

Published:
:   5 August 2011, 15:04

Updated:
:   22 November 2016, 07:32
:   [donchian\_channels.mq5](/en/code/download/402/donchian_channels.mq5 "donchian_channels.mq5")
    (10.41 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/402.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Real author:**

Richard Donchian

Richard Donchian is a legendary figure in trading. He is often called a founder of the trend following systems. The famous Turtle trading system is based on his works. Donchian came to a serious success when he was in quite an old age already. Despite that, he continued working and proved to be a successful trader showing by his own example that no one is too old for trading.

Donchian Channels is a volatility indicator based on the calculation of the current price range with the help of the recent highest and lowest prices. All that is needed to calculate the Channel is to find the highest maximum and the lowest minimum for a definite period.

Richard Donchian himself recommended to use period 20 to build the Channel. In those days trading was usually conducted on day charts and 20 is exactly an average number of days in a month. Nevertheless, period 20 is also quite convenient for creation of Donchian Channels on lesser timeframes. Results of building the Channels with the periods 18, 24 etc. are also quite interesting. "The Turtles" used the period 55 (for market entry).

Most of trading systems using Donchian Channels are breakout ones, they have a small per cent of profitable deals that must be enough to compensate the losses from a big amount of wrong entries over and above.

The Channel center line is also added in this version of the indicator (aside from the upper and lower border lines).

![Donchian Channels](https://c.mql5.com/18/3/Donchian_Channels__1.png "Donchian Channels")

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/402](/ru/code/402)

**Last comments |
[Go to discussion](/en/forum/4338)**
(12)

![Marco vd Heijden](https://c.mql5.com/avatar/2021/9/613A9489-6810.png "Marco vd Heijden")

**[Marco vd Heijden](/en/users/thecreator1)**
|
13 Jan 2019 at 16:30

Because it calles back 20 (usually) candles at [every tick](/en/articles/239 "Article \"The Fundamentals of Testing in MetaTrader 5\"").

It should be obvious that takes time.

![Otto Pauser](https://c.mql5.com/avatar/2016/5/574C2261-ACAB.JPG "Otto Pauser")

**[Otto Pauser](/en/users/kronenchakra)**
|
31 Jan 2019 at 00:41

This [indicator](https://www.mql5.com/en/docs/constants/indicatorconstants/lines "Reference book MQL5 : Indicator lines") only works correctly if margin is set to 0, the colours are invalid, everything is obsolete.

![](https://c.mql5.com/3/266/ukfj.JPG)

Here is a revised, code reduced, version. 86 lines instead of 232 lines.

```mql5
//+------------------------------------------------------------------+
//|DCCH.mq5 |
//|Copyright © 2018 Ing. Otto Pauser |
//| https://www.mql5.com/en/users/kronenchakra |
//+------------------------------------------------------------------+
#property copyright     "Copyright © 2019 Ing. Otto Pauser"
#property link          "https://www.mql5.com/en/users/kronenchakra"
#property version       "1.0"
#property description   "DCCH - Donchian Channel corrected and simplified"

#property indicator_chart_window
#property indicator_buffers 3
#property indicator_plots   3

//+------------------------------------------------------------------+
input int   inp_Period     =           20;   // Period
input int   inp_Offset     =            0;   // Offset (points)
input int   inp_Shift      =            0;   // Shift
input int   inp_LineWidth  =            2;   // Linewidth
input color inp_lineColor  = clrSteelBlue;   // Linecolour
//+------------------------------------------------------------------+

double buUpper[];
double buMidle[];
double buLower[];

double upper,lower,offset;
int    first,bar;

//+------------------------------------------------------------------+
void OnInit()
{
   InitBuffer(buUpper,"Donchian Upper");
   InitBuffer(buMidle,"Donchian Center");
   InitBuffer(buLower,"Donchian Lower");
   IndicatorSetString(INDICATOR_SHORTNAME,"Donchian("+IntegerToString(inp_Period)+")");
   offset=inp_Offset*_Point;
}

//+------------------------------------------------------------------+
int OnCalculate(const int rates_total,
                const int prev_calculated,
                const datetime &time[],
                const double &open[],
                const double &high[],
                const double &low[],
                const double &close[],
                const long &tick_volume[],
                const long &volume[],
                const int &spread[])
{
   if(rates_total<inp_Period+1) return(0);

   first=(prev_calculated==0)?inp_Period:prev_calculated-1;

   for(bar=first; bar<rates_total; bar++)
      {
         upper=high[ArrayMaximum(high,bar-inp_Period+1,inp_Period)];
         lower=low [ArrayMinimum(low ,bar-inp_Period+1,inp_Period)];
         buUpper[bar]=upper+offset;
         buLower[bar]=lower-offset;
         buMidle[bar]=(upper+lower)*0.5;
      }

   return(rates_total);
}

//+------------------------------------------------------------------+
//| could be outsourced to a .mqh|
//+------------------------------------------------------------------+
void InitBuffer(double &buffer[], string plotlabel)
{
   static int bufferindex=0;
   SetIndexBuffer     (bufferindex,buffer,INDICATOR_DATA);

   PlotIndexSetInteger(bufferindex,PLOT_DRAW_TYPE ,DRAW_LINE);
   PlotIndexSetInteger(bufferindex,PLOT_LINE_STYLE,STYLE_SOLID);
   PlotIndexSetInteger(bufferindex,PLOT_LINE_WIDTH,inp_LineWidth);
   PlotIndexSetInteger(bufferindex,PLOT_LINE_COLOR,inp_lineColor);
   PlotIndexSetString (bufferindex,PLOT_LABEL     ,plotlabel);
   PlotIndexSetInteger(bufferindex,PLOT_SHIFT     ,inp_Shift);
   PlotIndexSetInteger(bufferindex,PLOT_DRAW_BEGIN,inp_Period-1);
   PlotIndexSetDouble (bufferindex,PLOT_EMPTY_VALUE,EMPTY_VALUE);

   bufferindex++;
}
```

![TheNinjaTrader](https://c.mql5.com/avatar/2020/6/5EF79C14-C6E8.png "TheNinjaTrader")

**[TheNinjaTrader](/en/users/theninjatrader)**
|
11 Jul 2020 at 19:18

Complete newbie at bringing up indicators onto experts, would anyone be able to help me get the coding right for calling up the upper,middle and lower bands?

thanks guys and sorry for the noob question, first time

![Ahmet Olcer](https://c.mql5.com/avatar/2020/12/5FD9DA6E-3810.png "Ahmet Olcer")

**[Ahmet Olcer](/en/users/aolcer)**
|
28 Jan 2021 at 10:59

Hi,

iHighest and iLowest functions are so slow into the indicator code. I used ArrayMaximum and [ArrayMinimum functions](https://www.mql5.com/en/docs/array/arrayminimum "MQL5 documentation: ArrayMinimum function") in the OnCalculate event and it is faster than original code.

So you can use like this

         case HIGH\_LOW:

            //SsMax=high[iHighest(high,DonchianPeriod,bar)];

            //SsMin=low[iLowest(low,DonchianPeriod,bar)];

            SsMax=high[ArrayMaximum(high,bar-(DonchianPeriod-1),DonchianPeriod)];

            SsMin=low [ArrayMinimum(low,bar-(DonchianPeriod-1),DonchianPeriod)];

            break;

![AuAgInvest](https://c.mql5.com/avatar/avatar_na2.png "AuAgInvest")

**[AuAgInvest](/en/users/auaginvest)**
|
25 Jun 2024 at 18:26

Who do the min and max values of the channel in the data window not correspond exactly to the min or max values of the bar that the high or low was calculated from?

You can even see it in the screenshot provided by the OP; the high mark is not a straight line, but it wiggles a few ticks up and down, even though the real high value has not changed. Why is that?

Anyone know why that happens?

Does the "high" array not correspond to the high that is plotted by the bars on the chart?

![Entropy](https://c.mql5.com/i/code/indicator.png)
[Entropy](/en/code/397)

The indicator that demonstrates the power of price changes entropy.

![Support and Resistance](https://c.mql5.com/i/code/indicator.png)
[Support and Resistance](/en/code/401)

The "Support and Resistance" indicator shows the support and resistance levels using the Fractals indicator by Bill Williams.

![Keltner Channel](https://c.mql5.com/i/code/indicator.png)
[Keltner Channel](/en/code/399)

Keltner Channel is volatility-based envelopes set above and below an exponential moving average.

![CoeffofLine](https://c.mql5.com/i/code/indicator.png)
[CoeffofLine](/en/code/410)

CoeffofLine indicator shows the most likely future price direction (2-3 bars).