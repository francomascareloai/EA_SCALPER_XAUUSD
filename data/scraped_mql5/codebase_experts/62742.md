# Multi_Divergence_EA - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/62742

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/62742) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Multi\_Divergence\_EA - expert for MetaTrader 5

[Le Trung Kien Hoang](/en/users/kienasiy123)  |
[English](javascript:void(false);)

[–†—É—Å—Å–∫–∏–π](/ru/code/62742) [‰∏≠Êñá](/zh/code/62742) [Espa√±ol](/es/code/62742) [Deutsch](/de/code/62742) [Êó•Êú¨Ë™û](/ja/code/62742) [Portugu√™s](/pt/code/62742) [ÌïúÍµ≠Ïñ¥](/ko/code/62742) [Fran√ßais](/fr/code/62742) [Italiano](/it/code/62742) [T√ºrk√ße](/tr/code/62742)

Views:
:   4914

Rating:
:   (4)

Published:
:   17 August 2025, 16:41
:   [Multi\_Divergence.mq5](/en/code/download/62742/multi_divergence.mq5 "Multi_Divergence.mq5")
    (18.45 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/62742.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

### Multi-Divergence EA with Confluence and Filters

This Expert Advisor is designed to automate a sophisticated trading strategy based on¬† **market divergence**. The core idea is to identify high-probability reversal points by finding a¬† **confluence of signals**¬†from three of the most widely used oscillators: the Relative Strength Index (RSI), Moving Average Convergence Divergence (MACD), and the Stochastic Oscillator.

### How The Strategy Works

The EA's logic is built upon a multi-layered confirmation process to ensure high-quality trade signals and filter out market noise.

1. **Divergence Detection:**¬†The EA constantly scans the price action and the three indicators to find divergences.

   * **Bullish Divergence (Potential Buy Signal):**¬†Occurs when the price makes a new lower low, but an indicator fails to do so, instead making a higher low. This suggests that the bearish momentum is weakening and a bullish reversal may be imminent.
   * **Bearish Divergence (Potential Sell Signal):**¬†Occurs when the price makes a new higher high, but an indicator makes a lower high. This indicates that the bullish momentum is fading, signaling a potential bearish reversal.
2. **The Power of Confluence:**¬†The EA's unique strength is that it does not rely on a single indicator. Instead, it waits for a user-defined number of indicators (MinConfirmations) to show divergence simultaneously. For example, a trade will only be triggered if at least 2 out of the 3 indicators confirm the same divergence, significantly increasing the signal's reliability.
3. **Advanced Signal Filtering (Optional):**¬†To further improve accuracy, two additional filters can be enabled:

   * **Trend Filter:**¬†Uses a 50-period EMA to determine the overall market trend. If enabled, the EA will only enter buy trades when the price is above the EMA and sell trades when the price is below it. This helps to avoid trading against the dominant market momentum.
   * **Volume Filter:**¬†A trade signal is only considered valid if the volume of the signal bar is significantly higher than the average volume of the preceding bars. This confirms that there is strong market interest and conviction behind the potential reversal.

### Input Parameters Explained

All external variables are fully customizable to allow you to tailor the strategy to your preferences.

**=== Risk Management ===**

* LotSize: Sets the fixed trading volume if¬†UseMoneyManagement¬†is¬†false.
* StopLoss: The stop loss in points.
* TakeProfit: The take profit in points.
* MaxSpread: The maximum allowed spread in points for opening a new position.
* UseMoneyManagement: If¬†true, the EA automatically calculates the lot size based on¬†RiskPercent.
* RiskPercent: The percentage of your account equity to risk per trade.

**=== Divergence Settings ===**

* RSI\_Period,¬†MACD\_Fast,¬†MACD\_Slow,¬†MACD\_Signal,¬†Stoch\_K,¬†Stoch\_D,¬†Stoch\_Slowing: These are the standard input parameters for the RSI, MACD, and Stochastic indicators.

**=== Divergence Detection ===**

* BarsToCheck: The number of recent bars the EA will scan for divergence patterns.
* MinBarsDistance: The minimum number of bars on each side of a peak/trough to validate it. This helps ignore minor price fluctuations.
* MinDivergenceStrength: A filter for the minimum required strength of the divergence signal (0-1).
* MinConfirmations: A crucial parameter. Sets the minimum number of indicators (from 1 to 3) that must show divergence for a trade to be opened.
* UseVolumeFilter: Set to¬†true¬†to enable the volume confirmation filter.
* UseTrendFilter: Set to¬†true¬†to enable the EMA-based trend filter.

**=== Trading Settings ===**

* AllowBuy¬†/¬†AllowSell: Enable or disable long or short trades.
* MaxTrades: The maximum number of concurrent trades allowed.
* MagicNumber: A unique identifier for the EA's trades, preventing interference with other robots.

### Recommended Usage

* **Symbols:**¬†The strategy is universal and can be applied to any major currency pairs (e.g., EURUSD, GBPUSD) and other liquid instruments.
* **Timeframe:**¬†Divergence signals are generally more reliable on higher timeframes. It is recommended to use this EA on¬† **H1, H4, or D1**¬†charts to filter out market noise and capture more significant market moves.

**Last comments |
[Go to discussion](/en/forum/493449)**
(4)

![Tom Bardo](https://c.mql5.com/avatar/2022/4/624AE828-FC63.png "Tom Bardo")

**[Tom Bardo](/en/users/tombardo)**
|
13 Oct 2025 at 11:16

The EA doesn't open any trades. Worthless.

![Michael Charles Schefe](https://c.mql5.com/avatar/2021/5/60ADC6A5-6810.gif "Michael Charles Schefe")

**[Michael Charles Schefe](/en/users/ausimike)**
|
13 Oct 2025 at 15:58

**Automated-Trading:**  

[Multi\_Divergence\_EA](/en/code/62742):

Author: [Le Trung Kien Hoang](/en/users/kienasiy123 "kienasiy123")

these codes on codebase need to be checked!

This is why it dont work! Seriously!

```mql5
double Ask = SYMBOL_ASK;
double Bid = SYMBOL_BID;
```

...and these variables are not updated even 1 time in OnTick.

![Conor Mcnamara](https://c.mql5.com/avatar/2025/9/68dab3ec-4506.png "Conor Mcnamara")

**[Conor Mcnamara](/en/users/phade)**
|
13 Oct 2025 at 21:23

**Michael Charles Schefe [#](/en/forum/493449#comment_58257988):**  

these codes on codebase need to be checked!

This is why it dont work! Seriously!

...and these variables are not updated even 1 time in OnTick.

there was also an EA someone else posted which used MathRand for the indicator periods!

I don't know why people are even uploading these things. What is the purpose?

![Silk Road Trading LLC](https://c.mql5.com/avatar/2025/5/68239006-fc9d.png "Silk Road Trading LLC")

**[Ryan L Johnson](/en/users/rjo)**
|
13 Oct 2025 at 21:27

**Conor Mcnamara [#](/en/forum/493449#comment_58260267):**  

What is the purpose?

To give other people hands-on coding experience? üòÇ

![Average Range](https://c.mql5.com/i/code/indicator.png)
[Average Range](/en/code/54247)

It is an indicator that determines target levels according to the average of price movements.

![Tarantella](https://c.mql5.com/i/code/expert.png)
[Tarantella](/en/code/62713)

Tarantella EA: Advanced grid trading system with hedging capabilities and Market Profile integration. Uses ADX trend filtering, Fibonacci-based grid spacing, and multi-layered entry conditions (RSI/ATR/volume) to execute trades only within Market Profile value areas. Features intelligent risk management including trailing stops, breakeven triggers, and partial hedge closing.

![A powerful and feature-rich JSON library for MQL5, designed to bring a modern development experience similar to Python/JS](https://c.mql5.com/i/code/library.png)
[A powerful and feature-rich JSON library for MQL5, designed to bring a modern development experience similar to Python/JS](/en/code/62735)

A powerful and feature-rich JSON library for MQL5, designed to bring a modern development experience similar to Python/JS

![Spread lister - current, min, max](https://c.mql5.com/i/code/expert.png)
[Spread lister - current, min, max](/en/code/62784)

EA Spread lister shows the current, min and max values for all symbols / instruments.