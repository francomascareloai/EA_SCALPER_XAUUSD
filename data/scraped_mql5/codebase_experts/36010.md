# Close All Orders and Positions - script for MetaTrader 5

Source: https://www.mql5.com/en/code/36010

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Telegram](https://t.me/mql5dev)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/36010) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Scripts](https://c.mql5.com/i/code/script.png)

# Close All Orders and Positions - script for MetaTrader 5

[Omega J Msigwa](/en/users/omegajoctan)

Views:
:   53350

Rating:
:   (46)

Published:
:   16 August 2021, 09:25

Updated:
:   27 February 2022, 10:59
:   [Close All Orders and Positions.mq5](/en/code/download/36010/close_all_orders_and_positions.mq5 "Close All Orders and Positions.mq5")
    (3.75 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/36010.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

It happens sometimes when you've been creating and EA and you haven't noticed a bug that causes too many positions if not orders to be opened . or maybe there was a trade execution code outside the If statement somewhere in the Ontick that Opens trade in  the background on MT5 while you are on Metaeditor

It's boring trying to close too many orders and positions manually and it's time consuming. Lets Create the script that can close all of them.

**01: Instantiate the Libraries to use**

```mql5
#include <Trade\Trade.mqh> //Instatiate Trades Execution Library
#include <Trade\OrderInfo.mqh> //Instatiate Library for Orders Information
#include <Trade\PositionInfo.mqh> //Instatiate Library for Positions Information
//---
CTrade         m_trade; // Trades Info and Executions library
COrderInfo     m_order; //Library for Orders information
CPositionInfo  m_position; // Library for all position features and information
```

**02: Our simple inputs**

```mql5
input          color    OrdersColor = clrDodgerBlue; // Orders counter color on the chart
input          color    PositionsColor = clrGreenYellow; //Positions counter color on the chart
```

**03: (OPTIONAL)**Let's Draw Object on the chart to count the number of Positions and orders available to our trade section of MT5.

```mql5
   ChartWrite("Positions", "Positions " + (string)PositionsTotal(), 100, 80, 20, clrGreen); // write number of positions on the chart
   ChartWrite("Orders", "Orders " + (string)OrdersTotal(), 100, 50, 20, clrDodgerBlue); //Write Number of Orders on the Chart
```

04: Let Our Script deal with Positions First by closing them all

```mql5
      for(int i = PositionsTotal() - 1; i >= 0; i--) // loop all Open Positions
         if(m_position.SelectByIndex(i))  // select a position
           {
            m_trade.PositionClose(m_position.Ticket()); // then delete it --period
            Sleep(100); // Relax for 100 ms
            ChartWrite("Positions", "Positions " + (string)PositionsTotal(), 100, 80, 20, PositionsColor); //Re write number of positions on the chart
           }
```

**05: Then Finish by Closing Our Orders**

```mql5
      for(int i = OrdersTotal() - 1; i >= 0; i--) // loop all orders available
         if(m_order.SelectByIndex(i))  // select an order
           {
            m_trade.OrderDelete(m_order.Ticket()); // delete it --Period
            Sleep(100); // Relax for 100 ms
            ChartWrite("Orders", "Orders " + (string)OrdersTotal(), 100, 50, 20, OrdersColor); //Re Write Number of Orders on the Chart
           }

```

This is where our objects were initialized. To learn about objects read the documentation [HERE](/en/docs/objects)

```mql5

void ChartWrite(string  name,
                string  comment,
                int     x_distance,
                int     y_distance,
                int     FontSize,
                color   clr)
  {
   ObjectCreate(0, name, OBJ_LABEL, 0, 0, 0);
   ObjectSetInteger(0, name, OBJPROP_CORNER, CORNER_LEFT_UPPER);
   ObjectSetInteger(0, name, OBJPROP_COLOR, clr);
   ObjectSetString(0, name, OBJPROP_TEXT, comment);
   ObjectSetInteger(0, name, OBJPROP_FONTSIZE, FontSize);
   ObjectSetString(0, name,  OBJPROP_FONT, "Lucida Console");
   ObjectSetInteger(0, name, OBJPROP_SELECTABLE, false);
   ObjectSetInteger(0, name, OBJPROP_XDISTANCE, x_distance);
   ObjectSetInteger(0, name, OBJPROP_YDISTANCE, y_distance);
  }
//+------------------------------------------------------------------+
//|                                                                  |
//+------------------------------------------------------------------+
```

This Script can help you close all **Orders and Positions in the blink of an eye.**

**Last comments |
[Go to discussion](/en/forum/375710)**
(15)

![kmaster15](https://c.mql5.com/avatar/2023/2/63eb479e-40f6.jpg "kmaster15")

**[kmaster15](/en/users/kmaster15)**
|
13 Jul 2024 at 12:04

Hi J, can you make a script that shows the number of open buy open positions and sell open positions

![Omega J Msigwa](https://c.mql5.com/avatar/2022/6/62B4B2F2-C377.png "Omega J Msigwa")

**[Omega J Msigwa](/en/users/omegajoctan)**
|
15 Jul 2024 at 10:29

**kmaster15 [#](/en/forum/375710/page2#comment_53973139):**  
 Hi J, can you make a script that shows the number of open buy open positions and sell open positions

yeah

![GunnCap](https://c.mql5.com/avatar/avatar_na2.png "GunnCap")

**[GunnCap](/en/users/gunncap)**
|
7 Sep 2024 at 16:20

Works great, thanks!

![Kashif Sethi](https://c.mql5.com/avatar/2024/12/675B299A-607C.png "Kashif Sethi")

**[Kashif Sethi](/en/users/kashifsethi)**
|
12 Dec 2024 at 18:24

Hello , where should you put the " Close All Orders and Positions.mq5 " file ?
on the windows computer

![Nathanael Toussaint](https://c.mql5.com/avatar/2021/1/60161912-39E2.jpg "Nathanael Toussaint")

**[Nathanael Toussaint](/en/users/netking767)**
|
1 Oct 2025 at 07:25

Exactly what I needed!

![Price Line](https://c.mql5.com/i/code/indicator.png)
[Price Line](/en/code/36052)

Shows Last Price, Daily percentage change and Time based on Input selection to the Price Line

![The Fisher Stochastic Center Of Gravity](https://c.mql5.com/i/code/indicator.png)
[The Fisher Stochastic Center Of Gravity](/en/code/35827)

"The Fisher Stochastic Center Of Gravity" was created by John Ehlers (УCybernetic Analysis For Stocks And FuturesФ , pg.95)

![SCT - RiskPerTrade- MT5](https://c.mql5.com/i/code/script.png)
[SCT - RiskPerTrade- MT5](/en/code/36094)

Building good trading habits by seeing things in terms of percentage not in terms of money.

![The Fisher Transform Indicator](https://c.mql5.com/i/code/indicator.png)
[The Fisher Transform Indicator](/en/code/36133)

The Fisher Transform Indicator was created John Ehlers "Cybernetic Analysis For Stocks And Futures".