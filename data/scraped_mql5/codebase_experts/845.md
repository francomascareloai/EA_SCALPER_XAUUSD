# CFastFile - class for working with uchar array as a virtual file - library for MetaTrader 5

Source: https://www.mql5.com/en/code/845

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Facebook](https://www.facebook.com/mql5.community/)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/845) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Libraries](https://c.mql5.com/i/code/library.png)

# CFastFile - class for working with uchar array as a virtual file - library for MetaTrader 5

[---](/en/users/sergeev)  |
[English](javascript:void(false);)

[Русский](/ru/code/845) [中文](/zh/code/845) [Español](/es/code/845) [Deutsch](/de/code/845) [日本語](/ja/code/845) [Português](/pt/code/845)

Views:
:   5401

Rating:
:   (39)

Published:
:   2 March 2012, 09:09

Updated:
:   2 May 2017, 10:01
:   \MQL5\Scripts\

    [fastfile\_example.mq5](/en/code/download/845/fastfile_example.mq5 "fastfile_example.mq5")
    (1.75 KB)
    [view](# "view")

    \MQL5\Include\

    [FastFile.mqh](/en/code/download/845/fastfile.mqh "FastFile.mqh")
    (13.95 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/845.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

The CFastFile eliminates the need for an intermediate writing of data to the physical file on disk. It provides the significant acceleration when working with data.

It has functions, similar to standard FileWriteXXX/FileReadXXX functions. It means that you can easily migrate from the use of the physical files to the fast work with the "virtual" files in memory. The data storage and reading/writing is based on use of the **uchar**-array instead of the physical file.

**List of functions:**

```mql5
    CFastFile(uchar &data[]);          // constructor with initialization of file data from array

    void Clear();                         // clear file
   
    //--- functions for working with file properties
    void Delim(uchar delim=';');        // set delimiter (data separator) for CSV mode
    int Size();                        // gets file size
    int Tell();                        // gets current position
    void Seek(int offset, int origin);  // seek
    bool IsEnding();                   // checking of end of file (EOF)
    bool IsLineEnding();                 // checking of end of line

    //--- functions for writing the data to file
    uint WriteArray(uchar &src[], uint src_start=0, int src_cnt=WHOLE_ARRAY); // write uchar array
    uint WriteDouble(double v);          // write double
    uint WriteFloat(float v);
    uint WriteLong(long v);
    uint WriteInt(int v);
    uint WriteShort(short v);
    uint WriteChar(char v);
    uint WriteInteger(int v, int sz=INT_VALUE); // write integer - for compatibility with standard FileWriteInteger
    uint WriteString(string v, int cnt);        // write string cnt=-1 means CSV mode with addition of \r\n
   
    //--- functions for reading from file
    uint ReadArray(uchar &dst[], uint dst_start=0, int cnt=WHOLE_ARRAY); //  read array
    double ReadDouble();                 // read double
    float ReadFloat(); 
    long ReadLong();
    int ReadInt();
    short ReadShort();
    char ReadChar();
    int ReadInteger(int sz=INT_VALUE); // read integer - for compatibility with standard FileReadInteger
    double ReadNumber(); //
    string ReadString(int cnt);         read string. cnt=-1 means CSV mode - reading to delimiter (data separator)
   
    //--- functions, used to save data
    uint Save(uchar &v[]);     // save file to uchar array
    uint Save(int h);         // save file to the real file on disk. h - file handle (the file must be opened)
    uint Save(string file);    // save file to the real file on disk. file - file name

    //--- functions, used for loading of data
    uint Load(uchar &v[]);   // load file from uchar array
    uint Load(int h);         // load data from real file on disk. h - file handle (the file must be opened)
    uint Load(string file);  // load data from real file on disk. file - file name
```

One can see, the functions are named similar to the [standard file operations](/en/docs/files).

The migration from real files to the *CFastFile* is very easy. Instead of file open and getting file handle (for example, **int h**) you need to create the CFastFile class instance, for example:

```mql5
CFastFile f;
```

The next you need to change the conventional file functions according to the rule:

```mql5
FileWriteDouble(h, 10)  ->  f.WriteDouble(10)
```

For convenience, the *Save/Load* functions is added - it allows you to save/load the "virtual" file data to the real file on disk.

The demo example of CFastFile class use in included.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/845](/ru/code/845)

**Last comments |
[Go to discussion](/en/forum/6303)**
(3)

![---](https://c.mql5.com/avatar/avatar_na2.png "---")

**[---](/en/users/sergeev)**
|
1 May 2017 at 12:26

Library versions

1.01 - fixed copying of structures on union

![Rashid Umarov](https://c.mql5.com/avatar/2012/5/4FC60566-2EEC.jpg "Rashid Umarov")

**[Rashid Umarov](/en/users/rosh)**
|
1 May 2017 at 16:45

**o\_o:**  

Library versions

1.01 - fixed copying of structures to union

Updated

![Viktar Dzemikhau](https://c.mql5.com/avatar/2020/11/5FC52891-F98D.jpg "Viktar Dzemikhau")

**[Viktar Dzemikhau](/en/users/hoz)**
|
1 Jun 2018 at 17:16

The most interesting thing is that native functions are a bit crooked, but this library works smoothly. I also liked that I learnt what the strange at first glance union type is for ))

But there is one strange thing. It says that:

Класс CFastFile избавляет от необходимости промежуточной записи данных в физический файл на диске. Это позволяет получить значительное ускорение при работе с данными.

The class implements all the main functions of the FileWriteXXX/FileReadXXX family. That is, without changing the logic and code of your programme, you can easily switch from using physical files to fast work with their images in memory. Data is stored and read not with a real physical file, but with a **uchar-array**.

So data is [written to files](https://www.mql5.com/en/docs/files/filewrite "MQL5 documentation: FileWrite function") anyway. Yes, from **uchar-array**, but they are written. Then why will it be faster to write data this way than standard functions?

![Trading signals module based on WPRSIsignal indicator](https://c.mql5.com/i/code/library.png)
[Trading signals module based on WPRSIsignal indicator](/en/code/843)

Trading signals module for MQL5 Wizard. WPRSIsignal indicator's color arrow serves as a market entry signal.

![Trading signals module based on Candles_Smoothed indicator](https://c.mql5.com/i/code/library.png)
[Trading signals module based on Candles\_Smoothed indicator](/en/code/829)

Trading signals module for MQL5 Wizard. The moment, when a candlestick formed by Candles\_Smoothed changes its color, indicates the time for market entry.

![Trading signals module based on ColorJFatl indicator](https://c.mql5.com/i/code/library.png)
[Trading signals module based on ColorJFatl indicator](/en/code/841)

Trading signals module for MQL5 Wizard. The moment, when ColorJFatl indicator changes its color, indicates the time for market entry.

![Trading signals module based on SilverTrend_Signal indicator](https://c.mql5.com/i/code/library.png)
[Trading signals module based on SilverTrend\_Signal indicator](/en/code/839)

Trading signals module for MQL5 Wizard. SilverTrend\_Signal indicator's color dot serves as a market entry signal.