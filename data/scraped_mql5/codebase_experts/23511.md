# hedger - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/23511

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/23511) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/mt5setup.exe?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# hedger - expert for MetaTrader 5

eugene-last  |
[English](javascript:void(false);)

[Русский](/ru/code/23511) [Español](/es/code/23511)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   14123

Rating:
:   (25)

Published:
:   7 February 2019, 08:58
:   [hedger.mq5](/en/code/download/23511/hedger.mq5 "hedger.mq5")
    (43.44 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/23511.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Idea by:** eugene-last

**mq5 code by:** [barabashkakvn](/en/users/barabashkakvn)

The EA hedges a too losing position.

Suppose thereis an open BUY position on a given symbol (the position has been opened by another EA or manually). As soon as the losses on this position, in pips, exceed the pre-defined level of **Drawdown (opening a hedge)**, the EA will open a hedging SELL position with the same lot size. Then that new SELL position will be tracked and, as soon as its losses, in pips, exceed the predefined level of **Drawdown (closing the hedge)**, the EA will close that hedging SELL position.

![hedger](https://c.mql5.com/18/78/2018-12-05_11h07_40.png "hedger")

To demonstrate how it works, a BUY position opening operation was added for the TESTER mode only.

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/23511](/ru/code/23511)

**Last comments |
[Go to discussion](/en/forum/302502)**
(5)

![Vitaly Muzichenko](https://c.mql5.com/avatar/2025/11/691d3a3a-b70b.png "Vitaly Muzichenko")

**[Vitaly Muzichenko](/en/users/mvs)**
|
5 Dec 2018 at 18:30

**Automated-Trading:**  

[hedger](/en/code/23511):

Author: [Vladimir Karputov](/en/users/barabashkakvn "barabashkakvn")

Where is hedging as described? Apart from trivial locking there is nothing else.

![novice77](https://c.mql5.com/avatar/avatar_na2.png "novice77")

**[novice77](/en/users/novice77)**
|
4 Apr 2019 at 13:03

Hedge is very interesting, but your option is a very losing program. I do not advise to use it. It is necessary to impose on it something else. Perhaps you did it. Perhaps you have a winning option, but this is not what you published. \*\*\*

![Andreas Bauer](https://c.mql5.com/avatar/2021/4/606EF322-1D5A.jpg "Andreas Bauer")

**[Andreas Bauer](/en/users/andrewba)**
|
4 Apr 2019 at 14:08

Hedging is very nice, as long your [money management](https://www.mql5.com/en/articles/4162 "Article: Money Management by Vince. Implementation as a MQL5 Wizard Module") allows it [your opening lot is not too big].

An added money management system, that tracks your balance would be nice...

Like telling you how many pips you can survive with your (first) opened lot size + added hedged lot size.

![Heavybabar](https://c.mql5.com/avatar/avatar_na2.png "Heavybabar")

**[Heavybabar](/en/users/heavybabar)**
|
30 Oct 2019 at 07:23

Yes, really challenging strategy. Survival requires to bind a sharp money management with a profit (loss tracking) based on signals of your choice. This can be implemented, but to achieve profitability you must dynamically adjust the size ratio between hedged positions. If fact it you get into this kind of trade with 1:1 hedging ratio rule, then you're just "freezing" the loss, and expecting new trades to bring you back to money (clear the loss).

If the loosing trade was really a bad signal and market reverses in a trending mood, then set a 1:2 hedging ratio, thus clearing losses in just half pips move of the loosing position you are carrying (trend hedging). You need to compute orders margin accurately as margin comes first in your broker computing when closing hedged margin legs. First margin, then if OK, profit/losses are processed. If not, you taste the STOP OUT no matter if the whole operation (profit/losses/margin) is net benefiting for you, and everything else collapses with it (all others ongoing hedged positions). So think twice, and think twice once more.

Let say, market reverses again before the hedge ends...now you must reverse hedging ratio...compute new [margin required](https://www.mql5.com/en/docs/constants/environment_state/marketinfoconstants#enum_symbol_calc_mode "MQL5 documentation: Symbol properties") and cash needed to pass the gate...and if it reverses once more (range market scheme) all your cash will be sucked out until you can move any more...so bad signal is bad signal and to hedging algorithm can redeem you from hell trading.

But stay positive, if you were just in a range market, and opened too late, then you're mistaking and your algorithm will have your purse (money management) bouncing on the bands...having lot of positions hedge linked till you touch the broker stop out.

Keep your idea and start simple : even the most "nasa" like hedging algorithm can't save your money if trading with a bad signal. You must first find your way to sort out trending market and ranging market.

Yes, I said stay positive : a bad hedging strategy in a trending market can be profitable in a ranging market (just by symmetry of orders type when kissing the bands), and really profitable if you set the hedge ratio dynamically (reading market volatility).

So I really encourage you deepening your work with this aim, step by step, it's really lightening...and so it's really challenging your skills. Remember, no pain no gain ? So no risk, no profit ! An hedge comes always as a strategy on risk, if you don't see it, think twice.

Hope we'll stay in touch, as novice77 and Andreas say, you must impose constraints, but first find the good ones then work to tune them : just go with your idea slowly, expand your understanding of your statements and try, step by step !

At this time, from my experience, managing parent/children hedged orders with linked lists, dynamic money/risk management and a reactive (market driven) Profit/Loss Trailer Navigator...absolutely amazing guys...

Since my beginnings the most important things I've learned are :

1. Trade with Market sessions watch (know the good times and step aside to watch out and learn how to stay alive in range market and narrow your need to hedge after false signals).

2. Remember, money management is : the more you put in position margin (big lot size) the more you leverage your bets of the market direction, and the more you narrow cash left for breathing. If you're wrong the judgement comes really fast, but you're left with more money on your account as the margin is your locked property. Few people see it like that, I've read so much things about that I still wonder why this is most often not recognized and took as a building block. People say trade max 2% of your cash in a position...you can put a lot of maths on the topic, it doesn't change what I'm stating. Finally, the more you trade, the more you flip the coin, and you can't loose all the time nor win all the time. My rule is : don't get in the in-out messing, monitor your signals, wait and when you dive in, just go full force. If you're wrong, you die fast, but you know exactly how mush you accept to loose. Stay long on profit, cut your losses quickly (or hedge them once you've mastered your processing scheme).

3. Have market sessions clocks, have calendar events on your graphs, and fix your margin computing algorithm (this is the most most important thing to master). Margin computing seems to be trivial, but it's not. Margin value of an order changes constantly with quotes, and brokers don't help in understanding this. You don't see it when you trade a single position, and when you open two opposite trades you're mistaken by how the terminal balance shows to game for small pips swing in quotes. 1Buy/1Sell=0 margin ? Don't believe the ape man !

When you're about to close one leg of this simple 1:1 hedge after 200 pips move, the margin required for the ongoing position while you're closing the other, expecting to bank the profits first and then let the market reverse to narrow the loss until it's time to cut it, this margin is not the margin required when you opened...its value changed according to bid/ask ratio...that's it, and you must exactly know how much the broker will check after on your account, ignoring the profits you're trying to bank to finance it.

After many work around, no two brokers compute the margin the same way, no unified logic at all, and you must match the exact logic of the one you're dealing with (no matter using the same metaquotes terminal...so much creativity all around the world man...)...what's is exact bid/ask spread handling scheme in this computing always comes problematic, and none of them want to document if.

And I won't speak of hedged margin computing for currencies when your deposit currency is not the second leg...damn brokers !

To stop talking now in the hope i'll hear from you, let's just recast : market sessions clocks and calendar events on graphs, accurate margin computing...and then you can start tweaking your hedging algorithm.

But working with a poor signal, and setting "hard/fixed" stoploss/stopprofit will weaken your efforts and expectations...and you will need a profit trailler algorithm driven by a good mid/good level signal to dynamically start hedgings, set size ratios, link parent/children orders, take profits, reduce legs...and at last you'll ask for the loop CloseBy() processing to manage hundred of hedges.

Big program aims at big money, impossible without big problems man.

You're the right path, let's walk on the way together if you're still interested on.

Sincerely,

![Anik Chandra Dey Sagor](https://c.mql5.com/avatar/2023/2/63e9569f-c991.jpg "Anik Chandra Dey Sagor")

**[Anik Chandra Dey Sagor](/en/users/sagor23)**
|
28 Mar 2023 at 00:05

Sir update  this its not working   i eagerly need this

![Ingrit](https://c.mql5.com/i/code/expert.png)
[Ingrit](/en/code/23499)

Comparing OHLC on timeframe M5

![Starter](https://c.mql5.com/i/code/expert.png)
[Starter](/en/code/23495)

Three timeframes. One iMA (Moving Average, MA) and one iStochastic (Stochastic Oscillator) on each timeframe

![Stochastic_Convergence_Divergence](https://c.mql5.com/i/code/indicator.png)
[Stochastic\_Convergence\_Divergence](/en/code/23521)

Indicator Two Stochastics with MA Smoothing and Convergence Divergence line

![Market_Sessions](https://c.mql5.com/i/code/indicator.png)
[Market\_Sessions](/en/code/23523)

Indicator Market Session