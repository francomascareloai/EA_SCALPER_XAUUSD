# Flat Channel - expert for MetaTrader 5

Source: https://www.mql5.com/en/code/23139

* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 5](/en/code/mt5)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt5/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt5/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt5/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt5/libraries)
* [![](https://c.mql5.com/i/sidebar/mt.svg)MetaTrader 4](/en/code/mt4)
  + [![](https://c.mql5.com/i/sidebar/expert.svg)Experts](/en/code/mt4/experts)
  + [![](https://c.mql5.com/i/sidebar/indicator.svg)Indicators](/en/code/mt4/indicators)
  + [![](https://c.mql5.com/i/sidebar/scripts.svg)Scripts](/en/code/mt4/scripts)
  + [![](https://c.mql5.com/i/sidebar/library.svg)Libraries](/en/code/mt4/libraries)

* [![](https://c.mql5.com/i/sidebar/storage.svg)Storage](/en/code/storage)

Watch [how to download](https://youtu.be/rloNyFVtHuA?list=PLltlMLQ7OLeKwyQwC8FhiKwjl9syKhOCK) trading robots for free

Find us on [Twitter](https://x.com/mql5com)!  
 Join our fan page

Interesting script?  
So post a [link](/en/code/23139) to it -  
let others appraise it

You liked the script? Try it in the [MetaTrader 5](https://download.mql5.com/cdn/web/metaquotes.ltd/mt5/MetaTrader5.pkg.zip?utm_source=www.mql5.com&utm_campaign=download) terminal

[to pocket](#pocket "Pocket allows you to insert a complete content description to the appropriate comment")

![Experts](https://c.mql5.com/i/code/expert.png)

# Flat Channel - expert for MetaTrader 5

JS\_Sergey  |
[English](javascript:void(false);)

[Русский](/ru/code/23139) [中文](/zh/code/23139) [Español](/es/code/23139) [Deutsch](/de/code/23139) [日本語](/ja/code/23139) [Português](/pt/code/23139)

Published by:
:   [Vladimir Karputov](/en/users/barabashkakvn)

Views:
:   6349

Rating:
:   (21)

Published:
:   2 January 2019, 14:30
:   [Flat Channel.mq5](/en/code/download/23139/flat_channel.mq5 "Flat Channel.mq5")
    (88.53 KB)
    [view](# "view")

    \MQL5\Indicators\

    [Standard Deviation smoothing.mq5](/en/code/download/23139/standard_deviation_smoothing.mq5 "Standard Deviation smoothing.mq5")
    (15.18 KB)
    [view](# "view")

    [Download as ZIP](/en/code/download/23139.zip "Download all attachments in the single ZIP archive") [How to download code from MetaEditor](https://www.metatrader5.com/en/metaeditor/help/workspace/toolbox#codebase)

    ![MQL5 - Language of trade strategies built-in the MetaTrader 5 client terminal](https://c.mql5.com/i/registerlandings/logo-2.png)

    You are missing trading opportunities:

    * Free trading apps
    * Over 8,000 signals for copying
    * Economic news for exploring financial markets

    Registration
    Log in

    latin characters without spaces

    a password will be sent to this email

    An error occurred

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup&amp;reg=1)

    You agree to [website policy](/en/about/privacy) and [terms of use](/en/about/terms)

    If you do not have an account, please [register](https://www.mql5.com/en/auth_register)

    Allow the use of cookies to log in to the MQL5.com website.

    Please enable the necessary setting in your browser, otherwise you will not be able to log in.

     

    [Forgot your login/password?](https://www.mql5.com/en/auth_forgotten?return=popup)

    * [Log in With Google](https://www.mql5.com/en/auth_oauth2?provider=Google&amp;return=popup)
:   ![MQL5 Freelance](https://c.mql5.com/i/code/icon_freelance.svg)
    Need a robot or indicator based on this code? Order it on Freelance
    [Go to Freelance](/en/job/new "Go to Freelance")

**Idea** by [JS\_Sergey](/en/users/js_sergey "JS_Sergey (JS_Sergey)")

**mq5 code author** - [barabashkakvn](/en/users/barabashkakvn)

The Expert Advisor uses the  [Standard Deviation smoothing](/en/code/23119 "Standard Deviation smoothing") custom indicator, which is a smoothed [Standard Deviation](https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/sd "https://www.metatrader5.com/en/terminal/help/indicators/trend_indicators/sd"). Determine trend existence based on the indicator values on bars #0, #1, #2, #3 and #4:

(StdDev #0 > StdDev #1)  && (StdDev #1 > StdDev #2)  && (StdDev #2 > StdDev #3)  && (StdDev #3 > StdDev #4) -> there is a trend

It also determines flat within the "Minimum number of bars" bars. A flat zone is indicated by two lines:

![Flat Channel](https://c.mql5.com/18/77/2018-11-08_10h44_38.png "Flat Channel")

If there is no flat zone currently in the market, the EA does not place pending orders. Also, if there is no flat, appropriate lines are deleted from the chart. When any of the pending orders triggers, other pending orders are deleted, and trailing stop is further applied to positions.

Stop Loss and Take Profit can be set both as constant or dynamic values. This depends on the **Stop loss** and**Take Profit** parameters. The lot value can also be either constant ("Enable the money management function" is set to "false") or dynamic. This depends on the number of trades closed by Stop Loss and Take Profit.

EURUSD,M30:

![Flat Channel](https://c.mql5.com/18/77/2018-11-08_13h27_10.png "Flat Channel")

Translated from Russian by MetaQuotes Ltd.   
Original code: [https://www.mql5.com/ru/code/23139](/ru/code/23139)

**Last comments |
[Go to discussion](/en/forum/297344)**
(13)

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
27 Nov 2018 at 13:20

**refounder83:**  

I wrote to the broker's technical support that these levels are not broadcast.

Then just ignore them (temporarily comment out the lines where these levels are learnt).

![Evgenii Bazhenov](https://c.mql5.com/avatar/2023/5/645ced0e-034e.jpg "Evgenii Bazhenov")

**[Evgenii Bazhenov](/en/users/refounder83)**
|
28 Nov 2018 at 10:57

**Vladimir Karputov:**  

Then just ignore them (temporarily comment out the lines where those levels are learnt).

Can you tell me if time [control](https://www.mql5.com/en/articles/310 "Article: Custom Graphic Controls Part 1. Creating a simple control") does not work in this EA? There are lines in the TimeControl procedure.

```mql5
  if(!InpTimeControl)
      return(true);
```

i.e. if the value of InpTimeControl is false, it still returns true to the TimeControl procedure?

```mql5
bool TimeControl(void)
  {
   if(!InpTimeControl)
      return(true);
      
   MqlDateTime STimeCurrent;
   datetime time_current=TimeCurrent();
   if(time_current==D'1970.01.01 00:00')
      return(false);
   TimeToStruct(time_current,STimeCurrent);
   if(InpStartHour<InpEndHour) // intraday time interval
     {

      if(STimeCurrent.hour>=InpStartHour && STimeCurrent.hour<InpEndHour)
         return(true);
     }
   else if(InpStartHour>InpEndHour) // time interval with the transition in a day
     {

      if(STimeCurrent.hour>=InpStartHour || STimeCurrent.hour<InpEndHour)
         return(true);
     }
   else
      return(false);
//---
   return(false);
  }
```

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
28 Nov 2018 at 11:06

**refounder83:**  

Can you tell me if time control does not work in this EA? There are lines in the TimeControl procedure

i.e. if the value of InpTimeControl is false, it returns true to the TimeControl procedure?

I recommend using a more advanced TimeControl procedure:

Input parameters for it:

```mql5
input bool     InpTimeControl    = true;     // Use time control
input uchar    InpStartHour      = 10;       // Start hour
input uchar    InpEndHour        = 15;       // End hour
```

The procedure itself (can be set from morning to evening, or from evening to morning - i.e. with a day transition)

```mql5
//+------------------------------------------------------------------+
//| TimeControl|
//+------------------------------------------------------------------+
bool TimeControl(void)
  {
   if(!InpTimeControl)
      return(true);
   MqlDateTime STimeCurrent;
   datetime time_current=TimeCurrent();
   if(time_current==D'1970.01.01 00:00')
      return(false);
   TimeToStruct(time_current,STimeCurrent);
   if(InpStartHour<InpEndHour) // intraday time interval
     {
/*
Example:
input uchar InpStartHour = 5;// Start hour
input uchar InpEndHour = 10; // End hour
0 1 2 3 4 5 6 7 8 910 11 12 13 14 15 16 17 18 19 20 21 22 23 0 1 2 3 4 5 6 78 9 9 10 11 12 13 13 14 15
_ _ _ _ _ _ _ _ _ _ + + ++ + + _ _ _ _ _ _ _ __ _ _ _ _ _ _ _ _ _ _+ + + + + + + _ _ _ _ _ _ _ _ _
*/
      if(STimeCurrent.hour>=InpStartHour && STimeCurrent.hour<InpEndHour)
         return(true);
     }
   else if(InpStartHour>InpEndHour) // time interval with the transition in a day
     {
/*
Example:
input uchar InpStartHour = 10; // Start hour
input ucharInpEndHour = 5;// End hour
0 1 2 3 4 5 6 7 8 910 11 12 13 14 15 16 17 18 19 20 21 22 23 0 1 2 3 4 5 6 78 9 9 10 11 11 12 13 13 14 15
_ _ _ _ _ _ _ _ _ __ _ _ + + + + + + + ++ + + + + + + + + + +_ _ _ _ _ _ _ _ _ _ + + + + + + + + +
*/
      if(STimeCurrent.hour>=InpStartHour || STimeCurrent.hour<InpEndHour)
         return(true);
     }
   else
      return(false);
//---
   return(false);
  }
```

![Vladimir Karputov](https://c.mql5.com/avatar/2024/2/65d8b5a2-f9d9.jpg "Vladimir Karputov")

**[Vladimir Karputov](/en/users/barabashkakvn)**
|
28 Nov 2018 at 11:09

And so yes, if the**"Use time [control](https://www.mql5.com/en/articles/310 "Article: Custom Graphic Controls Part 1. Creating a simple control")**" parameter is set as***"false***" - that is, the time interval is disabled at all, then the bool TimeControl(void) procedure will always return "true". That is, it simply does not participate and does not interfere with the process of receiving signals.

![](https://c.mql5.com/avatar/avatar_na2.png)

**[Deleted]**
|
21 Jun 2023 at 17:49

Hello bladimir it does not allow to [place](https://www.mql5.com/en/articles/1171 "Why virtual hosting on Meta Trader 4 and MetaTrader 5 is better than the usual VPS Why virtual hosting on Meta Trader 4 and MetaTrader 5 is better than the usual VPS") or the ea only works in assets of 0.01 and 0.10 the broker that I use which is deriv and there are volatilitys assets does not work the ea is a good ea but it does not work in that broker it only works in the step index asset that allows 0.10 the other assets the broker allows from 0.001 0.002 0.003 0.004

![Normalized_Volume](https://c.mql5.com/i/code/indicator.png)
[Normalized\_Volume](/en/code/23126)

The Normalized Volume indicator

![MA_Trend](https://c.mql5.com/i/code/indicator.png)
[MA\_Trend](/en/code/23125)

MA Trend indicator

![Exp_Slow-Stoch_Duplex](https://c.mql5.com/i/code/expert.png)
[Exp\_Slow-Stoch\_Duplex](/en/code/23141)

Two identical trading systems (for long and short positions) based on the signals of the Slow-Stoch indicator, which can be configured in different ways within one Expert Advisor

![MACD_MFI](https://c.mql5.com/i/code/indicator.png)
[MACD\_MFI](/en/code/23150)

The MFI indicator (Money Flow Index) applied over MACD (Moving Average Convergence/Divergence) provides a visual presentation of the current price divergence