// This Pine Script™ code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Join our channel for more free tools: https://t.me/jonavyfxtrade
    
//@version=5
indicator("PSAR LRC [CRT Trader]", overlay=true)

// Kullanıcı Girişleri
slow_sar_set = input.float(0.04, 'Slow SAR', minval = 0.01, maxval = 0.4, group = 'SAR Settings')
sar_set = input.float(0.02, 'Normal SAR', minval = 0.01, maxval = 0.2, group = 'SAR Settings')
fast_sar_set = input.float(0.01, 'Fast SAR', minval = 0.01, maxval = 0.1, group = 'SAR Settings')
sar_avg_length = input.int(14, 'Hareketli Ortalama Uzunluğu', minval = 1, group = 'SAR Settings')

lrc_low_length = input.int(300, title="Low Band Length", group="LRC Band Settings")
lrc_high_length = input.int(300, title="High Band Length", group="LRC Band Settings")

showBuySell = input.bool( true, 'Al/Sat Sinyallerini Göster',  group = "Labels")

// Hesaplamalar
// ta.sar(baslangic, artis, maksimum) - sayı küçüldükçe değişim hızı artar
fast_sar = ta.sar(fast_sar_set, fast_sar_set, 0.1)
sar = ta.sar(sar_set, sar_set, 0.2)
slow_sar = ta.sar(slow_sar_set, slow_sar_set, 0.4)

// Hareketli Ortalama
sar_avg = ta.sma(sar, sar_avg_length)

// Çizimler
plot(fast_sar, title="Fast SAR", color=close > fast_sar ? #00ff00 : #FFBBBA, style=plot.style_circles, linewidth=1)
plot(sar, title="Parabolic SAR", color=close > sar ? #00b800 : #FF0103, style=plot.style_circles, linewidth=1)
plot(slow_sar, title="Slow SAR", color=close > slow_sar ? #145715 : #AA0000, style=plot.style_circles, linewidth=1)

plot(sar_avg, title="SAR Ortalama", color=color.blue, style=plot.style_line, linewidth=2)

// LRC
a = ta.linreg(high, lrc_high_length, 0)
b = ta.linreg(low, lrc_low_length, 0)
c = -ta.dev(low, lrc_low_length) + b
d = ta.dev(high, lrc_high_length) + a
plot(a, title="High Regression", color=color.new(color.orange, 0))
plot(b, title="Low Regression", color=color.new(color.orange, 0))
plot(c, title="Lower Channel", color=c < close ? color.green : color.red)
plot(d, title="Upper Channel", color=d < close ? color.green : color.red)

// Sinyaller
var bool buy_trig = false
var bool sell_trig = false
bool buySignal = not(buy_trig) and close > fast_sar and close > sar and close > slow_sar
bool sellSignal = not(sell_trig) and close < fast_sar and close < sar and close < slow_sar
if (buySignal)
    buy_trig := true
    sell_trig := false
else if (sellSignal)
    buy_trig := false
    sell_trig := true

if (showBuySell)    
    if (buySignal and not(buySignal[1]))
        label.new(x=bar_index, y=low, text="BUY", style=label.style_label_up, color=color.green, textcolor=color.white)
    if (sellSignal and not(sellSignal[1]))
        label.new(x=bar_index, y=high, text="SELL", style=label.style_label_down, color=color.red, textcolor=color.white)


// ==========================================================================================

// === Dashboard with Telegram Link ===
var table myTable = table.new(position.top_center, 1, 1, border_width=1, frame_color=color.black, bgcolor=color.white)

// Add Telegram Message to Dashboard
table.cell(myTable, 0, 0, "Join Telegram @simpleforextools", bgcolor=color.blue, text_color=color.white, text_size=size.normal)