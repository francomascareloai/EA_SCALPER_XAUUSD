//@version=5
library("Data Analysis Library", overlay=false)

// Exported function: Calculate correlation between two series
export calculate_correlation(float series1, float series2, int length) =>
    avg1 = ta.sma(series1, length)
    avg2 = ta.sma(series2, length)
    numerator = ta.sma((series1 - avg1) * (series2 - avg2), length)
    denominator = ta.sma((series1 - avg1) * (series1 - avg1), length) * ta.sma((series2 - avg2) * (series2 - avg2), length)
    correlation = numerator / math.sqrt(denominator)
    correlation

// Exported function: Calculate volatility
export calculate_volatility(float src, int length) =>
    ta.stdev(src, length)

// Exported function: Calculate beta coefficient
export calculate_beta(float assetReturns, float marketReturns, int length) =>
    covariance = ta.sma((assetReturns - ta.sma(assetReturns, length)) * (marketReturns - ta.sma(marketReturns, length)), length)
    marketVariance = ta.sma((marketReturns - ta.sma(marketReturns, length)) * (marketReturns - ta.sma(marketReturns, length)), length)
    beta = covariance / marketVariance
    beta

// Exported function: Calculate Sharpe ratio
export calculate_sharpe_ratio(float returns, float riskFreeRate, int length) =>
    avgReturn = ta.sma(returns, length)
    stdDev = ta.stdev(returns, length)
    sharpeRatio = (avgReturn - riskFreeRate) / stdDev
    sharpeRatio

// Exported function: Calculate maximum drawdown
export calculate_max_drawdown(float equity) =>
    peak = ta.cum(math.max(equity, equity[1]))
    drawdown = (equity - peak) / peak
    drawdown