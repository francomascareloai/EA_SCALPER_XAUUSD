//@version=5
strategy("Example AI Hybrid Strategy", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// Input parameters
useML = input.bool(true, "Use Machine Learning Signals")
confidenceThreshold = input.float(0.7, "Confidence Threshold", minval=0.5, maxval=0.9)

// External signals (simulated)
// In a real implementation, these would come from external sources
var float mlSignal = na
var float confidence = na

// Simulate ML signal updates (in real implementation, this would come from external source)
if (bar_index % 50 == 0)  // Update every 50 bars for simulation
    mlSignal := math.random(0, 2)  // 0 = hold, 1 = buy, 2 = sell
    confidence := math.random(50, 100) / 100.0  // 0.5 to 1.0

// Technical indicators as backup
rsi = ta.rsi(close, 14)
emaFast = ta.ema(close, 10)
emaSlow = ta.ema(close, 20)

// Signal combination logic
buySignal = (useML and mlSignal == 1 and confidence >= confidenceThreshold) or 
           (not useML and ta.crossover(emaFast, emaSlow) and rsi < 50)
           
sellSignal = (useML and mlSignal == 2 and confidence >= confidenceThreshold) or 
            (not useML and ta.crossunder(emaFast, emaSlow) and rsi > 50)

// Execute trades
if (buySignal)
    strategy.entry("Long", strategy.long)

if (sellSignal)
    strategy.entry("Short", strategy.short)

// Plot signals
plot(emaFast, "Fast EMA", color=color.blue)
plot(emaSlow, "Slow EMA", color=color.red)

// Plot RSI
hline(50, "RSI Midline", color=color.gray)
hline(70, "RSI Overbought", color=color.red)
hline(30, "RSI Oversold", color=color.green)