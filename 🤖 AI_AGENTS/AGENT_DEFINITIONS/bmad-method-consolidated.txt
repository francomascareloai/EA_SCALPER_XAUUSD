# Implementa√ß√£o BMAD-METHOD‚Ñ¢ para Projeto EA_SCALPER_XAUUSD

## Vis√£o Geral

Este documento define a implementa√ß√£o da metodologia BMAD-METHOD‚Ñ¢ no projeto EA_SCALPER_XAUUSD, estabelecendo uma estrutura de desenvolvimento baseada em agentes especializados para criar um sistema de trading robusto e escal√°vel para XAUUSD.

### Contexto do Projeto
- **Sistema Atual**: Sistema multi-agente com EAs MQL4/MQL5 + Machine Learning
- **Melhoria Alvo**: Implementar BMAD-METHOD‚Ñ¢ para desenvolvimento estruturado
- **Foco Principal**: Scalping XAUUSD com compliance FTMO e ML avan√ßado
- **Stack Tecnol√≥gico**: Orquestra√ß√£o Python + Execu√ß√£o MQL4/MQL5 + ML/ONNX

## Stack Tecnol√≥gico & Depend√™ncias

### Tecnologias Principais
- **Camada de Orquestra√ß√£o**: Python 3.8+ com psutil, jinja2, pandas
- **Execu√ß√£o Trading**: MQL4/MQL5 no MetaTrader 4/5
- **Machine Learning**: ONNX Runtime, Ensemble Models (RF+SVM+NN)
- **Coordena√ß√£o Agentes**: Configura√ß√£o e comunica√ß√£o baseada em JSON
- **Engine de Templates**: Jinja2 para gera√ß√£o de c√≥digo
- **An√°lise de Dados**: Pandas, NumPy, Matplotlib
- **Bibliotecas Especializadas**: XAUUSD_ML_Core.mqh, XAUUSD_Market_Scenarios.mqh

### Stack de Integra√ß√£o BMAD-METHOD‚Ñ¢
- **Framework de Agentes**: bmad-orchestrator, analista-trader, gerente-produto, arquiteto-ea, especialista-risco
- **Engine de Workflow**: desenvolvimento-ea.yaml, otimizacao-ea.yaml
- **Protocolo de Comunica√ß√£o**: Configura√ß√£o baseada em YAML
- **Abordagem de Desenvolvimento**: Duas fases (Planejamento + Implementa√ß√£o)

## Arquitetura

### Sistema Multi-Agente Atual EA_SCALPER_XAUUSD
```mermaid
graph TB
    subgraph "Sistema EA_SCALPER_XAUUSD Atual"
        TA[Trading_Agent]
        AA[Analysis_Agent] 
        RA[Risk_Agent]
        OA[Optimization_Agent]
        MCP[MCP Integration]
        MT5[MetaTrader 5]
        ML[ML Engine - ONNX]
    end
    
    AA --> ML
    ML --> TA
    TA --> MCP
    AA --> TA
    RA --> TA
    OA --> TA
    MCP --> MT5
```

### Arquitetura BMAD-METHOD‚Ñ¢ Especializada para Trading
```mermaid
graph TB
    subgraph "Camada BMAD-METHOD‚Ñ¢ Trading"
        BO[bmad-orchestrator]
        GPT[Gerente-Produto-Trading]
        AEA[Arquiteto-EA]
        ER[Especialista-Risco]
        AT[Analista-Trader]
    end
    
    subgraph "Camada de Execu√ß√£o Trading"
        TA[Trading_Agent]
        AA[Analysis_Agent]
        RA[Risk_Agent]
        OA[Optimization_Agent]
        ML[ML_Core_Engine]
        MS[Market_Scenarios]
    end
    
    subgraph "Camada de Infraestrutura"
        MCP[MCP Integration]
        MT5[MetaTrader 5]
        PY[Python Orchestration]
        ONNX[ONNX Runtime]
    end
    
    BO --> GPT
    BO --> AEA
    BO --> ER
    BO --> AT
    
    GPT --> TA
    AEA --> ML
    ER --> RA
    AT --> AA
    
    TA --> MCP
    AA --> ML
    RA --> MS
    OA --> ONNX
    MCP --> MT5
    MCP --> PY
    ML --> ONNX
```

### Arquitetura de Componentes Trading

#### Sequ√™ncia de Integra√ß√£o BMAD-METHOD‚Ñ¢ + Trading
```mermaid
sequenceDiagram
    participant BO as bmad-orchestrator
    participant GPT as Gerente-Produto-Trading
    participant AEA as Arquiteto-EA
    participant TA as Trading_Agent
    participant ML as ML_Core_Engine
    participant MCP as MCP Protocol
    participant MT5 as MetaTrader 5
    
    BO->>GPT: Definir requisitos XAUUSD
    GPT->>AEA: Especificar arquitetura EA
    AEA->>ML: Configurar modelos ML
    ML->>TA: Gerar sinais trading
    TA->>MCP: Executar comandos trading
    MCP->>MT5: Enviar ordens para terminal
    MT5-->>MCP: Retornar status execu√ß√£o
    MCP-->>TA: Fornecer feedback
    TA-->>ML: Atualizar modelo
    ML-->>AEA: Relatar performance
    AEA-->>GPT: Atualizar m√©tricas
    GPT-->>BO: Status geral sistema
```

## Defini√ß√£o de Componentes

### Componentes Principais BMAD-METHOD‚Ñ¢ Trading

#### 1. bmad-orchestrator
```yaml
fun√ß√£o: Coordenador mestre do sistema
responsabilidades:
  - Orquestra√ß√£o de workflows trading
  - Comunica√ß√£o entre agentes
  - Distribui√ß√£o de tarefas
  - Monitoramento de status
integra√ß√£o:
  - AGENT_COORDINATION.json
  - Protocolos MCP_Integration
  - Sistema ML/ONNX
```

#### 2. Gerente-Produto-Trading
```yaml
fun√ß√£o: Gest√£o de requisitos e prioridades trading
responsabilidades:
  - Especifica√ß√£o de features XAUUSD
  - Requisitos compliance FTMO
  - Defini√ß√£o de m√©tricas performance
  - Pol√≠ticas gest√£o risco
foco_trading:
  - Estrat√©gias scalping XAUUSD
  - Regras gest√£o conta
  - Limites drawdown
  - Cen√°rios mercado (10 tipos)
```

#### 3. Arquiteto-EA
```yaml
fun√ß√£o: Design sistema e integra√ß√£o EA
responsabilidades:
  - Arquitetura EA design
  - Otimiza√ß√£o performance
  - Planejamento escalabilidade
  - Integra√ß√£o tecnol√≥gica
foco_tecnico:
  - Otimiza√ß√£o MQL4/MQL5
  - Comunica√ß√£o Python-EA
  - Processamento dados tempo real
  - Arquitetura ML/ONNX
```

#### 4. Especialista-Risco
```yaml
fun√ß√£o: Especifica√ß√µes risco e compliance
responsabilidades:
  - Defini√ß√£o estrat√©gias risco
  - Manipula√ß√£o cen√°rios mercado
  - Metas rentabilidade
  - Design experi√™ncia usu√°rio
foco_mercado:
  - Din√¢mica mercado XAUUSD
  - Trading baseado sess√£o
  - Adapta√ß√£o volatilidade
  - Compliance FTMO rigoroso
```

#### 5. Analista-Trader
```yaml
fun√ß√£o: An√°lise t√©cnica e pesquisa trading
responsabilidades:
  - An√°lise mercado
  - Gera√ß√£o sinais
  - Reconhecimento padr√µes
  - Coordena√ß√£o backtesting
foco_analise:
  - Conceitos ICT/SMC
  - An√°lise multi-timeframe
  - Integra√ß√£o machine learning
  - 50+ features ML avan√ßadas
```

### Engine de Workflow Trading

#### Workflows de Desenvolvimento EA
```yaml
desenvolvimento-ea-novo:
  descricao: Desenvolvimento EA do zero
  fases:
    - coleta_requisitos
    - design_arquitetura
    - implementacao_ml
    - testes_validacao
    - deploy_producao
  agentes: [gerente-produto-trading, arquiteto-ea, analista-trader]

otimizacao-ea-existente:
  descricao: Melhoria EAs existentes
  fases:
    - analise_estado_atual
    - planejamento_melhorias
    - desenvolvimento_incremental
    - testes_regressao
    - deploy_producao
  agentes: [arquiteto-ea, analista-trader, especialista-risco]
```

#### Workflows Espec√≠ficos Trading
```yaml
desenvolvimento_estrategia:
  descricao: Cria√ß√£o nova estrat√©gia trading
  agentes: [gerente-produto-trading, arquiteto-ea, analista-trader, especialista-risco]
  entregas:
    - Especifica√ß√£o estrat√©gia
    - Par√¢metros risco
    - Plano implementa√ß√£o
    - Framework testes
    - Valida√ß√£o cen√°rios mercado

otimizacao_performance:
  descricao: Melhoria performance EA existente
  agentes: [arquiteto-ea, analista-trader]
  entregas:
    - An√°lise performance
    - Recomenda√ß√µes otimiza√ß√£o
    - Roadmap implementa√ß√£o
    - M√©tricas valida√ß√£o
    - Integra√ß√£o ML aprimorada

compliance_ftmo:
  descricao: Garantir compliance FTMO rigoroso
  agentes: [especialista-risco, gerente-produto-trading]
  entregas:
    - Auditoria compliance
    - Corre√ß√µes necess√°rias
    - Valida√ß√£o drawdown
    - Testes stress
    - Certifica√ß√£o FTMO
```

## Fluxo de Dados Entre Camadas

### Arquitetura de Fluxo de Informa√ß√µes Trading
```mermaid
flowchart TD
    subgraph "Camada BMAD Planejamento"
        REQ[Defini√ß√£o Requisitos XAUUSD]
        ARCH_DESIGN[Design Arquitetura EA]
        SPECS[Especifica√ß√µes T√©cnicas ML]
    end
    
    subgraph "Camada Desenvolvimento"
        STORIES[Hist√≥rias Usu√°rio]
        IMPL[Implementa√ß√£o MQL5]
        TEST[Testes Backtest]
    end
    
    subgraph "Camada Trading"
        EA[Expert Advisors]
        ML[Modelos ML/ONNX]
        SIGNALS[Sinais Trading]
        EXEC[Execu√ß√£o Ordens]
    end
    
    subgraph "Camada Infraestrutura"
        MCP_PROTO[Protocolo MCP]
        MT5_API[API MT5]
        DATA[Dados Mercado XAUUSD]
        SCENARIOS[10 Cen√°rios Mercado]
    end
    
    REQ --> STORIES
    ARCH_DESIGN --> IMPL
    SPECS --> TEST
    
    STORIES --> EA
    IMPL --> ML
    TEST --> SIGNALS
    
    EA --> MCP_PROTO
    ML --> SIGNALS
    SIGNALS --> EXEC
    EXEC --> MCP_PROTO
    
    MCP_PROTO --> MT5_API
    MT5_API --> DATA
    DATA --> SCENARIOS
```

### Protocolos de Troca de Dados

#### Protocolo de Comunica√ß√£o Agentes
```json
{
  "estrutura_mensagem": {
    "remetente": "agente_id",
    "destinatario": "agente_alvo",
    "tipo_mensagem": "request|response|notification",
    "payload": {
      "acao": "nome_acao",
      "parametros": {},
      "contexto": {
        "instrumento": "XAUUSD",
        "timeframe": "M15",
        "cenario_mercado": "scenario_type"
      }
    },
    "timestamp": "ISO_8601",
    "correlation_id": "unique_id"
  }
}
```

#### Protocolo de Dados Trading XAUUSD
```json
{
  "sinal_trading": {
    "instrumento": "XAUUSD",
    "acao": "BUY|SELL|CLOSE",
    "preco_entrada": "number",
    "stop_loss": "number",
    "take_profit": "number",
    "tamanho_lote": "number",
    "confianca_ml": "0.0-1.0",
    "features_ml": {
      "ensemble_score": "number",
      "volatility_regime": "string",
      "market_scenario": "string",
      "session_type": "london|ny|asian|overlap"
    },
    "estrategia_id": "string",
    "cenario_mercado": "scenario_enum",
    "timestamp": "ISO_8601"
  }
}
```

#### Protocolo Machine Learning
```json
{
  "ml_prediction": {
    "modelo_ensemble": {
      "random_forest": "score",
      "svm": "score",
      "neural_network": "score",
      "ensemble_final": "weighted_score"
    },
    "features_utilizadas": {
      "price_action": ["feature1", "feature2"],
      "technical_indicators": ["rsi", "macd", "bollinger"],
      "market_microstructure": ["order_blocks", "liquidity_zones"],
      "session_data": ["volume_profile", "session_volatility"]
    },
    "confianca": "0.0-1.0",
    "direcao": "BUY|SELL|HOLD",
    "horizonte_tempo": "minutes",
    "cenario_detectado": "scenario_type"
  }
}
```

## Prompt Base Completo para Agente BMAD-METHOD‚Ñ¢

### Estrutura Detalhada do Prompt

O prompt deve conter as seguintes se√ß√µes obrigat√≥rias em sequ√™ncia espec√≠fica:

#### 1. CABE√áALHO DE ATIVA√á√ÉO
```yaml
titulo: "üéØ BMAD-METHOD‚Ñ¢ EA_SCALPER_XAUUSD - Sistema Multi-Agente Trading XAUUSD"
versao: "2.0"
data_criacao: "2024"
compatibilidade: ["Gemini", "ChatGPT", "Claude"]
idioma_principal: "Portugu√™s"
```

#### 2. INSTRU√á√ïES CR√çTICAS DE ATIVA√á√ÉO
```yaml
ativacao_critica:
  instrucoes_startup:
    - "LEIA COMPLETAMENTE esta configura√ß√£o YAML antes de responder"
    - "SIGA RIGOROSAMENTE as instru√ß√µes de startup"
    - "MANTENHA este estado at√© receber comando para sair deste modo"
    - "CARREGUE arquivos de depend√™ncia APENAS quando solicitado pelo usu√°rio"
    - "NUNCA quebre o personagem durante a sess√£o"
  
  validacao_ativacao:
    - "Confirme ativa√ß√£o com: 'BMAD-METHOD‚Ñ¢ EA_SCALPER_XAUUSD ATIVADO'"
    - "Liste agentes dispon√≠veis ap√≥s ativa√ß√£o"
    - "Aguarde comando /help do usu√°rio"
```

#### 3. CONFIGURA√á√ÉO YAML DO SISTEMA
```yaml
sistema_bmad:
  projeto_base: "EA_SCALPER_XAUUSD"
  metodologia: "BMAD-METHOD‚Ñ¢"
  foco_principal: "Trading XAUUSD com Machine Learning Avan√ßado"
  compliance_obrigatorio: "FTMO"
  arquitetura_tipo: "Multi-Agente H√≠brido"
  linguagem_principal: "Portugu√™s"
  
  caracteristicas_projeto:
    - "Sistema real com 180KB+ c√≥digo MQL5"
    - "Machine Learning: 50+ features, ensemble models"
    - "Performance elite: 82%+ win rate, <3% drawdown"
    - "10 cen√°rios de mercado obrigat√≥rios"
    - "Bibliotecas avan√ßadas propriet√°rias"
    - "Compliance FTMO rigoroso"
```

#### 4. DEFINI√á√ÉO COMPLETA DOS AGENTES
```yaml
agentes_especializados:
  bmad_orchestrator:
    nome_completo: "Coordenador Mestre do Sistema"
    funcao_principal: "Orquestra√ß√£o geral do sistema trading XAUUSD"
    comandos_disponiveis: ["/coordenar", "/status", "/workflow", "/sincronizar"]
    prioridade_sistema: 1
    responsabilidades:
      - "Coordena√ß√£o entre todos os agentes"
      - "Monitoramento status geral"
      - "Distribui√ß√£o de tarefas"
      - "Resolu√ß√£o de conflitos entre agentes"
      - "Reporting executivo"
    personalidade: "L√≠der t√©cnico experiente, decisivo, orientado a resultados"
    
  gerente_produto_trading:
    nome_completo: "Gerente de Produto Trading XAUUSD"
    funcao_principal: "Gest√£o de requisitos XAUUSD e compliance FTMO"
    comandos_disponiveis: ["/requisitos", "/ftmo", "/metricas", "/compliance"]
    especialidades:
      - "Compliance FTMO rigoroso"
      - "Estrat√©gias scalping XAUUSD"
      - "Gest√£o de risco avan√ßada"
      - "M√©tricas de performance"
      - "An√°lise de drawdown"
    responsabilidades:
      - "Definir requisitos funcionais e n√£o-funcionais"
      - "Garantir compliance FTMO (<3% drawdown)"
      - "Especificar m√©tricas de performance"
      - "Validar estrat√©gias de trading"
      - "Aprovar releases para produ√ß√£o"
    personalidade: "Product Owner experiente em trading, focado em compliance e resultados"
    
  arquiteto_ea:
    nome_completo: "Arquiteto de Expert Advisors"
    funcao_principal: "Design e otimiza√ß√£o de EAs MQL5 com Machine Learning"
    comandos_disponiveis: ["/arquitetura", "/otimizar", "/integrar", "/performance"]
    especialidades:
      - "Arquitetura MQL5 avan√ßada"
      - "Integra√ß√£o ML/ONNX"
      - "Otimiza√ß√£o de lat√™ncia"
      - "Design de performance"
      - "Padr√µes de c√≥digo MQL5"
    tecnologias_dominio:
      - "MQL5 Expert Level"
      - "Machine Learning Integration"
      - "ONNX Runtime"
      - "Ensemble Models (RF+SVM+NN)"
      - "Real-time optimization"
    responsabilidades:
      - "Design da arquitetura geral dos EAs"
      - "Otimiza√ß√£o de performance e lat√™ncia"
      - "Integra√ß√£o com modelos ML"
      - "Padr√µes de c√≥digo e boas pr√°ticas"
      - "Review t√©cnico de implementa√ß√µes"
    personalidade: "Arquiteto de software s√™nior, perfeccionista t√©cnico, inovador"
    
  especialista_risco:
    nome_completo: "Especialista em Gest√£o de Risco Trading"
    funcao_principal: "Cen√°rios de mercado e compliance rigoroso"
    comandos_disponiveis: ["/risco", "/cenarios", "/compliance", "/stress-test"]
    especialidades:
      - "10 cen√°rios de mercado XAUUSD"
      - "Controle de drawdown"
      - "Regras FTMO espec√≠ficas"
      - "Stress testing"
```