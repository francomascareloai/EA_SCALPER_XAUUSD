//@version=5
library("Drawing Library", overlay=true)

// Exported function: Draw horizontal line with label
export draw_hline_with_label(float level, string label, color lineColor, int linestyle, string location) =>
    hline(level, label, lineColor, linestyle)
    var label lbl = na
    if (bar_index == last_bar_index)
        lbl := label.new(
            x=location == "left" ? bar_index - 100 : bar_index,
            y=level,
            text=label,
            color=lineColor,
            textcolor=color.white,
            style=label.style_label_left,
            yloc=yloc.price
        )

// Exported function: Draw Fibonacci retracement levels
export draw_fibonacci(float highPrice, float lowPrice) =>
    range = highPrice - lowPrice
    fib_236 = lowPrice + range * 0.236
    fib_382 = lowPrice + range * 0.382
    fib_500 = lowPrice + range * 0.500
    fib_618 = lowPrice + range * 0.618
    fib_786 = lowPrice + range * 0.786
    
    // Draw levels
    hline(fib_236, "23.6%", color.new(color.blue, 50), hline.style_dotted)
    hline(fib_382, "38.2%", color.new(color.blue, 50), hline.style_dotted)
    hline(fib_500, "50.0%", color.new(color.blue, 50), hline.style_dotted)
    hline(fib_618, "61.8%", color.new(color.blue, 50), hline.style_dotted)
    hline(fib_786, "78.6%", color.new(color.blue, 50), hline.style_dotted)
    
    [fib_236, fib_382, fib_500, fib_618, fib_786]

// Exported function: Draw support and resistance levels
export draw_support_resistance(float support, float resistance) =>
    hline(support, "Support", color.green, hline.style_solid)
    hline(resistance, "Resistance", color.red, hline.style_solid)

// Exported function: Draw price channel
export draw_price_channel(float upperChannel, float lowerChannel) =>
    hline(upperChannel, "Upper Channel", color.new(color.blue, 50), hline.style_dashed)
    hline(lowerChannel, "Lower Channel", color.new(color.blue, 50), hline.style_dashed)